!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.levelgraphJSONLD=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var jsonld=require("jsonld"),uuid=require("uuid"),RDFTYPE="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",RDFLANGSTRING="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",XSDTYPE="http://www.w3.org/2001/XMLSchema#",async=require("async"),N3Util=require("n3/lib/N3Util");function levelgraphJSONLD(db,jsonldOpts){if(db.jsonld){return db}var graphdb=Object.create(db);jsonldOpts=jsonldOpts||{};jsonldOpts.base=jsonldOpts.base||"";graphdb.jsonld={options:jsonldOpts};function doPut(obj,options,callback){var blanks={};jsonld.toRDF(obj,options,function(err,triples){var stream=graphdb.putStream();stream.on("error",callback);stream.on("close",function(){callback(null,obj)});triples["@default"].map(function(triple){return["subject","predicate","object"].reduce(function(acc,key){var node=triple[key];if(node.type==="blank node"){if(!blanks[node.value]){blanks[node.value]="_:"+uuid.v1()}node.value=blanks[node.value]}if(key==="object"&&triple.object.datatype){if(triple.object.datatype.match(XSDTYPE)){if(triple.object.datatype==="http://www.w3.org/2001/XMLSchema#string"){node.value='"'+triple.object.value+'"'}else{node.value='"'+triple.object.value+'"^^<'+triple.object.datatype+">"}}else if(triple.object.datatype.match(RDFLANGSTRING)){node.value='"'+triple.object.value+'"@'+triple.object.language}}acc[key]=node.value;return acc},{})}).forEach(function(triple){stream.write(triple)});stream.end()})}graphdb.jsonld.put=function(obj,options,callback){if(typeof obj==="string"){obj=JSON.parse(obj)}if(typeof options==="function"){callback=options;options={}}options.base=options.base||this.options.base;if(obj["@id"]){graphdb.jsonld.del(obj["@id"],options,function(err){if(err){return callback&&callback(err)}doPut(obj,options,callback)})}else{obj["@id"]=options.base+uuid.v1();doPut(obj,options,callback)}};graphdb.jsonld.del=function(iri,options,callback){if(typeof options==="function"){callback=options;options={}}if(typeof iri!=="string"){iri=iri["@id"]}var stream=graphdb.delStream();stream.on("close",callback);stream.on("error",callback);(function delAllTriples(iri,done){graphdb.get({subject:iri},function(err,triples){async.each(triples,function(triple,cb){stream.write(triple);if(triple.object.indexOf("_:")===0){delAllTriples(triple.object,cb)}else{cb()}},done)})})(iri,function(err){if(err){return callback(err)}stream.end()})};function getCoercedObject(object){var TYPES={PLAIN:"http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral",BOOLEAN:XSDTYPE+"boolean",INTEGER:XSDTYPE+"integer",DOUBLE:XSDTYPE+"double",STRING:XSDTYPE+"string"};var value=N3Util.getLiteralValue(object);var type=N3Util.getLiteralType(object);var coerced={};switch(type){case TYPES.STRING:case TYPES.PLAIN:case RDFLANGSTRING:coerced["@value"]=value;break;case TYPES.INTEGER:coerced["@value"]=parseInt(value,10);break;case TYPES.DOUBLE:coerced["@value"]=parseFloat(value);break;case TYPES.BOOLEAN:if(value==="true"||value==="1"){coerced["@value"]=true}else if(value==="false"||value==="0"){coerced["@value"]=false}else{throw new Error("value not boolean!")}break;default:coerced={"@value":value,"@type":type}}return coerced}function fetchExpandedTriples(iri,memo,callback){if(typeof memo==="function"){callback=memo;memo={}}graphdb.get({subject:iri},function(err,triples){if(err||triples.length===0){return callback(err,null)}async.reduce(triples,memo,function(acc,triple,cb){var key;if(!acc[triple.subject]){acc[triple.subject]={"@id":triple.subject}}if(triple.predicate===RDFTYPE){if(acc[triple.subject]["@type"]){acc[triple.subject]["@type"]=[acc[triple.subject]["@type"]];acc[triple.subject]["@type"].push(triple.object)}else{acc[triple.subject]["@type"]=triple.object}cb(null,acc)}else if(!N3Util.isBlank(triple.object)){var object={};if(N3Util.isUri(triple.object)){object["@id"]=triple.object}else if(N3Util.isLiteral(triple.object)){object=getCoercedObject(triple.object);var language=N3Util.getLiteralLanguage(triple.object);if(language){object["@language"]=language}}acc[triple.subject][triple.predicate]=object;cb(null,acc)}else{fetchExpandedTriples(triple.object,function(err,expanded){if(!acc[triple.subject][triple.predicate]){acc[triple.subject][triple.predicate]=expanded[triple.object]}else{if(!acc[triple.subject][triple.predicate].push){acc[triple.subject][triple.predicate]=[acc[triple.subject][triple.predicate]]}acc[triple.subject][triple.predicate].push(expanded[triple.object])}cb(err,acc)})}},callback)})}graphdb.jsonld.get=function(iri,context,options,callback){if(typeof options==="function"){callback=options;options={}}fetchExpandedTriples(iri,function(err,expanded){if(err||expanded===null){return callback(err,expanded)}jsonld.compact(expanded[iri],context,options,callback)})};return graphdb}module.exports=levelgraphJSONLD},{async:2,jsonld:41,"n3/lib/N3Util":98,uuid:100}],2:[function(require,module,exports){var process=require("__browserify_process");(function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){var called=false;return function(){if(called)throw new Error("Callback was already called.");called=true;fn.apply(root,arguments)}}var _each=function(arr,iterator){if(arr.forEach){return arr.forEach(iterator)}for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr)}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator)}var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a))});return results};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo)}_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo};var _keys=function(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){async.nextTick=function(fn){setImmediate(fn)};async.setImmediate=async.nextTick}else{async.nextTick=function(fn){setTimeout(fn,0)};async.setImmediate=async.nextTick}}else{async.nextTick=process.nextTick;if(typeof setImmediate!=="undefined"){async.setImmediate=setImmediate}else{async.setImmediate=async.nextTick}}async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;_each(arr,function(x){iterator(x,only_once(function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback(null)}}}))})};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;var iterate=function(){iterator(arr[completed],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback(null)}else{iterate()}}})};iterate()};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback()}var completed=0;var started=0;var running=0;(function replenish(){if(completed>=arr.length){return callback()}while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;running-=1;if(completed>=arr.length){callback()}else{replenish()}}})}})()}};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}};var _asyncMap=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err)})},function(err){callback(err,results)})};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){}}else{callback()}})},function(err){main_callback()})};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){}}callback()})},function(err){main_callback(false)})};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){}}callback()})},function(err){main_callback(true)})};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))}})};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);if(!keys.length){return callback(null)}var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn)};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return}}};var taskComplete=function(){_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(_keys(results).length===keys.length){callback(null,results);callback=function(){}}});_each(keys,function(k){var task=tasks[k]instanceof Function?[tasks[k]]:tasks[k];var taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}if(err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]});safeResults[k]=args;callback(err,safeResults);callback=function(){}}else{results[k]=args;async.setImmediate(taskComplete)}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)};if(ready()){task[task.length-1](taskCallback,results)}else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results)}};addListener(listener)}})};async.waterfall=function(tasks,callback){callback=callback||function(){};if(tasks.constructor!==Array){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length){return callback()}var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)};async.series=function(tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){async.mapSeries(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()};fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn};return makeCallback(0)};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){iterator(function(err){if(err){return callback(err)}async.whilst(test,iterator,callback)})}else{callback()}};async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}if(test()){async.doWhilst(iterator,test,callback)}else{callback()}})};async.until=function(test,iterator,callback){if(!test()){iterator(function(err){if(err){return callback(err)}async.until(test,iterator,callback)})}else{callback()}};async.doUntil=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}if(!test()){async.doUntil(iterator,test,callback)}else{callback()}})};async.queue=function(worker,concurrency){if(concurrency===undefined){concurrency=1}function _insert(q,data,pos,callback){if(data.constructor!==Array){data=[data]}_each(data,function(task){var item={data:task,callback:typeof callback==="function"?callback:null};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.saturated&&q.tasks.length===concurrency){q.saturated()}async.setImmediate(q.process)})}var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,push:function(data,callback){_insert(q,data,false,callback)},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){if(workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}workers+=1;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments)}if(q.drain&&q.tasks.length+workers===0){q.drain()}q.process()};var cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers}};return q};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,push:function(data,callback){if(data.constructor!==Array){data=[data]}_each(data,function(task){tasks.push({data:task,callback:typeof callback==="function"?callback:null});if(cargo.saturated&&tasks.length===payload){cargo.saturated()}});async.setImmediate(cargo.process)},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain)cargo.drain();return}var ts=typeof payload==="number"?tasks.splice(0,payload):tasks.splice(0);var ds=_map(ts,function(task){return task.data});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args)}});process()})},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(err){if(console.error){console.error(err)}}else if(console[name]){_each(args,function(x){console[name](x)})}}}]))}};async.log=_console_fn("log");async.dir=_console_fn("dir");async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){callback.apply(null,memo[key])}else if(key in queues){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.map(counter,iterator,callback)};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.mapSeries(counter,iterator,callback)};async.compose=function(){var fns=Array.prototype.reverse.call(arguments);return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};var _applyEach=function(eachfn,fns){var go=function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}else{return go}};async.applyEach=doParallel(_applyEach);async.applyEachSeries=doSeries(_applyEach);async.forever=function(fn,callback){function next(err){if(err){if(callback){return callback(err)}throw err}fn(next)}next()};if(typeof define!=="undefined"&&define.amd){define([],function(){return async})}else if(typeof module!=="undefined"&&module.exports){module.exports=async}else{root.async=async}})()},{__browserify_process:20}],3:[function(require,module,exports){},{}],4:[function(require,module,exports){var util=require("util/");var pSlice=Array.prototype.slice;var hasOwn=Object.prototype.hasOwnProperty;var assert=module.exports=ok;assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=stackStartFunction.name;var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function replacer(key,value){if(util.isUndefined(value)){return""+value}if(util.isNumber(value)&&(isNaN(value)||!isFinite(value))){return value.toString()}if(util.isFunction(value)||util.isRegExp(value)){return value.toString()}return value}function truncate(s,n){if(util.isString(s)){return s.length<n?s:s.slice(0,n)}else{return s}}function getMessage(self){return truncate(JSON.stringify(self.actual,replacer),128)+" "+self.operator+" "+truncate(JSON.stringify(self.expected,replacer),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};function _deepEqual(actual,expected){if(actual===expected){return true}else if(util.isBuffer(actual)&&util.isBuffer(expected)){if(actual.length!=expected.length)return false;for(var i=0;i<actual.length;i++){if(actual[i]!==expected[i])return false}return true}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if(!util.isObject(actual)&&!util.isObject(expected)){return actual==expected}else{return objEquiv(actual,expected)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b){if(util.isNullOrUndefined(a)||util.isNullOrUndefined(b))return false;if(a.prototype!==b.prototype)return false;if(isArguments(a)){if(!isArguments(b)){return false}a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b)}try{var ka=objectKeys(a),kb=objectKeys(b),key,i}catch(e){return false}if(ka.length!=kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key]))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}else if(actual instanceof expected){return true}else if(expected.call({},actual)===true){return true}return false}function _throws(shouldThrow,block,expected,message){var actual;if(util.isString(expected)){message=expected;expected=null}try{block()}catch(e){actual=e}message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}if(!shouldThrow&&expectedException(actual,expected)){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws.apply(this,[true].concat(pSlice.call(arguments)))};assert.doesNotThrow=function(block,message){_throws.apply(this,[false].concat(pSlice.call(arguments)))};assert.ifError=function(err){if(err){throw err}};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}return keys}},{"util/":39}],5:[function(require,module,exports){module.exports=require(3)},{}],6:[function(require,module,exports){var Buffer=require("buffer").Buffer;var intSize=4;var zeroBuffer=new Buffer(intSize);zeroBuffer.fill(0);var chrsz=8;function toArray(buf,bigEndian){if(buf.length%intSize!==0){var len=buf.length+(intSize-buf.length%intSize);buf=Buffer.concat([buf,zeroBuffer],len)}var arr=[];var fn=bigEndian?buf.readInt32BE:buf.readInt32LE;for(var i=0;i<buf.length;i+=intSize){arr.push(fn.call(buf,i))}return arr}function toBuffer(arr,size,bigEndian){var buf=new Buffer(size);var fn=bigEndian?buf.writeInt32BE:buf.writeInt32LE;for(var i=0;i<arr.length;i++){fn.call(buf,arr[i],i*4,true)}return buf}function hash(buf,fn,hashSize,bigEndian){if(!Buffer.isBuffer(buf))buf=new Buffer(buf);var arr=fn(toArray(buf,bigEndian),buf.length*chrsz);return toBuffer(arr,hashSize,bigEndian)}module.exports={hash:hash}},{buffer:21}],7:[function(require,module,exports){var Buffer=require("buffer").Buffer;var sha=require("./sha");var sha256=require("./sha256");var rng=require("./rng");var md5=require("./md5");var algorithms={sha1:sha,sha256:sha256,md5:md5};var blocksize=64;var zeroBuffer=new Buffer(blocksize);zeroBuffer.fill(0);function hmac(fn,key,data){if(!Buffer.isBuffer(key))key=new Buffer(key);if(!Buffer.isBuffer(data))data=new Buffer(data);if(key.length>blocksize){key=fn(key)}else if(key.length<blocksize){key=Buffer.concat([key,zeroBuffer],blocksize)}var ipad=new Buffer(blocksize),opad=new Buffer(blocksize);for(var i=0;i<blocksize;i++){ipad[i]=key[i]^54;opad[i]=key[i]^92}var hash=fn(Buffer.concat([ipad,data]));return fn(Buffer.concat([opad,hash]))}function hash(alg,key){alg=alg||"sha1";var fn=algorithms[alg];var bufs=[];var length=0;if(!fn)error("algorithm:",alg,"is not yet supported");return{update:function(data){if(!Buffer.isBuffer(data))data=new Buffer(data);bufs.push(data);length+=data.length;return this},digest:function(enc){var buf=Buffer.concat(bufs);var r=key?hmac(fn,key,buf):fn(buf);bufs=null;return enc?r.toString(enc):r}}}function error(){var m=[].slice.call(arguments).join(" ");throw new Error([m,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}exports.createHash=function(alg){return hash(alg)};exports.createHmac=function(alg,key){return hash(alg,key)};exports.randomBytes=function(size,callback){if(callback&&callback.call){try{callback.call(this,undefined,new Buffer(rng(size)))}catch(err){callback(err)}}else{return new Buffer(rng(size))}};function each(a,f){for(var i in a)f(a[i],i)}each(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(name){exports[name]=function(){error("sorry,",name,"is not implemented yet")}})},{"./md5":8,"./rng":9,"./sha":10,"./sha256":11,buffer:21}],8:[function(require,module,exports){var helpers=require("./helpers");function md5_vm_test(){return hex_md5("abc")=="900150983cd24fb0d6963f7d28e17f72"}function core_md5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)
}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}module.exports=function md5(buf){return helpers.hash(buf,core_md5,16)}},{"./helpers":6}],9:[function(require,module,exports){(function(){var _global=this;var mathRNG,whatwgRNG;mathRNG=function(size){var bytes=new Array(size);var r;for(var i=0,r;i<size;i++){if((i&3)==0)r=Math.random()*4294967296;bytes[i]=r>>>((i&3)<<3)&255}return bytes};if(_global.crypto&&crypto.getRandomValues){whatwgRNG=function(size){var bytes=new Uint8Array(size);crypto.getRandomValues(bytes);return bytes}}module.exports=whatwgRNG||mathRNG})()},{}],10:[function(require,module,exports){var helpers=require("./helpers");function core_sha1(x,len){x[len>>5]|=128<<24-len%32;x[(len+64>>9<<4)+15]=len;var w=Array(80);var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;var olde=e;for(var j=0;j<80;j++){if(j<16)w[j]=x[i+j];else w[j]=rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);var t=safe_add(safe_add(rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w[j]),sha1_kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t}a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);e=safe_add(e,olde)}return Array(a,b,c,d,e)}function sha1_ft(t,b,c,d){if(t<20)return b&c|~b&d;if(t<40)return b^c^d;if(t<60)return b&c|b&d|c&d;return b^c^d}function sha1_kt(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function rol(num,cnt){return num<<cnt|num>>>32-cnt}module.exports=function sha1(buf){return helpers.hash(buf,core_sha1,20,true)}},{"./helpers":6}],11:[function(require,module,exports){var helpers=require("./helpers");var safe_add=function(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535};var S=function(X,n){return X>>>n|X<<32-n};var R=function(X,n){return X>>>n};var Ch=function(x,y,z){return x&y^~x&z};var Maj=function(x,y,z){return x&y^x&z^y&z};var Sigma0256=function(x){return S(x,2)^S(x,13)^S(x,22)};var Sigma1256=function(x){return S(x,6)^S(x,11)^S(x,25)};var Gamma0256=function(x){return S(x,7)^S(x,18)^R(x,3)};var Gamma1256=function(x){return S(x,17)^S(x,19)^R(x,10)};var core_sha256=function(m,l){var K=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298);var HASH=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225);var W=new Array(64);var a,b,c,d,e,f,g,h,i,j;var T1,T2;m[l>>5]|=128<<24-l%32;m[(l+64>>9<<4)+15]=l;for(var i=0;i<m.length;i+=16){a=HASH[0];b=HASH[1];c=HASH[2];d=HASH[3];e=HASH[4];f=HASH[5];g=HASH[6];h=HASH[7];for(var j=0;j<64;j++){if(j<16){W[j]=m[j+i]}else{W[j]=safe_add(safe_add(safe_add(Gamma1256(W[j-2]),W[j-7]),Gamma0256(W[j-15])),W[j-16])}T1=safe_add(safe_add(safe_add(safe_add(h,Sigma1256(e)),Ch(e,f,g)),K[j]),W[j]);T2=safe_add(Sigma0256(a),Maj(a,b,c));h=g;g=f;f=e;e=safe_add(d,T1);d=c;c=b;b=a;a=safe_add(T1,T2)}HASH[0]=safe_add(a,HASH[0]);HASH[1]=safe_add(b,HASH[1]);HASH[2]=safe_add(c,HASH[2]);HASH[3]=safe_add(d,HASH[3]);HASH[4]=safe_add(e,HASH[4]);HASH[5]=safe_add(f,HASH[5]);HASH[6]=safe_add(g,HASH[6]);HASH[7]=safe_add(h,HASH[7])}return HASH};module.exports=function sha256(buf){return helpers.hash(buf,core_sha256,32,true)}},{"./helpers":6}],12:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{throw TypeError('Uncaught, unspecified "error" event.')}return false}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);console.trace()}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],13:[function(require,module,exports){var http=module.exports;var EventEmitter=require("events").EventEmitter;var Request=require("./lib/request");var url=require("url");http.request=function(params,cb){if(typeof params==="string"){params=url.parse(params)}if(!params)params={};if(!params.host&&!params.port){params.port=parseInt(window.location.port,10)}if(!params.host&&params.hostname){params.host=params.hostname}if(!params.scheme)params.scheme=window.location.protocol.split(":")[0];if(!params.host){params.host=window.location.hostname||window.location.host}if(/:/.test(params.host)){if(!params.port){params.port=params.host.split(":")[1]}params.host=params.host.split(":")[0]}if(!params.port)params.port=params.scheme=="https"?443:80;var req=new Request(new xhrHttp,params);if(cb)req.on("response",cb);return req};http.get=function(params,cb){params.method="GET";var req=http.request(params,cb);req.end();return req};http.Agent=function(){};http.Agent.defaultMaxSockets=4;var xhrHttp=function(){if(typeof window==="undefined"){throw new Error("no window object present")}else if(window.XMLHttpRequest){return window.XMLHttpRequest}else if(window.ActiveXObject){var axs=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];for(var i=0;i<axs.length;i++){try{var ax=new window.ActiveXObject(axs[i]);return function(){if(ax){var ax_=ax;ax=null;return ax_}else{return new window.ActiveXObject(axs[i])}}}catch(e){}}throw new Error("ajax not supported in this browser")}else{throw new Error("ajax not supported in this browser")}}()},{"./lib/request":14,events:12,url:37}],14:[function(require,module,exports){var Stream=require("stream");var Response=require("./response");var Base64=require("Base64");var inherits=require("inherits");var Request=module.exports=function(xhr,params){var self=this;self.writable=true;self.xhr=xhr;self.body=[];self.uri=(params.scheme||"http")+"://"+params.host+(params.port?":"+params.port:"")+(params.path||"/");try{xhr.withCredentials=true}catch(e){}xhr.open(params.method||"GET",self.uri,true);if(params.headers){var keys=objectKeys(params.headers);for(var i=0;i<keys.length;i++){var key=keys[i];if(!self.isSafeRequestHeader(key))continue;var value=params.headers[key];if(isArray(value)){for(var j=0;j<value.length;j++){xhr.setRequestHeader(key,value[j])}}else xhr.setRequestHeader(key,value)}}if(params.auth){this.setHeader("Authorization","Basic "+Base64.btoa(params.auth))}var res=new Response;res.on("close",function(){self.emit("close")});res.on("ready",function(){self.emit("response",res)});xhr.onreadystatechange=function(){res.handle(xhr)}};inherits(Request,Stream);Request.prototype.setHeader=function(key,value){if(isArray(value)){for(var i=0;i<value.length;i++){this.xhr.setRequestHeader(key,value[i])}}else{this.xhr.setRequestHeader(key,value)}};Request.prototype.write=function(s){this.body.push(s)};Request.prototype.destroy=function(s){this.xhr.abort();this.emit("close")};Request.prototype.end=function(s){if(s!==undefined)this.body.push(s);if(this.body.length===0){this.xhr.send("")}else if(typeof this.body[0]==="string"){this.xhr.send(this.body.join(""))}else if(isArray(this.body[0])){var body=[];for(var i=0;i<this.body.length;i++){body.push.apply(body,this.body[i])}this.xhr.send(body)}else if(/Array/.test(Object.prototype.toString.call(this.body[0]))){var len=0;for(var i=0;i<this.body.length;i++){len+=this.body[i].length}var body=new this.body[0].constructor(len);var k=0;for(var i=0;i<this.body.length;i++){var b=this.body[i];for(var j=0;j<b.length;j++){body[k++]=b[j]}}this.xhr.send(body)}else{var body="";for(var i=0;i<this.body.length;i++){body+=this.body[i].toString()}this.xhr.send(body)}};Request.unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];Request.prototype.isSafeRequestHeader=function(headerName){if(!headerName)return false;return indexOf(Request.unsafeHeaders,headerName.toLowerCase())===-1};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};var indexOf=function(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++){if(xs[i]===x)return i}return-1}},{"./response":15,Base64:16,inherits:18,stream:30}],15:[function(require,module,exports){var Stream=require("stream");var util=require("util");var Response=module.exports=function(res){this.offset=0;this.readable=true};util.inherits(Response,Stream);var capable={streaming:true,status2:true};function parseHeaders(res){var lines=res.getAllResponseHeaders().split(/\r?\n/);var headers={};for(var i=0;i<lines.length;i++){var line=lines[i];if(line==="")continue;var m=line.match(/^([^:]+):\s*(.*)/);if(m){var key=m[1].toLowerCase(),value=m[2];if(headers[key]!==undefined){if(isArray(headers[key])){headers[key].push(value)}else{headers[key]=[headers[key],value]}}else{headers[key]=value}}else{headers[line]=true}}return headers}Response.prototype.getResponse=function(xhr){var respType=String(xhr.responseType).toLowerCase();if(respType==="blob")return xhr.responseBlob||xhr.response;if(respType==="arraybuffer")return xhr.response;return xhr.responseText};Response.prototype.getHeader=function(key){return this.headers[key.toLowerCase()]};Response.prototype.handle=function(res){if(res.readyState===2&&capable.status2){try{this.statusCode=res.status;this.headers=parseHeaders(res)}catch(err){capable.status2=false}if(capable.status2){this.emit("ready")}}else if(capable.streaming&&res.readyState===3){try{if(!this.statusCode){this.statusCode=res.status;this.headers=parseHeaders(res);this.emit("ready")}}catch(err){}try{this._emitData(res)}catch(err){capable.streaming=false}}else if(res.readyState===4){if(!this.statusCode){this.statusCode=res.status;this.emit("ready")}this._emitData(res);if(res.error){this.emit("error",this.getResponse(res))}else this.emit("end");this.emit("close")}};Response.prototype._emitData=function(res){var respBody=this.getResponse(res);if(respBody.toString().match(/ArrayBuffer/)){this.emit("data",new Uint8Array(respBody,this.offset));this.offset=respBody.byteLength;return}if(respBody.length>this.offset){this.emit("data",respBody.slice(this.offset));this.offset=respBody.length}};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{stream:30,util:39}],16:[function(require,module,exports){(function(){var object=typeof exports!="undefined"?exports:this;var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function InvalidCharacterError(message){this.message=message}InvalidCharacterError.prototype=new Error;InvalidCharacterError.prototype.name="InvalidCharacterError";object.btoa||(object.btoa=function(input){for(var block,charCode,idx=0,map=chars,output="";input.charAt(idx|0)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8)){charCode=input.charCodeAt(idx+=3/4);if(charCode>255){throw new InvalidCharacterError("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.")}block=block<<8|charCode}return output});object.atob||(object.atob=function(input){input=input.replace(/=+$/,"");if(input.length%4==1){throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.")}for(var bc=0,bs,buffer,idx=0,output="";buffer=input.charAt(idx++);~buffer&&(bs=bc%4?bs*64+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0){buffer=chars.indexOf(buffer)}return output})})()},{}],17:[function(require,module,exports){var http=require("http");var https=module.exports;for(var key in http){if(http.hasOwnProperty(key))https[key]=http[key]}https.request=function(params,cb){if(!params)params={};params.scheme="https";return http.request.call(this,params,cb)}},{http:13}],18:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],19:[function(require,module,exports){require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({PcZj9L:[function(require,module,exports){var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=Buffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var browserSupport=function(){if(typeof Uint8Array==="undefined"||typeof ArrayBuffer==="undefined"||typeof DataView==="undefined")return false;try{var arr=new Uint8Array(0);arr.foo=function(){return 42};return 42===arr.foo()}catch(e){return false}}();function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var type=typeof subject;if(encoding==="base64"&&type==="string"){subject=stringtrim(subject);while(subject.length%4!==0){subject=subject+"="}}var length;if(type==="number")length=coerce(subject);else if(type==="string")length=Buffer.byteLength(subject,encoding);else if(type==="object")length=coerce(subject.length);else throw new Error("First argument needs to be a number, array or string.");var buf;if(browserSupport){buf=augment(new Uint8Array(length))}else{buf=this;buf.length=length}var i;if(Buffer.isBuffer(subject)){buf.set(subject)}else if(isArrayish(subject)){for(i=0;i<length;i++){if(Buffer.isBuffer(subject))buf[i]=subject.readUInt8(i);else buf[i]=subject[i]}}else if(type==="string"){buf.write(subject,0,encoding)}else if(type==="number"&&!browserSupport&&!noZero){for(i=0;i<length;i++){buf[i]=0}}return buf}Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":return true;default:return false}};Buffer.isBuffer=function(b){return b&&b._isBuffer};Buffer.byteLength=function(str,encoding){switch(encoding||"utf8"){case"hex":return str.length/2;case"utf8":case"utf-8":return utf8ToBytes(str).length;case"ascii":case"binary":return str.length;case"base64":return base64ToBytes(str).length;default:throw new Error("Unknown encoding")}};Buffer.concat=function(list,totalLength){if(!isArray(list)){throw new Error("Usage: Buffer.concat(list, [totalLength])\n"+"list should be an Array.")}if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(typeof totalLength!=="number"){totalLength=0;for(i=0;i<list.length;i++){totalLength+=list[i].length}}var buf=new Buffer(totalLength);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};function _hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0){throw new Error("Invalid hex string")}if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");buf[offset+i]=byte}Buffer._charsWritten=i*2;return i}function _utf8Write(buf,string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length)}function _asciiWrite(buf,string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length)}function _binaryWrite(buf,string,offset,length){return _asciiWrite(buf,string,offset,length)}function _base64Write(buf,string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length)}Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=Number(offset)||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();switch(encoding){case"hex":return _hexWrite(this,string,offset,length);case"utf8":case"utf-8":return _utf8Write(this,string,offset,length);case"ascii":return _asciiWrite(this,string,offset,length);case"binary":return _binaryWrite(this,string,offset,length);case"base64":return _base64Write(this,string,offset,length);default:throw new Error("Unknown encoding")}};Buffer.prototype.toString=function(encoding,start,end){var self=this;encoding=String(encoding||"utf8").toLowerCase();start=Number(start)||0;end=end!==undefined?Number(end):end=self.length;if(end===start)return"";switch(encoding){case"hex":return _hexSlice(self,start,end);case"utf8":case"utf-8":return _utf8Slice(self,start,end);case"ascii":return _asciiSlice(self,start,end);case"binary":return _binarySlice(self,start,end);case"base64":return _base64Slice(self,start,end);default:throw new Error("Unknown encoding")}};Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(!start)start=0;if(!end&&end!==0)end=this.length;if(!target_start)target_start=0;if(end===start)return;if(target.length===0||source.length===0)return;if(end<start)throw new Error("sourceEnd < sourceStart");if(target_start<0||target_start>=target.length)throw new Error("targetStart out of bounds");if(start<0||start>=source.length)throw new Error("sourceStart out of bounds");if(end<0||end>source.length)throw new Error("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-target_start<end-start)end=target.length-target_start+start;for(var i=0;i<end-start;i++)target[i+target_start]=this[i+start]};function _base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function _utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function _asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++)ret+=String.fromCharCode(buf[i]);return ret}function _binarySlice(buf,start,end){return _asciiSlice(buf,start,end)}function _hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}Buffer.prototype.slice=function(start,end){var len=this.length;start=clamp(start,len,0);end=clamp(end,len,len);if(browserSupport){return augment(this.subarray(start,end))}else{var sliceLen=end-start;var newBuf=new Buffer(sliceLen,undefined,true);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}return newBuf}};Buffer.prototype.readUInt8=function(offset,noAssert){var buf=this;if(!noAssert){assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"Trying to read beyond buffer length")}if(offset>=buf.length)return;return buf[offset]};function _readUInt16(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;if(browserSupport){if(offset+1<len){return buf._dataview.getUint16(offset,littleEndian)}else{var dv=new DataView(new ArrayBuffer(2));dv.setUint8(0,buf[len-1]);return dv.getUint16(0,littleEndian)}}else{var val;if(littleEndian){val=buf[offset];if(offset+1<len)val|=buf[offset+1]<<8}else{val=buf[offset]<<8;if(offset+1<len)val|=buf[offset+1]}return val}}Buffer.prototype.readUInt16LE=function(offset,noAssert){return _readUInt16(this,offset,true,noAssert)};Buffer.prototype.readUInt16BE=function(offset,noAssert){return _readUInt16(this,offset,false,noAssert)};function _readUInt32(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;if(browserSupport){if(offset+3<len){return buf._dataview.getUint32(offset,littleEndian)}else{var dv=new DataView(new ArrayBuffer(4));for(var i=0;i+offset<len;i++){dv.setUint8(i,buf[i+offset])}return dv.getUint32(0,littleEndian)}}else{var val;if(littleEndian){if(offset+2<len)val=buf[offset+2]<<16;if(offset+1<len)val|=buf[offset+1]<<8;val|=buf[offset];if(offset+3<len)val=val+(buf[offset+3]<<24>>>0)}else{if(offset+1<len)val=buf[offset+1]<<16;if(offset+2<len)val|=buf[offset+2]<<8;if(offset+3<len)val|=buf[offset+3];val=val+(buf[offset]<<24>>>0)}return val}}Buffer.prototype.readUInt32LE=function(offset,noAssert){return _readUInt32(this,offset,true,noAssert)};Buffer.prototype.readUInt32BE=function(offset,noAssert){return _readUInt32(this,offset,false,noAssert)};Buffer.prototype.readInt8=function(offset,noAssert){var buf=this;if(!noAssert){assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"Trying to read beyond buffer length")}if(offset>=buf.length)return;if(browserSupport){return buf._dataview.getInt8(offset)}else{var neg=buf[offset]&128;if(neg)return(255-buf[offset]+1)*-1;else return buf[offset]}};function _readInt16(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;if(browserSupport){if(offset+1===len){var dv=new DataView(new ArrayBuffer(2));dv.setUint8(0,buf[len-1]);return dv.getInt16(0,littleEndian)}else{return buf._dataview.getInt16(offset,littleEndian)}}else{var val=_readUInt16(buf,offset,littleEndian,true);var neg=val&32768;if(neg)return(65535-val+1)*-1;else return val}}Buffer.prototype.readInt16LE=function(offset,noAssert){return _readInt16(this,offset,true,noAssert)};Buffer.prototype.readInt16BE=function(offset,noAssert){return _readInt16(this,offset,false,noAssert)};function _readInt32(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;if(browserSupport){if(offset+3>=len){var dv=new DataView(new ArrayBuffer(4));for(var i=0;i+offset<len;i++){dv.setUint8(i,buf[i+offset])}return dv.getInt32(0,littleEndian)}else{return buf._dataview.getInt32(offset,littleEndian)}}else{var val=_readUInt32(buf,offset,littleEndian,true);var neg=val&2147483648;if(neg)return(4294967295-val+1)*-1;else return val}}Buffer.prototype.readInt32LE=function(offset,noAssert){return _readInt32(this,offset,true,noAssert)};Buffer.prototype.readInt32BE=function(offset,noAssert){return _readInt32(this,offset,false,noAssert)};function _readFloat(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset+3<buf.length,"Trying to read beyond buffer length")}if(browserSupport){return buf._dataview.getFloat32(offset,littleEndian)}else{return ieee754.read(buf,offset,littleEndian,23,4)}}Buffer.prototype.readFloatLE=function(offset,noAssert){return _readFloat(this,offset,true,noAssert)};Buffer.prototype.readFloatBE=function(offset,noAssert){return _readFloat(this,offset,false,noAssert)};function _readDouble(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset+7<buf.length,"Trying to read beyond buffer length")}if(browserSupport){return buf._dataview.getFloat64(offset,littleEndian)}else{return ieee754.read(buf,offset,littleEndian,52,8)}}Buffer.prototype.readDoubleLE=function(offset,noAssert){return _readDouble(this,offset,true,noAssert)};Buffer.prototype.readDoubleBE=function(offset,noAssert){return _readDouble(this,offset,false,noAssert)};Buffer.prototype.writeUInt8=function(value,offset,noAssert){var buf=this;if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"trying to write beyond buffer length");verifuint(value,255)}if(offset>=buf.length)return;buf[offset]=value};function _writeUInt16(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"trying to write beyond buffer length");verifuint(value,65535)}var len=buf.length;if(offset>=len)return;if(browserSupport){if(offset+1===len){var dv=new DataView(new ArrayBuffer(2));dv.setUint16(0,value,littleEndian);buf[offset]=dv.getUint8(0)}else{buf._dataview.setUint16(offset,value,littleEndian)}}else{for(var i=0,j=Math.min(len-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){_writeUInt16(this,value,offset,true,noAssert)};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){_writeUInt16(this,value,offset,false,noAssert)};function _writeUInt32(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"trying to write beyond buffer length");verifuint(value,4294967295)}var len=buf.length;if(offset>=len)return;var i;if(browserSupport){if(offset+3>=len){var dv=new DataView(new ArrayBuffer(4));dv.setUint32(0,value,littleEndian);for(i=0;i+offset<len;i++){buf[i+offset]=dv.getUint8(i)}}else{buf._dataview.setUint32(offset,value,littleEndian)}}else{for(i=0,j=Math.min(len-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){_writeUInt32(this,value,offset,true,noAssert)};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){_writeUInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeInt8=function(value,offset,noAssert){var buf=this;if(!noAssert){assert(value!==undefined&&value!==null,"missing value");
assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(offset>=buf.length)return;if(browserSupport){buf._dataview.setInt8(offset,value)}else{if(value>=0)buf.writeUInt8(value,offset,noAssert);else buf.writeUInt8(255+value+1,offset,noAssert)}};function _writeInt16(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}var len=buf.length;if(offset>=len)return;if(browserSupport){if(offset+1===len){var dv=new DataView(new ArrayBuffer(2));dv.setInt16(0,value,littleEndian);buf[offset]=dv.getUint8(0)}else{buf._dataview.setInt16(offset,value,littleEndian)}}else{if(value>=0)_writeUInt16(buf,value,offset,littleEndian,noAssert);else _writeUInt16(buf,65535+value+1,offset,littleEndian,noAssert)}}Buffer.prototype.writeInt16LE=function(value,offset,noAssert){_writeInt16(this,value,offset,true,noAssert)};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){_writeInt16(this,value,offset,false,noAssert)};function _writeInt32(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}var len=buf.length;if(offset>=len)return;if(browserSupport){if(offset+3>=len){var dv=new DataView(new ArrayBuffer(4));dv.setInt32(0,value,littleEndian);for(var i=0;i+offset<len;i++){buf[i+offset]=dv.getUint8(i)}}else{buf._dataview.setInt32(offset,value,littleEndian)}}else{if(value>=0)_writeUInt32(buf,value,offset,littleEndian,noAssert);else _writeUInt32(buf,4294967295+value+1,offset,littleEndian,noAssert)}}Buffer.prototype.writeInt32LE=function(value,offset,noAssert){_writeInt32(this,value,offset,true,noAssert)};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){_writeInt32(this,value,offset,false,noAssert)};function _writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}var len=buf.length;if(offset>=len)return;if(browserSupport){if(offset+3>=len){var dv=new DataView(new ArrayBuffer(4));dv.setFloat32(0,value,littleEndian);for(var i=0;i+offset<len;i++){buf[i+offset]=dv.getUint8(i)}}else{buf._dataview.setFloat32(offset,value,littleEndian)}}else{ieee754.write(buf,value,offset,littleEndian,23,4)}}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){_writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){_writeFloat(this,value,offset,false,noAssert)};function _writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+7<buf.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}var len=buf.length;if(offset>=len)return;if(browserSupport){if(offset+7>=len){var dv=new DataView(new ArrayBuffer(8));dv.setFloat64(0,value,littleEndian);for(var i=0;i+offset<len;i++){buf[i+offset]=dv.getUint8(i)}}else{buf._dataview.setFloat64(offset,value,littleEndian)}}else{ieee754.write(buf,value,offset,littleEndian,52,8)}}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){_writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){_writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.fill=function(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(typeof value==="string"){value=value.charCodeAt(0)}if(typeof value!=="number"||isNaN(value)){throw new Error("value is not a number")}if(end<start)throw new Error("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length){throw new Error("start out of bounds")}if(end<0||end>this.length){throw new Error("end out of bounds")}for(var i=start;i<end;i++){this[i]=value}};Buffer.prototype.inspect=function(){var out=[];var len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i===exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"};function BufferToArrayBuffer(){return new Buffer(this).buffer}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}var BP=Buffer.prototype;function augment(arr){arr._isBuffer=true;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BufferToArrayBuffer;if(arr.byteLength!==0)arr._dataview=new DataView(arr.buffer,arr.byteOffset,arr.byteLength);return arr}function clamp(index,len,defaultValue){if(typeof index!=="number")return defaultValue;index=~~index;if(index>=len)return len;if(index>=0)return index;index+=len;if(index>=0)return index;return 0}function coerce(length){length=~~Math.ceil(+length);return length<0?0:length}function isArray(subject){return(Array.isArray||function(subject){return Object.prototype.toString.call(subject)==="[object Array]"})(subject)}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)if(str.charCodeAt(i)<=127)byteArray.push(str.charCodeAt(i));else{var h=encodeURIComponent(str.charAt(i)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length){var pos;for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}function verifuint(value,max){assert(typeof value=="number","cannot write a non-number as a number");assert(value>=0,"specified a negative value for writing an unsigned value");assert(value<=max,"value is larger than maximum value for type");assert(Math.floor(value)===value,"value has a fractional component")}function verifsint(value,max,min){assert(typeof value=="number","cannot write a non-number as a number");assert(value<=max,"value larger than maximum allowed value");assert(value>=min,"value smaller than minimum allowed value");assert(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert(typeof value=="number","cannot write a non-number as a number");assert(value<=max,"value larger than maximum allowed value");assert(value>=min,"value smaller than minimum allowed value")}function assert(test,message){if(!test)throw new Error(message||"Failed assertion")}},{"base64-js":3,ieee754:4}],"native-buffer-browserify":[function(require,module,exports){module.exports=require("PcZj9L")},{}],3:[function(require,module,exports){(function(exports){"use strict";var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw"Invalid string. Length must be a multiple of 4"}placeHolders=indexOf(b64,"=");placeHolders=placeHolders>0?b64.length-placeHolders:0;arr=[];l=placeHolders>0?b64.length-4:b64.length;for(i=0,j=0;i<l;i+=4,j+=3){tmp=indexOf(lookup,b64.charAt(i))<<18|indexOf(lookup,b64.charAt(i+1))<<12|indexOf(lookup,b64.charAt(i+2))<<6|indexOf(lookup,b64.charAt(i+3));arr.push((tmp&16711680)>>16);arr.push((tmp&65280)>>8);arr.push(tmp&255)}if(placeHolders===2){tmp=indexOf(lookup,b64.charAt(i))<<2|indexOf(lookup,b64.charAt(i+1))>>4;arr.push(tmp&255)}else if(placeHolders===1){tmp=indexOf(lookup,b64.charAt(i))<<10|indexOf(lookup,b64.charAt(i+1))<<4|indexOf(lookup,b64.charAt(i+2))>>2;arr.push(tmp>>8&255);arr.push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function tripletToBase64(num){return lookup.charAt(num>>18&63)+lookup.charAt(num>>12&63)+lookup.charAt(num>>6&63)+lookup.charAt(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=lookup.charAt(temp>>2);output+=lookup.charAt(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=lookup.charAt(temp>>10);output+=lookup.charAt(temp>>4&63);output+=lookup.charAt(temp<<2&63);output+="=";break}return output}module.exports.toByteArray=b64ToByteArray;module.exports.fromByteArray=uint8ToBase64})();function indexOf(arr,elt){var len=arr.length;var from=Number(arguments[1])||0;from=from<0?Math.ceil(from):Math.floor(from);if(from<0)from+=len;for(;from<len;from++){if(typeof arr==="string"&&arr.charAt(from)===elt||typeof arr!=="string"&&arr[from]===elt){return from}}return-1}},{}],4:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}]},{},[]);module.exports=require("native-buffer-browserify").Buffer},{}],20:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],21:[function(require,module,exports){var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=Buffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;Buffer._useTypedArrays=function(){if(typeof Uint8Array==="undefined"||typeof ArrayBuffer==="undefined")return false;try{var arr=new Uint8Array(0);arr.foo=function(){return 42};return 42===arr.foo()&&typeof arr.subarray==="function"}catch(e){return false}}();function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var type=typeof subject;if(encoding==="base64"&&type==="string"){subject=stringtrim(subject);while(subject.length%4!==0){subject=subject+"="}}var length;if(type==="number")length=coerce(subject);else if(type==="string")length=Buffer.byteLength(subject,encoding);else if(type==="object")length=coerce(subject.length);else throw new Error("First argument needs to be a number, array or string.");var buf;if(Buffer._useTypedArrays){buf=augment(new Uint8Array(length))}else{buf=this;buf.length=length;buf._isBuffer=true}var i;if(Buffer._useTypedArrays&&typeof Uint8Array==="function"&&subject instanceof Uint8Array){buf._set(subject)}else if(isArrayish(subject)){for(i=0;i<length;i++){if(Buffer.isBuffer(subject))buf[i]=subject.readUInt8(i);else buf[i]=subject[i]}}else if(type==="string"){buf.write(subject,0,encoding)}else if(type==="number"&&!Buffer._useTypedArrays&&!noZero){for(i=0;i<length;i++){buf[i]=0}}return buf}Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":return true;default:return false}};Buffer.isBuffer=function(b){return b!=null&&b._isBuffer||false};Buffer.byteLength=function(str,encoding){switch(encoding||"utf8"){case"hex":return str.length/2;case"utf8":case"utf-8":return utf8ToBytes(str).length;case"ascii":case"binary":return str.length;case"base64":return base64ToBytes(str).length;default:throw new Error("Unknown encoding")}};Buffer.concat=function(list,totalLength){assert(isArray(list),"Usage: Buffer.concat(list, [totalLength])\n"+"list should be an Array.");if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(typeof totalLength!=="number"){totalLength=0;for(i=0;i<list.length;i++){totalLength+=list[i].length}}var buf=new Buffer(totalLength);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};function _hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;assert(strLen%2===0,"Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);assert(!isNaN(byte),"Invalid hex string");buf[offset+i]=byte}Buffer._charsWritten=i*2;return i}function _utf8Write(buf,string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length)}function _asciiWrite(buf,string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length)}function _binaryWrite(buf,string,offset,length){return _asciiWrite(buf,string,offset,length)}function _base64Write(buf,string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length)}Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=Number(offset)||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();switch(encoding){case"hex":return _hexWrite(this,string,offset,length);case"utf8":case"utf-8":return _utf8Write(this,string,offset,length);case"ascii":return _asciiWrite(this,string,offset,length);case"binary":return _binaryWrite(this,string,offset,length);case"base64":return _base64Write(this,string,offset,length);default:throw new Error("Unknown encoding")}};Buffer.prototype.toString=function(encoding,start,end){var self=this;encoding=String(encoding||"utf8").toLowerCase();start=Number(start)||0;end=end!==undefined?Number(end):end=self.length;if(end===start)return"";switch(encoding){case"hex":return _hexSlice(self,start,end);case"utf8":case"utf-8":return _utf8Slice(self,start,end);case"ascii":return _asciiSlice(self,start,end);case"binary":return _binarySlice(self,start,end);case"base64":return _base64Slice(self,start,end);default:throw new Error("Unknown encoding")}};Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(!start)start=0;if(!end&&end!==0)end=this.length;if(!target_start)target_start=0;if(end===start)return;if(target.length===0||source.length===0)return;assert(end>=start,"sourceEnd < sourceStart");assert(target_start>=0&&target_start<target.length,"targetStart out of bounds");assert(start>=0&&start<source.length,"sourceStart out of bounds");assert(end>=0&&end<=source.length,"sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-target_start<end-start)end=target.length-target_start+start;for(var i=0;i<end-start;i++)target[i+target_start]=this[i+start]};function _base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function _utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function _asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++)ret+=String.fromCharCode(buf[i]);return ret}function _binarySlice(buf,start,end){return _asciiSlice(buf,start,end)}function _hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}Buffer.prototype.slice=function(start,end){var len=this.length;start=clamp(start,len,0);end=clamp(end,len,len);if(Buffer._useTypedArrays){return augment(this.subarray(start,end))}else{var sliceLen=end-start;var newBuf=new Buffer(sliceLen,undefined,true);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}return newBuf}};Buffer.prototype.get=function(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};Buffer.prototype.readUInt8=function(offset,noAssert){var buf=this;if(!noAssert){assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"Trying to read beyond buffer length")}if(offset>=buf.length)return;return buf[offset]};function _readUInt16(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val;if(littleEndian){val=buf[offset];if(offset+1<len)val|=buf[offset+1]<<8}else{val=buf[offset]<<8;if(offset+1<len)val|=buf[offset+1]}return val}Buffer.prototype.readUInt16LE=function(offset,noAssert){return _readUInt16(this,offset,true,noAssert)};Buffer.prototype.readUInt16BE=function(offset,noAssert){return _readUInt16(this,offset,false,noAssert)};function _readUInt32(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val;if(littleEndian){if(offset+2<len)val=buf[offset+2]<<16;if(offset+1<len)val|=buf[offset+1]<<8;val|=buf[offset];if(offset+3<len)val=val+(buf[offset+3]<<24>>>0)}else{if(offset+1<len)val=buf[offset+1]<<16;if(offset+2<len)val|=buf[offset+2]<<8;if(offset+3<len)val|=buf[offset+3];val=val+(buf[offset]<<24>>>0)}return val}Buffer.prototype.readUInt32LE=function(offset,noAssert){return _readUInt32(this,offset,true,noAssert)};Buffer.prototype.readUInt32BE=function(offset,noAssert){return _readUInt32(this,offset,false,noAssert)};Buffer.prototype.readInt8=function(offset,noAssert){var buf=this;if(!noAssert){assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"Trying to read beyond buffer length")}if(offset>=buf.length)return;var neg=buf[offset]&128;if(neg)return(255-buf[offset]+1)*-1;else return buf[offset]};function _readInt16(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val=_readUInt16(buf,offset,littleEndian,true);var neg=val&32768;if(neg)return(65535-val+1)*-1;else return val}Buffer.prototype.readInt16LE=function(offset,noAssert){return _readInt16(this,offset,true,noAssert)};Buffer.prototype.readInt16BE=function(offset,noAssert){return _readInt16(this,offset,false,noAssert)};function _readInt32(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val=_readUInt32(buf,offset,littleEndian,true);var neg=val&2147483648;if(neg)return(4294967295-val+1)*-1;else return val}Buffer.prototype.readInt32LE=function(offset,noAssert){return _readInt32(this,offset,true,noAssert)};Buffer.prototype.readInt32BE=function(offset,noAssert){return _readInt32(this,offset,false,noAssert)};function _readFloat(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset+3<buf.length,"Trying to read beyond buffer length")}return ieee754.read(buf,offset,littleEndian,23,4)}Buffer.prototype.readFloatLE=function(offset,noAssert){return _readFloat(this,offset,true,noAssert)};Buffer.prototype.readFloatBE=function(offset,noAssert){return _readFloat(this,offset,false,noAssert)};function _readDouble(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset+7<buf.length,"Trying to read beyond buffer length")}return ieee754.read(buf,offset,littleEndian,52,8)}Buffer.prototype.readDoubleLE=function(offset,noAssert){return _readDouble(this,offset,true,noAssert)};Buffer.prototype.readDoubleBE=function(offset,noAssert){return _readDouble(this,offset,false,noAssert)};Buffer.prototype.writeUInt8=function(value,offset,noAssert){var buf=this;if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"trying to write beyond buffer length");verifuint(value,255)}if(offset>=buf.length)return;buf[offset]=value};function _writeUInt16(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"trying to write beyond buffer length");verifuint(value,65535)}var len=buf.length;if(offset>=len)return;for(var i=0,j=Math.min(len-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){_writeUInt16(this,value,offset,true,noAssert)};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){_writeUInt16(this,value,offset,false,noAssert)};function _writeUInt32(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"trying to write beyond buffer length");verifuint(value,4294967295)}var len=buf.length;if(offset>=len)return;for(var i=0,j=Math.min(len-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){_writeUInt32(this,value,offset,true,noAssert)};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){_writeUInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeInt8=function(value,offset,noAssert){var buf=this;if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(offset>=buf.length)return;if(value>=0)buf.writeUInt8(value,offset,noAssert);else buf.writeUInt8(255+value+1,offset,noAssert)};function _writeInt16(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}var len=buf.length;if(offset>=len)return;if(value>=0)_writeUInt16(buf,value,offset,littleEndian,noAssert);else _writeUInt16(buf,65535+value+1,offset,littleEndian,noAssert)}Buffer.prototype.writeInt16LE=function(value,offset,noAssert){_writeInt16(this,value,offset,true,noAssert)};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){_writeInt16(this,value,offset,false,noAssert)};function _writeInt32(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}var len=buf.length;if(offset>=len)return;if(value>=0)_writeUInt32(buf,value,offset,littleEndian,noAssert);else _writeUInt32(buf,4294967295+value+1,offset,littleEndian,noAssert)}Buffer.prototype.writeInt32LE=function(value,offset,noAssert){_writeInt32(this,value,offset,true,noAssert)};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){_writeInt32(this,value,offset,false,noAssert)};function _writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}var len=buf.length;if(offset>=len)return;ieee754.write(buf,value,offset,littleEndian,23,4)}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){_writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){_writeFloat(this,value,offset,false,noAssert)};function _writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+7<buf.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}var len=buf.length;if(offset>=len)return;ieee754.write(buf,value,offset,littleEndian,52,8)}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){_writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){_writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.fill=function(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(typeof value==="string"){value=value.charCodeAt(0)}assert(typeof value==="number"&&!isNaN(value),"value is not a number");assert(end>=start,"end < start");if(end===start)return;if(this.length===0)return;assert(start>=0&&start<this.length,"start out of bounds");assert(end>=0&&end<=this.length,"end out of bounds");for(var i=start;i<end;i++){this[i]=value}};Buffer.prototype.inspect=function(){var out=[];var len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i===exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"};Buffer.prototype.toArrayBuffer=function(){if(typeof Uint8Array==="function"){if(Buffer._useTypedArrays){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1)buf[i]=this[i];return buf.buffer}}else{throw new Error("Buffer.toArrayBuffer not supported in this browser")}};function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}var BP=Buffer.prototype;function augment(arr){arr._isBuffer=true;arr._get=arr.get;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr}function clamp(index,len,defaultValue){if(typeof index!=="number")return defaultValue;index=~~index;if(index>=len)return len;if(index>=0)return index;index+=len;if(index>=0)return index;return 0}function coerce(length){length=~~Math.ceil(+length);return length<0?0:length}function isArray(subject){return(Array.isArray||function(subject){return Object.prototype.toString.call(subject)==="[object Array]"
})(subject)}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){var b=str.charCodeAt(i);if(b<=127)byteArray.push(str.charCodeAt(i));else{var start=i;if(b>=55296&&b<=57343)i++;var h=encodeURIComponent(str.slice(start,i+1)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length){var pos;for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}function verifuint(value,max){assert(typeof value=="number","cannot write a non-number as a number");assert(value>=0,"specified a negative value for writing an unsigned value");assert(value<=max,"value is larger than maximum value for type");assert(Math.floor(value)===value,"value has a fractional component")}function verifsint(value,max,min){assert(typeof value=="number","cannot write a non-number as a number");assert(value<=max,"value larger than maximum allowed value");assert(value>=min,"value smaller than minimum allowed value");assert(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert(typeof value=="number","cannot write a non-number as a number");assert(value<=max,"value larger than maximum allowed value");assert(value>=min,"value smaller than minimum allowed value")}function assert(test,message){if(!test)throw new Error(message||"Failed assertion")}},{"base64-js":22,ieee754:23}],22:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var ZERO="0".charCodeAt(0);var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS)return 62;if(code===SLASH)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}module.exports.toByteArray=b64ToByteArray;module.exports.fromByteArray=uint8ToBase64})()},{}],23:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],24:[function(require,module,exports){var process=require("__browserify_process");function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}},{__browserify_process:20}],25:[function(require,module,exports){var global=typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^ -~]/,regexSeparators=/\x2E|。|．|｡/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw RangeError(errors[type])}function map(array,fn){var length=array.length;while(length--){array[length]=fn(array[length])}return array}function mapDomain(string,fn){return map(string.split(regexSeparators),fn).join(".")}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,length,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(domain){return mapDomain(domain,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(domain){return mapDomain(domain,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.2.3",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define(function(){return punycode})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(this)},{}],26:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],27:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return obj[k].map(function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],28:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":26,"./encode":27}],29:[function(require,module,exports){module.exports=Duplex;var inherits=require("inherits");var setImmediate=require("process/browser.js").nextTick;var Readable=require("./readable.js");var Writable=require("./writable.js");inherits(Duplex,Readable);Duplex.prototype.write=Writable.prototype.write;Duplex.prototype.end=Writable.prototype.end;Duplex.prototype._write=Writable.prototype._write;function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;var self=this;setImmediate(function(){self.end()})}},{"./readable.js":33,"./writable.js":35,inherits:18,"process/browser.js":31}],30:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("./readable.js");Stream.Writable=require("./writable.js");Stream.Duplex=require("./duplex.js");Stream.Transform=require("./transform.js");Stream.PassThrough=require("./passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{"./duplex.js":29,"./passthrough.js":32,"./readable.js":33,"./transform.js":34,"./writable.js":35,events:12,inherits:18}],31:[function(require,module,exports){module.exports=require(20)},{}],32:[function(require,module,exports){module.exports=PassThrough;var Transform=require("./transform.js");var inherits=require("inherits");inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./transform.js":34,inherits:18}],33:[function(require,module,exports){var process=require("__browserify_process");module.exports=Readable;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;var Stream=require("./index.js");var Buffer=require("buffer").Buffer;var setImmediate=require("process/browser.js").nextTick;var StringDecoder;var inherits=require("inherits");inherits(Readable,Stream);function ReadableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=false;this.ended=false;this.endEmitted=false;this.reading=false;this.calledRead=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(typeof chunk==="string"&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null||chunk===undefined){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);state.length+=state.objectMode?1:chunk.length;if(addToFront){state.buffer.unshift(chunk)}else{state.reading=false;state.buffer.push(chunk)}if(state.needReadable)emitReadable(stream);maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(isNaN(n)||n===null){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=true;var nOrig=n;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;if(state.length-n<=state.highWaterMark)doRead=true;if(state.ended||state.reading)doRead=false;if(doRead){state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(state.ended&&!state.endEmitted&&state.length===0)endReadable(this);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode&&!er){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;if(state.length>0)emitReadable(stream);else endReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(state.emittedReadable)return;state.emittedReadable=true;if(state.sync)setImmediate(function(){emitReadable_(stream)});else emitReadable_(stream)}function emitReadable_(stream){stream.emit("readable")}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;setImmediate(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)setImmediate(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){if(readable!==src)return;cleanup()}function onend(){dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);if(!dest._writableState||dest._writableState.needDrain)ondrain()}var errListeners=EE.listenerCount(dest,"error");function onerror(er){unpipe();if(errListeners===0&&EE.listenerCount(dest,"error")===0)dest.emit("error",er)}dest.once("error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){this.on("readable",pipeOnReadable);state.flowing=true;setImmediate(function(){flow(src)})}return dest};function pipeOnDrain(src){return function(){var dest=this;var state=src._readableState;state.awaitDrain--;if(state.awaitDrain===0)flow(src)}}function flow(src){var state=src._readableState;var chunk;state.awaitDrain=0;function write(dest,i,list){var written=dest.write(chunk);if(false===written){state.awaitDrain++}}while(state.pipesCount&&null!==(chunk=src.read())){if(state.pipesCount===1)write(state.pipes,0,null);else forEach(state.pipes,write);src.emit("data",chunk);if(state.awaitDrain>0)return}if(state.pipesCount===0){state.flowing=false;if(EE.listenerCount(src,"data")>0)emitDataEvents(src);return}state.ranOut=true}function pipeOnReadable(){if(this._readableState.ranOut){this._readableState.ranOut=false;flow(this)}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&!this._readableState.flowing)emitDataEvents(this);if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){this.read(0)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){emitDataEvents(this);this.read(0);this.emit("resume")};Readable.prototype.pause=function(){emitDataEvents(this,true);this.emit("pause")};function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing){throw new Error("Cannot switch to old mode now.")}var paused=startPaused||false;var readable=false;stream.readable=true;stream.pipe=Stream.prototype.pipe;stream.on=stream.addListener=Stream.prototype.on;stream.on("readable",function(){readable=true;var c;while(!paused&&null!==(c=stream.read()))stream.emit("data",c);if(c===null){readable=false;stream._readableState.needReadable=true}});stream.pause=function(){paused=true;this.emit("pause")};stream.resume=function(){paused=false;if(readable)setImmediate(function(){stream.emit("readable")});else this.read(0);this.emit("resume")};stream.emit("readable")}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){if(state.decoder)chunk=state.decoder.write(chunk);if(!chunk||!state.objectMode&&!chunk.length)return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(typeof stream[i]==="function"&&typeof this[i]==="undefined"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,function(x){return self.emit.apply(self,ev,x)})});self._read=function(n){if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted&&state.calledRead){state.ended=true;setImmediate(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}},{"./index.js":30,__browserify_process:20,buffer:21,events:12,inherits:18,"process/browser.js":31,string_decoder:36}],34:[function(require,module,exports){module.exports=Transform;var Duplex=require("./duplex.js");var inherits=require("inherits");inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);
Duplex.call(this,options);var ts=this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("finish",function(){if("function"===typeof this._flush)this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var rs=stream._readableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./duplex.js":29,inherits:18}],35:[function(require,module,exports){module.exports=Writable;Writable.WritableState=WritableState;var isUint8Array=typeof Uint8Array!=="undefined"?function(x){return x instanceof Uint8Array}:function(x){return x&&x.constructor&&x.constructor.name==="Uint8Array"};var isArrayBuffer=typeof ArrayBuffer!=="undefined"?function(x){return x instanceof ArrayBuffer}:function(x){return x&&x.constructor&&x.constructor.name==="ArrayBuffer"};var inherits=require("inherits");var Stream=require("./index.js");var setImmediate=require("process/browser.js").nextTick;var Buffer=require("buffer").Buffer;inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.objectMode=!!options.objectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[]}function Writable(options){if(!(this instanceof Writable)&&!(this instanceof Stream.Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);setImmediate(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);setImmediate(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(isUint8Array(chunk))chunk=new Buffer(chunk);if(isArrayBuffer(chunk)&&typeof Uint8Array!=="undefined")chunk=new Buffer(new Uint8Array(chunk));if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb))ret=writeOrBuffer(this,state,chunk,encoding,cb);return ret};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;state.needDrain=!ret;if(state.writing)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,len,chunk,encoding,cb);return ret}function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)setImmediate(function(){cb(er)});else cb(er);stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(stream,state);if(sync){setImmediate(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);cb();if(finished)finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,len,chunk,encoding,cb);if(state.writing){c++;break}}state.bufferProcessing=false;if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(typeof chunk!=="undefined"&&chunk!==null)this.write(chunk,encoding);if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){state.finished=true;stream.emit("finish")}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)setImmediate(cb);else stream.once("finish",cb)}state.ended=true}},{"./index.js":30,buffer:21,inherits:18,"process/browser.js":31}],36:[function(require,module,exports){var Buffer=require("buffer").Buffer;function assertEncoding(encoding){if(encoding&&!Buffer.isEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";var offset=0;while(this.charLength){var i=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,offset,i);this.charReceived+=i-offset;offset=i;if(this.charReceived<this.charLength){return""}charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(i==buffer.length)return charStr;buffer=buffer.slice(i,buffer.length);break}var lenIncomplete=this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-lenIncomplete,end);this.charReceived=lenIncomplete;end-=lenIncomplete}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);this.charBuffer.write(charStr.charAt(charStr.length-1),this.encoding);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}return i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){var incomplete=this.charReceived=buffer.length%2;this.charLength=incomplete?2:0;return incomplete}function base64DetectIncompleteChar(buffer){var incomplete=this.charReceived=buffer.length%3;this.charLength=incomplete?3:0;return incomplete}},{buffer:21}],37:[function(require,module,exports){(function(){"use strict";var punycode=require("punycode");exports.parse=urlParse;exports.resolve=urlResolve;exports.resolveObject=urlResolveObject;exports.format=urlFormat;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,delims=["<",">",'"',"`"," ","\r","\n","	"],unwise=["{","}","|","\\","^","~","`"].concat(delims),autoEscape=["'"].concat(delims),nonHostChars=["%","/","?",";","#"].concat(unwise).concat(autoEscape),nonAuthChars=["/","@","?","#"].concat(delims),hostnameMaxLen=255,hostnamePartPattern=/^[a-zA-Z0-9][a-z0-9A-Z_-]{0,62}$/,hostnamePartStart=/^([a-zA-Z0-9][a-z0-9A-Z_-]{0,62})(.*)$/,unsafeProtocol={javascript:true,"javascript:":true},hostlessProtocol={javascript:true,"javascript:":true},pathedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"ftp:":true,"gopher:":true,"file:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&typeof url==="object"&&url.href)return url;if(typeof url!=="string"){throw new TypeError("Parameter 'url' must be a string, not "+typeof url)}var out={},rest=url;rest=rest.trim();var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();out.protocol=lowerProto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);out.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var atSign=rest.indexOf("@");if(atSign!==-1){var auth=rest.slice(0,atSign);var hasAuth=true;for(var i=0,l=nonAuthChars.length;i<l;i++){if(auth.indexOf(nonAuthChars[i])!==-1){hasAuth=false;break}}if(hasAuth){out.auth=decodeURIComponent(auth);rest=rest.substr(atSign+1)}}var firstNonHost=-1;for(var i=0,l=nonHostChars.length;i<l;i++){var index=rest.indexOf(nonHostChars[i]);if(index!==-1&&(firstNonHost<0||index<firstNonHost))firstNonHost=index}if(firstNonHost!==-1){out.host=rest.substr(0,firstNonHost);rest=rest.substr(firstNonHost)}else{out.host=rest;rest=""}var p=parseHost(out.host);var keys=Object.keys(p);for(var i=0,l=keys.length;i<l;i++){var key=keys[i];out[key]=p[key]}out.hostname=out.hostname||"";var ipv6Hostname=out.hostname[0]==="["&&out.hostname[out.hostname.length-1]==="]";if(out.hostname.length>hostnameMaxLen){out.hostname=""}else if(!ipv6Hostname){var hostparts=out.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest="/"+notHost.join(".")+rest}out.hostname=validParts.join(".");break}}}}out.hostname=out.hostname.toLowerCase();if(!ipv6Hostname){var domainArray=out.hostname.split(".");var newOut=[];for(var i=0;i<domainArray.length;++i){var s=domainArray[i];newOut.push(s.match(/[^A-Za-z0-9_-]/)?"xn--"+punycode.encode(s):s)}out.hostname=newOut.join(".")}out.host=(out.hostname||"")+(out.port?":"+out.port:"");out.href+=out.host;if(ipv6Hostname){out.hostname=out.hostname.substr(1,out.hostname.length-2);if(rest[0]!=="/"){rest="/"+rest}}}if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(hash!==-1){out.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){out.search=rest.substr(qm);out.query=rest.substr(qm+1);if(parseQueryString){out.query=querystring.parse(out.query)}rest=rest.slice(0,qm)}else if(parseQueryString){out.search="";out.query={}}if(rest)out.pathname=rest;if(slashedProtocol[proto]&&out.hostname&&!out.pathname){out.pathname="/"}if(out.pathname||out.search){out.path=(out.pathname?out.pathname:"")+(out.search?out.search:"")}out.href=urlFormat(out);return out}function urlFormat(obj){if(typeof obj==="string")obj=urlParse(obj);var auth=obj.auth||"";if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,":");auth+="@"}var protocol=obj.protocol||"",pathname=obj.pathname||"",hash=obj.hash||"",host=false,query="";if(obj.host!==undefined){host=auth+obj.host}else if(obj.hostname!==undefined){host=auth+(obj.hostname.indexOf(":")===-1?obj.hostname:"["+obj.hostname+"]");if(obj.port){host+=":"+obj.port}}if(obj.query&&typeof obj.query==="object"&&Object.keys(obj.query).length){query=querystring.stringify(obj.query)}var search=obj.search||query&&"?"+query||"";if(protocol&&protocol.substr(-1)!==":")protocol+=":";if(obj.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host="//"+(host||"");if(pathname&&pathname.charAt(0)!=="/")pathname="/"+pathname}else if(!host){host=""}if(hash&&hash.charAt(0)!=="#")hash="#"+hash;if(search&&search.charAt(0)!=="?")search="?"+search;return protocol+host+pathname+search+hash}function urlResolve(source,relative){return urlFormat(urlResolveObject(source,relative))}function urlResolveObject(source,relative){if(!source)return relative;source=urlParse(urlFormat(source),false,true);relative=urlParse(urlFormat(relative),false,true);source.hash=relative.hash;if(relative.href===""){source.href=urlFormat(source);return source}if(relative.slashes&&!relative.protocol){relative.protocol=source.protocol;if(slashedProtocol[relative.protocol]&&relative.hostname&&!relative.pathname){relative.path=relative.pathname="/"}relative.href=urlFormat(relative);return relative}if(relative.protocol&&relative.protocol!==source.protocol){if(!slashedProtocol[relative.protocol]){relative.href=urlFormat(relative);return relative}source.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||"").split("/");while(relPath.length&&!(relative.host=relPath.shift()));if(!relative.host)relative.host="";if(!relative.hostname)relative.hostname="";if(relPath[0]!=="")relPath.unshift("");if(relPath.length<2)relPath.unshift("");relative.pathname=relPath.join("/")}source.pathname=relative.pathname;source.search=relative.search;source.query=relative.query;source.host=relative.host||"";source.auth=relative.auth;source.hostname=relative.hostname||relative.host;source.port=relative.port;if(source.pathname!==undefined||source.search!==undefined){source.path=(source.pathname?source.pathname:"")+(source.search?source.search:"")}source.slashes=source.slashes||relative.slashes;source.href=urlFormat(source);return source}var isSourceAbs=source.pathname&&source.pathname.charAt(0)==="/",isRelAbs=relative.host!==undefined||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||source.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=source.pathname&&source.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=source.protocol&&!slashedProtocol[source.protocol];if(psychotic){delete source.hostname;delete source.port;if(source.host){if(srcPath[0]==="")srcPath[0]=source.host;else srcPath.unshift(source.host)}delete source.host;if(relative.protocol){delete relative.hostname;delete relative.port;if(relative.host){if(relPath[0]==="")relPath[0]=relative.host;else relPath.unshift(relative.host)}delete relative.host}mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")}if(isRelAbs){source.host=relative.host||relative.host===""?relative.host:source.host;source.hostname=relative.hostname||relative.hostname===""?relative.hostname:source.hostname;source.search=relative.search;source.query=relative.query;srcPath=relPath}else if(relPath.length){if(!srcPath)srcPath=[];srcPath.pop();srcPath=srcPath.concat(relPath);source.search=relative.search;source.query=relative.query}else if("search"in relative){if(psychotic){source.hostname=source.host=srcPath.shift();var authInHost=source.host&&source.host.indexOf("@")>0?source.host.split("@"):false;if(authInHost){source.auth=authInHost.shift();source.host=source.hostname=authInHost.shift()}}source.search=relative.search;source.query=relative.query;if(source.pathname!==undefined||source.search!==undefined){source.path=(source.pathname?source.pathname:"")+(source.search?source.search:"")}source.href=urlFormat(source);return source}if(!srcPath.length){delete source.pathname;if(!source.search){source.path="/"+source.search}else{delete source.path}source.href=urlFormat(source);return source}var last=srcPath.slice(-1)[0];var hasTrailingSlash=(source.host||relative.host)&&(last==="."||last==="..")||last==="";var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last=="."){srcPath.splice(i,1)}else if(last===".."){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}}if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift("..")}}if(mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")){srcPath.unshift("")}if(hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"){srcPath.push("")}var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){source.hostname=source.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=source.host&&source.host.indexOf("@")>0?source.host.split("@"):false;if(authInHost){source.auth=authInHost.shift();source.host=source.hostname=authInHost.shift()}}mustEndAbs=mustEndAbs||source.host&&srcPath.length;if(mustEndAbs&&!isAbsolute){srcPath.unshift("")}source.pathname=srcPath.join("/");if(source.pathname!==undefined||source.search!==undefined){source.path=(source.pathname?source.pathname:"")+(source.search?source.search:"")}source.auth=relative.auth||source.auth;source.slashes=source.slashes||relative.slashes;source.href=urlFormat(source);return source}function parseHost(host){var out={};var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){out.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host)out.hostname=host;return out}})()},{punycode:25,querystring:28}],38:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],39:[function(require,module,exports){var process=require("__browserify_process"),global=typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}},{"./support/isBuffer":38,__browserify_process:20,inherits:18}],40:[function(require,module,exports){var process=require("__browserify_process");(function(global,browserGlobal,underTest){"use strict";underTest=!!underTest;var async;var MutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver;var Promise;if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]"){async=function(callback,binding){process.nextTick(function(){callback.call(binding)})}}else if(MutationObserver){var queue=[];var observer=new MutationObserver(function(){var toProcess=queue.slice();queue=[];toProcess.forEach(function(tuple){tuple[0].call(tuple[1])})});var element=document.createElement("div");observer.observe(element,{attributes:true});window.addEventListener("unload",function(){observer.disconnect();observer=null});async=function(callback,binding){queue.push([callback,binding]);element.setAttribute("drainQueue","drainQueue")}}else{async=function(callback,binding){setTimeout(function(){callback.call(binding)},1)}}var _readOnlyProperty=function(v){return{enumerable:true,configurable:false,get:v}};var _method=function(v,e,c,w){return{enumerable:!!(e||0),configurable:!!(c||1),writable:!!(w||1),value:v||function(){}}};var _pseudoPrivate=function(v){return _method(v,0,1,0)};var _public=function(v){return _method(v,1)};var isThenable=function(any){try{var f=any.then;if(typeof f=="function"){return true}}catch(e){}return false};var AlreadyResolved=function(name){Error.call(this,name)};AlreadyResolved.prototype=Object.create(Error.prototype);var Backlog=function(){var bl=[];bl.pump=function(value){async(function(){var l=bl.length;var x=0;while(x<l){x++;bl.shift()(value)}})};return bl};var Resolver=function(future,fulfillCallbacks,rejectCallbacks,setValue,setError,setState){var isResolved=false;var resolver=this;var fulfill=function(value){async(function(){setState("fulfilled");setValue(value);fulfillCallbacks.pump(value)})};var reject=function(reason){async(function(){setState("rejected");setError(reason);rejectCallbacks.pump(reason)})};var resolve=function(value){if(isThenable(value)){value.then(resolve,reject);return}fulfill(value)};var ifNotResolved=function(func,name){return function(value){if(!isResolved){isResolved=true;func(value)}else{if(typeof console!="undefined"){console.error("Cannot resolve a Promise multiple times.")}}}};this.resolve=ifNotResolved(resolve,"resolve");this.fulfill=ifNotResolved(fulfill,"fulfill");this.reject=ifNotResolved(reject,"reject");
this.cancel=function(){resolver.reject(new Error("Cancel"))};this.timeout=function(){resolver.reject(new Error("Timeout"))};if(underTest){Object.defineProperties(this,{_isResolved:_readOnlyProperty(function(){return isResolved})})}setState("pending")};var Promise=function(init){var fulfillCallbacks=new Backlog;var rejectCallbacks=new Backlog;var value;var error;var state="pending";if(underTest){Object.defineProperties(this,{_value:_readOnlyProperty(function(){return value}),_error:_readOnlyProperty(function(){return error}),_state:_readOnlyProperty(function(){return state})})}Object.defineProperties(this,{_addAcceptCallback:_pseudoPrivate(function(cb){fulfillCallbacks.push(cb);if(state=="fulfilled"){fulfillCallbacks.pump(value)}}),_addRejectCallback:_pseudoPrivate(function(cb){rejectCallbacks.push(cb);if(state=="rejected"){rejectCallbacks.pump(error)}})});var r=new Resolver(this,fulfillCallbacks,rejectCallbacks,function(v){value=v},function(e){error=e},function(s){state=s});try{if(init){init(r)}}catch(e){r.reject(e)}};var isCallback=function(any){return typeof any=="function"};var wrap=function(callback,resolver,disposition){if(!isCallback(callback)){return resolver[disposition].bind(resolver)}return function(){try{var r=callback.apply(null,arguments);resolver.resolve(r)}catch(e){resolver.reject(e)}}};var addCallbacks=function(onfulfill,onreject,scope){if(isCallback(onfulfill)){scope._addAcceptCallback(onfulfill)}if(isCallback(onreject)){scope._addRejectCallback(onreject)}return scope};Promise.prototype=Object.create(null,{then:_public(function(onfulfill,onreject){var f=this;return new Promise(function(r){addCallbacks(wrap(onfulfill,r,"resolve"),wrap(onreject,r,"reject"),f)})}),"catch":_public(function(onreject){var f=this;return new Promise(function(r){addCallbacks(null,wrap(onreject,r,"reject"),f)})})});Promise.isThenable=isThenable;var toPromiseList=function(list){return Array.prototype.slice.call(list).map(Promise.resolve)};Promise.any=function(){var futures=toPromiseList(arguments);return new Promise(function(r){if(!futures.length){r.reject("No futures passed to Promise.any()")}else{var resolved=false;var firstSuccess=function(value){if(resolved){return}resolved=true;r.resolve(value)};var firstFailure=function(reason){if(resolved){return}resolved=true;r.reject(reason)};futures.forEach(function(f,idx){f.then(firstSuccess,firstFailure)})}})};Promise.every=function(){var futures=toPromiseList(arguments);return new Promise(function(r){if(!futures.length){r.reject("No futures passed to Promise.every()")}else{var values=new Array(futures.length);var count=0;var accumulate=function(idx,v){count++;values[idx]=v;if(count==futures.length){r.resolve(values)}};futures.forEach(function(f,idx){f.then(accumulate.bind(null,idx),r.reject)})}})};Promise.some=function(){var futures=toPromiseList(arguments);return new Promise(function(r){if(!futures.length){r.reject("No futures passed to Promise.some()")}else{var count=0;var accumulateFailures=function(e){count++;if(count==futures.length){r.reject()}};futures.forEach(function(f,idx){f.then(r.resolve,accumulateFailures)})}})};Promise.fulfill=function(value){return new Promise(function(r){r.fulfill(value)})};Promise.resolve=function(value){return new Promise(function(r){r.resolve(value)})};Promise.reject=function(reason){return new Promise(function(r){r.reject(reason)})};global.Promise=Promise;if(typeof window!=="undefined"){window.DomPromise=Promise}})(this,typeof window!=="undefined"?window:{},this.runningUnderTest||false)},{__browserify_process:20}],41:[function(require,module,exports){var process=require("__browserify_process");(function(){var _nodejs=typeof process!=="undefined"&&process.versions&&process.versions.node;var wrapper=function(jsonld){jsonld.compact=function(input,ctx,options,callback){if(arguments.length<2){return jsonld.nextTick(function(){callback(new TypeError("Could not compact, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(ctx===null){return jsonld.nextTick(function(){callback(new JsonLdError("The compaction context must not be null.","jsonld.CompactError",{code:"invalid local context"}))})}if(input===null){return jsonld.nextTick(function(){callback(null,null)})}if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("compactArrays"in options)){options.compactArrays=true}if(!("graph"in options)){options.graph=false}if(!("skipExpansion"in options)){options.skipExpansion=false}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}var expand=function(input,options,callback){jsonld.nextTick(function(){if(options.skipExpansion){return callback(null,input)}jsonld.expand(input,options,callback)})};expand(input,options,function(err,expanded){if(err){return callback(new JsonLdError("Could not expand input before compaction.","jsonld.CompactError",{cause:err}))}var activeCtx=_getInitialContext(options);jsonld.processContext(activeCtx,ctx,options,function(err,activeCtx){if(err){return callback(new JsonLdError("Could not process context before compaction.","jsonld.CompactError",{cause:err}))}var compacted;try{compacted=(new Processor).compact(activeCtx,null,expanded,options)}catch(ex){return callback(ex)}cleanup(null,compacted,activeCtx,options)})});function cleanup(err,compacted,activeCtx,options){if(err){return callback(err)}if(options.compactArrays&&!options.graph&&_isArray(compacted)){if(compacted.length===1){compacted=compacted[0]}else if(compacted.length===0){compacted={}}}else if(options.graph&&_isObject(compacted)){compacted=[compacted]}if(_isObject(ctx)&&"@context"in ctx){ctx=ctx["@context"]}ctx=_clone(ctx);if(!_isArray(ctx)){ctx=[ctx]}var tmp=ctx;ctx=[];for(var i=0;i<tmp.length;++i){if(!_isObject(tmp[i])||Object.keys(tmp[i]).length>0){ctx.push(tmp[i])}}var hasContext=ctx.length>0;if(ctx.length===1){ctx=ctx[0]}if(_isArray(compacted)){var kwgraph=_compactIri(activeCtx,"@graph");var graph=compacted;compacted={};if(hasContext){compacted["@context"]=ctx}compacted[kwgraph]=graph}else if(_isObject(compacted)&&hasContext){var graph=compacted;compacted={"@context":ctx};for(var key in graph){compacted[key]=graph[key]}}callback(null,compacted,activeCtx)}};jsonld.expand=function(input,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not expand, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}if(!("keepFreeFloatingNodes"in options)){options.keepFreeFloatingNodes=false}jsonld.nextTick(function(){if(typeof input==="string"){var done=function(err,remoteDoc){if(err){return callback(err)}try{if(!remoteDoc.document){throw new JsonLdError("No remote document found at the given URL.","jsonld.NullRemoteDocument")}if(typeof remoteDoc.document==="string"){remoteDoc.document=JSON.parse(remoteDoc.document)}}catch(ex){return callback(new JsonLdError("Could not retrieve a JSON-LD document from the URL. URL "+"derefencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:ex,remoteDoc:remoteDoc}))}expand(remoteDoc)};var promise=options.documentLoader(input,done);if(promise&&"then"in promise){promise.then(done.bind(null,null),done)}return}expand({contextUrl:null,documentUrl:null,document:input})});function expand(remoteDoc){if(!("base"in options)){options.base=remoteDoc.documentUrl||""}var input={document:_clone(remoteDoc.document),remoteContext:{"@context":remoteDoc.contextUrl}};if("expandContext"in options){var expandContext=_clone(options.expandContext);if(typeof expandContext==="object"&&"@context"in expandContext){input.expandContext=expandContext}else{input.expandContext={"@context":expandContext}}}_retrieveContextUrls(input,options,function(err,input){if(err){return callback(err)}var expanded;try{var processor=new Processor;var activeCtx=_getInitialContext(options);var document=input.document;var remoteContext=input.remoteContext["@context"];if(input.expandContext){activeCtx=processor.processContext(activeCtx,input.expandContext["@context"],options)}if(remoteContext){activeCtx=processor.processContext(activeCtx,remoteContext,options)}expanded=processor.expand(activeCtx,null,document,options,false);if(_isObject(expanded)&&"@graph"in expanded&&Object.keys(expanded).length===1){expanded=expanded["@graph"]}else if(expanded===null){expanded=[]}if(!_isArray(expanded)){expanded=[expanded]}}catch(ex){return callback(ex)}callback(null,expanded)})}};jsonld.flatten=function(input,ctx,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not flatten, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}else if(typeof ctx==="function"){callback=ctx;ctx=null;options={}}options=options||{};if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}jsonld.expand(input,options,function(err,_input){if(err){return callback(new JsonLdError("Could not expand input before flattening.","jsonld.FlattenError",{cause:err}))}var flattened;try{flattened=(new Processor).flatten(_input)}catch(ex){return callback(ex)}if(ctx===null){return callback(null,flattened)}options.graph=true;options.skipExpansion=true;jsonld.compact(flattened,ctx,options,function(err,compacted){if(err){return callback(new JsonLdError("Could not compact flattened output.","jsonld.FlattenError",{cause:err}))}callback(null,compacted)})})};jsonld.frame=function(input,frame,options,callback){if(arguments.length<2){return jsonld.nextTick(function(){callback(new TypeError("Could not frame, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}if(!("embed"in options)){options.embed=true}options.explicit=options.explicit||false;options.omitDefault=options.omitDefault||false;jsonld.nextTick(function(){if(typeof frame==="string"){var done=function(err,remoteDoc){if(err){return callback(err)}try{if(!remoteDoc.document){throw new JsonLdError("No remote document found at the given URL.","jsonld.NullRemoteDocument")}if(typeof remoteDoc.document==="string"){remoteDoc.document=JSON.parse(remoteDoc.document)}}catch(ex){return callback(new JsonLdError("Could not retrieve a JSON-LD document from the URL. URL "+"derefencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:ex,remoteDoc:remoteDoc}))}doFrame(remoteDoc)};var promise=options.documentLoader(frame,done);if(promise&&"then"in promise){promise.then(done.bind(null,null),done)}return}doFrame({contextUrl:null,documentUrl:null,document:frame})});function doFrame(remoteFrame){var frame=remoteFrame.document;var ctx;if(frame){ctx=frame["@context"]||{};if(remoteFrame.contextUrl){if(!ctx){ctx=remoteFrame.contextUrl}else if(_isArray(ctx)){ctx.push(remoteFrame.contextUrl)}else{ctx=[ctx,remoteFrame.contextUrl]}frame["@context"]=ctx}}else{ctx={}}jsonld.expand(input,options,function(err,expanded){if(err){return callback(new JsonLdError("Could not expand input before framing.","jsonld.FrameError",{cause:err}))}var opts=_clone(options);opts.isFrame=true;opts.keepFreeFloatingNodes=true;jsonld.expand(frame,opts,function(err,expandedFrame){if(err){return callback(new JsonLdError("Could not expand frame before framing.","jsonld.FrameError",{cause:err}))}var framed;try{framed=(new Processor).frame(expanded,expandedFrame,opts)}catch(ex){return callback(ex)}opts.graph=true;opts.skipExpansion=true;jsonld.compact(framed,ctx,opts,function(err,compacted,ctx){if(err){return callback(new JsonLdError("Could not compact framed output.","jsonld.FrameError",{cause:err}))}var graph=_compactIri(ctx,"@graph");compacted[graph]=_removePreserve(ctx,compacted[graph],opts);callback(null,compacted)})})})}};jsonld.objectify=function(input,ctx,options,callback){if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}jsonld.expand(input,options,function(err,_input){if(err){return callback(new JsonLdError("Could not expand input before framing.","jsonld.FrameError",{cause:err}))}var flattened;try{flattened=(new Processor).flatten(_input)}catch(ex){return callback(ex)}options.graph=true;options.skipExpansion=true;jsonld.compact(flattened,ctx,options,function(err,compacted,ctx){if(err){return callback(new JsonLdError("Could not compact flattened output.","jsonld.FrameError",{cause:err}))}var graph=_compactIri(ctx,"@graph");compacted[graph]=_removePreserve(ctx,compacted[graph],options);var top=compacted[graph][0];var recurse=function(subject){if(!_isObject(subject)&&!_isArray(subject)){return}if(_isObject(subject)){if(recurse.visited[subject["@id"]]){return}recurse.visited[subject["@id"]]=true}for(var k in subject){var obj=subject[k];var isid=jsonld.getContextValue(ctx,k,"@type")==="@id";if(!_isArray(obj)&&!_isObject(obj)&&!isid){continue}if(_isString(obj)&&isid){subject[k]=obj=top[obj];recurse(obj)}else if(_isArray(obj)){for(var i=0;i<obj.length;++i){if(_isString(obj[i])&&isid){obj[i]=top[obj[i]]}else if(_isObject(obj[i])&&"@id"in obj[i]){obj[i]=top[obj[i]["@id"]]}recurse(obj[i])}}else if(_isObject(obj)){var sid=obj["@id"];subject[k]=obj=top[sid];recurse(obj)}}};recurse.visited={};recurse(top);compacted.of_type={};for(var s in top){if(!("@type"in top[s])){continue}var types=top[s]["@type"];if(!_isArray(types)){types=[types]}for(var t in types){if(!(types[t]in compacted.of_type)){compacted.of_type[types[t]]=[]}compacted.of_type[types[t]].push(top[s])}}callback(null,compacted)})})};jsonld.normalize=function(input,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not normalize, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}var opts=_clone(options);delete opts.format;opts.produceGeneralizedRdf=false;jsonld.toRDF(input,opts,function(err,dataset){if(err){return callback(new JsonLdError("Could not convert input to RDF dataset before normalization.","jsonld.NormalizeError",{cause:err}))}(new Processor).normalize(dataset,options,callback)})};jsonld.fromRDF=function(dataset,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not convert from RDF, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("useRdfType"in options)){options.useRdfType=false}if(!("useNativeTypes"in options)){options.useNativeTypes=false}if(!("format"in options)&&_isString(dataset)){if(!("format"in options)){options.format="application/nquads"}}jsonld.nextTick(function(){if(options.format){var rdfParser=options.rdfParser||_rdfParsers[options.format];if(!rdfParser){throw new JsonLdError("Unknown input format.","jsonld.UnknownFormat",{format:options.format})}dataset=rdfParser(dataset,function(err,dataset){if(err){return callback(err)}fromRDF(dataset,options,callback)});if(dataset){if("then"in dataset){return dataset.then(function(dataset){fromRDF(dataset,options,callback)},callback)}fromRDF(dataset,options,callback)}}function fromRDF(dataset,options,callback){(new Processor).fromRDF(dataset,options,callback)}})};jsonld.toRDF=function(input,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not convert to RDF, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}jsonld.expand(input,options,function(err,expanded){if(err){return callback(new JsonLdError("Could not expand input before serialization to RDF.","jsonld.RdfError",{cause:err}))}var dataset;try{dataset=Processor.prototype.toRDF(expanded,options);if(options.format){if(options.format==="application/nquads"){return callback(null,_toNQuads(dataset))}throw new JsonLdError("Unknown output format.","jsonld.UnknownFormat",{format:options.format})}}catch(ex){return callback(ex)}callback(null,dataset)})};jsonld.relabelBlankNodes=function(input){_labelBlankNodes(new UniqueNamer("_:b",input))};jsonld.documentLoader=function(url,callback){var err=new JsonLdError("Could not retrieve a JSON-LD document from the URL. URL derefencing not "+"implemented.","jsonld.LoadDocumentError",{code:"loading document failed"});if(_nodejs){return callback(err,{contextUrl:null,documentUrl:url,document:null})}return jsonld.promisify(function(callback){callback(err)})};jsonld.loadDocument=function(url,callback){var promise=jsonld.documentLoader(url,callback);if(promise&&"then"in promise){promise.then(callback.bind(null,null),callback)}};jsonld.promises=function(){var slice=Array.prototype.slice;var promisify=jsonld.promisify;var api={};api.expand=function(input){if(arguments.length<1){throw new TypeError("Could not expand, too few arguments.")}return promisify.apply(null,[jsonld.expand].concat(slice.call(arguments)))};api.compact=function(input,ctx){if(arguments.length<2){throw new TypeError("Could not compact, too few arguments.")}var compact=function(input,ctx,options,callback){jsonld.compact(input,ctx,options,function(err,compacted){callback(err,compacted)})};return promisify.apply(null,[compact].concat(slice.call(arguments)))};api.flatten=function(input){if(arguments.length<1){throw new TypeError("Could not flatten, too few arguments.")}return promisify.apply(null,[jsonld.flatten].concat(slice.call(arguments)))};api.frame=function(input,frame){if(arguments.length<2){throw new TypeError("Could not frame, too few arguments.")}return promisify.apply(null,[jsonld.frame].concat(slice.call(arguments)))};api.fromRDF=function(dataset){if(arguments.length<1){throw new TypeError("Could not convert from RDF, too few arguments.")}return promisify.apply(null,[jsonld.fromRDF].concat(slice.call(arguments)))};api.toRDF=function(input){if(arguments.length<1){throw new TypeError("Could not convert to RDF, too few arguments.")}return promisify.apply(null,[jsonld.toRDF].concat(slice.call(arguments)))};api.normalize=function(input){if(arguments.length<1){throw new TypeError("Could not normalize, too few arguments.")}return promisify.apply(null,[jsonld.normalize].concat(slice.call(arguments)))};return api};jsonld.promisify=function(op){var Promise=require("./Promise").Promise;var args=Array.prototype.slice.call(arguments,1);return new Promise(function(resolver){op.apply(null,args.concat(function(err,value){if(err){resolver.reject(err)}else{resolver.resolve(value)}}))})};function JsonLdProcessor(){}JsonLdProcessor.prototype=jsonld.promises();JsonLdProcessor.prototype.toString=function(){if(this instanceof JsonLdProcessor){return"[object JsonLdProcessor]"}return"[object JsonLdProcessorPrototype]"};jsonld.JsonLdProcessor=JsonLdProcessor;var canDefineProperty=!!Object.defineProperty;if(canDefineProperty){try{Object.defineProperty({},"x",{})}catch(e){canDefineProperty=false}}if(canDefineProperty){Object.defineProperty(JsonLdProcessor,"prototype",{writable:false,enumerable:false});Object.defineProperty(JsonLdProcessor.prototype,"constructor",{writable:true,enumerable:false,configurable:true,value:JsonLdProcessor})}if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){jsonld.setImmediate=setImmediate;jsonld.nextTick=function(callback){return setImmediate(callback)}}else{jsonld.setImmediate=function(callback){setTimeout(callback,0)};jsonld.nextTick=jsonld.setImmediate}}else{jsonld.nextTick=process.nextTick;if(typeof setImmediate==="function"){jsonld.setImmediate=setImmediate}else{jsonld.setImmediate=jsonld.nextTick}}jsonld.parseLinkHeader=function(header){var rval={};var entries=header.match(/(?:<[^>]*?>|"[^"]*?"|[^,])+/g);var rLinkHeader=/\s*<([^>]*?)>\s*(?:;\s*(.*))?/;for(var i=0;i<entries.length;++i){var match=entries[i].match(rLinkHeader);if(!match){continue}var result={target:match[1]};var params=match[2];var rParams=/(.*?)=(?:(?:"([^"]*?)")|([^"]*?))\s*(?:(?:;\s*)|$)/g;while(match=rParams.exec(params)){result[match[1]]=match[2]===undefined?match[3]:match[2]}var rel=result["rel"]||"";if(_isArray(rval[rel])){rval[rel].push(result)}else if(rel in rval){rval[rel]=[rval[rel],result]}else{rval[rel]=result}}return rval};jsonld.DocumentCache=function(size){this.order=[];this.cache={};this.size=size||50;this.expires=30*1e3};jsonld.DocumentCache.prototype.get=function(url){if(url in this.cache){var entry=this.cache[url];if(entry.expires>=+new Date){return entry.ctx}delete this.cache[url];this.order.splice(this.order.indexOf(url),1)}return null};jsonld.DocumentCache.prototype.set=function(url,ctx){if(this.order.length===this.size){delete this.cache[this.order.shift()]}this.order.push(url);this.cache[url]={ctx:ctx,expires:+new Date+this.expires}};jsonld.ActiveContextCache=function(size){this.order=[];this.cache={};this.size=size||100};jsonld.ActiveContextCache.prototype.get=function(activeCtx,localCtx){var key1=JSON.stringify(activeCtx);var key2=JSON.stringify(localCtx);var level1=this.cache[key1];if(level1&&key2 in level1){return level1[key2]}return null};jsonld.ActiveContextCache.prototype.set=function(activeCtx,localCtx,result){if(this.order.length===this.size){var entry=this.order.shift();delete this.cache[entry.activeCtx][entry.localCtx]}var key1=JSON.stringify(activeCtx);var key2=JSON.stringify(localCtx);this.order.push({activeCtx:key1,localCtx:key2});if(!(key1 in this.cache)){this.cache[key1]={}}this.cache[key1][key2]=_clone(result)};jsonld.cache={activeCtx:new jsonld.ActiveContextCache};jsonld.documentLoaders={};jsonld.documentLoaders.jquery=function($,options){options=options||{};var cache=new jsonld.DocumentCache;var loader=function(url,callback){if(options.secure&&url.indexOf("https")!==0){return callback(new JsonLdError("URL could not be dereferenced; secure mode is enabled and "+'the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:url}),{contextUrl:null,documentUrl:url,document:null})}var doc=cache.get(url);if(doc!==null){return callback(null,doc)}$.ajax({url:url,dataType:"json",crossDomain:true,success:function(data,textStatus,jqXHR){var doc={contextUrl:null,documentUrl:url,document:data};var contentType=jqXHR.getResponseHeader("Content-Type");var linkHeader=jqXHR.getResponseHeader("Link");if(linkHeader&&contentType!=="application/ld+json"){linkHeader=jsonld.parseLinkHeader(linkHeader)[LINK_HEADER_REL];if(_isArray(linkHeader)){return callback(new JsonLdError("URL could not be dereferenced, it has more than one "+"associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:url}),doc)}if(linkHeader){doc.contextUrl=linkHeader.target}}cache.set(url,doc);callback(null,doc)},error:function(jqXHR,textStatus,err){callback(new JsonLdError("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:url,cause:err}),{contextUrl:null,documentUrl:url,document:null})}})};var usePromise=typeof Promise!=="undefined";if("usePromise"in options){usePromise=options.usePromise}if(usePromise){return function(url){return jsonld.promisify(loader,url)}}return loader};jsonld.documentLoaders.node=function(options){options=options||{};var maxRedirects="maxRedirects"in options?options.maxRedirects:-1;var request=require("request");var http=require("http");var cache=new jsonld.DocumentCache;function loadDocument(url,redirects,callback){if(options.secure&&url.indexOf("https")!==0){return callback(new JsonLdError("URL could not be dereferenced; secure mode is enabled and "+'the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:url}),{contextUrl:null,documentUrl:url,document:null})}var doc=cache.get(url);if(doc!==null){return callback(null,doc)}request({url:url,strictSSL:true,followRedirect:false},function(err,res,body){doc={contextUrl:null,documentUrl:url,document:body||null};if(err){return callback(new JsonLdError("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:url,cause:err}),doc)}var statusText=http.STATUS_CODES[res.statusCode];if(res.statusCode>=400){return callback(new JsonLdError("URL could not be dereferenced: "+statusText,"jsonld.InvalidUrl",{code:"loading document failed",url:url,httpStatusCode:res.statusCode}),doc)}if(res.headers.link&&res.headers["content-type"]!=="application/ld+json"){var linkHeader=jsonld.parseLinkHeader(res.headers.link)[LINK_HEADER_REL];if(_isArray(linkHeader)){return callback(new JsonLdError("URL could not be dereferenced, it has more than one associated "+"HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:url}),doc)}if(linkHeader){doc.contextUrl=linkHeader.target}}if(res.statusCode>=300&&res.statusCode<400&&res.headers.location){if(redirects.length===maxRedirects){return callback(new JsonLdError("URL could not be dereferenced; there were too many redirects.","jsonld.TooManyRedirects",{code:"loading document failed",url:url,httpStatusCode:res.statusCode,redirects:redirects}),doc)}if(redirects.indexOf(url)!==-1){return callback(new JsonLdError("URL could not be dereferenced; infinite redirection was detected.","jsonld.InfiniteRedirectDetected",{code:"recursive context inclusion",url:url,httpStatusCode:res.statusCode,redirects:redirects}),doc)}redirects.push(url);return loadDocument(res.headers.location,redirects,callback)}redirects.push(url);for(var i=0;i<redirects.length;++i){cache.set(redirects[i],{contextUrl:null,documentUrl:redirects[i],document:body})}callback(err,doc)})}var loader=function(url,callback){loadDocument(url,[],callback)};if(options.usePromise){return function(url){return jsonld.promisify(loader,url)}}return loader};jsonld.documentLoaders.xhr=function(options){var rlink=/(^|(\r\n))link:/i;options=options||{};var cache=new jsonld.DocumentCache;var loader=function(url,callback){if(options.secure&&url.indexOf("https")!==0){return callback(new JsonLdError("URL could not be dereferenced; secure mode is enabled and "+'the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:url}),{contextUrl:null,documentUrl:url,document:null})}var doc=cache.get(url);if(doc!==null){return callback(null,doc)}var xhr=options.xhr||XMLHttpRequest;var req=new xhr;req.onload=function(e){var doc={contextUrl:null,documentUrl:url,document:req.response};var contentType=req.getResponseHeader("Content-Type");var linkHeader;if(rlink.test(req.getAllResponseHeaders())){linkHeader=req.getResponseHeader("Link")}if(linkHeader&&contentType!=="application/ld+json"){linkHeader=jsonld.parseLinkHeader(linkHeader)[LINK_HEADER_REL];if(_isArray(linkHeader)){return callback(new JsonLdError("URL could not be dereferenced, it has more than one "+"associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:url}),doc)}if(linkHeader){doc.contextUrl=linkHeader.target}}cache.set(url,doc);callback(null,doc)};req.onerror=function(){callback(new JsonLdError("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:url}),{contextUrl:null,documentUrl:url,document:null})};req.open("GET",url,true);req.send()};var usePromise=typeof Promise!=="undefined";if("usePromise"in options){usePromise=options.usePromise}if(usePromise){return function(url){return jsonld.promisify(loader,url)}}return loader};jsonld.useDocumentLoader=function(type){if(!(type in jsonld.documentLoaders)){throw new JsonLdError('Unknown document loader type: "'+type+'"',"jsonld.UnknownDocumentLoader",{type:type})}jsonld.documentLoader=jsonld.documentLoaders[type].apply(jsonld,Array.prototype.slice.call(arguments,1))};jsonld.processContext=function(activeCtx,localCtx){var options={};var callbackArg=2;if(arguments.length>3){options=arguments[2]||{};callbackArg+=1}var callback=arguments[callbackArg];if(!("base"in options)){options.base=""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}if(localCtx===null){return callback(null,_getInitialContext(options))}localCtx=_clone(localCtx);if(_isString(localCtx)||_isObject(localCtx)&&!("@context"in localCtx)){localCtx={"@context":localCtx}}_retrieveContextUrls(localCtx,options,function(err,ctx){if(err){return callback(err)}try{ctx=(new Processor).processContext(activeCtx,ctx,options)}catch(ex){return callback(ex)}callback(null,ctx)})};jsonld.hasProperty=function(subject,property){var rval=false;if(property in subject){var value=subject[property];rval=!_isArray(value)||value.length>0}return rval};jsonld.hasValue=function(subject,property,value){var rval=false;if(jsonld.hasProperty(subject,property)){var val=subject[property];var isList=_isList(val);if(_isArray(val)||isList){if(isList){val=val["@list"]}for(var i=0;i<val.length;++i){if(jsonld.compareValues(value,val[i])){rval=true;break}}}else if(!_isArray(value)){rval=jsonld.compareValues(value,val)}}return rval};jsonld.addValue=function(subject,property,value,options){options=options||{};if(!("propertyIsArray"in options)){options.propertyIsArray=false}if(!("allowDuplicate"in options)){options.allowDuplicate=true}if(_isArray(value)){if(value.length===0&&options.propertyIsArray&&!(property in subject)){subject[property]=[]}for(var i=0;i<value.length;++i){jsonld.addValue(subject,property,value[i],options)}}else if(property in subject){var hasValue=!options.allowDuplicate&&jsonld.hasValue(subject,property,value);if(!_isArray(subject[property])&&(!hasValue||options.propertyIsArray)){subject[property]=[subject[property]]}if(!hasValue){subject[property].push(value)}}else{subject[property]=options.propertyIsArray?[value]:value}};jsonld.getValues=function(subject,property){var rval=subject[property]||[];if(!_isArray(rval)){rval=[rval]}return rval};jsonld.removeProperty=function(subject,property){delete subject[property]};jsonld.removeValue=function(subject,property,value,options){options=options||{};if(!("propertyIsArray"in options)){options.propertyIsArray=false}var values=jsonld.getValues(subject,property).filter(function(e){return!jsonld.compareValues(e,value)});if(values.length===0){jsonld.removeProperty(subject,property)}else if(values.length===1&&!options.propertyIsArray){subject[property]=values[0]}else{subject[property]=values}};jsonld.compareValues=function(v1,v2){if(v1===v2){return true}if(_isValue(v1)&&_isValue(v2)&&v1["@value"]===v2["@value"]&&v1["@type"]===v2["@type"]&&v1["@language"]===v2["@language"]&&v1["@index"]===v2["@index"]){return true}if(_isObject(v1)&&"@id"in v1&&_isObject(v2)&&"@id"in v2){return v1["@id"]===v2["@id"]}return false};jsonld.getContextValue=function(ctx,key,type){var rval=null;if(key===null){return rval}if(type==="@language"&&type in ctx){rval=ctx[type]}if(ctx.mappings[key]){var entry=ctx.mappings[key];if(_isUndefined(type)){rval=entry}else if(type in entry){rval=entry[type]}}return rval};var _rdfParsers={};jsonld.registerRDFParser=function(contentType,parser){_rdfParsers[contentType]=parser};jsonld.unregisterRDFParser=function(contentType){delete _rdfParsers[contentType]};if(_nodejs){if(typeof XMLSerializer==="undefined"){var XMLSerializer=null}if(typeof Node==="undefined"){var Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}}}var XSD_BOOLEAN="http://www.w3.org/2001/XMLSchema#boolean";var XSD_DOUBLE="http://www.w3.org/2001/XMLSchema#double";
var XSD_INTEGER="http://www.w3.org/2001/XMLSchema#integer";var XSD_STRING="http://www.w3.org/2001/XMLSchema#string";var RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#";var RDF_LIST=RDF+"List";var RDF_FIRST=RDF+"first";var RDF_REST=RDF+"rest";var RDF_NIL=RDF+"nil";var RDF_TYPE=RDF+"type";var RDF_PLAIN_LITERAL=RDF+"PlainLiteral";var RDF_XML_LITERAL=RDF+"XMLLiteral";var RDF_OBJECT=RDF+"object";var RDF_LANGSTRING=RDF+"langString";var LINK_HEADER_REL="http://www.w3.org/ns/json-ld#context";var MAX_CONTEXT_URLS=10;var JsonLdError=function(msg,type,details){if(_nodejs){Error.call(this);Error.captureStackTrace(this,this.constructor)}this.name=type||"jsonld.Error";this.message=msg||"An unspecified JSON-LD error occurred.";this.details=details||{}};if(_nodejs){require("util").inherits(JsonLdError,Error)}var Processor=function(){};Processor.prototype.compact=function(activeCtx,activeProperty,element,options){if(_isArray(element)){var rval=[];for(var i=0;i<element.length;++i){var compacted=this.compact(activeCtx,activeProperty,element[i],options);if(compacted!==null){rval.push(compacted)}}if(options.compactArrays&&rval.length===1){var container=jsonld.getContextValue(activeCtx,activeProperty,"@container");if(container===null){rval=rval[0]}}return rval}if(_isObject(element)){if(_isValue(element)||_isSubjectReference(element)){return _compactValue(activeCtx,activeProperty,element)}var insideReverse=activeProperty==="@reverse";var keys=Object.keys(element).sort();var rval={};for(var ki=0;ki<keys.length;++ki){var expandedProperty=keys[ki];var expandedValue=element[expandedProperty];if(expandedProperty==="@id"||expandedProperty==="@type"){var compactedValue;if(_isString(expandedValue)){compactedValue=_compactIri(activeCtx,expandedValue,null,{vocab:expandedProperty==="@type"})}else{compactedValue=[];for(var vi=0;vi<expandedValue.length;++vi){compactedValue.push(_compactIri(activeCtx,expandedValue[vi],null,{vocab:true}))}}var alias=_compactIri(activeCtx,expandedProperty);var isArray=_isArray(compactedValue)&&expandedValue.length===0;jsonld.addValue(rval,alias,compactedValue,{propertyIsArray:isArray});continue}if(expandedProperty==="@reverse"){var compactedValue=this.compact(activeCtx,"@reverse",expandedValue,options);for(var compactedProperty in compactedValue){if(activeCtx.mappings[compactedProperty]&&activeCtx.mappings[compactedProperty].reverse){var value=compactedValue[compactedProperty];var container=jsonld.getContextValue(activeCtx,compactedProperty,"@container");var useArray=container==="@set"||!options.compactArrays;jsonld.addValue(rval,compactedProperty,value,{propertyIsArray:useArray});delete compactedValue[compactedProperty]}}if(Object.keys(compactedValue).length>0){var alias=_compactIri(activeCtx,expandedProperty);jsonld.addValue(rval,alias,compactedValue)}continue}if(expandedProperty==="@index"){var container=jsonld.getContextValue(activeCtx,activeProperty,"@container");if(container==="@index"){continue}var alias=_compactIri(activeCtx,expandedProperty);jsonld.addValue(rval,alias,expandedValue);continue}if(expandedValue.length===0){var itemActiveProperty=_compactIri(activeCtx,expandedProperty,expandedValue,{vocab:true},insideReverse);jsonld.addValue(rval,itemActiveProperty,expandedValue,{propertyIsArray:true})}for(var vi=0;vi<expandedValue.length;++vi){var expandedItem=expandedValue[vi];var itemActiveProperty=_compactIri(activeCtx,expandedProperty,expandedItem,{vocab:true},insideReverse);var container=jsonld.getContextValue(activeCtx,itemActiveProperty,"@container");var isList=_isList(expandedItem);var list=null;if(isList){list=expandedItem["@list"]}var compactedItem=this.compact(activeCtx,itemActiveProperty,isList?list:expandedItem,options);if(isList){if(!_isArray(compactedItem)){compactedItem=[compactedItem]}if(container!=="@list"){var wrapper={};wrapper[_compactIri(activeCtx,"@list")]=compactedItem;compactedItem=wrapper;if("@index"in expandedItem){compactedItem[_compactIri(activeCtx,"@index")]=expandedItem["@index"]}}else if(itemActiveProperty in rval){throw new JsonLdError('JSON-LD compact error; property has a "@list" @container '+"rule but there is more than a single @list that matches "+"the compacted term in the document. Compaction might mix "+"unwanted items into the list.","jsonld.SyntaxError",{code:"compaction to list of lists"})}}if(container==="@language"||container==="@index"){var mapObject;if(itemActiveProperty in rval){mapObject=rval[itemActiveProperty]}else{rval[itemActiveProperty]=mapObject={}}if(container==="@language"&&_isValue(compactedItem)){compactedItem=compactedItem["@value"]}jsonld.addValue(mapObject,expandedItem[container],compactedItem)}else{var isArray=!options.compactArrays||container==="@set"||container==="@list"||_isArray(compactedItem)&&compactedItem.length===0||expandedProperty==="@list"||expandedProperty==="@graph";jsonld.addValue(rval,itemActiveProperty,compactedItem,{propertyIsArray:isArray})}}}return rval}return element};Processor.prototype.expand=function(activeCtx,activeProperty,element,options,insideList){var self=this;if(element===null||element===undefined){return null}if(!_isArray(element)&&!_isObject(element)){if(!insideList&&(activeProperty===null||_expandIri(activeCtx,activeProperty,{vocab:true})==="@graph")){return null}return _expandValue(activeCtx,activeProperty,element)}if(_isArray(element)){var rval=[];var container=jsonld.getContextValue(activeCtx,activeProperty,"@container");insideList=insideList||container==="@list";for(var i=0;i<element.length;++i){var e=self.expand(activeCtx,activeProperty,element[i],options);if(insideList&&(_isArray(e)||_isList(e))){throw new JsonLdError("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"})}if(e!==null){if(_isArray(e)){rval=rval.concat(e)}else{rval.push(e)}}}return rval}if("@context"in element){activeCtx=self.processContext(activeCtx,element["@context"],options)}var expandedActiveProperty=_expandIri(activeCtx,activeProperty,{vocab:true});var rval={};var keys=Object.keys(element).sort();for(var ki=0;ki<keys.length;++ki){var key=keys[ki];var value=element[key];var expandedValue;if(key==="@context"){continue}var expandedProperty=_expandIri(activeCtx,key,{vocab:true});if(expandedProperty===null||!(_isAbsoluteIri(expandedProperty)||_isKeyword(expandedProperty))){continue}if(_isKeyword(expandedProperty)){if(expandedActiveProperty==="@reverse"){throw new JsonLdError("Invalid JSON-LD syntax; a keyword cannot be used as a @reverse "+"property.","jsonld.SyntaxError",{code:"invalid reverse property map",value:value})}if(expandedProperty in rval){throw new JsonLdError("Invalid JSON-LD syntax; colliding keywords detected.","jsonld.SyntaxError",{code:"colliding keywords",keyword:expandedProperty})}}if(expandedProperty==="@id"&&!_isString(value)){if(!options.isFrame){throw new JsonLdError('Invalid JSON-LD syntax; "@id" value must a string.',"jsonld.SyntaxError",{code:"invalid @id value",value:value})}if(!_isObject(value)){throw new JsonLdError('Invalid JSON-LD syntax; "@id" value must be a string or an '+"object.","jsonld.SyntaxError",{code:"invalid @id value",value:value})}}if(expandedProperty==="@type"){_validateTypeValue(value)}if(expandedProperty==="@graph"&&!(_isObject(value)||_isArray(value))){throw new JsonLdError('Invalid JSON-LD syntax; "@graph" value must not be an '+"object or an array.","jsonld.SyntaxError",{code:"invalid @graph value",value:value})}if(expandedProperty==="@value"&&(_isObject(value)||_isArray(value))){throw new JsonLdError('Invalid JSON-LD syntax; "@value" value must not be an '+"object or an array.","jsonld.SyntaxError",{code:"invalid value object value",value:value})}if(expandedProperty==="@language"){if(!_isString(value)){throw new JsonLdError('Invalid JSON-LD syntax; "@language" value must be a string.',"jsonld.SyntaxError",{code:"invalid language-tagged string",value:value})}value=value.toLowerCase()}if(expandedProperty==="@index"){if(!_isString(value)){throw new JsonLdError('Invalid JSON-LD syntax; "@index" value must be a string.',"jsonld.SyntaxError",{code:"invalid @index value",value:value})}}if(expandedProperty==="@reverse"){if(!_isObject(value)){throw new JsonLdError('Invalid JSON-LD syntax; "@reverse" value must be an object.',"jsonld.SyntaxError",{code:"invalid @reverse value",value:value})}expandedValue=self.expand(activeCtx,"@reverse",value,options);if("@reverse"in expandedValue){for(var property in expandedValue["@reverse"]){jsonld.addValue(rval,property,expandedValue["@reverse"][property],{propertyIsArray:true})}}var reverseMap=rval["@reverse"]||null;for(var property in expandedValue){if(property==="@reverse"){continue}if(reverseMap===null){reverseMap=rval["@reverse"]={}}jsonld.addValue(reverseMap,property,[],{propertyIsArray:true});var items=expandedValue[property];for(var ii=0;ii<items.length;++ii){var item=items[ii];if(_isValue(item)||_isList(item)){throw new JsonLdError('Invalid JSON-LD syntax; "@reverse" value must not be a '+"@value or an @list.","jsonld.SyntaxError",{code:"invalid reverse property value",value:expandedValue})}jsonld.addValue(reverseMap,property,item,{propertyIsArray:true})}}continue}var container=jsonld.getContextValue(activeCtx,key,"@container");if(container==="@language"&&_isObject(value)){expandedValue=_expandLanguageMap(value)}else if(container==="@index"&&_isObject(value)){expandedValue=function _expandIndexMap(activeProperty){var rval=[];var keys=Object.keys(value).sort();for(var ki=0;ki<keys.length;++ki){var key=keys[ki];var val=value[key];if(!_isArray(val)){val=[val]}val=self.expand(activeCtx,activeProperty,val,options,false);for(var vi=0;vi<val.length;++vi){var item=val[vi];if(!("@index"in item)){item["@index"]=key}rval.push(item)}}return rval}(key)}else{var isList=expandedProperty==="@list";if(isList||expandedProperty==="@set"){var nextActiveProperty=activeProperty;if(isList&&expandedActiveProperty==="@graph"){nextActiveProperty=null}expandedValue=self.expand(activeCtx,nextActiveProperty,value,options,isList);if(isList&&_isList(expandedValue)){throw new JsonLdError("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"})}}else{expandedValue=self.expand(activeCtx,key,value,options,false)}}if(expandedValue===null&&expandedProperty!=="@value"){continue}if(expandedProperty!=="@list"&&!_isList(expandedValue)&&container==="@list"){expandedValue=_isArray(expandedValue)?expandedValue:[expandedValue];expandedValue={"@list":expandedValue}}if(activeCtx.mappings[key]&&activeCtx.mappings[key].reverse){var reverseMap=rval["@reverse"]={};if(!_isArray(expandedValue)){expandedValue=[expandedValue]}for(var ii=0;ii<expandedValue.length;++ii){var item=expandedValue[ii];if(_isValue(item)||_isList(item)){throw new JsonLdError('Invalid JSON-LD syntax; "@reverse" value must not be a '+"@value or an @list.","jsonld.SyntaxError",{code:"invalid reverse property value",value:expandedValue})}jsonld.addValue(reverseMap,expandedProperty,item,{propertyIsArray:true})}continue}var useArray=["@index","@id","@type","@value","@language"].indexOf(expandedProperty)===-1;jsonld.addValue(rval,expandedProperty,expandedValue,{propertyIsArray:useArray})}keys=Object.keys(rval);var count=keys.length;if("@value"in rval){if("@type"in rval&&"@language"in rval){throw new JsonLdError('Invalid JSON-LD syntax; an element containing "@value" may not '+'contain both "@type" and "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:rval})}var validCount=count-1;if("@type"in rval){validCount-=1}if("@index"in rval){validCount-=1}if("@language"in rval){validCount-=1}if(validCount!==0){throw new JsonLdError('Invalid JSON-LD syntax; an element containing "@value" may only '+'have an "@index" property and at most one other property '+'which can be "@type" or "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:rval})}if(rval["@value"]===null){rval=null}else if("@language"in rval&&!_isString(rval["@value"])){throw new JsonLdError("Invalid JSON-LD syntax; only strings may be language-tagged.","jsonld.SyntaxError",{code:"invalid language-tagged value",element:rval})}else if("@type"in rval&&(!_isAbsoluteIri(rval["@type"])||rval["@type"].indexOf("_:")===0)){throw new JsonLdError('Invalid JSON-LD syntax; an element containing "@value" and "@type" '+'must have an absolute IRI for the value of "@type".',"jsonld.SyntaxError",{code:"invalid typed value",element:rval})}}else if("@type"in rval&&!_isArray(rval["@type"])){rval["@type"]=[rval["@type"]]}else if("@set"in rval||"@list"in rval){if(count>1&&!(count===2&&"@index"in rval)){throw new JsonLdError('Invalid JSON-LD syntax; if an element has the property "@set" '+'or "@list", then it can have at most one other property that is '+'"@index".',"jsonld.SyntaxError",{code:"invalid set or list object",element:rval})}if("@set"in rval){rval=rval["@set"];keys=Object.keys(rval);count=keys.length}}else if(count===1&&"@language"in rval){rval=null}if(_isObject(rval)&&!options.keepFreeFloatingNodes&&!insideList&&(activeProperty===null||expandedActiveProperty==="@graph")){if(count===0||"@value"in rval||"@list"in rval||count===1&&"@id"in rval){rval=null}}return rval};Processor.prototype.flatten=function(input){var namer=new UniqueNamer("_:b");var graphs={"@default":{}};_createNodeMap(input,graphs,"@default",namer);var defaultGraph=graphs["@default"];var graphNames=Object.keys(graphs).sort();for(var i=0;i<graphNames.length;++i){var graphName=graphNames[i];if(graphName==="@default"){continue}var nodeMap=graphs[graphName];var subject=defaultGraph[graphName];if(!subject){defaultGraph[graphName]=subject={"@id":graphName,"@graph":[]}}else if(!("@graph"in subject)){subject["@graph"]=[]}var graph=subject["@graph"];var ids=Object.keys(nodeMap).sort();for(var ii=0;ii<ids.length;++ii){var node=nodeMap[ids[ii]];if(!_isSubjectReference(node)){graph.push(node)}}}var flattened=[];var keys=Object.keys(defaultGraph).sort();for(var ki=0;ki<keys.length;++ki){var node=defaultGraph[keys[ki]];if(!_isSubjectReference(node)){flattened.push(node)}}return flattened};Processor.prototype.frame=function(input,frame,options){var state={options:options,graphs:{"@default":{},"@merged":{}}};var namer=new UniqueNamer("_:b");_createNodeMap(input,state.graphs,"@merged",namer);state.subjects=state.graphs["@merged"];var framed=[];_frame(state,Object.keys(state.subjects).sort(),frame,framed,null);return framed};Processor.prototype.normalize=function(dataset,options,callback){var quads=[];var bnodes={};for(var graphName in dataset){var triples=dataset[graphName];if(graphName==="@default"){graphName=null}for(var ti=0;ti<triples.length;++ti){var quad=triples[ti];if(graphName!==null){if(graphName.indexOf("_:")===0){quad.name={type:"blank node",value:graphName}}else{quad.name={type:"IRI",value:graphName}}}quads.push(quad);var attrs=["subject","object","name"];for(var ai=0;ai<attrs.length;++ai){var attr=attrs[ai];if(quad[attr]&&quad[attr].type==="blank node"){var id=quad[attr].value;if(id in bnodes){bnodes[id].quads.push(quad)}else{bnodes[id]={quads:[quad]}}}}}}var namer=new UniqueNamer("_:c14n");return hashBlankNodes(Object.keys(bnodes));function hashBlankNodes(unnamed){var nextUnnamed=[];var duplicates={};var unique={};jsonld.setImmediate(function(){hashUnnamed(0)});function hashUnnamed(i){if(i===unnamed.length){return nameBlankNodes(unique,duplicates,nextUnnamed)}var bnode=unnamed[i];var hash=_hashQuads(bnode,bnodes,namer);if(hash in duplicates){duplicates[hash].push(bnode);nextUnnamed.push(bnode)}else if(hash in unique){duplicates[hash]=[unique[hash],bnode];nextUnnamed.push(unique[hash]);nextUnnamed.push(bnode);delete unique[hash]}else{unique[hash]=bnode}jsonld.setImmediate(function(){hashUnnamed(i+1)})}}function nameBlankNodes(unique,duplicates,unnamed){var named=false;var hashes=Object.keys(unique).sort();for(var i=0;i<hashes.length;++i){var bnode=unique[hashes[i]];namer.getName(bnode);named=true}if(named){hashBlankNodes(unnamed)}else{nameDuplicates(duplicates)}}function nameDuplicates(duplicates){var hashes=Object.keys(duplicates).sort();processGroup(0);function processGroup(i){if(i===hashes.length){return createArray()}var group=duplicates[hashes[i]];var results=[];nameGroupMember(group,0);function nameGroupMember(group,n){if(n===group.length){results.sort(function(a,b){a=a.hash;b=b.hash;return a<b?-1:a>b?1:0});for(var r in results){for(var key in results[r].pathNamer.existing){namer.getName(key)}}return processGroup(i+1)}var bnode=group[n];if(namer.isNamed(bnode)){return nameGroupMember(group,n+1)}var pathNamer=new UniqueNamer("_:b");pathNamer.getName(bnode);_hashPaths(bnode,bnodes,namer,pathNamer,function(err,result){if(err){return callback(err)}results.push(result);nameGroupMember(group,n+1)})}}}function createArray(){var normalized=[];for(var i=0;i<quads.length;++i){var quad=quads[i];var attrs=["subject","object","name"];for(var ai=0;ai<attrs.length;++ai){var attr=attrs[ai];if(quad[attr]&&quad[attr].type==="blank node"&&quad[attr].value.indexOf("_:c14n")!==0){quad[attr].value=namer.getName(quad[attr].value)}}normalized.push(_toNQuad(quad,quad.name?quad.name.value:null))}normalized.sort();if(options.format){if(options.format==="application/nquads"){return callback(null,normalized.join(""))}return callback(new JsonLdError("Unknown output format.","jsonld.UnknownFormat",{format:options.format}))}callback(null,_parseNQuads(normalized.join("")))}};Processor.prototype.fromRDF=function(dataset,options,callback){var defaultGraph={};var graphMap={"@default":defaultGraph};for(var name in dataset){var graph=dataset[name];if(!(name in graphMap)){graphMap[name]={}}if(name!=="@default"&&!(name in defaultGraph)){defaultGraph[name]={"@id":name}}var nodeMap=graphMap[name];for(var ti=0;ti<graph.length;++ti){var triple=graph[ti];var s=triple.subject.value;var p=triple.predicate.value;var o=triple.object;if(!(s in nodeMap)){nodeMap[s]={"@id":s}}var node=nodeMap[s];var objectIsId=o.type==="IRI"||o.type==="blank node";if(objectIsId&&!(o.value in nodeMap)){nodeMap[o.value]={"@id":o.value}}if(p===RDF_TYPE&&!options.useRdfType&&objectIsId){jsonld.addValue(node,"@type",o.value,{propertyIsArray:true});continue}var value=_RDFToObject(o,options.useNativeTypes);jsonld.addValue(node,p,value,{propertyIsArray:true});if(objectIsId){var object=nodeMap[o.value];if(!("usages"in object)){object.usages=[]}object.usages.push({node:node,property:p,value:value})}}}for(var name in graphMap){var graphObject=graphMap[name];if(!(RDF_NIL in graphObject)){continue}var nil=graphObject[RDF_NIL];for(var i=0;i<nil.usages.length;++i){var usage=nil.usages[i];var node=usage.node;var property=usage.property;var head=usage.value;var list=[];var listNodes=[];var nodeKeyCount=Object.keys(node).length;while(property===RDF_REST&&node.usages.length===1&&_isArray(node[RDF_FIRST])&&node[RDF_FIRST].length===1&&_isArray(node[RDF_REST])&&node[RDF_REST].length===1&&(nodeKeyCount===4||nodeKeyCount===5&&_isArray(node["@type"])&&node["@type"].length===1&&node["@type"][0]===RDF_LIST)){list.push(node[RDF_FIRST][0]);listNodes.push(node["@id"]);usage=node.usages[0];node=usage.node;property=usage.property;head=usage.value;nodeKeyCount=Object.keys(node).length;if(node["@id"].indexOf("_:")!==0){break}}if(property===RDF_FIRST){if(node["@id"]===RDF_NIL){continue}head=graphObject[head["@id"]][RDF_REST][0];list.pop();listNodes.pop()}delete head["@id"];head["@list"]=list.reverse();for(var j=0;j<listNodes.length;++j){delete graphObject[listNodes[j]]}}}var result=[];var subjects=Object.keys(defaultGraph).sort();for(var i=0;i<subjects.length;++i){var subject=subjects[i];var node=defaultGraph[subject];if(subject in graphMap){var graph=node["@graph"]=[];var graphObject=graphMap[subject];var subjects_=Object.keys(graphObject).sort();for(var si=0;si<subjects_.length;++si){var node_=graphObject[subjects_[si]];delete node_.usages;if(!_isSubjectReference(node_)){graph.push(node_)}}}delete node.usages;if(!_isSubjectReference(node)){result.push(node)}}callback(null,result)};Processor.prototype.toRDF=function(input,options){var namer=new UniqueNamer("_:b");var nodeMap={"@default":{}};_createNodeMap(input,nodeMap,"@default",namer);var dataset={};var graphNames=Object.keys(nodeMap).sort();for(var i=0;i<graphNames.length;++i){var graphName=graphNames[i];if(graphName==="@default"||_isAbsoluteIri(graphName)){dataset[graphName]=_graphToRDF(nodeMap[graphName],namer,options)}}return dataset};Processor.prototype.processContext=function(activeCtx,localCtx,options){if(_isObject(localCtx)&&"@context"in localCtx&&_isArray(localCtx["@context"])){localCtx=localCtx["@context"]}var ctxs=_isArray(localCtx)?localCtx:[localCtx];if(ctxs.length===0){return activeCtx.clone()}var rval=activeCtx;var mustClone=true;for(var i=0;i<ctxs.length;++i){var ctx=ctxs[i];if(ctx===null){rval=_getInitialContext(options);mustClone=false;continue}if(_isObject(ctx)&&"@context"in ctx){ctx=ctx["@context"]}if(!_isObject(ctx)){throw new JsonLdError("Invalid JSON-LD syntax; @context must be an object.","jsonld.SyntaxError",{code:"invalid local context",context:ctx})}if(jsonld.cache.activeCtx){var cached=jsonld.cache.activeCtx.get(activeCtx,ctx);if(cached){rval=cached;mustClone=true;continue}}if(mustClone){rval=rval.clone();mustClone=false}var defined={};if("@base"in ctx){var base=ctx["@base"];if(base===null){base=null}else if(!_isString(base)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@base" in a '+"@context must be a string or null.","jsonld.SyntaxError",{code:"invalid base IRI",context:ctx})}else if(base!==""&&!_isAbsoluteIri(base)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@base" in a '+"@context must be an absolute IRI or the empty string.","jsonld.SyntaxError",{code:"invalid base IRI",context:ctx})}if(base!==null){base=jsonld.url.parse(base||"")}rval["@base"]=base;defined["@base"]=true}if("@vocab"in ctx){var value=ctx["@vocab"];if(value===null){delete rval["@vocab"]}else if(!_isString(value)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@vocab" in a '+"@context must be a string or null.","jsonld.SyntaxError",{code:"invalid vocab mapping",context:ctx})}else if(!_isAbsoluteIri(value)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@vocab" in a '+"@context must be an absolute IRI.","jsonld.SyntaxError",{code:"invalid vocab mapping",context:ctx})}else{rval["@vocab"]=value}defined["@vocab"]=true}if("@language"in ctx){var value=ctx["@language"];if(value===null){delete rval["@language"]}else if(!_isString(value)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@language" in a '+"@context must be a string or null.","jsonld.SyntaxError",{code:"invalid default language",context:ctx})}else{rval["@language"]=value.toLowerCase()}defined["@language"]=true}for(var key in ctx){_createTermDefinition(rval,ctx,key,defined)}if(jsonld.cache.activeCtx){jsonld.cache.activeCtx.set(activeCtx,ctx,rval)}}return rval};function _expandLanguageMap(languageMap){var rval=[];var keys=Object.keys(languageMap).sort();for(var ki=0;ki<keys.length;++ki){var key=keys[ki];var val=languageMap[key];if(!_isArray(val)){val=[val]}for(var vi=0;vi<val.length;++vi){var item=val[vi];if(!_isString(item)){throw new JsonLdError("Invalid JSON-LD syntax; language map values must be strings.","jsonld.SyntaxError",{code:"invalid language map value",languageMap:languageMap})}rval.push({"@value":item,"@language":key.toLowerCase()})}}return rval}function _labelBlankNodes(namer,element){if(_isArray(element)){for(var i=0;i<element.length;++i){element[i]=_labelBlankNodes(namer,element[i])}}else if(_isList(element)){element["@list"]=_labelBlankNodes(namer,element["@list"])}else if(_isObject(element)){if(_isBlankNode(element)){element["@id"]=namer.getName(element["@id"])}var keys=Object.keys(element).sort();for(var ki=0;ki<keys.length;++ki){var key=keys[ki];if(key!=="@id"){element[key]=_labelBlankNodes(namer,element[key])}}}return element}function _expandValue(activeCtx,activeProperty,value){if(value===null){return null}var expandedProperty=_expandIri(activeCtx,activeProperty,{vocab:true});if(expandedProperty==="@id"){return _expandIri(activeCtx,value,{base:true})}else if(expandedProperty==="@type"){return _expandIri(activeCtx,value,{vocab:true,base:true})}var type=jsonld.getContextValue(activeCtx,activeProperty,"@type");if(type==="@id"||expandedProperty==="@graph"&&_isString(value)){return{"@id":_expandIri(activeCtx,value,{base:true})}}if(type==="@vocab"){return{"@id":_expandIri(activeCtx,value,{vocab:true,base:true})}}if(_isKeyword(expandedProperty)){return value}rval={};if(type!==null){rval["@type"]=type}else if(_isString(value)){var language=jsonld.getContextValue(activeCtx,activeProperty,"@language");if(language!==null){rval["@language"]=language}}rval["@value"]=value;return rval}function _graphToRDF(graph,namer,options){var rval=[];var ids=Object.keys(graph).sort();for(var i=0;i<ids.length;++i){var id=ids[i];var node=graph[id];var properties=Object.keys(node).sort();for(var pi=0;pi<properties.length;++pi){var property=properties[pi];var items=node[property];if(property==="@type"){property=RDF_TYPE}else if(_isKeyword(property)){continue}for(var ii=0;ii<items.length;++ii){var item=items[ii];var subject={};subject.type=id.indexOf("_:")===0?"blank node":"IRI";subject.value=id;if(!_isAbsoluteIri(id)){continue}var predicate={};predicate.type=property.indexOf("_:")===0?"blank node":"IRI";predicate.value=property;if(!_isAbsoluteIri(property)){continue}if(predicate.type==="blank node"&&!options.produceGeneralizedRdf){continue}if(_isList(item)){_listToRDF(item["@list"],namer,subject,predicate,rval)}else{var object=_objectToRDF(item);if(object){rval.push({subject:subject,predicate:predicate,object:object})}}}}}return rval}function _listToRDF(list,namer,subject,predicate,triples){var first={type:"IRI",value:RDF_FIRST};var rest={type:"IRI",value:RDF_REST};var nil={type:"IRI",value:RDF_NIL};for(var i=0;i<list.length;++i){var item=list[i];var blankNode={type:"blank node",value:namer.getName()};triples.push({subject:subject,predicate:predicate,object:blankNode});subject=blankNode;predicate=first;var object=_objectToRDF(item);if(object){triples.push({subject:subject,predicate:predicate,object:object})}predicate=rest}triples.push({subject:subject,predicate:predicate,object:nil})}function _objectToRDF(item){var object={};if(_isValue(item)){object.type="literal";var value=item["@value"];var datatype=item["@type"]||null;if(_isBoolean(value)){object.value=value.toString();object.datatype=datatype||XSD_BOOLEAN}else if(_isDouble(value)||datatype===XSD_DOUBLE){object.value=value.toExponential(15).replace(/(\d)0*e\+?/,"$1E");object.datatype=datatype||XSD_DOUBLE}else if(_isNumber(value)){object.value=value.toFixed(0);object.datatype=datatype||XSD_INTEGER}else if("@language"in item){object.value=value;object.datatype=datatype||RDF_LANGSTRING;object.language=item["@language"]}else{object.value=value;object.datatype=datatype||XSD_STRING}}else{var id=_isObject(item)?item["@id"]:item;object.type=id.indexOf("_:")===0?"blank node":"IRI";object.value=id}if(object.type==="IRI"&&!_isAbsoluteIri(object.value)){return null}return object}function _RDFToObject(o,useNativeTypes){if(o.type==="IRI"||o.type==="blank node"){return{"@id":o.value}}var rval={"@value":o.value};if(o["language"]){rval["@language"]=o.language}else{var type=o.datatype;if(!type){type=XSD_STRING}if(useNativeTypes){if(type===XSD_BOOLEAN){if(rval["@value"]==="true"){rval["@value"]=true}else if(rval["@value"]==="false"){rval["@value"]=false}}else if(_isNumeric(rval["@value"])){if(type===XSD_INTEGER){var i=parseInt(rval["@value"]);if(i.toFixed(0)===rval["@value"]){rval["@value"]=i}}else if(type===XSD_DOUBLE){rval["@value"]=parseFloat(rval["@value"])}}if([XSD_BOOLEAN,XSD_INTEGER,XSD_DOUBLE,XSD_STRING].indexOf(type)===-1){rval["@type"]=type}}else if(type!==XSD_STRING){rval["@type"]=type}}return rval}function _compareRDFTriples(t1,t2){var attrs=["subject","predicate","object"];for(var i=0;i<attrs.length;++i){var attr=attrs[i];if(t1[attr].type!==t2[attr].type||t1[attr].value!==t2[attr].value){return false}}if(t1.object.language!==t2.object.language){return false}if(t1.object.datatype!==t2.object.datatype){return false}return true}function _hashQuads(id,bnodes,namer){if("hash"in bnodes[id]){return bnodes[id].hash}var quads=bnodes[id].quads;var nquads=[];for(var i=0;i<quads.length;++i){nquads.push(_toNQuad(quads[i],quads[i].name?quads[i].name.value:null,id))}nquads.sort();var hash=bnodes[id].hash=sha1.hash(nquads);return hash}function _hashPaths(id,bnodes,namer,pathNamer,callback){var md=sha1.create();var groups={};var groupHashes;var quads=bnodes[id].quads;jsonld.setImmediate(function(){groupNodes(0)});function groupNodes(i){if(i===quads.length){groupHashes=Object.keys(groups).sort();return hashGroup(0)}var quad=quads[i];var bnode=_getAdjacentBlankNodeName(quad.subject,id);var direction=null;if(bnode!==null){direction="p"}else{bnode=_getAdjacentBlankNodeName(quad.object,id);if(bnode!==null){direction="r"}}if(bnode!==null){var name;if(namer.isNamed(bnode)){name=namer.getName(bnode)}else if(pathNamer.isNamed(bnode)){name=pathNamer.getName(bnode)}else{name=_hashQuads(bnode,bnodes,namer)}var md=sha1.create();md.update(direction);md.update(quad.predicate.value);md.update(name);var groupHash=md.digest();if(groupHash in groups){groups[groupHash].push(bnode)}else{groups[groupHash]=[bnode]}}jsonld.setImmediate(function(){groupNodes(i+1)})}function hashGroup(i){if(i===groupHashes.length){return callback(null,{hash:md.digest(),pathNamer:pathNamer})}var groupHash=groupHashes[i];md.update(groupHash);var chosenPath=null;var chosenNamer=null;var permutator=new Permutator(groups[groupHash]);jsonld.setImmediate(function(){permutate()});function permutate(){var permutation=permutator.next();var pathNamerCopy=pathNamer.clone();var path="";var recurse=[];for(var n in permutation){var bnode=permutation[n];if(namer.isNamed(bnode)){path+=namer.getName(bnode)}else{if(!pathNamerCopy.isNamed(bnode)){recurse.push(bnode)}path+=pathNamerCopy.getName(bnode)}if(chosenPath!==null&&path.length>=chosenPath.length&&path>chosenPath){return nextPermutation(true)}}nextRecursion(0);function nextRecursion(n){if(n===recurse.length){return nextPermutation(false)}var bnode=recurse[n];_hashPaths(bnode,bnodes,namer,pathNamerCopy,function(err,result){if(err){return callback(err)}path+=pathNamerCopy.getName(bnode)+"<"+result.hash+">";pathNamerCopy=result.pathNamer;if(chosenPath!==null&&path.length>=chosenPath.length&&path>chosenPath){return nextPermutation(true)}nextRecursion(n+1)})}function nextPermutation(skipped){if(!skipped&&(chosenPath===null||path<chosenPath)){chosenPath=path;chosenNamer=pathNamerCopy}if(permutator.hasNext()){jsonld.setImmediate(function(){permutate()})}else{md.update(chosenPath);pathNamer=chosenNamer;hashGroup(i+1)}}}}}function _getAdjacentBlankNodeName(node,id){return node.type==="blank node"&&node.value!==id?node.value:null}function _createNodeMap(input,graphs,graph,namer,name,list){if(_isArray(input)){for(var i=0;i<input.length;++i){_createNodeMap(input[i],graphs,graph,namer,undefined,list)}return}if(!_isObject(input)){if(list){list.push(input)}return}if(_isValue(input)){if("@type"in input){var type=input["@type"];if(type.indexOf("_:")===0){input["@type"]=type=namer.getName(type)}}if(list){list.push(input)}return}if("@type"in input){var types=input["@type"];for(var i=0;i<types.length;++i){var type=types[i];if(type.indexOf("_:")===0){namer.getName(type)}}}if(_isUndefined(name)){name=_isBlankNode(input)?namer.getName(input["@id"]):input["@id"]}if(list){list.push({"@id":name})}var subjects=graphs[graph];var subject=subjects[name]=subjects[name]||{};subject["@id"]=name;var properties=Object.keys(input).sort();for(var pi=0;pi<properties.length;++pi){var property=properties[pi];if(property==="@id"){continue}if(property==="@reverse"){var referencedNode={"@id":name};var reverseMap=input["@reverse"];for(var reverseProperty in reverseMap){var items=reverseMap[reverseProperty];for(var ii=0;ii<items.length;++ii){var item=items[ii];
var itemName=item["@id"];if(_isBlankNode(item)){itemName=namer.getName(itemName)}_createNodeMap(item,graphs,graph,namer,itemName);jsonld.addValue(subjects[itemName],reverseProperty,referencedNode,{propertyIsArray:true,allowDuplicate:false})}}continue}if(property==="@graph"){if(!(name in graphs)){graphs[name]={}}var g=graph==="@merged"?graph:name;_createNodeMap(input[property],graphs,g,namer);continue}if(property!=="@type"&&_isKeyword(property)){if(property==="@index"&&"@index"in subject){throw new JsonLdError("Invalid JSON-LD syntax; conflicting @index property detected.","jsonld.SyntaxError",{code:"conflicting indexes",subject:subject})}subject[property]=input[property];continue}var objects=input[property];if(property.indexOf("_:")===0){property=namer.getName(property)}if(objects.length===0){jsonld.addValue(subject,property,[],{propertyIsArray:true});continue}for(var oi=0;oi<objects.length;++oi){var o=objects[oi];if(property==="@type"){o=o.indexOf("_:")===0?namer.getName(o):o}if(_isSubject(o)||_isSubjectReference(o)){var id=_isBlankNode(o)?namer.getName(o["@id"]):o["@id"];jsonld.addValue(subject,property,{"@id":id},{propertyIsArray:true,allowDuplicate:false});_createNodeMap(o,graphs,graph,namer,id)}else if(_isList(o)){var _list=[];_createNodeMap(o["@list"],graphs,graph,namer,name,_list);o={"@list":_list};jsonld.addValue(subject,property,o,{propertyIsArray:true,allowDuplicate:false})}else{_createNodeMap(o,graphs,graph,namer,name);jsonld.addValue(subject,property,o,{propertyIsArray:true,allowDuplicate:false})}}}}function _frame(state,subjects,frame,parent,property){_validateFrame(state,frame);frame=frame[0];var matches=_filterSubjects(state,subjects,frame);var options=state.options;var embedOn=_getFrameFlag(frame,options,"embed");var explicitOn=_getFrameFlag(frame,options,"explicit");var ids=Object.keys(matches).sort();for(var idx in ids){var id=ids[idx];if(property===null){state.embeds={}}var output={};output["@id"]=id;var embed={parent:parent,property:property};if(embedOn&&id in state.embeds){embedOn=false;var existing=state.embeds[id];if(_isArray(existing.parent)){for(var i=0;i<existing.parent.length;++i){if(jsonld.compareValues(output,existing.parent[i])){embedOn=true;break}}}else if(jsonld.hasValue(existing.parent,existing.property,output)){embedOn=true}if(embedOn){_removeEmbed(state,id)}}if(!embedOn){_addFrameOutput(state,parent,property,output)}else{state.embeds[id]=embed;var subject=matches[id];var props=Object.keys(subject).sort();for(var i=0;i<props.length;i++){var prop=props[i];if(_isKeyword(prop)){output[prop]=_clone(subject[prop]);continue}if(!(prop in frame)){if(!explicitOn){_embedValues(state,subject,prop,output)}continue}var objects=subject[prop];for(var oi=0;oi<objects.length;++oi){var o=objects[oi];if(_isList(o)){var list={"@list":[]};_addFrameOutput(state,output,prop,list);var src=o["@list"];for(var n in src){o=src[n];if(_isSubjectReference(o)){_frame(state,[o["@id"]],frame[prop][0]["@list"],list,"@list")}else{_addFrameOutput(state,list,"@list",_clone(o))}}continue}if(_isSubjectReference(o)){_frame(state,[o["@id"]],frame[prop],output,prop)}else{_addFrameOutput(state,output,prop,_clone(o))}}}var props=Object.keys(frame).sort();for(var i=0;i<props.length;++i){var prop=props[i];if(_isKeyword(prop)){continue}var next=frame[prop][0];var omitDefaultOn=_getFrameFlag(next,options,"omitDefault");if(!omitDefaultOn&&!(prop in output)){var preserve="@null";if("@default"in next){preserve=_clone(next["@default"])}if(!_isArray(preserve)){preserve=[preserve]}output[prop]=[{"@preserve":preserve}]}}_addFrameOutput(state,parent,property,output)}}}function _getFrameFlag(frame,options,name){var flag="@"+name;return flag in frame?frame[flag][0]:options[name]}function _validateFrame(state,frame){if(!_isArray(frame)||frame.length!==1||!_isObject(frame[0])){throw new JsonLdError("Invalid JSON-LD syntax; a JSON-LD frame must be a single object.","jsonld.SyntaxError",{frame:frame})}}function _filterSubjects(state,subjects,frame){var rval={};for(var i=0;i<subjects.length;++i){var id=subjects[i];var subject=state.subjects[id];if(_filterSubject(subject,frame)){rval[id]=subject}}return rval}function _filterSubject(subject,frame){if("@type"in frame&&!(frame["@type"].length===1&&_isObject(frame["@type"][0]))){var types=frame["@type"];for(var i=0;i<types.length;++i){if(jsonld.hasValue(subject,"@type",types[i])){return true}}return false}for(var key in frame){if((key==="@id"||!_isKeyword(key))&&!(key in subject)){return false}}return true}function _embedValues(state,subject,property,output){var objects=subject[property];for(var i=0;i<objects.length;++i){var o=objects[i];if(_isList(o)){var list={"@list":[]};_addFrameOutput(state,output,property,list);return _embedValues(state,o,"@list",list["@list"])}if(_isSubjectReference(o)){var id=o["@id"];if(!(id in state.embeds)){var embed={parent:output,property:property};state.embeds[id]=embed;o={};var s=state.subjects[id];for(var prop in s){if(_isKeyword(prop)){o[prop]=_clone(s[prop]);continue}_embedValues(state,s,prop,o)}}_addFrameOutput(state,output,property,o)}else{_addFrameOutput(state,output,property,_clone(o))}}}function _removeEmbed(state,id){var embeds=state.embeds;var embed=embeds[id];var parent=embed.parent;var property=embed.property;var subject={"@id":id};if(_isArray(parent)){for(var i=0;i<parent.length;++i){if(jsonld.compareValues(parent[i],subject)){parent[i]=subject;break}}}else{var useArray=_isArray(parent[property]);jsonld.removeValue(parent,property,subject,{propertyIsArray:useArray});jsonld.addValue(parent,property,subject,{propertyIsArray:useArray})}var removeDependents=function(id){var ids=Object.keys(embeds);for(var i=0;i<ids.length;++i){var next=ids[i];if(next in embeds&&_isObject(embeds[next].parent)&&embeds[next].parent["@id"]===id){delete embeds[next];removeDependents(next)}}};removeDependents(id)}function _addFrameOutput(state,parent,property,output){if(_isObject(parent)){jsonld.addValue(parent,property,output,{propertyIsArray:true})}else{parent.push(output)}}function _removePreserve(ctx,input,options){if(_isArray(input)){var output=[];for(var i=0;i<input.length;++i){var result=_removePreserve(ctx,input[i],options);if(result!==null){output.push(result)}}input=output}else if(_isObject(input)){if("@preserve"in input){if(input["@preserve"]==="@null"){return null}return input["@preserve"]}if(_isValue(input)){return input}if(_isList(input)){input["@list"]=_removePreserve(ctx,input["@list"],options);return input}for(var prop in input){var result=_removePreserve(ctx,input[prop],options);var container=jsonld.getContextValue(ctx,prop,"@container");if(options.compactArrays&&_isArray(result)&&result.length===1&&container===null){result=result[0]}input[prop]=result}}return input}function _compareShortestLeast(a,b){if(a.length<b.length){return-1}else if(b.length<a.length){return 1}else if(a===b){return 0}return a<b?-1:1}function _selectTerm(activeCtx,iri,value,containers,typeOrLanguage,typeOrLanguageValue){if(typeOrLanguageValue===null){typeOrLanguageValue="@null"}var prefs=[];if((typeOrLanguageValue==="@id"||typeOrLanguageValue==="@reverse")&&_isSubjectReference(value)){if(typeOrLanguageValue==="@reverse"){prefs.push("@reverse")}var term=_compactIri(activeCtx,value["@id"],null,{vocab:true});if(term in activeCtx.mappings&&activeCtx.mappings[term]&&activeCtx.mappings[term]["@id"]===value["@id"]){prefs.push.apply(prefs,["@vocab","@id"])}else{prefs.push.apply(prefs,["@id","@vocab"])}}else{prefs.push(typeOrLanguageValue)}prefs.push("@none");var containerMap=activeCtx.inverse[iri];for(var ci=0;ci<containers.length;++ci){var container=containers[ci];if(!(container in containerMap)){continue}var typeOrLanguageValueMap=containerMap[container][typeOrLanguage];for(var pi=0;pi<prefs.length;++pi){var pref=prefs[pi];if(!(pref in typeOrLanguageValueMap)){continue}return typeOrLanguageValueMap[pref]}}return null}function _compactIri(activeCtx,iri,value,relativeTo,reverse){if(iri===null){return iri}if(_isUndefined(value)){value=null}if(_isUndefined(reverse)){reverse=false}relativeTo=relativeTo||{};if(_isKeyword(iri)){relativeTo.vocab=true}if(relativeTo.vocab&&iri in activeCtx.getInverse()){var defaultLanguage=activeCtx["@language"]||"@none";var containers=[];if(_isObject(value)&&"@index"in value){containers.push("@index")}var typeOrLanguage="@language";var typeOrLanguageValue="@null";if(reverse){typeOrLanguage="@type";typeOrLanguageValue="@reverse";containers.push("@set")}else if(_isList(value)){if(!("@index"in value)){containers.push("@list")}var list=value["@list"];var commonLanguage=list.length===0?defaultLanguage:null;var commonType=null;for(var i=0;i<list.length;++i){var item=list[i];var itemLanguage="@none";var itemType="@none";if(_isValue(item)){if("@language"in item){itemLanguage=item["@language"]}else if("@type"in item){itemType=item["@type"]}else{itemLanguage="@null"}}else{itemType="@id"}if(commonLanguage===null){commonLanguage=itemLanguage}else if(itemLanguage!==commonLanguage&&_isValue(item)){commonLanguage="@none"}if(commonType===null){commonType=itemType}else if(itemType!==commonType){commonType="@none"}if(commonLanguage==="@none"&&commonType==="@none"){break}}commonLanguage=commonLanguage||"@none";commonType=commonType||"@none";if(commonType!=="@none"){typeOrLanguage="@type";typeOrLanguageValue=commonType}else{typeOrLanguageValue=commonLanguage}}else{if(_isValue(value)){if("@language"in value&&!("@index"in value)){containers.push("@language");typeOrLanguageValue=value["@language"]}else if("@type"in value){typeOrLanguage="@type";typeOrLanguageValue=value["@type"]}}else{typeOrLanguage="@type";typeOrLanguageValue="@id"}containers.push("@set")}containers.push("@none");var term=_selectTerm(activeCtx,iri,value,containers,typeOrLanguage,typeOrLanguageValue);if(term!==null){return term}}if(relativeTo.vocab){if("@vocab"in activeCtx){var vocab=activeCtx["@vocab"];if(iri.indexOf(vocab)===0&&iri!==vocab){var suffix=iri.substr(vocab.length);if(!(suffix in activeCtx.mappings)){return suffix}}}}var choice=null;for(var term in activeCtx.mappings){if(term.indexOf(":")!==-1){continue}var definition=activeCtx.mappings[term];if(!definition||definition["@id"]===iri||iri.indexOf(definition["@id"])!==0){continue}var curie=term+":"+iri.substr(definition["@id"].length);var isUsableCurie=!(curie in activeCtx.mappings)||value===null&&activeCtx.mappings[curie]&&activeCtx.mappings[curie]["@id"]===iri;if(isUsableCurie&&(choice===null||_compareShortestLeast(curie,choice)<0)){choice=curie}}if(choice!==null){return choice}if(!relativeTo.vocab){return _removeBase(activeCtx["@base"],iri)}return iri}function _compactValue(activeCtx,activeProperty,value){if(_isValue(value)){var type=jsonld.getContextValue(activeCtx,activeProperty,"@type");var language=jsonld.getContextValue(activeCtx,activeProperty,"@language");var container=jsonld.getContextValue(activeCtx,activeProperty,"@container");var preserveIndex="@index"in value&&container!=="@index";if(!preserveIndex){if(value["@type"]===type||value["@language"]===language){return value["@value"]}}var keyCount=Object.keys(value).length;var isValueOnlyKey=keyCount===1||keyCount===2&&"@index"in value&&!preserveIndex;var hasDefaultLanguage="@language"in activeCtx;var isValueString=_isString(value["@value"]);var hasNullMapping=activeCtx.mappings[activeProperty]&&activeCtx.mappings[activeProperty]["@language"]===null;if(isValueOnlyKey&&(!hasDefaultLanguage||!isValueString||hasNullMapping)){return value["@value"]}var rval={};if(preserveIndex){rval[_compactIri(activeCtx,"@index")]=value["@index"]}if("@type"in value){rval[_compactIri(activeCtx,"@type")]=_compactIri(activeCtx,value["@type"],null,{vocab:true})}else if("@language"in value){rval[_compactIri(activeCtx,"@language")]=value["@language"]}rval[_compactIri(activeCtx,"@value")]=value["@value"];return rval}var expandedProperty=_expandIri(activeCtx,activeProperty,{vocab:true});var type=jsonld.getContextValue(activeCtx,activeProperty,"@type");var compacted=_compactIri(activeCtx,value["@id"],null,{vocab:type==="@vocab"});if(type==="@id"||type==="@vocab"||expandedProperty==="@graph"){return compacted}var rval={};rval[_compactIri(activeCtx,"@id")]=compacted;return rval}function _createTermDefinition(activeCtx,localCtx,term,defined){if(term in defined){if(defined[term]){return}throw new JsonLdError("Cyclical context definition detected.","jsonld.CyclicalContext",{code:"cyclic IRI mapping",context:localCtx,term:term})}defined[term]=false;if(_isKeyword(term)){throw new JsonLdError("Invalid JSON-LD syntax; keywords cannot be overridden.","jsonld.SyntaxError",{code:"keyword redefinition",context:localCtx})}if(activeCtx.mappings[term]){delete activeCtx.mappings[term]}var value=localCtx[term];if(value===null||_isObject(value)&&value["@id"]===null){activeCtx.mappings[term]=null;defined[term]=true;return}if(_isString(value)){value={"@id":value}}if(!_isObject(value)){throw new JsonLdError("Invalid JSON-LD syntax; @context property values must be "+"strings or objects.","jsonld.SyntaxError",{code:"invalid term definition",context:localCtx})}var mapping=activeCtx.mappings[term]={};mapping.reverse=false;if("@reverse"in value){if("@id"in value){throw new JsonLdError("Invalid JSON-LD syntax; a @reverse term definition must not "+"contain @id.","jsonld.SyntaxError",{code:"invalid reverse property",context:localCtx})}var reverse=value["@reverse"];if(!_isString(reverse)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @reverse value must be a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}var id=_expandIri(activeCtx,reverse,{vocab:true,base:false},localCtx,defined);if(!_isAbsoluteIri(id)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @reverse value must be an "+"absolute IRI or a blank node identifier.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}mapping["@id"]=id;mapping.reverse=true}else if("@id"in value){var id=value["@id"];if(!_isString(id)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @id value must be an array "+"of strings or a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}if(id!==term){id=_expandIri(activeCtx,id,{vocab:true,base:false},localCtx,defined);if(!_isAbsoluteIri(id)&&!_isKeyword(id)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @id value must be an "+"absolute IRI, a blank node identifier, or a keyword.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}mapping["@id"]=id}}if(!("@id"in mapping)){var colon=term.indexOf(":");if(colon!==-1){var prefix=term.substr(0,colon);if(prefix in localCtx){_createTermDefinition(activeCtx,localCtx,prefix,defined)}if(activeCtx.mappings[prefix]){var suffix=term.substr(colon+1);mapping["@id"]=activeCtx.mappings[prefix]["@id"]+suffix}else{mapping["@id"]=term}}else{if(!("@vocab"in activeCtx)){throw new JsonLdError("Invalid JSON-LD syntax; @context terms must define an @id.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx,term:term})}mapping["@id"]=activeCtx["@vocab"]+term}}defined[term]=true;if("@type"in value){var type=value["@type"];if(!_isString(type)){throw new JsonLdError("Invalid JSON-LD syntax; an @context @type values must be a string.","jsonld.SyntaxError",{code:"invalid type mapping",context:localCtx})}if(type!=="@id"&&type!=="@vocab"){type=_expandIri(activeCtx,type,{vocab:true,base:false},localCtx,defined);if(!_isAbsoluteIri(type)){throw new JsonLdError("Invalid JSON-LD syntax; an @context @type value must be an "+"absolute IRI.","jsonld.SyntaxError",{code:"invalid type mapping",context:localCtx})}if(type.indexOf("_:")===0){throw new JsonLdError("Invalid JSON-LD syntax; an @context @type values must be an IRI, "+"not a blank node identifier.","jsonld.SyntaxError",{code:"invalid type mapping",context:localCtx})}}mapping["@type"]=type}if("@container"in value){var container=value["@container"];if(container!=="@list"&&container!=="@set"&&container!=="@index"&&container!=="@language"){throw new JsonLdError("Invalid JSON-LD syntax; @context @container value must be "+"one of the following: @list, @set, @index, or @language.","jsonld.SyntaxError",{code:"invalid container mapping",context:localCtx})}if(mapping.reverse&&container!=="@index"&&container!=="@set"&&container!==null){throw new JsonLdError("Invalid JSON-LD syntax; @context @container value for a @reverse "+"type definition must be @index or @set.","jsonld.SyntaxError",{code:"invalid reverse property",context:localCtx})}mapping["@container"]=container}if("@language"in value&&!("@type"in value)){var language=value["@language"];if(language!==null&&!_isString(language)){throw new JsonLdError("Invalid JSON-LD syntax; @context @language value must be "+"a string or null.","jsonld.SyntaxError",{code:"invalid language mapping",context:localCtx})}if(language!==null){language=language.toLowerCase()}mapping["@language"]=language}var id=mapping["@id"];if(id==="@context"||id==="@preserve"){throw new JsonLdError("Invalid JSON-LD syntax; @context and @preserve cannot be aliased.","jsonld.SyntaxError",{code:"invalid keyword alias",context:localCtx})}}function _expandIri(activeCtx,value,relativeTo,localCtx,defined){if(value===null||_isKeyword(value)){return value}if(localCtx&&value in localCtx&&defined[value]!==true){_createTermDefinition(activeCtx,localCtx,value,defined)}relativeTo=relativeTo||{};if(relativeTo.vocab){var mapping=activeCtx.mappings[value];if(mapping===null){return null}if(mapping){return mapping["@id"]}}var colon=value.indexOf(":");if(colon!==-1){var prefix=value.substr(0,colon);var suffix=value.substr(colon+1);if(prefix==="_"||suffix.indexOf("//")===0){return value}if(localCtx&&prefix in localCtx){_createTermDefinition(activeCtx,localCtx,prefix,defined)}var mapping=activeCtx.mappings[prefix];if(mapping){return mapping["@id"]+suffix}return value}if(relativeTo.vocab&&"@vocab"in activeCtx){return activeCtx["@vocab"]+value}var rval=value;if(relativeTo.base){rval=_prependBase(activeCtx["@base"],rval)}return rval}function _prependBase(base,iri){if(base===null){return iri}if(iri.indexOf(":")!==-1){return iri}if(_isString(base)){base=jsonld.url.parse(base||"")}var rel=jsonld.url.parse(iri);var hierPart=base.protocol||"";if(rel.authority){hierPart+="//"+rel.authority}else if(base.href!==""){hierPart+="//"+base.authority}var path;if(rel.pathname.indexOf("/")===0){path=rel.pathname}else{path=base.pathname;if(rel.pathname!==""){path=path.substr(0,path.lastIndexOf("/")+1);if(path.length>0&&path.substr(-1)!=="/"){path+="/"}path+=rel.pathname}}path=_removeDotSegments(path,hierPart!=="");if(rel.query){path+="?"+rel.query}if(rel.hash){path+=rel.hash}var rval=hierPart+path;if(rval===""){rval="./"}return rval}function _removeBase(base,iri){if(base===null){return iri}if(_isString(base)){base=jsonld.url.parse(base||"")}var root="";if(base.href!==""){root+=(base.protocol||"")+"//"+base.authority}else if(iri.indexOf("//")){root+="//"}if(iri.indexOf(root)!==0){return iri}var rel=jsonld.url.parse(iri.substr(root.length));var baseSegments=base.normalizedPath.split("/");var iriSegments=rel.normalizedPath.split("/");var last=rel.hash||rel.query?0:1;while(baseSegments.length>0&&iriSegments.length>last){if(baseSegments[0]!==iriSegments[0]){break}baseSegments.shift();iriSegments.shift()}var rval="";if(baseSegments.length>0){if(base.normalizedPath.substr(-1)!=="/"||baseSegments[0]===""){baseSegments.pop()}for(var i=0;i<baseSegments.length;++i){rval+="../"}}rval+=iriSegments.join("/");if(rel.query){rval+="?"+rel.query}if(rel.hash){rval+=rel.hash}if(rval===""){rval="./"}return rval}function _getInitialContext(options){var base=jsonld.url.parse(options.base||"");return{"@base":base,mappings:{},inverse:null,getInverse:_createInverseContext,clone:_cloneActiveContext};function _createInverseContext(){var activeCtx=this;if(activeCtx.inverse){return activeCtx.inverse}var inverse=activeCtx.inverse={};var defaultLanguage=activeCtx["@language"]||"@none";var mappings=activeCtx.mappings;var terms=Object.keys(mappings).sort(_compareShortestLeast);for(var i=0;i<terms.length;++i){var term=terms[i];var mapping=mappings[term];if(mapping===null){continue}var container=mapping["@container"]||"@none";var ids=mapping["@id"];if(!_isArray(ids)){ids=[ids]}for(var ii=0;ii<ids.length;++ii){var iri=ids[ii];var entry=inverse[iri];if(!entry){inverse[iri]=entry={}}if(!entry[container]){entry[container]={"@language":{},"@type":{}}}entry=entry[container];if(mapping.reverse){_addPreferredTerm(mapping,term,entry["@type"],"@reverse")}else if("@type"in mapping){_addPreferredTerm(mapping,term,entry["@type"],mapping["@type"])}else if("@language"in mapping){var language=mapping["@language"]||"@null";_addPreferredTerm(mapping,term,entry["@language"],language)}else{_addPreferredTerm(mapping,term,entry["@language"],defaultLanguage);_addPreferredTerm(mapping,term,entry["@type"],"@none");_addPreferredTerm(mapping,term,entry["@language"],"@none")}}}return inverse}function _addPreferredTerm(mapping,term,entry,typeOrLanguageValue){if(!(typeOrLanguageValue in entry)){entry[typeOrLanguageValue]=term}}function _cloneActiveContext(){var child={};child["@base"]=this["@base"];child.mappings=_clone(this.mappings);child.clone=this.clone;child.inverse=null;child.getInverse=this.getInverse;if("@language"in this){child["@language"]=this["@language"]}if("@vocab"in this){child["@vocab"]=this["@vocab"]}return child}}function _isKeyword(v){if(!_isString(v)){return false}switch(v){case"@base":case"@context":case"@container":case"@default":case"@embed":case"@explicit":case"@graph":case"@id":case"@index":case"@language":case"@list":case"@omitDefault":case"@preserve":case"@reverse":case"@set":case"@type":case"@value":case"@vocab":return true}return false}function _isObject(v){return Object.prototype.toString.call(v)==="[object Object]"}function _isEmptyObject(v){return _isObject(v)&&Object.keys(v).length===0}function _isArray(v){return Array.isArray(v)}function _validateTypeValue(v){if(_isString(v)||_isEmptyObject(v)){return}var isValid=false;if(_isArray(v)){isValid=true;for(var i=0;i<v.length;++i){if(!_isString(v[i])){isValid=false;break}}}if(!isValid){throw new JsonLdError('Invalid JSON-LD syntax; "@type" value must a string, an array of '+"strings, or an empty object.","jsonld.SyntaxError",{code:"invalid type value",value:v})}}function _isString(v){return typeof v==="string"||Object.prototype.toString.call(v)==="[object String]"}function _isNumber(v){return typeof v==="number"||Object.prototype.toString.call(v)==="[object Number]"}function _isDouble(v){return _isNumber(v)&&String(v).indexOf(".")!==-1}function _isNumeric(v){return!isNaN(parseFloat(v))&&isFinite(v)}function _isBoolean(v){return typeof v==="boolean"||Object.prototype.toString.call(v)==="[object Boolean]"}function _isUndefined(v){return typeof v==="undefined"}function _isSubject(v){var rval=false;if(_isObject(v)&&!("@value"in v||"@set"in v||"@list"in v)){var keyCount=Object.keys(v).length;rval=keyCount>1||!("@id"in v)}return rval}function _isSubjectReference(v){return _isObject(v)&&Object.keys(v).length===1&&"@id"in v}function _isValue(v){return _isObject(v)&&"@value"in v}function _isList(v){return _isObject(v)&&"@list"in v}function _isBlankNode(v){var rval=false;if(_isObject(v)){if("@id"in v){rval=v["@id"].indexOf("_:")===0}else{rval=Object.keys(v).length===0||!("@value"in v||"@set"in v||"@list"in v)}}return rval}function _isAbsoluteIri(v){return _isString(v)&&v.indexOf(":")!==-1}function _clone(value){if(value&&typeof value==="object"){var rval;if(_isArray(value)){rval=[];for(var i=0;i<value.length;++i){rval[i]=_clone(value[i])}}else{rval={};for(var key in value){rval[key]=_clone(value[key])}}return rval}return value}function _findContextUrls(input,urls,replace,base){var count=Object.keys(urls).length;if(_isArray(input)){for(var i=0;i<input.length;++i){_findContextUrls(input[i],urls,replace,base)}return count<Object.keys(urls).length}else if(_isObject(input)){for(var key in input){if(key!=="@context"){_findContextUrls(input[key],urls,replace,base);continue}var ctx=input[key];if(_isArray(ctx)){var length=ctx.length;for(var i=0;i<length;++i){var _ctx=ctx[i];if(_isString(_ctx)){_ctx=_prependBase(base,_ctx);if(replace){_ctx=urls[_ctx];if(_isArray(_ctx)){Array.prototype.splice.apply(ctx,[i,1].concat(_ctx));i+=_ctx.length;length+=_ctx.length}else{ctx[i]=_ctx}}else if(!(_ctx in urls)){urls[_ctx]=false}}}}else if(_isString(ctx)){ctx=_prependBase(base,ctx);if(replace){input[key]=urls[ctx]}else if(!(ctx in urls)){urls[ctx]=false}}}return count<Object.keys(urls).length}return false}function _retrieveContextUrls(input,options,callback){var error=null;var regex=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;var documentLoader=options.documentLoader;var retrieve=function(input,cycles,documentLoader,base,callback){if(Object.keys(cycles).length>MAX_CONTEXT_URLS){error=new JsonLdError("Maximum number of @context URLs exceeded.","jsonld.ContextUrlError",{code:"loading remote context failed",max:MAX_CONTEXT_URLS});return callback(error)}var urls={};var finished=function(){_findContextUrls(input,urls,true,base);callback(null,input)};if(!_findContextUrls(input,urls,false,base)){finished()}var queue=[];for(var url in urls){if(urls[url]===false){if(!regex.test(url)){error=new JsonLdError("Malformed URL.","jsonld.InvalidUrl",{code:"loading remote context failed",url:url});return callback(error)}queue.push(url)}}var count=queue.length;for(var i=0;i<queue.length;++i){(function(url){if(url in cycles){error=new JsonLdError("Cyclical @context URLs detected.","jsonld.ContextUrlError",{code:"recursive context inclusion",url:url});return callback(error)}var _cycles=_clone(cycles);_cycles[url]=true;var done=function(err,remoteDoc){if(error){return}var ctx=remoteDoc?remoteDoc.document:null;if(!err&&_isString(ctx)){try{ctx=JSON.parse(ctx)}catch(ex){err=ex}}if(err){err=new JsonLdError("Derefencing a URL did not result in a valid JSON-LD object. "+"Possible causes are an inaccessible URL perhaps due to "+"a same-origin policy (ensure the server uses CORS if you are "+"using client-side JavaScript), too many redirects, a "+"non-JSON response, or more than one HTTP Link Header was "+"provided for a remote context.","jsonld.InvalidUrl",{code:"loading remote context failed",url:url,cause:err})}else if(!_isObject(ctx)){err=new JsonLdError("Derefencing a URL did not result in a JSON object. The "+"response was valid JSON, but it was not a JSON object.","jsonld.InvalidUrl",{code:"invalid remote context",url:url,cause:err})}if(err){error=err;return callback(error)}if(!("@context"in ctx)){ctx={"@context":{}}}else{ctx={"@context":ctx["@context"]}}if(remoteDoc.contextUrl){if(!_isArray(ctx["@context"])){ctx["@context"]=[ctx["@context"]]}ctx["@context"].push(remoteDoc.contextUrl)}retrieve(ctx,_cycles,documentLoader,url,function(err,ctx){if(err){return callback(err)}urls[url]=ctx["@context"];count-=1;if(count===0){finished()}})};var promise=documentLoader(url,done);if(promise&&"then"in promise){promise.then(done.bind(null,null),done)}})(queue[i])}};retrieve(input,{},documentLoader,options.base,callback)}if(!Object.keys){Object.keys=function(o){if(o!==Object(o)){throw new TypeError("Object.keys called on non-object")}var rval=[];for(var p in o){if(Object.prototype.hasOwnProperty.call(o,p)){rval.push(p)}}return rval}}function _parseNQuads(input){var iri="(?:<([^:]+:[^>]*)>)";var bnode="(_:(?:[A-Za-z0-9]+))";var plain='"([^"\\\\]*(?:\\\\.[^"\\\\]*)*)"';var datatype="(?:\\^\\^"+iri+")";var language="(?:@([a-z]+(?:-[a-z0-9]+)*))";var literal="(?:"+plain+"(?:"+datatype+"|"+language+")?)";var ws="[ \\t]+";var wso="[ \\t]*";var eoln=/(?:\r\n)|(?:\n)|(?:\r)/g;var empty=new RegExp("^"+wso+"$");var subject="(?:"+iri+"|"+bnode+")"+ws;var property=iri+ws;var object="(?:"+iri+"|"+bnode+"|"+literal+")"+wso;var graphName="(?:\\.|(?:(?:"+iri+"|"+bnode+")"+wso+"\\.))";var quad=new RegExp("^"+wso+subject+property+object+graphName+wso+"$");var dataset={};var lines=input.split(eoln);var lineNumber=0;for(var li=0;li<lines.length;++li){var line=lines[li];lineNumber++;if(empty.test(line)){continue}var match=line.match(quad);if(match===null){throw new JsonLdError("Error while parsing N-Quads; invalid quad.","jsonld.ParseError",{line:lineNumber})}var triple={};if(!_isUndefined(match[1])){triple.subject={type:"IRI",value:match[1]}}else{triple.subject={type:"blank node",value:match[2]}}triple.predicate={type:"IRI",value:match[3]};if(!_isUndefined(match[4])){triple.object={type:"IRI",value:match[4]}}else if(!_isUndefined(match[5])){triple.object={type:"blank node",value:match[5]}}else{triple.object={type:"literal"};if(!_isUndefined(match[7])){triple.object.datatype=match[7]}else if(!_isUndefined(match[8])){triple.object.datatype=RDF_LANGSTRING;triple.object.language=match[8]}else{triple.object.datatype=XSD_STRING}var unescaped=match[6].replace(/\\"/g,'"').replace(/\\t/g,"	").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\\\/g,"\\");triple.object.value=unescaped}var name="@default";if(!_isUndefined(match[9])){name=match[9]}else if(!_isUndefined(match[10])){name=match[10]}if(!(name in dataset)){dataset[name]=[triple]}else{var unique=true;var triples=dataset[name];for(var ti=0;unique&&ti<triples.length;++ti){if(_compareRDFTriples(triples[ti],triple)){unique=false}}if(unique){triples.push(triple)}}}return dataset}jsonld.registerRDFParser("application/nquads",_parseNQuads);function _toNQuads(dataset){var quads=[];for(var graphName in dataset){var triples=dataset[graphName];for(var ti=0;ti<triples.length;++ti){var triple=triples[ti];if(graphName==="@default"){graphName=null}quads.push(_toNQuad(triple,graphName))}}quads.sort();return quads.join("")}function _toNQuad(triple,graphName,bnode){var s=triple.subject;var p=triple.predicate;var o=triple.object;var g=graphName;var quad="";if(s.type==="IRI"){quad+="<"+s.value+">"}else if(bnode){quad+=s.value===bnode?"_:a":"_:z"}else{quad+=s.value}quad+=" ";if(p.type==="IRI"){quad+="<"+p.value+">"}else if(bnode){quad+="_:p"}else{quad+=p.value}quad+=" ";if(o.type==="IRI"){quad+="<"+o.value+">"}else if(o.type==="blank node"){if(bnode){quad+=o.value===bnode?"_:a":"_:z"}else{quad+=o.value}}else{var escaped=o.value.replace(/\\/g,"\\\\").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\"/g,'\\"');quad+='"'+escaped+'"';if(o.datatype===RDF_LANGSTRING){if(o.language){quad+="@"+o.language}}else if(o.datatype!==XSD_STRING){quad+="^^<"+o.datatype+">"}}if(g!==null){if(g.indexOf("_:")!==0){quad+=" <"+g+">"}else if(bnode){quad+=" _:g"}else{quad+=" "+g}}quad+=" .\n";return quad}function _parseRdfaApiData(data){var dataset={};dataset["@default"]=[];var subjects=data.getSubjects();for(var si=0;si<subjects.length;++si){var subject=subjects[si];if(subject===null){continue}var triples=data.getSubjectTriples(subject);if(triples===null){continue}var predicates=triples.predicates;for(var predicate in predicates){var objects=predicates[predicate].objects;for(var oi=0;oi<objects.length;++oi){var object=objects[oi];var triple={};if(subject.indexOf("_:")===0){triple.subject={type:"blank node",value:subject}}else{triple.subject={type:"IRI",value:subject}}if(predicate.indexOf("_:")===0){triple.predicate={type:"blank node",value:predicate}}else{triple.predicate={type:"IRI",value:predicate}}var value=object.value;if(object.type===RDF_XML_LITERAL){if(!XMLSerializer){_defineXMLSerializer()}var serializer=new XMLSerializer;value="";for(var x=0;x<object.value.length;x++){if(object.value[x].nodeType===Node.ELEMENT_NODE){value+=serializer.serializeToString(object.value[x])}else if(object.value[x].nodeType===Node.TEXT_NODE){value+=object.value[x].nodeValue}}}triple.object={};if(object.type===RDF_OBJECT){if(object.value.indexOf("_:")===0){triple.object.type="blank node"}else{triple.object.type="IRI"}}else{triple.object.type="literal";if(object.type===RDF_PLAIN_LITERAL){if(object.language){triple.object.datatype=RDF_LANGSTRING;triple.object.language=object.language}else{triple.object.datatype=XSD_STRING
}}else{triple.object.datatype=object.type}}triple.object.value=value;dataset["@default"].push(triple)}}}return dataset}jsonld.registerRDFParser("rdfa-api",_parseRdfaApiData);function UniqueNamer(prefix){this.prefix=prefix;this.counter=0;this.existing={}}UniqueNamer.prototype.clone=function(){var copy=new UniqueNamer(this.prefix);copy.counter=this.counter;copy.existing=_clone(this.existing);return copy};UniqueNamer.prototype.getName=function(oldName){if(oldName&&oldName in this.existing){return this.existing[oldName]}var name=this.prefix+this.counter;this.counter+=1;if(oldName){this.existing[oldName]=name}return name};UniqueNamer.prototype.isNamed=function(oldName){return oldName in this.existing};var Permutator=function(list){this.list=list.sort();this.done=false;this.left={};for(var i=0;i<list.length;++i){this.left[list[i]]=true}};Permutator.prototype.hasNext=function(){return!this.done};Permutator.prototype.next=function(){var rval=this.list.slice();var k=null;var pos=0;var length=this.list.length;for(var i=0;i<length;++i){var element=this.list[i];var left=this.left[element];if((k===null||element>k)&&(left&&i>0&&element>this.list[i-1]||!left&&i<length-1&&element>this.list[i+1])){k=element;pos=i}}if(k===null){this.done=true}else{var swap=this.left[k]?pos-1:pos+1;this.list[pos]=this.list[swap];this.list[swap]=k;for(var i=0;i<length;++i){if(this.list[i]>k){this.left[this.list[i]]=!this.left[this.list[i]]}}}return rval};var sha1=jsonld.sha1={};var crypto=require("crypto");sha1.create=function(){var md=crypto.createHash("sha1");return{update:function(data){md.update(data,"utf8")},digest:function(){return md.digest("hex")}}};sha1.hash=function(nquads){var md=sha1.create();for(var i=0;i<nquads.length;++i){md.update(nquads[i])}return md.digest()};if(!XMLSerializer){var _defineXMLSerializer=function(){XMLSerializer=require("xmldom").XMLSerializer}}jsonld.url={};var parse=require("url").parse;jsonld.url.parse=function(url){var parsed=parse(url);parsed.pathname=parsed.pathname||"";_parseAuthority(parsed);parsed.normalizedPath=_removeDotSegments(parsed.pathname,parsed.authority!=="");return parsed};function _parseAuthority(parsed){if(parsed.href.indexOf(":")===-1&&parsed.href.indexOf("//")===0&&!parsed.host){parsed.pathname=parsed.pathname.substr(2);var idx=parsed.pathname.indexOf("/");if(idx===-1){parsed.authority=parsed.pathname;parsed.pathname=""}else{parsed.authority=parsed.pathname.substr(0,idx);parsed.pathname=parsed.pathname.substr(idx)}}else{parsed.authority=parsed.host||"";if(parsed.auth){parsed.authority=parsed.auth+"@"+parsed.authority}}}function _removeDotSegments(path,hasAuthority){var rval="";if(path.indexOf("/")===0){rval="/"}var input=path.split("/");var output=[];while(input.length>0){if(input[0]==="."||input[0]===""&&input.length>1){input.shift();continue}if(input[0]===".."){input.shift();if(hasAuthority||output.length>0&&output[output.length-1]!==".."){output.pop()}else{output.push("..")}continue}output.push(input.shift())}return rval+output.join("/")}if(_nodejs){jsonld.useDocumentLoader("node")}else if(typeof XMLHttpRequest!=="undefined"){jsonld.useDocumentLoader("xhr")}if(_nodejs){jsonld.use=function(extension){switch(extension){case"request":jsonld.request=require("./request");break;default:throw new JsonLdError("Unknown extension.","jsonld.UnknownExtension",{extension:extension})}}}return jsonld};var factory=function(){return wrapper(function(){return factory()})};wrapper(factory);module.exports=factory})()},{"./Promise":40,"./request":43,__browserify_process:20,crypto:7,http:13,request:44,url:37,util:39,xmldom:95}],42:[function(require,module,exports){var _nodejs=typeof module!=="undefined";function RDFa(){}RDFa.attach=function(document,update){if(_nodejs){var _baseURI=document.location.href}function URIResolver(){}URIResolver.SCHEME=new RegExp("^[A-Za-z][A-Za-z0-9+-.]*:");URIResolver.prototype.parseURI=function(uri){if(_nodejs){uri=uri||_baseURI}var match=URIResolver.SCHEME.exec(uri);if(!match){if(_nodejs){throw new Error("Bad URI value, no scheme: "+uri)}throw"Bad URI value, no scheme: "+uri}var parsed={spec:uri};parsed.scheme=match[0].substring(0,match[0].length-1);parsed.schemeSpecificPart=parsed.spec.substring(match[0].length);if(parsed.schemeSpecificPart.charAt(0)=="/"&&parsed.schemeSpecificPart.charAt(1)=="/"){this.parseGeneric(parsed)}else{parsed.isGeneric=false}parsed.normalize=function(){if(!this.isGeneric){return}if(this.segments.length==0){return}if(this.path.length>1&&this.path.substring(this.path.length-2)=="/."){this.path=this.path.substring(0,this.path.length-1);this.segments.splice(this.segments.length-1,1);this.schemeSpecificPart="//"+this.authority+this.path;if(typeof this.query!="undefined"){this.schemeSpecificPart+="?"+this.query}if(typeof this.fragment!="undefined"){this.schemeSpecificPart+="#"+this.fragment}this.spec=this.scheme+":"+this.schemeSpecificPart;return}var end=this.path.charAt(this.path.length-1);if(end!="/"){end=""}for(var i=0;i<this.segments.length;i++){if(i>0&&this.segments[i]==".."){this.segments.splice(i-1,2);i-=2}if(this.segments[i]=="."){this.segments.splice(i,1);i--}}this.path=this.segments.length==0?"/":"/"+this.segments.join("/")+end;this.schemeSpecificPart="//"+this.authority+this.path;if(typeof this.query!="undefined"){this.schemeSpecificPart+="?"+this.query}if(typeof this.fragment!="undefined"){this.schemeSpecificPart+="#"+this.fragment}this.spec=this.scheme+":"+this.schemeSpecificPart};parsed.resolve=function(href){if(!href){return this.spec}if(href.charAt(0)=="#"){var lastHash=this.spec.lastIndexOf("#");return lastHash<0?this.spec+href:this.spec.substring(0,lastHash)+href}if(!this.isGeneric){throw"Cannot resolve uri against non-generic URI: "+this.spec}var colon=href.indexOf(":");if(href.charAt(0)=="/"){return this.scheme+"://"+this.authority+href}else if(href.charAt(0)=="."&&href.charAt(1)=="/"){if(this.path.charAt(this.path.length-1)=="/"){return this.scheme+"://"+this.authority+this.path+href.substring(2)}else{var last=this.path.lastIndexOf("/");return this.scheme+"://"+this.authority+this.path.substring(0,last)+href.substring(1)}}else if(URIResolver.SCHEME.test(href)){return href}else if(href.charAt(0)=="?"){return this.scheme+"://"+this.authority+this.path+href}else{if(this.path.charAt(this.path.length-1)=="/"){return this.scheme+"://"+this.authority+this.path+href}else{var last=this.path.lastIndexOf("/");return this.scheme+"://"+this.authority+this.path.substring(0,last+1)+href}}};parsed.relativeTo=function(otherURI){if(otherURI.scheme!=this.scheme){return this.spec}if(!this.isGeneric){throw"A non generic URI cannot be made relative: "+this.spec}if(!otherURI.isGeneric){throw"Cannot make a relative URI against a non-generic URI: "+otherURI.spec}if(otherURI.authority!=this.authority){return this.spec}var i=0;for(;i<this.segments.length&&i<otherURI.segments.length;i++){if(this.segments[i]!=otherURI.segments[i]){var relative="";for(var j=i;j<otherURI.segments.length;j++){relative+="../"}for(var j=i;j<this.segments.length;j++){relative+=this.segments[j];if(j+1<this.segments.length){relative+="/"}}if(this.path.charAt(this.path.length-1)=="/"){relative+="/"}return relative}}if(this.segments.length==otherURI.segments.length){return this.hash?this.hash:this.query?this.query:""}else if(i<this.segments.length){var relative="";for(var j=i;j<this.segments.length;j++){relative+=this.segments[j];if(j+1<this.segments.length){relative+="/"}}if(this.path.charAt(this.path.length-1)=="/"){relative+="/"}return relative}else{throw"Cannot calculate a relative URI for "+this.spec+" against "+otherURI.spec}};return parsed};URIResolver.prototype.parseGeneric=function(parsed){if(parsed.schemeSpecificPart.charAt(0)!="/"||parsed.schemeSpecificPart.charAt(1)!="/"){throw"Generic URI values should start with '//':"+parsed.spec}var work=parsed.schemeSpecificPart.substring(2);var pathStart=work.indexOf("/");parsed.authority=pathStart<0?work:work.substring(0,pathStart);parsed.path=pathStart<0?"":work.substring(pathStart);var hash=parsed.path.indexOf("#");if(hash>=0){parsed.fragment=parsed.path.substring(hash+1);parsed.path=parsed.path.substring(0,hash)}var questionMark=parsed.path.indexOf("?");if(questionMark>=0){parsed.query=parsed.path.substring(questionMark+1);parsed.path=parsed.path.substring(0,questionMark)}if(parsed.path=="/"||parsed.path==""){parsed.segments=[]}else{parsed.segments=parsed.path.split(/\//);if(parsed.segments.length>0&&parsed.segments[0]==""&&parsed.path.length>1&&parsed.path.charAt(1)!="/"){parsed.segments.shift()}if(parsed.segments.length>0&&parsed.path.length>0&&parsed.path.charAt(parsed.path.length-1)=="/"&&parsed.segments[parsed.segments.length-1]==""){if(parsed.path.length>1&&parsed.path.charAt(parsed.path.length-2)!="/"){parsed.segments.pop()}}}parsed.isGeneric=true};Object.size=function(obj){var size=0;for(var key in obj){if(obj.hasOwnProperty(key)){size++}}return size};RDFaProcessor.prototype=new URIResolver;RDFaProcessor.prototype.constructor=RDFaProcessor;function RDFaProcessor(targetObject){this.target=targetObject;this.target.tripleCount=0;this.target.triplesGraph={};this.target.prefixes={};this.target.terms={};this.language=null;this.vocabulary=null;this.typeURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#type";this.objectURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#object";this.XMLLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral";this.PlainLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral";this.blankCounter=0;this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}];this.contentAttributes=["content"];this.inXHTMLMode=false;this.absURIRE=/[\w\_\-]+:\S+/}RDFaProcessor.prototype.newBlankNode=function(){this.blankCounter++;return"_:"+this.blankCounter};RDFaProcessor.nameChar="[-A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�က0-F.0-9·̀-ͯ‿-⁀]";RDFaProcessor.nameStartChar="[A-Za-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣一-龥〇〡-〩_]";RDFaProcessor.NCNAME=new RegExp("^"+RDFaProcessor.nameStartChar+RDFaProcessor.nameChar+"*$");RDFaProcessor.prototype.trim=function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};RDFaProcessor.prototype.tokenize=function(str){return this.trim(str).split(/\s+/)};RDFaProcessor.prototype.parseSafeCURIEOrCURIEOrURI=function(value,prefixes,base){value=this.trim(value);if(value.charAt(0)=="["&&value.charAt(value.length-1)=="]"){value=value.substring(1,value.length-1);value=value.trim(value);if(value.length==0){return null}return this.parseCURIE(value,prefixes,base)}else{return this.parseCURIEOrURI(value,prefixes,base)}};RDFaProcessor.prototype.parseCURIE=function(value,prefixes,base){var colon=value.indexOf(":");if(colon>=0){var prefix=value.substring(0,colon);if(prefix==""){var uri=prefixes[""];return uri?uri+value.substring(colon+1):null}else if(prefix=="_"){return"_:"+value.substring(colon+1)}else if(RDFaProcessor.NCNAME.test(prefix)){var uri=prefixes[prefix];if(uri){return uri+value.substring(colon+1)}}}return null};RDFaProcessor.prototype.parseCURIEOrURI=function(value,prefixes,base){var curie=this.parseCURIE(value,prefixes,base);if(curie){return curie}return this.resolveAndNormalize(base,value)};RDFaProcessor.prototype.parsePredicate=function(value,defaultVocabulary,terms,prefixes,base){var predicate=this.parseTermOrCURIEOrAbsURI(value,defaultVocabulary,terms,prefixes,base);if(predicate&&predicate.indexOf("_:")==0){return null}return predicate};RDFaProcessor.prototype.parseTermOrCURIEOrURI=function(value,defaultVocabulary,terms,prefixes,base){value=this.trim(value);var curie=this.parseCURIE(value,prefixes,base);if(curie){return curie}else{var term=terms[value];if(term){return term}var lcvalue=value.toLowerCase();term=terms[lcvalue];if(term){return term}if(defaultVocabulary&&!this.absURIRE.exec(value)){return defaultVocabulary+value}}return this.resolveAndNormalize(base,value)};RDFaProcessor.prototype.parseTermOrCURIEOrAbsURI=function(value,defaultVocabulary,terms,prefixes,base){value=this.trim(value);var curie=this.parseCURIE(value,prefixes,base);if(curie){return curie}else{if(defaultVocabulary&&!this.absURIRE.exec(value)){return defaultVocabulary+value}var term=terms[value];if(term){return term}var lcvalue=value.toLowerCase();term=terms[lcvalue];if(term){return term}}if(this.absURIRE.exec(value)){return this.resolveAndNormalize(base,value)}return null};RDFaProcessor.prototype.resolveAndNormalize=function(base,href){var u=base.resolve(href);var parsed=this.parseURI(u);parsed.normalize();return parsed.spec};RDFaProcessor.prototype.parsePrefixMappings=function(str,target){var values=this.tokenize(str);var prefix=null;var uri=null;for(var i=0;i<values.length;i++){if(values[i][values[i].length-1]==":"){prefix=values[i].substring(0,values[i].length-1)}else if(prefix){target[prefix]=values[i];prefix=null}}};RDFaProcessor.prototype.copyMappings=function(mappings){var newMappings={};for(var k in mappings){newMappings[k]=mappings[k]}return newMappings};RDFaProcessor.prototype.ancestorPath=function(node){var path="";while(node&&node.nodeType!=Node.DOCUMENT_NODE){path="/"+node.localName+path;node=node.parentNode}return path};RDFaProcessor.prototype.setContext=function(node){if(node.localName=="html"&&node.getAttribute("version")=="XHTML+RDFa 1.1"){this.setXHTMLContext()}else if(node.localName=="html"||node.namespaceURI=="http://www.w3.org/1999/xhtml"){this.setHTMLContext()}else{this.setXMLContext()}};RDFaProcessor.prototype.setInitialContext=function(){this.vocabulary=null;this.target.prefixes={};this.target.terms={};this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}];this.contentAttributes=["content"];this.target.prefixes[""]="http://www.w3.org/1999/xhtml/vocab#";this.target.prefixes["grddl"]="http://www.w3.org/2003/g/data-view#";this.target.prefixes["ma"]="http://www.w3.org/ns/ma-ont#";this.target.prefixes["owl"]="http://www.w3.org/2002/07/owl#";this.target.prefixes["rdf"]="http://www.w3.org/1999/02/22-rdf-syntax-ns#";this.target.prefixes["rdfa"]="http://www.w3.org/ns/rdfa#";this.target.prefixes["rdfs"]="http://www.w3.org/2000/01/rdf-schema#";this.target.prefixes["rif"]="http://www.w3.org/2007/rif#";this.target.prefixes["skos"]="http://www.w3.org/2004/02/skos/core#";this.target.prefixes["skosxl"]="http://www.w3.org/2008/05/skos-xl#";this.target.prefixes["wdr"]="http://www.w3.org/2007/05/powder#";this.target.prefixes["void"]="http://rdfs.org/ns/void#";this.target.prefixes["wdrs"]="http://www.w3.org/2007/05/powder-s#";this.target.prefixes["xhv"]="http://www.w3.org/1999/xhtml/vocab#";this.target.prefixes["xml"]="http://www.w3.org/XML/1998/namespace";this.target.prefixes["xsd"]="http://www.w3.org/2001/XMLSchema#";this.target.prefixes["sd"]="http://www.w3.org/ns/sparql-service-description#";this.target.prefixes["org"]="http://www.w3.org/ns/org#";this.target.prefixes["gldp"]="http://www.w3.org/ns/people#";this.target.prefixes["cnt"]="http://www.w3.org/2008/content#";this.target.prefixes["dcat"]="http://www.w3.org/ns/dcat#";this.target.prefixes["earl"]="http://www.w3.org/ns/earl#";this.target.prefixes["ht"]="http://www.w3.org/2006/http#";this.target.prefixes["ptr"]="http://www.w3.org/2009/pointers#";this.target.prefixes["cc"]="http://creativecommons.org/ns#";this.target.prefixes["ctag"]="http://commontag.org/ns#";this.target.prefixes["dc"]="http://purl.org/dc/terms/";this.target.prefixes["dcterms"]="http://purl.org/dc/terms/";this.target.prefixes["foaf"]="http://xmlns.com/foaf/0.1/";this.target.prefixes["gr"]="http://purl.org/goodrelations/v1#";this.target.prefixes["ical"]="http://www.w3.org/2002/12/cal/icaltzd#";this.target.prefixes["og"]="http://ogp.me/ns#";this.target.prefixes["rev"]="http://purl.org/stuff/rev#";this.target.prefixes["sioc"]="http://rdfs.org/sioc/ns#";this.target.prefixes["v"]="http://rdf.data-vocabulary.org/#";this.target.prefixes["vcard"]="http://www.w3.org/2006/vcard/ns#";this.target.prefixes["schema"]="http://schema.org/";this.target.terms["describedby"]="http://www.w3.org/2007/05/powder-s#describedby";this.target.terms["license"]="http://www.w3.org/1999/xhtml/vocab#license";this.target.terms["role"]="http://www.w3.org/1999/xhtml/vocab#role"};RDFaProcessor.prototype.setXMLContext=function(){this.setInitialContext();this.inXHTMLMode=false};RDFaProcessor.prototype.setHTMLContext=function(){this.setInitialContext();this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"},{namespaceURI:null,localName:"lang"}];this.contentAttributes=["value","datetime","content"];this.inXHTMLMode=false};RDFaProcessor.prototype.setXHTMLContext=function(){this.setInitialContext();this.inXHTMLMode=true;this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}];this.contentAttributes=["content"];this.target.terms["alternate"]="http://www.w3.org/1999/xhtml/vocab#alternate";this.target.terms["appendix"]="http://www.w3.org/1999/xhtml/vocab#appendix";this.target.terms["bookmark"]="http://www.w3.org/1999/xhtml/vocab#bookmark";this.target.terms["cite"]="http://www.w3.org/1999/xhtml/vocab#cite";this.target.terms["chapter"]="http://www.w3.org/1999/xhtml/vocab#chapter";this.target.terms["contents"]="http://www.w3.org/1999/xhtml/vocab#contents";this.target.terms["copyright"]="http://www.w3.org/1999/xhtml/vocab#copyright";this.target.terms["first"]="http://www.w3.org/1999/xhtml/vocab#first";this.target.terms["glossary"]="http://www.w3.org/1999/xhtml/vocab#glossary";this.target.terms["help"]="http://www.w3.org/1999/xhtml/vocab#help";this.target.terms["icon"]="http://www.w3.org/1999/xhtml/vocab#icon";this.target.terms["index"]="http://www.w3.org/1999/xhtml/vocab#index";this.target.terms["last"]="http://www.w3.org/1999/xhtml/vocab#last";this.target.terms["license"]="http://www.w3.org/1999/xhtml/vocab#license";this.target.terms["meta"]="http://www.w3.org/1999/xhtml/vocab#meta";this.target.terms["next"]="http://www.w3.org/1999/xhtml/vocab#next";this.target.terms["prev"]="http://www.w3.org/1999/xhtml/vocab#prev";this.target.terms["previous"]="http://www.w3.org/1999/xhtml/vocab#previous";this.target.terms["section"]="http://www.w3.org/1999/xhtml/vocab#section";this.target.terms["stylesheet"]="http://www.w3.org/1999/xhtml/vocab#stylesheet";this.target.terms["subsection"]="http://www.w3.org/1999/xhtml/vocab#subsection";this.target.terms["start"]="http://www.w3.org/1999/xhtml/vocab#start";this.target.terms["top"]="http://www.w3.org/1999/xhtml/vocab#top";this.target.terms["up"]="http://www.w3.org/1999/xhtml/vocab#up";this.target.terms["p3pv1"]="http://www.w3.org/1999/xhtml/vocab#p3pv1";this.target.terms["related"]="http://www.w3.org/1999/xhtml/vocab#related";this.target.terms["role"]="http://www.w3.org/1999/xhtml/vocab#role";this.target.terms["transformation"]="http://www.w3.org/1999/xhtml/vocab#transformation"};RDFaProcessor.prototype.getTransferGraph=function(){var graph={};for(var subject in this.target.triplesGraph){var snode=this.target.triplesGraph[subject];var tsnode={subject:subject,predicates:{}};graph[subject]=tsnode;for(var predicate in snode.predicates){var pnode=snode.predicates[predicate];var tpnode={predicate:predicate,objects:[]};tsnode.predicates[predicate]=tpnode;for(var i=0;i<pnode.objects.length;i++){var object=pnode.objects[i];if(object.type==this.XMLLiteralURI){var serializer=new XMLSerializer;var value="";for(var x=0;x<object.value.length;x++){if(object.value[x].nodeType==Node.ELEMENT_NODE){value+=serializer.serializeToString(object.value[x])}else if(object.value[x].nodeType==Node.TEXT_NODE){value+=object.value[x].nodeValue}}tpnode.objects.push({type:object.type,value:value})}else{tpnode.objects.push({type:object.type,value:object.value})}}}}return graph};RDFaProcessor.prototype.newSubject=function(data,origin,subject){var snode=data.triplesGraph[subject];if(!snode){snode={subject:subject,predicates:{},origins:[]};data.triplesGraph[subject]=snode}for(var i=0;i<snode.origins.length;i++){if(snode.origins[i]==origin){return snode}}snode.origins.push(origin);return snode};RDFaProcessor.prototype.addTriple=function(data,origin,subject,predicate,object){var graph=data.triplesGraph;var snode=this.newSubject(data,origin,subject);var pnode=snode.predicates[predicate];if(!pnode){pnode={predicate:predicate,objects:[]};snode.predicates[predicate]=pnode}for(var i=0;i<pnode.objects.length;i++){if(pnode.objects[i].type==object.type&&pnode.objects[i].value==object.value){return}}data.tripleCount++;pnode.objects.push(object);object.origin=origin};RDFaProcessor.prototype.process=function(node){if(node.parentNode.nodeType==Node.DOCUMENT_NODE){this.setContext(node)}var queue=[];queue.push({current:node,context:this.push(null,node.baseURI)});while(queue.length>0){var item=queue.shift();if(item.parent){if(item.context.parent&&item.context.parent.listMapping==item.listMapping){continue}for(var predicate in item.listMapping){var list=item.listMapping[predicate];if(list.length==0){this.addTriple(this.target,item.parent,item.subject,predicate,{type:this.objectURI,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"});continue}var bnodes=[];for(var i=0;i<list.length;i++){bnodes.push(this.newBlankNode());this.newSubject(this.target,item.parent,bnodes[i])}for(var i=0;i<bnodes.length;i++){this.addTriple(this.target,item.parent,bnodes[i],"http://www.w3.org/1999/02/22-rdf-syntax-ns#first",list[i]);this.addTriple(this.target,item.parent,bnodes[i],"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest",{type:this.objectURI,value:i+1<bnodes.length?bnodes[i+1]:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"})}this.addTriple(this.target,item.parent,item.subject,predicate,{type:this.objectURI,value:bnodes[0]})}continue}var current=item.current;var context=item.context;var skip=false;var newSubject=null;var currentObjectResource=null;var typedResource=null;var prefixes=context.prefixes;var prefixesCopied=false;var incomplete=[];var listMapping=context.listMapping;var listMappingDifferent=context.parent?false:true;var language=context.language;var vocabulary=context.vocabulary;var base=this.parseURI(current.baseURI);current.subject=null;var vocabAtt=current.getAttributeNode("vocab");if(vocabAtt){var value=this.trim(vocabAtt.value);if(value.length>0){vocabulary=value;var baseSubject=base.spec;this.newSubject(this.target,current,baseSubject);this.addTriple(this.target,current,baseSubject,"http://www.w3.org/ns/rdfa#usesVocabulary",{type:this.objectURI,value:vocabulary})}else{vocabulary=this.vocabulary}}for(var i=0;i<current.attributes.length;i++){var att=current.attributes[i];if(att.nodeName.charAt(0)=="x"&&att.nodeName.indexOf("xmlns:")==0){if(!prefixesCopied){prefixes=this.copyMappings(prefixes);prefixesCopied=true}var prefix=att.nodeName.substring(6);prefixes[prefix]=this.trim(att.value)}}var prefixAtt=current.getAttributeNode("prefix");if(prefixAtt){if(!prefixesCopied){prefixes=this.copyMappings(prefixes);prefixesCopied=true}this.parsePrefixMappings(prefixAtt.value,prefixes)}var xmlLangAtt=null;for(var i=0;!xmlLangAtt&&i<this.langAttributes.length;i++){xmlLangAtt=current.getAttributeNodeNS(this.langAttributes[i].namespaceURI,this.langAttributes[i].localName)}if(xmlLangAtt){var value=this.trim(xmlLangAtt.value);if(value.length>0){language=value}}var relAtt=current.getAttributeNode("rel");var revAtt=current.getAttributeNode("rev");var typeofAtt=current.getAttributeNode("typeof");var propertyAtt=current.getAttributeNode("property");var datatypeAtt=current.getAttributeNode("datatype");var contentAtt=null;for(var i=0;!contentAtt&&i<this.contentAttributes.length;i++){contentAtt=current.getAttributeNode(this.contentAttributes[i])}var aboutAtt=current.getAttributeNode("about");var srcAtt=current.getAttributeNode("src");var resourceAtt=current.getAttributeNode("resource");var hrefAtt=current.getAttributeNode("href");var inlistAtt=current.getAttributeNode("inlist");if(relAtt||revAtt){if(aboutAtt){newSubject=this.parseSafeCURIEOrCURIEOrURI(aboutAtt.value,prefixes,base)}if(typeofAtt){typedResource=newSubject}if(!newSubject){if(current.parentNode.nodeType==Node.DOCUMENT_NODE){newSubject=current.baseURI}else if(context.parentObject){newSubject=current.parentNode.baseURI==context.parentObject?current.baseURI:context.parentObject}}if(resourceAtt){currentObjectResource=this.parseSafeCURIEOrCURIEOrURI(resourceAtt.value,prefixes,base)}if(!currentObjectResource){if(hrefAtt){currentObjectResource=this.resolveAndNormalize(base,hrefAtt.value)}else if(srcAtt){currentObjectResource=this.resolveAndNormalize(base,srcAtt.value)}else if(typeofAtt&&!aboutAtt&&!(this.inXHTMLMode&&(current.localName=="head"||current.localName=="body"))){currentObjectResource=this.newBlankNode()}}if(typeofAtt&&!aboutAtt&&this.inXHTMLMode&&(current.localName=="head"||current.localName=="body")){typedResource=newSubject}else if(typeofAtt&&!aboutAtt){typedResource=currentObjectResource}}else if(propertyAtt&&!contentAtt&&!datatypeAtt){if(aboutAtt){newSubject=this.parseSafeCURIEOrCURIEOrURI(aboutAtt.value,prefixes,base);if(typeofAtt){typedResource=newSubject}}if(!newSubject&&current.parentNode.nodeType==Node.DOCUMENT_NODE){newSubject=current.baseURI;if(typeofAtt){typedResource=newSubject}}else if(!newSubject&&context.parentObject){newSubject=current.parentNode.baseURI==context.parentObject?current.baseURI:context.parentObject}if(typeofAtt&&!typedResource){if(resourceAtt){typedResource=this.parseSafeCURIEOrCURIEOrURI(resourceAtt.value,prefixes,base)}if(!typedResource&&hrefAtt){typedResource=this.resolveAndNormalize(base,hrefAtt.value)}if(!typedResource&&srcAtt){typedResource=this.resolveAndNormalize(base,srcAtt.value)}if(!typedResource&&this.inXHTMLMode&&(current.localName=="head"||current.localName=="body")){typedResource=newSubject}if(!typedResource){typedResource=this.newBlankNode()}currentObjectResource=typedResource}}else{if(aboutAtt){newSubject=this.parseSafeCURIEOrCURIEOrURI(aboutAtt.value,prefixes,base)}if(!newSubject&&resourceAtt){newSubject=this.parseSafeCURIEOrCURIEOrURI(resourceAtt.value,prefixes,base)}if(!newSubject&&hrefAtt){newSubject=this.resolveAndNormalize(base,hrefAtt.value)}if(!typedResource&&srcAtt){newSubject=this.resolveAndNormalize(base,srcAtt.value)}if(!newSubject){if(current.parentNode.nodeType==Node.DOCUMENT_NODE){newSubject=current.baseURI}else if(this.inXHTMLMode&&(current.localName=="head"||current.localName=="body")){newSubject=current.parentNode.baseURI==context.parentObject?current.baseURI:context.parentObject}else if(typeofAtt){newSubject=this.newBlankNode()}else if(context.parentObject){newSubject=current.parentNode.baseURI==context.parentObject?current.baseURI:context.parentObject;if(!propertyAtt){skip=true}}}if(typeofAtt){typedResource=newSubject}}if(newSubject){this.newSubject(this.target,current,newSubject);current.subject=newSubject}if(typedResource){var values=this.tokenize(typeofAtt.value);for(var i=0;i<values.length;i++){var object=this.parseTermOrCURIEOrAbsURI(values[i],vocabulary,context.terms,prefixes,base);if(object){this.addTriple(this.target,current,typedResource,this.typeURI,{type:this.objectURI,value:object})}}}if(newSubject&&newSubject!=context.parentObject){listMapping={};listMappingDifferent=true}if(currentObjectResource){if(relAtt&&inlistAtt){var values=this.tokenize(relAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){var list=listMapping[predicate];if(!list){list=[];listMapping[predicate]=list}list.push({type:this.objectURI,value:currentObjectResource})}}}else if(relAtt){var values=this.tokenize(relAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){this.addTriple(this.target,current,newSubject,predicate,{type:this.objectURI,value:currentObjectResource})}}}if(revAtt){var values=this.tokenize(revAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){this.addTriple(this.target,current,currentObjectResource,predicate,{type:this.objectURI,value:newSubject})}}}}else{if(newSubject&&!currentObjectResource&&(relAtt||revAtt)){currentObjectResource=this.newBlankNode()}if(relAtt&&inlistAtt){var values=this.tokenize(relAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){var list=listMapping[predicate];if(!list){list=[];listMapping[predicate]=list}incomplete.push({predicate:predicate,list:list})}}}else if(relAtt){var values=this.tokenize(relAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){incomplete.push({predicate:predicate,forward:true})}}}if(revAtt){var values=this.tokenize(revAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){incomplete.push({predicate:predicate,forward:false})}}}}if(propertyAtt){var datatype=null;var content=null;if(datatypeAtt){datatype=datatypeAtt.value==""?this.PlainLiteralURI:this.parseTermOrCURIEOrAbsURI(datatypeAtt.value,vocabulary,context.terms,prefixes,base);content=datatype==this.XMLLiteralURI?null:contentAtt?contentAtt.value:current.textContent}else if(contentAtt){datatype=this.PlainLiteralURI;content=contentAtt.value}else if(!relAtt&&!revAtt&&!contentAtt){if(resourceAtt){content=this.parseSafeCURIEOrCURIEOrURI(resourceAtt.value,prefixes,base)}if(!content&&hrefAtt){content=this.resolveAndNormalize(base,hrefAtt.value)}else if(!content&&srcAtt){content=this.resolveAndNormalize(base,srcAtt.value)}if(content){datatype=this.objectURI}}if(!datatype){if(typeofAtt&&!aboutAtt){datatype=this.objectURI;content=typedResource}else{datatype=this.PlainLiteralURI;content=current.textContent}}var values=this.tokenize(propertyAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){if(inlistAtt){var list=listMapping[predicate];if(!list){list=[];listMapping[predicate]=list}list.push(datatype==this.XMLLiteralURI?{type:this.XMLLiteralURI,value:current.childNodes}:{type:datatype?datatype:this.PlainLiteralURI,value:content,language:language})}else{if(datatype==this.XMLLiteralURI){this.addTriple(this.target,current,newSubject,predicate,{type:this.XMLLiteralURI,value:current.childNodes})}else{this.addTriple(this.target,current,newSubject,predicate,{type:datatype?datatype:this.PlainLiteralURI,value:content,language:language})}}}}}if(newSubject&&!skip){for(var i=0;i<context.incomplete.length;i++){if(context.incomplete[i].list){context.incomplete[i].list.push({type:this.objectURI,value:newSubject})}else if(context.incomplete[i].forward){this.addTriple(this.target,current,context.subject,context.incomplete[i].predicate,{type:this.objectURI,value:newSubject})}else{this.addTriple(this.target,current,newSubject,context.incomplete[i].predicate,{type:this.objectURI,value:context.subject})}}}var childContext=null;var listSubject=newSubject;if(skip){childContext=this.push(context,context.subject);childContext.parentObject=current.parentNode.baseURI==context.parentObject?current.baseURI:context.parentObject;childContext.incomplete=context.incomplete;childContext.language=language;childContext.prefixes=prefixes;childContext.vocabulary=vocabulary}else{childContext=this.push(context,newSubject);childContext.parentObject=currentObjectResource?currentObjectResource:newSubject?newSubject:context.subject;childContext.prefixes=prefixes;
childContext.incomplete=incomplete;if(currentObjectResource){listSubject=currentObjectResource;listMapping={};listMappingDifferent=true}childContext.listMapping=listMapping;childContext.language=language;childContext.vocabulary=vocabulary}if(listMappingDifferent){queue.unshift({parent:current,context:context,subject:listSubject,listMapping:listMapping})}for(var child=current.lastChild;child;child=child.previousSibling){if(child.nodeType==Node.ELEMENT_NODE){queue.unshift({current:child,context:childContext})}}}for(var subject in this.target.triplesGraph){var snode=this.target.triplesGraph[subject];if(Object.size(snode.predicates)==0){delete this.target.triplesGraph[subject]}}};RDFaProcessor.prototype.push=function(parent,subject){return{parent:parent,subject:subject?subject:parent?parent.subject:null,parentObject:null,incomplete:[],listMapping:parent?parent.listMapping:{},language:parent?parent.language:this.language,prefixes:parent?parent.prefixes:this.target.prefixes,terms:parent?parent.terms:this.target.terms,vocabulary:parent?parent.voabulary:this.vocabulary}};function RDFaEnvironment(owner){this.query=function(query,template){if(!query){return owner.getProjections(template)}var projections=[];for(var subject in owner._data_.triplesGraph){var snode=owner._data_.triplesGraph[subject];for(var key in query){var predicate=owner._data_.curieParser.parse(key,true);var pnode=snode.predicates[predicate];if(!pnode){snode=null;break}var value=owner._data_.curieParser.parse(query[key],false);var object=null;for(var i=0;!object&&i<pnode.objects.length;i++){if(pnode.objects[i].value==value){object=pnode.objects[i]}}if(!object){snode=null;break}}if(snode){projections.push(DocumentData.toProjection(owner,snode,template))}}return projections}}function Projection(owner,subject){this._data_={owner:owner,subject:subject,properties:{}}}Projection.prototype.getProperties=function(){var propertyNames=[];for(var property in this._data_.properties){propertyNames.push(property)}return propertyNames};Projection.prototype.getSubject=function(){return this._data_.subject};Projection.prototype.get=function(uriOrCurie){var property=this._data_.owner._data_.curieParser.parse(uriOrCurie,true);var objects=this._data_.properties[property];return objects?objects[0]:null};Projection.prototype.getAll=function(uriOrCurie){var property=this._data_.owner._data_.curieParser.parse(uriOrCurie,true);return this._data_.properties[property]};DocumentData.prototype=new URIResolver;DocumentData.prototype.constructor=DocumentData;function DocumentData(uri){this._data_={tripleCount:0,triplesGraph:{},prefixes:{},terms:{},baseURI:this.parseURI(uri)};var dataContext=this._data_;this._data_.curieParser={trim:function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},parse:function(value,resolve){value=this.trim(value);if(value.charAt(0)=="["&&value.charAt(value.length-1)=="]"){value=value.substring(1,value.length-1)}var colon=value.indexOf(":");if(colon>=0){var prefix=value.substring(0,colon);if(prefix==""){var uri=dataContext.prefixes[""];return uri?uri+value.substring(colon+1):null}else if(prefix=="_"){return"_:"+value.substring(colon+1)}else if(DocumentData.NCNAME.test(prefix)){var uri=dataContext.prefixes[prefix];if(uri){return uri+value.substring(colon+1)}}}return resolve?dataContext.baseURI.resolve(value):value}};Object.defineProperty(this,"rdfa",{value:new RDFaEnvironment(this),writable:false,configurable:false,enumerable:true})}DocumentData.nameChar="[-A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�က0-F.0-9·̀-ͯ‿-⁀]";DocumentData.nameStartChar="[A-Za-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣一-龥〇〡-〩_]";DocumentData.NCNAME=new RegExp("^"+RDFaProcessor.nameStartChar+RDFaProcessor.nameChar+"*$");DocumentData.toProjection=function(owner,snode,template){var projection=new Projection(owner,snode.subject);for(var predicate in snode.predicates){var pnode=snode.predicates[predicate];var values=[];projection._data_.properties[predicate]=values;for(var i=0;i<pnode.objects.length;i++){values.push(pnode.objects[i].value)}}if(template){for(var key in template){var predicate=template[key];predicate=owner._data_.curieParser.parse(predicate,true);var values=projection._data_.properties[predicate];if(values){projection[key]=values.length==1?values[0]:values}}}return projection};DocumentData.prototype.getProperties=function(subject){var properties=[];if(subject){subject=this._data_.curieParser.parse(subject,true);snode=this._data_.triplesGraph[subject];if(snode){for(var predicate in snode.predicates){properties.push(predicate)}}}else{var uniqueProperties={};for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];if(snode){for(var predicate in snode.predicates){if(!uniqueProperties[predicate]){uniqueProperties[predicate]=true;properties.push(predicate)}}}}}return properties};DocumentData.prototype.getSubjects=function(property,value){var subjects=[];if(property){property=this._data_.curieParser.parse(property,true)}if(property&&value){var expanded=this._data_.curieParser.parse(value,true);for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];var pnode=snode.predicates[property];if(pnode){for(var i=0;i<pnode.objects.length;i++){if(pnode.objects[i].value==value||pnode.objects[i].value==expanded){subjects.push(subject);break}}}}}else if(property){for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];var pnode=snode.predicates[property];if(pnode){subjects.push(subject)}}}else if(value){var expanded=this._data_.curieParser.parse(value,true);for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];for(var predicate in snode.predicates){var pnode=subject.predicates[predicate];if(pnode){var object=null;for(var i=0;!object&&i<pnode.objects.length;i++){if(pnode.objects[i].value==value||node.objects[i].value==expanded){object=pnode.objects[i]}}if(object){subjects.push(subject);break}}}}}else{for(var subject in this._data_.triplesGraph){subjects.push(subject)}}return subjects};DocumentData.prototype.getValues=function(subject,property){var values=[];if(property){property=this._data_.curieParser.parse(property,true)}if(subject){subject=this._data_.curieParser.parse(subject,true);var snode=this._data_.triplesGraph[subject];if(snode){if(property){var pnode=snode.predicates[property];if(pnode){for(var i=0;i<pnode.objects.length;i++){values.push(pnode.objects[i].value)}}}else{for(var predicate in snode.predicates){var pnode=snode.predicates[predicate];for(var i=0;i<pnode.objects.length;i++){values.push(pnode.objects[i].value)}}}}}else if(property){for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];var pnode=snode.predicates[property];if(pnode){for(var i=0;i<pnode.objects.length;i++){values.push(pnode.objects[i].value)}}}}else{for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];for(var predicate in snode.predicates){var pnode=snode.predicates[predicate];for(var i=0;i<pnode.objects.length;i++){values.push(pnode.objects[i].value)}}}}return values};DocumentData.prototype.setMapping=function(prefix,uri){this._data_.prefixes[prefix]=uri};DocumentData.prototype.getSubjectTriples=function(subject){if(!subject){return null}subject=this._data_.curieParser.parse(subject,true);var triples={subject:subject,predicates:{}};var snode=this._data_.triplesGraph[subject];if(!snode){return null}for(var predicate in snode.predicates){var pnode=snode.predicates[predicate];var objects=[];triples.predicates[predicate]={predicate:predicate,objects:objects};for(var i=0;i<pnode.objects.length;i++){var object=pnode.objects[i];if(object.type==this.XMLLiteralURI){var serializer=new XMLSerializer;var value="";for(var x=0;x<object.value.length;x++){if(object.value[x].nodeType==Node.ELEMENT_NODE){value+=serializer.serializeToString(object.value[x])}else if(object.value[x].nodeType==Node.TEXT_NODE){value+=object.value[x].nodeValue}}objects.push({type:object.type,value:value})}else{objects.push({type:object.type,value:object.value})}}}return triples};DocumentData.prototype.getProjection=function(subject,template){if(!subject){return null}subject=this._data_.curieParser.parse(subject,true);var snode=this._data_.triplesGraph[subject];if(!snode){return null}return DocumentData.toProjection(this,snode,template)};DocumentData.prototype.getProjections=function(property,value,template){if(property){property=this._data_.curieParser.parse(property,true)}var projections=[];if(typeof value=="undefined"&&typeof template=="undefined"){template=property}if(property&&value){var expanded=this._data_.curieParser.parse(value,true);for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];var pnode=snode.predicates[property];if(pnode){for(var i=0;i<pnode.objects.length;i++){if(pnode.objects[i].value==value||pnode.objects[i].value==expanded){projections.push(DocumentData.toProjection(this,snode,template));break}}}}}else if(property){for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];if(snode.predicates[property]){projections.push(DocumentData.toProjection(this,snode,template))}}}else{for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];projections.push(DocumentData.toProjection(this,snode,template))}}return projections};DocumentData.attach=function(target){Object.defineProperty(target,"data",{value:new DocumentData(target.baseURI||target.location.href),writable:false,configurable:false,enumerable:true});target.getElementsByType=function(type){return this.getElementsByProperty("http://www.w3.org/1999/02/22-rdf-syntax-ns#type",type)};target.getElementsBySubject=function(subject){var nodes=[];nodes.item=function(index){return this[index]};subject=this.data._data_.curieParser.parse(subject,true);var snode=this.data._data_.triplesGraph[subject];if(snode){for(var i=0;i<snode.origins.length;i++){nodes.push(snode.origins[i])}}return nodes};target.getElementsByProperty=function(property,value){var nodes=[];nodes.item=function(index){return this[index]};if(value){value=this.data._data_.curieParser.parse(value,false)}var noValue=typeof value=="undefined";property=this.data._data_.curieParser.parse(property,true);for(var subject in this.data._data_.triplesGraph){var snode=this.data._data_.triplesGraph[subject];var pnode=snode.predicates[property];if(pnode){for(var i=0;i<pnode.objects.length;i++){if(noValue||pnode.objects[i].value==value){nodes.push(pnode.objects[i].origin)}}}}return nodes};target.getElementSubject=function(e){for(var subject in this.data._data_.triplesGraph){var snode=this.data._data_.triplesGraph[subject];for(predicate in snode.predicates){var pnode=snode.predicates[predicate];for(var i=0;i<pnode.objects.length;i++){if(pnode.objects[i].origin==e){return subject}}}}return null}};var hasFeature=document.implementation.hasFeature;document.implementation.hasFeature=function(feature,version){if(feature=="RDFaAPI"&&version=="1.1"){return true}return hasFeature(feature,version)};var loaded=document.data?true:false;if(document.head&&!_nodejs){var meta=document.createElement("meta");meta.setAttribute("name","green-turtle-rdfa-message");document.head.appendChild(meta);var makeEvent=function(){var event=document.createEvent("Event");event.initEvent("green-turtle-rdfa-extension",true,true);return event};meta.addEventListener("green-turtle-rdfa-document",function(event){var message=JSON.parse(meta.getAttribute("content"));if(message.type=="status"){var doneEvent=makeEvent();meta.setAttribute("content",'{ "type": "status", "loaded": '+loaded+', "count": '+document.data._data_.tripleCount+" }");setTimeout(function(){meta.dispatchEvent(doneEvent)},1)}else if(message.type=="get-subjects"){var subjects=document.data.getSubjects();meta.setAttribute("content",'{ "type": "subjects", "subjects": '+JSON.stringify(subjects)+" }");var event=makeEvent();setTimeout(function(){meta.dispatchEvent(event)},1)}else if(message.type=="get-subject"){var triples=null;if(document.data.getSubjectTriples){triples=document.data.getSubjectTriples(message.subject)}else{var subjects={};var subjectList=document.data.getSubjects();for(var i=0;i<subjectList.length;i++){subjects[subjectList[i]]=true}triples={subject:message.subject,predicates:{}};var projection=document.data.getProjection(message.subject);var properties=projection.getProperties();for(var i=0;i<properties.length;i++){var objects=[];triples.predicates[properties[i]]={predicate:predicate,objects:objects};var values=projection.getAll(properties[i]);for(var j=0;j<values.length;j++){if(subjects[values[j]]){objects.push({type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#object",value:values[j]})}else{objects.push({type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral",value:values[j]})}}}}var response={type:"subject",subject:message.subject,triples:triples};meta.setAttribute("content",JSON.stringify(response));var event=makeEvent();setTimeout(function(){meta.dispatchEvent(event)},1)}},false)}if(update||!document.data){if(!update){DocumentData.attach(document)}var processor=new RDFaProcessor(document.data._data_);processor.process(document.documentElement);loaded=true}};if(_nodejs){module.exports=RDFa;if(typeof Node==="undefined"){var Node={ELEMENT_NODE:1,TEXT_NODE:3,DOCUMENT_NODE:9}}}else{if(document.readyState=="loading"){window.addEventListener("load",function(){RDFa.attach(document)},false)}else{RDFa.attach(document)}}},{}],43:[function(require,module,exports){var process=require("__browserify_process"),Buffer=require("__browserify_Buffer");(function(){"use strict";var fs=require("fs");var jsonld=require("./jsonld");try{var request=require("request")}catch(e){}try{var jsdom=require("jsdom");var RDFa=require("../js/rdfa")}catch(e){}function _clone(value){if(value&&typeof value==="object"){var rval=Array.isArray(value)?[]:{};for(var i in value){rval[i]=_clone(value[i])}return rval}return value}function _typedParse(loc,type,data,callback){switch(type.toLowerCase()){case"text":case"plain":case"text/plain":callback(null,data);break;case"json":case"jsonld":case"json-ld":case"ld+json":case"application/json":case"application/ld+json":try{callback(null,JSON.parse(data))}catch(ex){callback({message:"Error parsing JSON.",contentType:type,url:loc,exception:ex.toString()})}break;case"xml":case"html":case"xhtml":case"text/html":case"application/xhtml+xml":if(typeof jsdom==="undefined"){callback({message:"jsdom module not found.",contentType:type,url:loc});break}if(typeof RDFa==="undefined"){callback({message:"RDFa module not found.",contentType:type,url:loc});break}try{jsdom.env({url:loc,html:data,done:function(errors,window){if(errors&&errors.length>0){return callback({message:"DOM Errors:",errors:errors,url:loc})}try{RDFa.attach(window.document);jsonld.fromRDF(window.document.data,{format:"rdfa-api"},callback)}catch(ex){callback({message:"RDFa extraction error.",contentType:type,url:loc})}}})}catch(ex){callback({message:"jsdom error.",contentType:type,url:loc})}break;default:callback({message:"Unknown Content-Type.",contentType:type,url:loc})}}function endsWith(str,suffix){return str.indexOf(suffix,str.length-suffix.length)!==-1}function isSequence(data){return typeof data==="string"||Buffer.isBuffer(data)}function _parse(loc,type,data,callback){var seq=isSequence(data);if(seq&&data.length===0){return callback(null,null)}if(!seq&&typeof data==="object"){return callback(null,data)}if(type&&type!=="auto"){return _typedParse(loc,type,data,callback)}if(loc&&endsWith(loc,".txt")){return _typedParse(loc,"text",data,callback)}if(loc&&(endsWith(loc,".json")||endsWith(loc,".jsonld")||endsWith(loc,".json-ld"))){return _typedParse(loc,"json",data,callback)}if(loc&&(endsWith(loc,".xml")||endsWith(loc,".html")||endsWith(loc,".xhtml"))){return _typedParse(loc,"html",data,callback)}_typedParse(loc,"application/ld+json",data,function(err,data){if(err){return _typedParse(loc,"text/html",data,function(err,data){if(err){return callback({message:"Unable to auto-detect format.",url:loc})}callback(null,data)})}callback(null,data)})}function _request(loc,options,callback){if(typeof options==="function"){callback=options;options={}}if(!loc||loc==="-"){var data="";process.stdin.resume();process.stdin.setEncoding(options.encoding||"utf8");process.stdin.on("data",function(chunk){data+=chunk});process.stdin.on("end",function(){_parse(loc,options.dataType,data,function(err,data){callback(err,null,data)})})}else if(loc.indexOf("http://")===0||loc.indexOf("https://")===0){if(typeof request==="undefined"){callback({message:"request module not found.",url:loc});return}var opts=_clone(options);opts.url=loc;opts.encoding=opts.encoding||"utf8";if(!("strictSSL"in opts)){opts.strictSSL=true}opts.headers=opts.headers||{};if(!("Accept"in opts.headers)){opts.headers.Accept="application/ld+json; q=1.0, "+"application/json; q=0.8, "+"text/html; q=0.6, "+"application/xhtml+xml; q=0.6"}request(opts,function(err,res,body){if(err){return callback(err)}if(!(res.statusCode>=200&&res.statusCode<300)){var msg={message:"Bad status code.",statusCode:res.statusCode,url:loc};if(body){return _parse(loc,null,body,function(err,data){if(err){data=body}msg.body=data;callback(msg)})}else{return callback(msg)}}if(!body||isSequence(body)&&body.length===0){return callback(null,null,null)}var dataType=options.dataType||(res.headers["content-type"]||"").split(";")[0];_parse(loc,dataType,body,function(err,data){callback(err,res,data)})})}else{fs.readFile(loc,options.encoding||"utf8",function(error,data){if(error){return callback(error)}_parse(loc,options.type,data,function(err,data){callback(err,null,data)})})}}module.exports=_request})()},{"../js/rdfa":42,"./jsonld":41,__browserify_Buffer:19,__browserify_process:20,fs:3,jsdom:5,request:44}],44:[function(require,module,exports){var process=require("__browserify_process"),Buffer=require("__browserify_Buffer");var http=require("http"),https=false,tls=false,url=require("url"),util=require("util"),stream=require("stream"),qs=require("qs"),querystring=require("querystring"),crypto=require("crypto"),oauth=require("oauth-sign"),hawk=require("hawk"),aws=require("aws-sign"),httpSignature=require("http-signature"),uuid=require("node-uuid"),mime=require("mime"),tunnel=require("tunnel-agent"),safeStringify=require("json-stringify-safe"),ForeverAgent=require("forever-agent"),FormData=require("form-data"),Cookie=require("cookie-jar"),CookieJar=Cookie.Jar,cookieJar=new CookieJar;try{https=require("https")}catch(e){}try{tls=require("tls")}catch(e){}var debug;if(/\brequest\b/.test(process.env.NODE_DEBUG)){debug=function(){console.error("REQUEST %s",util.format.apply(util,arguments))}}else{debug=function(){}}function toBase64(str){return new Buffer(str||"","ascii").toString("base64")}function md5(str){return crypto.createHash("md5").update(str).digest("hex")}if(https&&!https.Agent){https.Agent=function(options){http.Agent.call(this,options)};util.inherits(https.Agent,http.Agent);https.Agent.prototype._getConnection=function(host,port,cb){var s=tls.connect(port,host,this.options,function(){if(cb)cb()});return s}}function isReadStream(rs){if(rs.readable&&rs.path&&rs.mode){return true}}function copy(obj){var o={};Object.keys(obj).forEach(function(i){o[i]=obj[i]});return o}var isUrl=/^https?:/;var globalPool={};function Request(options){stream.Stream.call(this);this.readable=true;this.writable=true;if(typeof options==="string"){options={uri:options}}var reserved=Object.keys(Request.prototype);for(var i in options){if(reserved.indexOf(i)===-1){this[i]=options[i]}else{if(typeof options[i]==="function"){delete options[i]}}}if(options.method){this.explicitMethod=true}this.init(options)}util.inherits(Request,stream.Stream);Request.prototype.init=function(options){var self=this;if(!options)options={};if(!self.method)self.method=options.method||"GET";self.localAddress=options.localAddress;debug(options);if(!self.pool&&self.pool!==false)self.pool=globalPool;self.dests=self.dests||[];self.__isRequestRequest=true;if(!self._callback&&self.callback){self._callback=self.callback;self.callback=function(){if(self._callbackCalled)return;self._callbackCalled=true;self._callback.apply(self,arguments)};self.on("error",self.callback.bind());self.on("complete",self.callback.bind(self,null))}if(self.url&&!self.uri){self.uri=self.url;delete self.url}if(!self.uri){return self.emit("error",new Error("options.uri is a required argument"))}else{if(typeof self.uri=="string")self.uri=url.parse(self.uri)}if(self.strictSSL===false){self.rejectUnauthorized=false}if(self.proxy){if(typeof self.proxy=="string")self.proxy=url.parse(self.proxy);if(http.globalAgent&&self.uri.protocol==="https:"){var tunnelFn=self.proxy.protocol==="http:"?tunnel.httpsOverHttp:tunnel.httpsOverHttps;var tunnelOptions={proxy:{host:self.proxy.hostname,port:+self.proxy.port,proxyAuth:self.proxy.auth,headers:{Host:self.uri.hostname+":"+(self.uri.port||self.uri.protocol==="https:"?443:80)}},rejectUnauthorized:self.rejectUnauthorized,ca:this.ca};self.agent=tunnelFn(tunnelOptions);self.tunnel=true}}if(!self.uri.host||!self.uri.pathname){var faultyUri=url.format(self.uri);var message='Invalid URI "'+faultyUri+'"';if(Object.keys(options).length===0){message+=". This can be caused by a crappy redirection."}self.emit("error",new Error(message));return}self._redirectsFollowed=self._redirectsFollowed||0;self.maxRedirects=self.maxRedirects!==undefined?self.maxRedirects:10;self.followRedirect=self.followRedirect!==undefined?self.followRedirect:true;self.followAllRedirects=self.followAllRedirects!==undefined?self.followAllRedirects:false;if(self.followRedirect||self.followAllRedirects)self.redirects=self.redirects||[];self.headers=self.headers?copy(self.headers):{};self.setHost=false;if(!(self.headers.host||self.headers.Host)){self.headers.host=self.uri.hostname;if(self.uri.port){if(!(self.uri.port===80&&self.uri.protocol==="http:")&&!(self.uri.port===443&&self.uri.protocol==="https:"))self.headers.host+=":"+self.uri.port}self.setHost=true}self.jar(self._jar||options.jar);if(!self.uri.pathname){self.uri.pathname="/"}if(!self.uri.port){if(self.uri.protocol=="http:"){self.uri.port=80}else if(self.uri.protocol=="https:"){self.uri.port=443}}if(self.proxy&&!self.tunnel){self.port=self.proxy.port;self.host=self.proxy.hostname}else{self.port=self.uri.port;self.host=self.uri.hostname}self.clientErrorHandler=function(error){if(self._aborted)return;if(self.req&&self.req._reusedSocket&&error.code==="ECONNRESET"&&self.agent.addRequestNoreuse){self.agent={addRequest:self.agent.addRequestNoreuse.bind(self.agent)};self.start();self.req.end();return}if(self.timeout&&self.timeoutTimer){clearTimeout(self.timeoutTimer);self.timeoutTimer=null}self.emit("error",error)};self._parserErrorHandler=function(error){if(this.res){if(this.res.request){this.res.request.emit("error",error)}else{this.res.emit("error",error)}}else{this._httpMessage.emit("error",error)}};if(options.form){self.form(options.form)}if(options.qs)self.qs(options.qs);if(self.uri.path){self.path=self.uri.path}else{self.path=self.uri.pathname+(self.uri.search||"")}if(self.path.length===0)self.path="/";if(options.oauth){self.oauth(options.oauth)}if(options.aws){self.aws(options.aws)}if(options.hawk){self.hawk(options.hawk)}if(options.httpSignature){self.httpSignature(options.httpSignature)}if(options.auth){self.auth(options.auth.user===""?options.auth.user:options.auth.user||options.auth.username,options.auth.pass||options.auth.password,options.auth.sendImmediately)}if(self.uri.auth&&!self.headers.authorization){var authPieces=self.uri.auth.split(":").map(function(item){return querystring.unescape(item)});self.auth(authPieces[0],authPieces.slice(1).join(":"),true)}if(self.proxy&&self.proxy.auth&&!self.headers["proxy-authorization"]&&!self.tunnel){self.headers["proxy-authorization"]="Basic "+toBase64(self.proxy.auth.split(":").map(function(item){return querystring.unescape(item)}).join(":"))}if(self.proxy&&!self.tunnel)self.path=self.uri.protocol+"//"+self.uri.host+self.path;if(options.json){self.json(options.json)}else if(options.multipart){self.boundary=uuid();self.multipart(options.multipart)}if(self.body){var length=0;if(!Buffer.isBuffer(self.body)){if(Array.isArray(self.body)){for(var i=0;i<self.body.length;i++){length+=self.body[i].length}}else{self.body=new Buffer(self.body);length=self.body.length}}else{length=self.body.length}if(length){if(!self.headers["content-length"]&&!self.headers["Content-Length"])self.headers["content-length"]=length}else{throw new Error("Argument error, options.body.")}}var protocol=self.proxy&&!self.tunnel?self.proxy.protocol:self.uri.protocol,defaultModules={"http:":http,"https:":https},httpModules=self.httpModules||{};self.httpModule=httpModules[protocol]||defaultModules[protocol];if(!self.httpModule)return this.emit("error",new Error("Invalid protocol"));if(options.ca)self.ca=options.ca;if(!self.agent){if(options.agentOptions)self.agentOptions=options.agentOptions;if(options.agentClass){self.agentClass=options.agentClass}else if(options.forever){self.agentClass=protocol==="http:"?ForeverAgent:ForeverAgent.SSL}else{self.agentClass=self.httpModule.Agent}}if(self.pool===false){self.agent=false}else{self.agent=self.agent||self.getAgent();if(self.maxSockets){self.agent.maxSockets=self.maxSockets}if(self.pool.maxSockets){self.agent.maxSockets=self.pool.maxSockets}}self.on("pipe",function(src){if(self.ntick&&self._started)throw new Error("You cannot pipe to this stream after the outbound request has started.");self.src=src;if(isReadStream(src)){if(!self.headers["content-type"]&&!self.headers["Content-Type"])self.headers["content-type"]=mime.lookup(src.path)}else{if(src.headers){for(var i in src.headers){if(!self.headers[i]){self.headers[i]=src.headers[i]}}}if(self._json&&!self.headers["content-type"]&&!self.headers["Content-Type"])self.headers["content-type"]="application/json";if(src.method&&!self.explicitMethod){self.method=src.method}}});process.nextTick(function(){if(self._aborted)return;if(self._form){self.setHeaders(self._form.getHeaders());self._form.pipe(self)}if(self.body){if(Array.isArray(self.body)){self.body.forEach(function(part){self.write(part)})}else{self.write(self.body)}self.end()}else if(self.requestBodyStream){console.warn("options.requestBodyStream is deprecated, please pass the request object to stream.pipe.");self.requestBodyStream.pipe(self)}else if(!self.src){if(self.method!=="GET"&&typeof self.method!=="undefined"){self.headers["content-length"]=0}self.end()}self.ntick=true})};Request.prototype._updateProtocol=function(){var self=this;var protocol=self.uri.protocol;if(protocol==="https:"){if(self.proxy){self.tunnel=true;var tunnelFn=self.proxy.protocol==="http:"?tunnel.httpsOverHttp:tunnel.httpsOverHttps;var tunnelOptions={proxy:{host:self.proxy.hostname,port:+self.proxy.port,proxyAuth:self.proxy.auth},rejectUnauthorized:self.rejectUnauthorized,ca:self.ca};self.agent=tunnelFn(tunnelOptions);return}self.httpModule=https;switch(self.agentClass){case ForeverAgent:self.agentClass=ForeverAgent.SSL;break;case http.Agent:self.agentClass=https.Agent;break;default:return}if(self.agent)self.agent=self.getAgent()}else{if(self.tunnel)self.tunnel=false;self.httpModule=http;switch(self.agentClass){case ForeverAgent.SSL:self.agentClass=ForeverAgent;break;case https.Agent:self.agentClass=http.Agent;break;default:return}if(self.agent){self.agent=null;self.agent=self.getAgent()}}};Request.prototype.getAgent=function(){var Agent=this.agentClass;var options={};if(this.agentOptions){for(var i in this.agentOptions){options[i]=this.agentOptions[i]}}if(this.ca)options.ca=this.ca;if(typeof this.rejectUnauthorized!=="undefined")options.rejectUnauthorized=this.rejectUnauthorized;if(this.cert&&this.key){options.key=this.key;options.cert=this.cert}var poolKey="";if(Agent!==this.httpModule.Agent){poolKey+=Agent.name}if(!this.httpModule.globalAgent){options.host=this.host;options.port=this.port;if(poolKey)poolKey+=":";poolKey+=this.host+":"+this.port}var proxy=this.proxy;if(typeof proxy==="string")proxy=url.parse(proxy);var isHttps=proxy&&proxy.protocol==="https:"||this.uri.protocol==="https:";if(isHttps){if(options.ca){if(poolKey)poolKey+=":";poolKey+=options.ca}if(typeof options.rejectUnauthorized!=="undefined"){if(poolKey)poolKey+=":";poolKey+=options.rejectUnauthorized}if(options.cert)poolKey+=options.cert.toString("ascii")+options.key.toString("ascii");if(options.ciphers){if(poolKey)poolKey+=":";poolKey+=options.ciphers}if(options.secureOptions){if(poolKey)poolKey+=":";poolKey+=options.secureOptions}}if(!poolKey&&Object.keys(options).length===0&&this.httpModule.globalAgent){return this.httpModule.globalAgent}poolKey=this.uri.protocol+poolKey;if(this.pool[poolKey])return this.pool[poolKey];return this.pool[poolKey]=new Agent(options)};Request.prototype.start=function(){var self=this;if(self._aborted)return;self._started=true;self.method=self.method||"GET";self.href=self.uri.href;if(self.src&&self.src.stat&&self.src.stat.size&&!self.headers["content-length"]&&!self.headers["Content-Length"]){self.headers["content-length"]=self.src.stat.size}if(self._aws){self.aws(self._aws,true)}var reqOptions=copy(self);delete reqOptions.auth;debug("make request",self.uri.href);self.req=self.httpModule.request(reqOptions,self.onResponse.bind(self));if(self.timeout&&!self.timeoutTimer){self.timeoutTimer=setTimeout(function(){self.req.abort();var e=new Error("ETIMEDOUT");e.code="ETIMEDOUT";self.emit("error",e)},self.timeout);if(self.req.setTimeout){self.req.setTimeout(self.timeout,function(){if(self.req){self.req.abort();var e=new Error("ESOCKETTIMEDOUT");e.code="ESOCKETTIMEDOUT";self.emit("error",e)}})}}self.req.on("error",self.clientErrorHandler);self.req.on("drain",function(){self.emit("drain")});self.on("end",function(){if(self.req.connection)self.req.connection.removeListener("error",self._parserErrorHandler)});self.emit("request",self.req)};Request.prototype.onResponse=function(response){var self=this;debug("onResponse",self.uri.href,response.statusCode,response.headers);response.on("end",function(){debug("response end",self.uri.href,response.statusCode,response.headers)});if(response.connection.listeners("error").indexOf(self._parserErrorHandler)===-1){response.connection.once("error",self._parserErrorHandler)}if(self._aborted){debug("aborted",self.uri.href);response.resume();return}if(self._paused)response.pause();else response.resume();self.response=response;response.request=self;response.toJSON=toJSON;if(self.httpModule===https&&self.strictSSL&&!response.client.authorized){debug("strict ssl error",self.uri.href);var sslErr=response.client.authorizationError;self.emit("error",new Error("SSL Error: "+sslErr));return}if(self.setHost)delete self.headers.host;if(self.timeout&&self.timeoutTimer){clearTimeout(self.timeoutTimer);self.timeoutTimer=null}var addCookie=function(cookie){if(self._jar)self._jar.add(new Cookie(cookie));else cookieJar.add(new Cookie(cookie))};if(response.headers["set-cookie"]&&!self._disableCookies){if(Array.isArray(response.headers["set-cookie"]))response.headers["set-cookie"].forEach(addCookie);else addCookie(response.headers["set-cookie"])}var redirectTo=null;if(response.statusCode>=300&&response.statusCode<400&&response.headers.location){debug("redirect",response.headers.location);if(self.followAllRedirects){redirectTo=response.headers.location}else if(self.followRedirect){switch(self.method){case"PATCH":case"PUT":case"POST":case"DELETE":break;default:redirectTo=response.headers.location;
break}}}else if(response.statusCode==401&&self._hasAuth&&!self._sentAuth){var authHeader=response.headers["www-authenticate"];var authVerb=authHeader&&authHeader.split(" ")[0];debug("reauth",authVerb);switch(authVerb){case"Basic":self.auth(self._user,self._pass,true);redirectTo=self.uri;break;case"Digest":var matches=authHeader.match(/([a-z0-9_-]+)="([^"]+)"/gi);var challenge={};for(var i=0;i<matches.length;i++){var eqPos=matches[i].indexOf("=");var key=matches[i].substring(0,eqPos);var quotedValue=matches[i].substring(eqPos+1);challenge[key]=quotedValue.substring(1,quotedValue.length-1)}var ha1=md5(self._user+":"+challenge.realm+":"+self._pass);var ha2=md5(self.method+":"+self.uri.path);var digestResponse=md5(ha1+":"+challenge.nonce+":1::auth:"+ha2);var authValues={username:self._user,realm:challenge.realm,nonce:challenge.nonce,uri:self.uri.path,qop:challenge.qop,response:digestResponse,nc:1,cnonce:""};authHeader=[];for(var k in authValues){authHeader.push(k+'="'+authValues[k]+'"')}authHeader="Digest "+authHeader.join(", ");self.setHeader("authorization",authHeader);self._sentAuth=true;redirectTo=self.uri;break}}if(redirectTo){debug("redirect to",redirectTo);if(self._paused)response.resume();if(self._redirectsFollowed>=self.maxRedirects){self.emit("error",new Error("Exceeded maxRedirects. Probably stuck in a redirect loop "+self.uri.href));return}self._redirectsFollowed+=1;if(!isUrl.test(redirectTo)){redirectTo=url.resolve(self.uri.href,redirectTo)}var uriPrev=self.uri;self.uri=url.parse(redirectTo);if(self.uri.protocol!==uriPrev.protocol){self._updateProtocol()}self.redirects.push({statusCode:response.statusCode,redirectUri:redirectTo});if(self.followAllRedirects&&response.statusCode!=401)self.method="GET";delete self.src;delete self.req;delete self.agent;delete self._started;if(response.statusCode!=401){delete self.body;delete self._form;if(self.headers){delete self.headers.host;delete self.headers["content-type"];delete self.headers["content-length"]}}self.emit("redirect");self.init();return}else{self._redirectsFollowed=self._redirectsFollowed||0;response.on("close",function(){if(!self._ended)self.response.emit("end")});if(self.encoding){if(self.dests.length!==0){console.error("Ignoring encoding parameter as this stream is being piped to another stream which makes the encoding option invalid.")}else{response.setEncoding(self.encoding)}}self.emit("response",response);self.dests.forEach(function(dest){self.pipeDest(dest)});response.on("data",function(chunk){self._destdata=true;self.emit("data",chunk)});response.on("end",function(chunk){self._ended=true;self.emit("end",chunk)});response.on("close",function(){self.emit("close")});if(self.callback){var buffer=[];var bodyLen=0;self.on("data",function(chunk){buffer.push(chunk);bodyLen+=chunk.length});self.on("end",function(){debug("end event",self.uri.href);if(self._aborted){debug("aborted",self.uri.href);return}if(buffer.length&&Buffer.isBuffer(buffer[0])){debug("has body",self.uri.href,bodyLen);var body=new Buffer(bodyLen);var i=0;buffer.forEach(function(chunk){chunk.copy(body,i,0,chunk.length);i+=chunk.length});if(self.encoding===null){response.body=body}else{response.body=body.toString(self.encoding)}}else if(buffer.length){if(self.encoding==="utf8"&&buffer[0].length>0&&buffer[0][0]==="﻿"){buffer[0]=buffer[0].substring(1)}response.body=buffer.join("")}if(self._json){try{response.body=JSON.parse(response.body)}catch(e){}}debug("emitting complete",self.uri.href);if(response.body==undefined&&!self._json){response.body=""}self.emit("complete",response,response.body)})}}debug("finish init function",self.uri.href)};Request.prototype.abort=function(){this._aborted=true;if(this.req){this.req.abort()}else if(this.response){this.response.abort()}this.emit("abort")};Request.prototype.pipeDest=function(dest){var response=this.response;if(dest.headers){dest.headers["content-type"]=response.headers["content-type"];if(response.headers["content-length"]){dest.headers["content-length"]=response.headers["content-length"]}}if(dest.setHeader){for(var i in response.headers){dest.setHeader(i,response.headers[i])}dest.statusCode=response.statusCode}if(this.pipefilter)this.pipefilter(response,dest)};Request.prototype.setHeader=function(name,value,clobber){if(clobber===undefined)clobber=true;if(clobber||!this.headers.hasOwnProperty(name))this.headers[name]=value;else this.headers[name]+=","+value;return this};Request.prototype.setHeaders=function(headers){for(var i in headers){this.setHeader(i,headers[i])}return this};Request.prototype.qs=function(q,clobber){var base;if(!clobber&&this.uri.query)base=qs.parse(this.uri.query);else base={};for(var i in q){base[i]=q[i]}if(qs.stringify(base)===""){return this}this.uri=url.parse(this.uri.href.split("?")[0]+"?"+qs.stringify(base));this.url=this.uri;this.path=this.uri.path;return this};Request.prototype.form=function(form){if(form){this.headers["content-type"]="application/x-www-form-urlencoded; charset=utf-8";this.body=qs.stringify(form).toString("utf8");return this}this._form=new FormData;return this._form};Request.prototype.multipart=function(multipart){var self=this;self.body=[];if(!self.headers["content-type"]){self.headers["content-type"]="multipart/related; boundary="+self.boundary}else{self.headers["content-type"]=self.headers["content-type"].split(";")[0]+"; boundary="+self.boundary}if(!multipart.forEach)throw new Error("Argument error, options.multipart.");if(self.preambleCRLF){self.body.push(new Buffer("\r\n"))}multipart.forEach(function(part){var body=part.body;if(body==null)throw Error("Body attribute missing in multipart.");delete part.body;var preamble="--"+self.boundary+"\r\n";Object.keys(part).forEach(function(key){preamble+=key+": "+part[key]+"\r\n"});preamble+="\r\n";self.body.push(new Buffer(preamble));self.body.push(new Buffer(body));self.body.push(new Buffer("\r\n"))});self.body.push(new Buffer("--"+self.boundary+"--"));return self};Request.prototype.json=function(val){var self=this;var setAcceptHeader=function(){if(!self.headers["accept"]&&!self.headers["Accept"]){self.setHeader("accept","application/json")}};setAcceptHeader();this._json=true;if(typeof val==="boolean"){if(typeof this.body==="object"){setAcceptHeader();this.body=safeStringify(this.body);self.setHeader("content-type","application/json")}}else{setAcceptHeader();this.body=safeStringify(val);self.setHeader("content-type","application/json")}return this};function getHeader(name,headers){var result,re,match;Object.keys(headers).forEach(function(key){re=new RegExp(name,"i");match=key.match(re);if(match)result=headers[key]});return result}Request.prototype.auth=function(user,pass,sendImmediately){if(typeof user!=="string"||pass!==undefined&&typeof pass!=="string"){throw new Error("auth() received invalid user or password")}this._user=user;this._pass=pass;this._hasAuth=true;if(sendImmediately||typeof sendImmediately=="undefined"){this.setHeader("authorization","Basic "+toBase64(user+":"+pass));this._sentAuth=true}return this};Request.prototype.aws=function(opts,now){if(!now){this._aws=opts;return this}var date=new Date;this.setHeader("date",date.toUTCString());var auth={key:opts.key,secret:opts.secret,verb:this.method.toUpperCase(),date:date,contentType:getHeader("content-type",this.headers)||"",md5:getHeader("content-md5",this.headers)||"",amazonHeaders:aws.canonicalizeHeaders(this.headers)};if(opts.bucket&&this.path){auth.resource="/"+opts.bucket+this.path}else if(opts.bucket&&!this.path){auth.resource="/"+opts.bucket}else if(!opts.bucket&&this.path){auth.resource=this.path}else if(!opts.bucket&&!this.path){auth.resource="/"}auth.resource=aws.canonicalizeResource(auth.resource);this.setHeader("authorization",aws.authorization(auth));return this};Request.prototype.httpSignature=function(opts){var req=this;httpSignature.signRequest({getHeader:function(header){return getHeader(header,req.headers)},setHeader:function(header,value){req.setHeader(header,value)},method:this.method,path:this.path},opts);debug("httpSignature authorization",getHeader("authorization",this.headers));return this};Request.prototype.hawk=function(opts){this.headers.Authorization=hawk.client.header(this.uri,this.method,opts).field};Request.prototype.oauth=function(_oauth){var form;if(this.headers["content-type"]&&this.headers["content-type"].slice(0,"application/x-www-form-urlencoded".length)==="application/x-www-form-urlencoded"){form=qs.parse(this.body)}if(this.uri.query){form=qs.parse(this.uri.query)}if(!form)form={};var oa={};for(var i in form)oa[i]=form[i];for(var i in _oauth)oa["oauth_"+i]=_oauth[i];if(!oa.oauth_version)oa.oauth_version="1.0";if(!oa.oauth_timestamp)oa.oauth_timestamp=Math.floor(Date.now()/1e3).toString();if(!oa.oauth_nonce)oa.oauth_nonce=uuid().replace(/-/g,"");oa.oauth_signature_method="HMAC-SHA1";var consumer_secret=oa.oauth_consumer_secret;delete oa.oauth_consumer_secret;var token_secret=oa.oauth_token_secret;delete oa.oauth_token_secret;var timestamp=oa.oauth_timestamp;var baseurl=this.uri.protocol+"//"+this.uri.host+this.uri.pathname;var signature=oauth.hmacsign(this.method,baseurl,oa,consumer_secret,token_secret);for(var i in form){if(i.slice(0,"oauth_")in _oauth){}else{delete oa["oauth_"+i];if(i!=="x_auth_mode")delete oa[i]}}oa.oauth_timestamp=timestamp;this.headers.Authorization="OAuth "+Object.keys(oa).sort().map(function(i){return i+'="'+oauth.rfc3986(oa[i])+'"'}).join(",");this.headers.Authorization+=',oauth_signature="'+oauth.rfc3986(signature)+'"';return this};Request.prototype.jar=function(jar){var cookies;if(this._redirectsFollowed===0){this.originalCookieHeader=this.headers.cookie}if(jar===false){cookies=false;this._disableCookies=true}else if(jar){cookies=jar.get({url:this.uri.href})}else{cookies=cookieJar.get({url:this.uri.href})}if(cookies&&cookies.length){var cookieString=cookies.map(function(c){return c.name+"="+c.value}).join("; ");if(this.originalCookieHeader){this.headers.cookie=this.originalCookieHeader+"; "+cookieString}else{this.headers.cookie=cookieString}}this._jar=jar;return this};Request.prototype.pipe=function(dest,opts){if(this.response){if(this._destdata){throw new Error("You cannot pipe after data has been emitted from the response.")}else if(this._ended){throw new Error("You cannot pipe after the response has been ended.")}else{stream.Stream.prototype.pipe.call(this,dest,opts);this.pipeDest(dest);return dest}}else{this.dests.push(dest);stream.Stream.prototype.pipe.call(this,dest,opts);return dest}};Request.prototype.write=function(){if(!this._started)this.start();return this.req.write.apply(this.req,arguments)};Request.prototype.end=function(chunk){if(chunk)this.write(chunk);if(!this._started)this.start();this.req.end()};Request.prototype.pause=function(){if(!this.response)this._paused=true;else this.response.pause.apply(this.response,arguments)};Request.prototype.resume=function(){if(!this.response)this._paused=false;else this.response.resume.apply(this.response,arguments)};Request.prototype.destroy=function(){if(!this._ended)this.end();else if(this.response)this.response.destroy()};function initParams(uri,options,callback){if(typeof options==="function"&&!callback)callback=options;if(options&&typeof options==="object"){options.uri=uri}else if(typeof uri==="string"){options={uri:uri}}else{options=uri;uri=options.uri}return{uri:uri,options:options,callback:callback}}function request(uri,options,callback){if(typeof uri==="undefined")throw new Error("undefined is not a valid uri or options object.");if(typeof options==="function"&&!callback)callback=options;if(options&&typeof options==="object"){options.uri=uri}else if(typeof uri==="string"){options={uri:uri}}else{options=uri}options=copy(options);if(callback)options.callback=callback;var r=new Request(options);return r}module.exports=request;request.Request=Request;request.debug=process.env.NODE_DEBUG&&/request/.test(process.env.NODE_DEBUG);request.initParams=initParams;request.defaults=function(options,requester){var def=function(method){var d=function(uri,opts,callback){var params=initParams(uri,opts,callback);for(var i in options){if(params.options[i]===undefined)params.options[i]=options[i]}if(typeof requester==="function"){if(method===request){method=requester}else{params.options._requester=requester}}return method(params.options,params.callback)};return d};var de=def(request);de.get=def(request.get);de.patch=def(request.patch);de.post=def(request.post);de.put=def(request.put);de.head=def(request.head);de.del=def(request.del);de.cookie=def(request.cookie);de.jar=request.jar;return de};request.forever=function(agentOptions,optionsArg){var options={};if(optionsArg){for(option in optionsArg){options[option]=optionsArg[option]}}if(agentOptions)options.agentOptions=agentOptions;options.forever=true;return request.defaults(options)};request.get=request;request.post=function(uri,options,callback){var params=initParams(uri,options,callback);params.options.method="POST";return request(params.uri||null,params.options,params.callback)};request.put=function(uri,options,callback){var params=initParams(uri,options,callback);params.options.method="PUT";return request(params.uri||null,params.options,params.callback)};request.patch=function(uri,options,callback){var params=initParams(uri,options,callback);params.options.method="PATCH";return request(params.uri||null,params.options,params.callback)};request.head=function(uri,options,callback){var params=initParams(uri,options,callback);params.options.method="HEAD";if(params.options.body||params.options.requestBodyStream||params.options.json&&typeof params.options.json!=="boolean"||params.options.multipart){throw new Error("HTTP HEAD requests MUST NOT include a request body.")}return request(params.uri||null,params.options,params.callback)};request.del=function(uri,options,callback){var params=initParams(uri,options,callback);params.options.method="DELETE";if(typeof params.options._requester==="function"){request=params.options._requester}return request(params.uri||null,params.options,params.callback)};request.jar=function(){return new CookieJar};request.cookie=function(str){if(str&&str.uri)str=str.uri;if(typeof str!=="string")throw new Error("The cookie function only accepts STRING as param");return new Cookie(str)};function getSafe(self,uuid){if(typeof self==="object"||typeof self==="function")var safe={};if(Array.isArray(self))var safe=[];var recurse=[];Object.defineProperty(self,uuid,{});var attrs=Object.keys(self).filter(function(i){if(i===uuid)return false;if(typeof self[i]!=="object"&&typeof self[i]!=="function"||self[i]===null)return true;return!Object.getOwnPropertyDescriptor(self[i],uuid)});for(var i=0;i<attrs.length;i++){if(typeof self[attrs[i]]!=="object"&&typeof self[attrs[i]]!=="function"||self[attrs[i]]===null){safe[attrs[i]]=self[attrs[i]]}else{recurse.push(attrs[i]);Object.defineProperty(self[attrs[i]],uuid,{})}}for(var i=0;i<recurse.length;i++){safe[recurse[i]]=getSafe(self[recurse[i]],uuid)}return safe}function toJSON(){return getSafe(this,"__"+((1+Math.random())*65536|0).toString(16))}Request.prototype.toJSON=toJSON},{__browserify_Buffer:19,__browserify_process:20,"aws-sign":45,"cookie-jar":46,crypto:7,"forever-agent":48,"form-data":49,hawk:52,http:13,"http-signature":73,https:17,"json-stringify-safe":88,mime:89,"node-uuid":90,"oauth-sign":91,qs:92,querystring:28,stream:30,tls:94,"tunnel-agent":93,url:37,util:39}],45:[function(require,module,exports){var crypto=require("crypto"),parse=require("url").parse;var keys=["acl","location","logging","notification","partNumber","policy","requestPayment","torrent","uploadId","uploads","versionId","versioning","versions","website"];function authorization(options){return"AWS "+options.key+":"+sign(options)}module.exports=authorization;module.exports.authorization=authorization;function hmacSha1(options){return crypto.createHmac("sha1",options.secret).update(options.message).digest("base64")}module.exports.hmacSha1=hmacSha1;function sign(options){options.message=stringToSign(options);return hmacSha1(options)}module.exports.sign=sign;function signQuery(options){options.message=queryStringToSign(options);return hmacSha1(options)}module.exports.signQuery=signQuery;function stringToSign(options){var headers=options.amazonHeaders||"";if(headers)headers+="\n";var r=[options.verb,options.md5,options.contentType,options.date.toUTCString(),headers+options.resource];return r.join("\n")}module.exports.queryStringToSign=stringToSign;function queryStringToSign(options){return"GET\n\n\n"+options.date+"\n"+options.resource}module.exports.queryStringToSign=queryStringToSign;function canonicalizeHeaders(headers){var buf=[],fields=Object.keys(headers);for(var i=0,len=fields.length;i<len;++i){var field=fields[i],val=headers[field],field=field.toLowerCase();if(0!==field.indexOf("x-amz"))continue;buf.push(field+":"+val)}return buf.sort().join("\n")}module.exports.canonicalizeHeaders=canonicalizeHeaders;function canonicalizeResource(resource){var url=parse(resource,true),path=url.pathname,buf=[];Object.keys(url.query).forEach(function(key){if(!~keys.indexOf(key))return;var val=""==url.query[key]?"":"="+encodeURIComponent(url.query[key]);buf.push(key+val)});return path+(buf.length?"?"+buf.sort().join("&"):"")}module.exports.canonicalizeResource=canonicalizeResource},{crypto:7,url:37}],46:[function(require,module,exports){var url=require("url");var Cookie=exports=module.exports=function Cookie(str,req){this.str=str;str.split(/ *; */).reduce(function(obj,pair){var p=pair.indexOf("=");var key=p>0?pair.substring(0,p).trim():pair.trim();var lowerCasedKey=key.toLowerCase();var value=p>0?pair.substring(p+1).trim():true;if(!obj.name){obj.name=key;obj.value=value}else if(lowerCasedKey==="httponly"){obj.httpOnly=value}else{obj[lowerCasedKey]=value}return obj},this);this.expires=this.expires?new Date(this.expires):Infinity;this.path=this.path?this.path.trim():req?url.parse(req.url).pathname:"/"};Cookie.prototype.toString=function(){return this.str};module.exports.Jar=require("./jar")},{"./jar":47,url:37}],47:[function(require,module,exports){var url=require("url");var CookieJar=exports=module.exports=function CookieJar(){this.cookies=[]};CookieJar.prototype.add=function(cookie){this.cookies=this.cookies.filter(function(c){return!(c.name==cookie.name&&c.path==cookie.path)});this.cookies.push(cookie)};CookieJar.prototype.get=function(req){var path=url.parse(req.url).pathname,now=new Date,specificity={};return this.cookies.filter(function(cookie){if(0==path.indexOf(cookie.path)&&now<cookie.expires&&cookie.path.length>(specificity[cookie.name]||0))return specificity[cookie.name]=cookie.path.length})};CookieJar.prototype.cookieString=function(req){var cookies=this.get(req);if(cookies.length){return cookies.map(function(cookie){return cookie.name+"="+cookie.value}).join("; ")}}},{url:37}],48:[function(require,module,exports){module.exports=ForeverAgent;ForeverAgent.SSL=ForeverAgentSSL;var util=require("util"),Agent=require("http").Agent,net=require("net"),tls=require("tls"),AgentSSL=require("https").Agent;function ForeverAgent(options){var self=this;self.options=options||{};self.requests={};self.sockets={};self.freeSockets={};self.maxSockets=self.options.maxSockets||Agent.defaultMaxSockets;self.minSockets=self.options.minSockets||ForeverAgent.defaultMinSockets;self.on("free",function(socket,host,port){var name=host+":"+port;if(self.requests[name]&&self.requests[name].length){self.requests[name].shift().onSocket(socket)}else if(self.sockets[name].length<self.minSockets){if(!self.freeSockets[name])self.freeSockets[name]=[];self.freeSockets[name].push(socket);function onIdleError(){socket.destroy()}socket._onIdleError=onIdleError;socket.on("error",onIdleError)}else{socket.destroy()}})}util.inherits(ForeverAgent,Agent);ForeverAgent.defaultMinSockets=5;ForeverAgent.prototype.createConnection=net.createConnection;ForeverAgent.prototype.addRequestNoreuse=Agent.prototype.addRequest;ForeverAgent.prototype.addRequest=function(req,host,port){var name=host+":"+port;if(this.freeSockets[name]&&this.freeSockets[name].length>0&&!req.useChunkedEncodingByDefault){var idleSocket=this.freeSockets[name].pop();idleSocket.removeListener("error",idleSocket._onIdleError);delete idleSocket._onIdleError;req._reusedSocket=true;req.onSocket(idleSocket)}else{this.addRequestNoreuse(req,host,port)}};ForeverAgent.prototype.removeSocket=function(s,name,host,port){if(this.sockets[name]){var index=this.sockets[name].indexOf(s);if(index!==-1){this.sockets[name].splice(index,1)}}else if(this.sockets[name]&&this.sockets[name].length===0){delete this.sockets[name];delete this.requests[name]}if(this.freeSockets[name]){var index=this.freeSockets[name].indexOf(s);if(index!==-1){this.freeSockets[name].splice(index,1);if(this.freeSockets[name].length===0){delete this.freeSockets[name]}}}if(this.requests[name]&&this.requests[name].length){this.createSocket(name,host,port).emit("free")}};function ForeverAgentSSL(options){ForeverAgent.call(this,options)}util.inherits(ForeverAgentSSL,ForeverAgent);ForeverAgentSSL.prototype.createConnection=createConnectionSSL;ForeverAgentSSL.prototype.addRequestNoreuse=AgentSSL.prototype.addRequest;function createConnectionSSL(port,host,options){if(typeof port==="object"){options=port}else if(typeof host==="object"){options=host}else if(typeof options==="object"){options=options}else{options={}}if(typeof port==="number"){options.port=port}if(typeof host==="string"){options.host=host}return tls.connect(options)}},{http:13,https:17,net:3,tls:94,util:39}],49:[function(require,module,exports){var process=require("__browserify_process"),Buffer=require("__browserify_Buffer");var CombinedStream=require("combined-stream");var util=require("util");var path=require("path");var http=require("http");var https=require("https");var parseUrl=require("url").parse;var fs=require("fs");var mime=require("mime");var async=require("async");module.exports=FormData;function FormData(){this._overheadLength=0;this._valueLength=0;this._lengthRetrievers=[];CombinedStream.call(this)}util.inherits(FormData,CombinedStream);FormData.LINE_BREAK="\r\n";FormData.prototype.append=function(field,value,options){options=options||{};var append=CombinedStream.prototype.append.bind(this);if(typeof value=="number")value=""+value;var header=this._multiPartHeader(field,value,options);var footer=this._multiPartFooter(field,value,options);append(header);append(value);append(footer);this._trackLength(header,value,options)};FormData.prototype._trackLength=function(header,value,options){var valueLength=0;if(options.knownLength!=null){valueLength+=+options.knownLength}else if(Buffer.isBuffer(value)){valueLength=value.length}else if(typeof value==="string"){valueLength=Buffer.byteLength(value)}this._valueLength+=valueLength;this._overheadLength+=Buffer.byteLength(header)+ +FormData.LINE_BREAK.length;if(!value||!value.path&&!(value.readable&&value.hasOwnProperty("httpVersion"))){return}this._lengthRetrievers.push(function(next){if(options.knownLength!=null){next(null,0)}else if(value.hasOwnProperty("fd")){fs.stat(value.path,function(err,stat){if(err){next(err);return}next(null,stat.size)})}else if(value.hasOwnProperty("httpVersion")){next(null,+value.headers["content-length"])}else if(value.hasOwnProperty("httpModule")){value.on("response",function(response){value.pause();next(null,+response.headers["content-length"])});value.resume()}else{next("Unknown stream")}})};FormData.prototype._multiPartHeader=function(field,value,options){var boundary=this.getBoundary();var header="";if(options.header!=null){header=options.header}else{header+="--"+boundary+FormData.LINE_BREAK+'Content-Disposition: form-data; name="'+field+'"';if(options.filename||value.path){header+='; filename="'+path.basename(options.filename||value.path)+'"'+FormData.LINE_BREAK+"Content-Type: "+(options.contentType||mime.lookup(options.filename||value.path))}else if(value.readable&&value.hasOwnProperty("httpVersion")){header+='; filename="'+path.basename(value.client._httpMessage.path)+'"'+FormData.LINE_BREAK+"Content-Type: "+value.headers["content-type"]}header+=FormData.LINE_BREAK+FormData.LINE_BREAK}return header};FormData.prototype._multiPartFooter=function(field,value,options){return function(next){var footer=FormData.LINE_BREAK;var lastPart=this._streams.length===0;if(lastPart){footer+=this._lastBoundary()}next(footer)}.bind(this)};FormData.prototype._lastBoundary=function(){return"--"+this.getBoundary()+"--"};FormData.prototype.getHeaders=function(userHeaders){var formHeaders={"content-type":"multipart/form-data; boundary="+this.getBoundary()};for(var header in userHeaders){formHeaders[header.toLowerCase()]=userHeaders[header]}return formHeaders};FormData.prototype.getCustomHeaders=function(contentType){contentType=contentType?contentType:"multipart/form-data";var formHeaders={"content-type":contentType+"; boundary="+this.getBoundary(),"content-length":this.getLengthSync()};return formHeaders};FormData.prototype.getBoundary=function(){if(!this._boundary){this._generateBoundary()}return this._boundary};FormData.prototype._generateBoundary=function(){var boundary="--------------------------";for(var i=0;i<24;i++){boundary+=Math.floor(Math.random()*10).toString(16)}this._boundary=boundary};FormData.prototype.getLengthSync=function(){var knownLength=this._overheadLength+this._valueLength;if(this._streams.length){knownLength+=this._lastBoundary().length}return knownLength};FormData.prototype.getLength=function(cb){var knownLength=this._overheadLength+this._valueLength;if(this._streams.length){knownLength+=this._lastBoundary().length}if(!this._lengthRetrievers.length){process.nextTick(cb.bind(this,null,knownLength));return}async.parallel(this._lengthRetrievers,function(err,values){if(err){cb(err);return}values.forEach(function(length){knownLength+=length});cb(null,knownLength)})};FormData.prototype.submit=function(params,cb){this.getLength(function(err,length){var request,options,defaults={method:"post",port:80,headers:this.getHeaders({"Content-Length":length})};if(typeof params=="string"){params=parseUrl(params);options=populate({port:params.port,path:params.pathname,host:params.hostname},defaults)}else{options=populate(params,defaults)}if(params.protocol=="https:"){if(!params.port)options.port=443;request=https.request(options)}else{request=http.request(options)}this.pipe(request);if(cb){request.on("error",cb);request.on("response",cb.bind(this,null))}return request}.bind(this))};function populate(dst,src){for(var prop in src){if(!dst[prop])dst[prop]=src[prop]}return dst}},{__browserify_Buffer:19,__browserify_process:20,async:2,"combined-stream":50,fs:3,http:13,https:17,mime:89,path:24,url:37,util:39}],50:[function(require,module,exports){var Buffer=require("__browserify_Buffer");var util=require("util");var Stream=require("stream").Stream;var DelayedStream=require("delayed-stream");module.exports=CombinedStream;function CombinedStream(){this.writable=false;this.readable=true;this.dataSize=0;this.maxDataSize=2*1024*1024;this.pauseStreams=true;this._released=false;this._streams=[];this._currentStream=null}util.inherits(CombinedStream,Stream);CombinedStream.create=function(options){var combinedStream=new this;options=options||{};for(var option in options){combinedStream[option]=options[option]}return combinedStream};CombinedStream.isStreamLike=function(stream){return typeof stream!=="function"&&typeof stream!=="string"&&typeof stream!=="boolean"&&typeof stream!=="number"&&!Buffer.isBuffer(stream)};CombinedStream.prototype.append=function(stream){var isStreamLike=CombinedStream.isStreamLike(stream);if(isStreamLike){if(!(stream instanceof DelayedStream)){stream.on("data",this._checkDataSize.bind(this));stream=DelayedStream.create(stream,{maxDataSize:Infinity,pauseStream:this.pauseStreams})}this._handleErrors(stream);if(this.pauseStreams){stream.pause()}}this._streams.push(stream);return this};CombinedStream.prototype.pipe=function(dest,options){Stream.prototype.pipe.call(this,dest,options);this.resume()};CombinedStream.prototype._getNext=function(){this._currentStream=null;var stream=this._streams.shift();if(typeof stream=="undefined"){this.end();return}if(typeof stream!=="function"){this._pipeNext(stream);return}var getStream=stream;getStream(function(stream){var isStreamLike=CombinedStream.isStreamLike(stream);if(isStreamLike){stream.on("data",this._checkDataSize.bind(this));this._handleErrors(stream)}this._pipeNext(stream)}.bind(this))};CombinedStream.prototype._pipeNext=function(stream){this._currentStream=stream;var isStreamLike=CombinedStream.isStreamLike(stream);if(isStreamLike){stream.on("end",this._getNext.bind(this));stream.pipe(this,{end:false});return}var value=stream;this.write(value);this._getNext()};CombinedStream.prototype._handleErrors=function(stream){var self=this;stream.on("error",function(err){self._emitError(err)})};CombinedStream.prototype.write=function(data){this.emit("data",data)};CombinedStream.prototype.pause=function(){if(!this.pauseStreams){return}this.emit("pause")};CombinedStream.prototype.resume=function(){if(!this._released){this._released=true;this.writable=true;this._getNext()}this.emit("resume")};CombinedStream.prototype.end=function(){this._reset();this.emit("end")};CombinedStream.prototype.destroy=function(){this._reset();this.emit("close")};CombinedStream.prototype._reset=function(){this.writable=false;this._streams=[];this._currentStream=null};CombinedStream.prototype._checkDataSize=function(){this._updateDataSize();if(this.dataSize<=this.maxDataSize){return}var message="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(message))};CombinedStream.prototype._updateDataSize=function(){this.dataSize=0;var self=this;this._streams.forEach(function(stream){if(!stream.dataSize){return}self.dataSize+=stream.dataSize});if(this._currentStream&&this._currentStream.dataSize){this.dataSize+=this._currentStream.dataSize}};CombinedStream.prototype._emitError=function(err){this._reset();this.emit("error",err)}},{__browserify_Buffer:19,"delayed-stream":51,stream:30,util:39}],51:[function(require,module,exports){var Stream=require("stream").Stream;var util=require("util");module.exports=DelayedStream;function DelayedStream(){this.source=null;this.dataSize=0;this.maxDataSize=1024*1024;this.pauseStream=true;this._maxDataSizeExceeded=false;this._released=false;this._bufferedEvents=[]}util.inherits(DelayedStream,Stream);DelayedStream.create=function(source,options){var delayedStream=new this;options=options||{};for(var option in options){delayedStream[option]=options[option]}delayedStream.source=source;var realEmit=source.emit;source.emit=function(){delayedStream._handleEmit(arguments);return realEmit.apply(source,arguments)};source.on("error",function(){});if(delayedStream.pauseStream){source.pause()}return delayedStream};DelayedStream.prototype.__defineGetter__("readable",function(){return this.source.readable});DelayedStream.prototype.resume=function(){if(!this._released){this.release()}this.source.resume()};DelayedStream.prototype.pause=function(){this.source.pause()};DelayedStream.prototype.release=function(){this._released=true;this._bufferedEvents.forEach(function(args){this.emit.apply(this,args)}.bind(this));this._bufferedEvents=[]};DelayedStream.prototype.pipe=function(){var r=Stream.prototype.pipe.apply(this,arguments);this.resume();return r};DelayedStream.prototype._handleEmit=function(args){if(this._released){this.emit.apply(this,args);return}if(args[0]==="data"){this.dataSize+=args[1].length;this._checkIfMaxDataSizeExceeded()}this._bufferedEvents.push(args)};DelayedStream.prototype._checkIfMaxDataSizeExceeded=function(){if(this._maxDataSizeExceeded){return}if(this.dataSize<=this.maxDataSize){return}this._maxDataSizeExceeded=true;var message="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this.emit("error",new Error(message))}},{stream:30,util:39}],52:[function(require,module,exports){module.exports=require("./lib")
},{"./lib":55}],53:[function(require,module,exports){var Url=require("url");var Hoek=require("hoek");var Cryptiles=require("cryptiles");var Crypto=require("./crypto");var Utils=require("./utils");var internals={};exports.header=function(uri,method,options){var result={field:"",artifacts:{}};if(!uri||typeof uri!=="string"&&typeof uri!=="object"||!method||typeof method!=="string"||!options||typeof options!=="object"){return result}var timestamp=options.timestamp||Math.floor((Utils.now()+(options.localtimeOffsetMsec||0))/1e3);var credentials=options.credentials;if(!credentials||!credentials.id||!credentials.key||!credentials.algorithm){return result}if(Crypto.algorithms.indexOf(credentials.algorithm)===-1){return result}if(typeof uri==="string"){uri=Url.parse(uri)}var artifacts={ts:timestamp,nonce:options.nonce||Cryptiles.randomString(6),method:method,resource:uri.pathname+(uri.search||""),host:uri.hostname,port:uri.port||(uri.protocol==="http:"?80:443),hash:options.hash,ext:options.ext,app:options.app,dlg:options.dlg};result.artifacts=artifacts;if(!artifacts.hash&&options.hasOwnProperty("payload")){artifacts.hash=Crypto.calculatePayloadHash(options.payload,credentials.algorithm,options.contentType)}var mac=Crypto.calculateMac("header",credentials,artifacts);var hasExt=artifacts.ext!==null&&artifacts.ext!==undefined&&artifacts.ext!=="";var header='Hawk id="'+credentials.id+'", ts="'+artifacts.ts+'", nonce="'+artifacts.nonce+(artifacts.hash?'", hash="'+artifacts.hash:"")+(hasExt?'", ext="'+Utils.escapeHeaderAttribute(artifacts.ext):"")+'", mac="'+mac+'"';if(artifacts.app){header+=', app="'+artifacts.app+(artifacts.dlg?'", dlg="'+artifacts.dlg:"")+'"'}result.field=header;return result};exports.authenticate=function(res,credentials,artifacts,options){artifacts=Hoek.clone(artifacts);options=options||{};if(res.headers["www-authenticate"]){var attributes=Utils.parseAuthorizationHeader(res.headers["www-authenticate"],["ts","tsm","error"]);if(attributes instanceof Error){return false}if(attributes.ts){var tsm=Crypto.calculateTsMac(attributes.ts,credentials);if(tsm!==attributes.tsm){return false}}}if(!res.headers["server-authorization"]&&!options.required){return true}var attributes=Utils.parseAuthorizationHeader(res.headers["server-authorization"],["mac","ext","hash"]);if(attributes instanceof Error){return false}artifacts.ext=attributes.ext;artifacts.hash=attributes.hash;var mac=Crypto.calculateMac("response",credentials,artifacts);if(mac!==attributes.mac){return false}if(!options.hasOwnProperty("payload")){return true}if(!attributes.hash){return false}var calculatedHash=Crypto.calculatePayloadHash(options.payload,credentials.algorithm,res.headers["content-type"]);return calculatedHash===attributes.hash};exports.getBewit=function(uri,options){if(!uri||typeof uri!=="string"&&typeof uri!=="object"||!options||typeof options!=="object"||!options.ttlSec){return""}options.ext=options.ext===null||options.ext===undefined?"":options.ext;var now=Utils.now()+(options.localtimeOffsetMsec||0);var credentials=options.credentials;if(!credentials||!credentials.id||!credentials.key||!credentials.algorithm){return""}if(Crypto.algorithms.indexOf(credentials.algorithm)===-1){return""}if(typeof uri==="string"){uri=Url.parse(uri)}var exp=Math.floor(now/1e3)+options.ttlSec;var mac=Crypto.calculateMac("bewit",credentials,{ts:exp,nonce:"",method:"GET",resource:uri.pathname+(uri.search||""),host:uri.hostname,port:uri.port||(uri.protocol==="http:"?80:443),ext:options.ext});var bewit=credentials.id+"\\"+exp+"\\"+mac+"\\"+options.ext;return Utils.base64urlEncode(bewit)}},{"./crypto":54,"./utils":57,cryptiles:63,hoek:65,url:37}],54:[function(require,module,exports){var Crypto=require("crypto");var Url=require("url");var Utils=require("./utils");var internals={};exports.headerVersion="1";exports.algorithms=["sha1","sha256"];exports.calculateMac=function(type,credentials,options){var normalized=exports.generateNormalizedString(type,options);var hmac=Crypto.createHmac(credentials.algorithm,credentials.key).update(normalized);var digest=hmac.digest("base64");return digest};exports.generateNormalizedString=function(type,options){var normalized="hawk."+exports.headerVersion+"."+type+"\n"+options.ts+"\n"+options.nonce+"\n"+options.method.toUpperCase()+"\n"+options.resource+"\n"+options.host.toLowerCase()+"\n"+options.port+"\n"+(options.hash||"")+"\n";if(options.ext){normalized+=options.ext.replace("\\","\\\\").replace("\n","\\n")}normalized+="\n";if(options.app){normalized+=options.app+"\n"+(options.dlg||"")+"\n"}return normalized};exports.calculatePayloadHash=function(payload,algorithm,contentType){var hash=exports.initializePayloadHash(algorithm,contentType);hash.update(payload||"");return exports.finalizePayloadHash(hash)};exports.initializePayloadHash=function(algorithm,contentType){var hash=Crypto.createHash(algorithm);hash.update("hawk."+exports.headerVersion+".payload\n");hash.update(Utils.parseContentType(contentType)+"\n");return hash};exports.finalizePayloadHash=function(hash){hash.update("\n");return hash.digest("base64")};exports.calculateTsMac=function(ts,credentials){var hmac=Crypto.createHmac(credentials.algorithm,credentials.key);hmac.update("hawk."+exports.headerVersion+".ts\n"+ts+"\n");return hmac.digest("base64")}},{"./utils":57,crypto:7,url:37}],55:[function(require,module,exports){exports.error=exports.Error=require("boom");exports.sntp=require("sntp");exports.server=require("./server");exports.client=require("./client");exports.crypto=require("./crypto");exports.utils=require("./utils");exports.uri={authenticate:exports.server.authenticateBewit,getBewit:exports.client.getBewit}},{"./client":53,"./crypto":54,"./server":56,"./utils":57,boom:58,sntp:68}],56:[function(require,module,exports){var Boom=require("boom");var Hoek=require("hoek");var Cryptiles=require("cryptiles");var Crypto=require("./crypto");var Utils=require("./utils");var internals={};exports.authenticate=function(req,credentialsFunc,options,callback){callback=Utils.nextTick(callback);options.nonceFunc=options.nonceFunc||function(nonce,ts,nonceCallback){return nonceCallback()};options.timestampSkewSec=options.timestampSkewSec||60;var now=Utils.now()+(options.localtimeOffsetMsec||0);var request=Utils.parseRequest(req,options);if(request instanceof Error){return callback(Boom.badRequest(request.message))}var attributes=Utils.parseAuthorizationHeader(request.authorization);if(attributes instanceof Error){return callback(attributes)}var artifacts={method:request.method,host:request.host,port:request.port,resource:request.url,ts:attributes.ts,nonce:attributes.nonce,hash:attributes.hash,ext:attributes.ext,app:attributes.app,dlg:attributes.dlg,mac:attributes.mac,id:attributes.id};if(!attributes.id||!attributes.ts||!attributes.nonce||!attributes.mac){return callback(Boom.badRequest("Missing attributes"),null,artifacts)}credentialsFunc(attributes.id,function(err,credentials){if(err){return callback(err,credentials||null,artifacts)}if(!credentials){return callback(Boom.unauthorized("Unknown credentials","Hawk"),null,artifacts)}if(!credentials.key||!credentials.algorithm){return callback(Boom.internal("Invalid credentials"),credentials,artifacts)}if(Crypto.algorithms.indexOf(credentials.algorithm)===-1){return callback(Boom.internal("Unknown algorithm"),credentials,artifacts)}var mac=Crypto.calculateMac("header",credentials,artifacts);if(!Cryptiles.fixedTimeComparison(mac,attributes.mac)){return callback(Boom.unauthorized("Bad mac","Hawk"),credentials,artifacts)}if(options.payload!==null&&options.payload!==undefined){if(!attributes.hash){return callback(Boom.unauthorized("Missing required payload hash","Hawk"),credentials,artifacts)}var hash=Crypto.calculatePayloadHash(options.payload,credentials.algorithm,request.contentType);if(!Cryptiles.fixedTimeComparison(hash,attributes.hash)){return callback(Boom.unauthorized("Bad payload hash","Hawk"),credentials,artifacts)}}options.nonceFunc(attributes.nonce,attributes.ts,function(err){if(err){return callback(Boom.unauthorized("Invalid nonce","Hawk"),credentials,artifacts)}if(Math.abs(attributes.ts*1e3-now)>options.timestampSkewSec*1e3){var fresh=Math.floor((Utils.now()+(options.localtimeOffsetMsec||0))/1e3);var tsm=Crypto.calculateTsMac(fresh,credentials);return callback(Boom.unauthorized("Stale timestamp","Hawk",{ts:fresh,tsm:tsm}),credentials,artifacts)}return callback(null,credentials,artifacts)})})};exports.authenticatePayload=function(payload,credentials,artifacts,contentType){var calculatedHash=Crypto.calculatePayloadHash(payload,credentials.algorithm,contentType);return Cryptiles.fixedTimeComparison(calculatedHash,artifacts.hash)};exports.header=function(credentials,artifacts,options){options=options||{};if(!artifacts||typeof artifacts!=="object"||typeof options!=="object"){return""}artifacts=Hoek.clone(artifacts);delete artifacts.mac;artifacts.hash=options.hash;artifacts.ext=options.ext;if(!credentials||!credentials.key||!credentials.algorithm){return""}if(Crypto.algorithms.indexOf(credentials.algorithm)===-1){return""}if(!artifacts.hash&&options.hasOwnProperty("payload")){artifacts.hash=Crypto.calculatePayloadHash(options.payload,credentials.algorithm,options.contentType)}var mac=Crypto.calculateMac("response",credentials,artifacts);var header='Hawk mac="'+mac+'"'+(artifacts.hash?', hash="'+artifacts.hash+'"':"");if(artifacts.ext!==null&&artifacts.ext!==undefined&&artifacts.ext!==""){header+=', ext="'+Utils.escapeHeaderAttribute(artifacts.ext)+'"'}return header};exports.authenticateBewit=function(req,credentialsFunc,options,callback){callback=Utils.nextTick(callback);var now=Utils.now()+(options.localtimeOffsetMsec||0);var request=Utils.parseRequest(req,options);if(request instanceof Error){return callback(Boom.badRequest(request.message))}var resource=request.url.match(/^(\/.*)([\?&])bewit\=([^&$]*)(?:&(.+))?$/);if(!resource){return callback(Boom.unauthorized(null,"Hawk"))}if(!resource[3]){return callback(Boom.unauthorized("Empty bewit","Hawk"))}if(request.method!=="GET"&&request.method!=="HEAD"){return callback(Boom.unauthorized("Invalid method","Hawk"))}if(request.authorization){return callback(Boom.badRequest("Multiple authentications","Hawk"))}var bewitString=Utils.base64urlDecode(resource[3]);if(bewitString instanceof Error){return callback(Boom.badRequest("Invalid bewit encoding"))}var bewitParts=bewitString.split("\\");if(!bewitParts||bewitParts.length!==4){return callback(Boom.badRequest("Invalid bewit structure"))}var bewit={id:bewitParts[0],exp:parseInt(bewitParts[1],10),mac:bewitParts[2],ext:bewitParts[3]||""};if(!bewit.id||!bewit.exp||!bewit.mac){return callback(Boom.badRequest("Missing bewit attributes"))}var url=resource[1];if(resource[4]){url+=resource[2]+resource[4]}if(bewit.exp*1e3<=now){return callback(Boom.unauthorized("Access expired","Hawk"),null,bewit)}credentialsFunc(bewit.id,function(err,credentials){if(err){return callback(err,credentials||null,bewit.ext)}if(!credentials){return callback(Boom.unauthorized("Unknown credentials","Hawk"),null,bewit)}if(!credentials.key||!credentials.algorithm){return callback(Boom.internal("Invalid credentials"),credentials,bewit)}if(Crypto.algorithms.indexOf(credentials.algorithm)===-1){return callback(Boom.internal("Unknown algorithm"),credentials,bewit)}var mac=Crypto.calculateMac("bewit",credentials,{ts:bewit.exp,nonce:"",method:"GET",resource:url,host:request.host,port:request.port,ext:bewit.ext});if(!Cryptiles.fixedTimeComparison(mac,bewit.mac)){return callback(Boom.unauthorized("Bad mac","Hawk"),credentials,bewit)}return callback(null,credentials,bewit)})}},{"./crypto":54,"./utils":57,boom:58,cryptiles:63,hoek:65}],57:[function(require,module,exports){var __dirname="/node_modules/jsonld/node_modules/request/node_modules/hawk/lib";var Hoek=require("hoek");var Sntp=require("sntp");var Boom=require("boom");var internals={};internals.import=function(){for(var i in Hoek){if(Hoek.hasOwnProperty(i)){exports[i]=Hoek[i]}}};internals.import();exports.version=function(){return exports.loadPackage(__dirname+"/..").version};exports.parseHost=function(req,hostHeaderName){hostHeaderName=hostHeaderName?hostHeaderName.toLowerCase():"host";var hostHeader=req.headers[hostHeaderName];if(!hostHeader){return null}var hostHeaderRegex=/^(?:(?:\r\n)?[\t ])*([^:]+)(?::(\d+))?(?:(?:\r\n)?[\t ])*$/;var hostParts=hostHeader.match(hostHeaderRegex);if(!hostParts||hostParts.length!==3||!hostParts[1]){return null}return{name:hostParts[1],port:hostParts[2]?hostParts[2]:req.connection&&req.connection.encrypted?443:80}};exports.parseContentType=function(header){if(!header){return""}return header.split(";")[0].trim().toLowerCase()};exports.parseRequest=function(req,options){if(!req.headers){return req}var host=exports.parseHost(req,options.hostHeaderName);if(!host){return new Error("Invalid Host header")}var request={method:req.method,url:req.url,host:host.name,port:host.port,authorization:req.headers.authorization,contentType:req.headers["content-type"]||""};return request};exports.now=function(){return Sntp.now()};exports.parseAuthorizationHeader=function(header,keys){keys=keys||["id","ts","nonce","hash","ext","mac","app","dlg"];if(!header){return Boom.unauthorized(null,"Hawk")}var headerParts=header.match(/^(\w+)(?:\s+(.*))?$/);if(!headerParts){return Boom.badRequest("Invalid header syntax")}var scheme=headerParts[1];if(scheme.toLowerCase()!=="hawk"){return Boom.unauthorized(null,"Hawk")}var attributesString=headerParts[2];if(!attributesString){return Boom.badRequest("Invalid header syntax")}var attributes={};var errorMessage="";var verify=attributesString.replace(/(\w+)="([^"\\]*)"\s*(?:,\s*|$)/g,function($0,$1,$2){if(keys.indexOf($1)===-1){errorMessage="Unknown attribute: "+$1;return}if($2.match(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~]+$/)===null){errorMessage="Bad attribute value: "+$1;return}if(attributes.hasOwnProperty($1)){errorMessage="Duplicate attribute: "+$1;return}attributes[$1]=$2;return""});if(verify!==""){return Boom.badRequest(errorMessage||"Bad header format")}return attributes};exports.unauthorized=function(message){return Boom.unauthorized(message,"Hawk")}},{boom:58,hoek:65,sntp:68}],58:[function(require,module,exports){arguments[4][52][0].apply(exports,arguments)},{"./lib":59}],59:[function(require,module,exports){var Http=require("http");var NodeUtil=require("util");var Hoek=require("hoek");var internals={};exports=module.exports=internals.Boom=function(){var self=this;Hoek.assert(this.constructor===internals.Boom,"Error must be instantiated using new");Error.call(this);this.isBoom=true;this.response={code:0,payload:{},headers:{}};if(arguments[0]instanceof Error){var error=arguments[0];this.data=error;this.response.code=error.code||500;if(error.message){this.message=error.message}}else{var code=arguments[0];var message=arguments[1];Hoek.assert(!isNaN(parseFloat(code))&&isFinite(code)&&code>=400,"First argument must be a number (400+)");this.response.code=code;if(message){this.message=message}}this.reformat();return this};NodeUtil.inherits(internals.Boom,Error);internals.Boom.prototype.reformat=function(){this.response.payload.code=this.response.code;this.response.payload.error=Http.STATUS_CODES[this.response.code]||"Unknown";if(this.message){this.response.payload.message=Hoek.escapeHtml(this.message)}};internals.Boom.badRequest=function(message){return new internals.Boom(400,message)};internals.Boom.unauthorized=function(message,scheme,attributes){var err=new internals.Boom(401,message);if(!scheme){return err}var wwwAuthenticate="";if(typeof scheme==="string"){wwwAuthenticate=scheme;if(attributes){var names=Object.keys(attributes);for(var i=0,il=names.length;i<il;++i){if(i){wwwAuthenticate+=","}var value=attributes[names[i]];if(value===null||value===undefined){value=""}wwwAuthenticate+=" "+names[i]+'="'+Hoek.escapeHeaderAttribute(value.toString())+'"'}}if(message){if(attributes){wwwAuthenticate+=","}wwwAuthenticate+=' error="'+Hoek.escapeHeaderAttribute(message)+'"'}else{err.isMissing=true}}else{var wwwArray=scheme;for(var i=0,il=wwwArray.length;i<il;++i){if(i){wwwAuthenticate+=", "}wwwAuthenticate+=wwwArray[i]}}err.response.headers["WWW-Authenticate"]=wwwAuthenticate;return err};internals.Boom.clientTimeout=function(message){return new internals.Boom(408,message)};internals.Boom.serverTimeout=function(message){return new internals.Boom(503,message)};internals.Boom.forbidden=function(message){return new internals.Boom(403,message)};internals.Boom.notFound=function(message){return new internals.Boom(404,message)};internals.Boom.internal=function(message,data){var err=new internals.Boom(500,message);if(data&&data.stack){err.trace=data.stack.split("\n");err.outterTrace=Hoek.displayStack(1)}else{err.trace=Hoek.displayStack(1)}err.data=data;err.response.payload.message="An internal server error occurred";return err};internals.Boom.passThrough=function(code,payload,contentType,headers){var err=new internals.Boom(500,"Pass-through");err.data={code:code,payload:payload,type:contentType};err.response.code=code;err.response.type=contentType;err.response.headers=headers;err.response.payload=payload;return err}},{hoek:60,http:13,util:39}],60:[function(require,module,exports){arguments[4][52][0].apply(exports,arguments)},{"./lib":62}],61:[function(require,module,exports){var Buffer=require("__browserify_Buffer");var internals={};exports.escapeJavaScript=function(input){if(!input){return""}var escaped="";for(var i=0,il=input.length;i<il;++i){var charCode=input.charCodeAt(i);if(internals.isSafe(charCode)){escaped+=input[i]}else{escaped+=internals.escapeJavaScriptChar(charCode)}}return escaped};exports.escapeHtml=function(input){if(!input){return""}var escaped="";for(var i=0,il=input.length;i<il;++i){var charCode=input.charCodeAt(i);if(internals.isSafe(charCode)){escaped+=input[i]}else{escaped+=internals.escapeHtmlChar(charCode)}}return escaped};internals.escapeJavaScriptChar=function(charCode){if(charCode>=256){return"\\u"+internals.padLeft(""+charCode,4)}var hexValue=new Buffer(String.fromCharCode(charCode),"ascii").toString("hex");return"\\x"+internals.padLeft(hexValue,2)};internals.escapeHtmlChar=function(charCode){var namedEscape=internals.namedHtml[charCode];if(typeof namedEscape!=="undefined"){return namedEscape}if(charCode>=256){return"&#"+charCode+";"}var hexValue=new Buffer(String.fromCharCode(charCode),"ascii").toString("hex");return"&#x"+internals.padLeft(hexValue,2)+";"};internals.padLeft=function(str,len){while(str.length<len){str="0"+str}return str};internals.isSafe=function(charCode){return typeof internals.safeCharCodes[charCode]!=="undefined"};internals.namedHtml={38:"&amp;",60:"&lt;",62:"&gt;",34:"&quot;",160:"&nbsp;",162:"&cent;",163:"&pound;",164:"&curren;",169:"&copy;",174:"&reg;"};internals.safeCharCodes=function(){var safe={};for(var i=32;i<123;++i){if(i>=97&&i<=122||i>=65&&i<=90||i>=48&&i<=57||i===32||i===46||i===44||i===45||i===58||i===95){safe[i]=null}}return safe}()},{__browserify_Buffer:19}],62:[function(require,module,exports){var process=require("__browserify_process"),Buffer=require("__browserify_Buffer");var Fs=require("fs");var Escape=require("./escape");var internals={};exports.clone=function(obj,seen){if(typeof obj!=="object"||obj===null){return obj}seen=seen||{orig:[],copy:[]};var lookup=seen.orig.indexOf(obj);if(lookup!==-1){return seen.copy[lookup]}var newObj=obj instanceof Array?[]:{};seen.orig.push(obj);seen.copy.push(newObj);for(var i in obj){if(obj.hasOwnProperty(i)){if(obj[i]instanceof Buffer){newObj[i]=new Buffer(obj[i])}else if(obj[i]instanceof Date){newObj[i]=new Date(obj[i].getTime())}else if(obj[i]instanceof RegExp){var flags=""+(obj[i].global?"g":"")+(obj[i].ignoreCase?"i":"")+(obj[i].multiline?"m":"");newObj[i]=new RegExp(obj[i].source,flags)}else{newObj[i]=exports.clone(obj[i],seen)}}}return newObj};exports.merge=function(target,source,isNullOverride,isMergeArrays){exports.assert(target&&typeof target=="object","Invalid target value: must be an object");exports.assert(source===null||source===undefined||typeof source==="object","Invalid source value: must be null, undefined, or an object");if(!source){return target}if(source instanceof Array){exports.assert(target instanceof Array,"Cannot merge array onto an object");if(isMergeArrays===false){target.length=0}for(var i=0,il=source.length;i<il;++i){target.push(source[i])}return target}var keys=Object.keys(source);for(var k=0,kl=keys.length;k<kl;++k){var key=keys[k];var value=source[key];if(value&&typeof value==="object"){if(!target[key]||typeof target[key]!=="object"){target[key]=exports.clone(value)}else{exports.merge(target[key],source[key],isNullOverride,isMergeArrays)}}else{if(value!==null&&value!==undefined){target[key]=value}else if(isNullOverride!==false){target[key]=value}}}return target};exports.applyToDefaults=function(defaults,options){exports.assert(defaults&&typeof defaults=="object","Invalid defaults value: must be an object");exports.assert(!options||options===true||typeof options==="object","Invalid options value: must be true, falsy or an object");if(!options){return null}var copy=exports.clone(defaults);if(options===true){return copy}return exports.merge(copy,options,false,false)};exports.unique=function(array,key){var index={};var result=[];for(var i=0,il=array.length;i<il;++i){var id=key?array[i][key]:array[i];if(index[id]!==true){result.push(array[i]);index[id]=true}}return result};exports.mapToObject=function(array,key){if(!array){return null}var obj={};for(var i=0,il=array.length;i<il;++i){if(key){if(array[i][key]){obj[array[i][key]]=true}}else{obj[array[i]]=true}}return obj};exports.intersect=function(array1,array2,justFirst){if(!array1||!array2){return[]}var common=[];var hash=array1 instanceof Array?exports.mapToObject(array1):array1;var found={};for(var i=0,il=array2.length;i<il;++i){if(hash[array2[i]]&&!found[array2[i]]){if(justFirst){return array2[i]}common.push(array2[i]);found[array2[i]]=true}}return justFirst?null:common};exports.matchKeys=function(obj,keys){var matched=[];for(var i=0,il=keys.length;i<il;++i){if(obj.hasOwnProperty(keys[i])){matched.push(keys[i])}}return matched};exports.flatten=function(array,target){var result=target||[];for(var i=0,il=array.length;i<il;++i){if(Array.isArray(array[i])){exports.flatten(array[i],result)}else{result.push(array[i])}}return result};exports.removeKeys=function(object,keys){for(var i=0,il=keys.length;i<il;i++){delete object[keys[i]]}};exports.reach=function(obj,chain){var path=chain.split(".");var ref=obj;for(var i=0,il=path.length;i<il;++i){if(ref){ref=ref[path[i]]}}return ref};exports.inheritAsync=function(self,obj,keys){keys=keys||null;for(var i in obj){if(obj.hasOwnProperty(i)){if(keys instanceof Array&&keys.indexOf(i)<0){continue}self.prototype[i]=function(fn){return function(next){var result=null;try{result=fn()}catch(err){return next(err)}return next(null,result)}}(obj[i])}}};exports.formatStack=function(stack){var trace=[];for(var i=0,il=stack.length;i<il;++i){var item=stack[i];trace.push([item.getFileName(),item.getLineNumber(),item.getColumnNumber(),item.getFunctionName(),item.isConstructor()])}return trace};exports.formatTrace=function(trace){var display=[];for(var i=0,il=trace.length;i<il;++i){var row=trace[i];display.push((row[4]?"new ":"")+row[3]+" ("+row[0]+":"+row[1]+":"+row[2]+")")}return display};exports.callStack=function(slice){var v8=Error.prepareStackTrace;Error.prepareStackTrace=function(err,stack){return stack};var capture={};Error.captureStackTrace(capture,arguments.callee);var stack=capture.stack;Error.prepareStackTrace=v8;var trace=exports.formatStack(stack);if(slice){return trace.slice(slice)}return trace};exports.displayStack=function(slice){var trace=exports.callStack(slice===undefined?1:slice+1);return exports.formatTrace(trace)};exports.abortThrow=false;exports.abort=function(message,hideStack){if(process.env.NODE_ENV==="test"||exports.abortThrow===true){throw new Error(message||"Unknown error")}var stack="";if(!hideStack){stack=exports.displayStack(1).join("\n	")}console.log("ABORT: "+message+"\n	"+stack);process.exit(1)};exports.assert=function(condition){if(condition){return}var msgs=Array.prototype.slice.call(arguments,1);msgs=msgs.map(function(msg){return typeof msg==="string"?msg:msg instanceof Error?msg.message:JSON.stringify(msg)});throw new Error(msgs.join(" ")||"Unknown error")};exports.loadDirModules=function(path,excludeFiles,target){var exclude={};for(var i=0,il=excludeFiles.length;i<il;++i){exclude[excludeFiles[i]+".js"]=true}var files=Fs.readdirSync(path);for(i=0,il=files.length;i<il;++i){var filename=files[i];if(/\.js$/.test(filename)&&!exclude[filename]){var name=filename.substr(0,filename.lastIndexOf("."));var capName=name.charAt(0).toUpperCase()+name.substr(1).toLowerCase();if(typeof target!=="function"){target[capName]=require(path+"/"+name)}else{target(path+"/"+name,name,capName)}}}};exports.rename=function(obj,from,to){obj[to]=obj[from];delete obj[from]};exports.Timer=function(){this.reset()};exports.Timer.prototype.reset=function(){this.ts=Date.now()};exports.Timer.prototype.elapsed=function(){return Date.now()-this.ts};exports.loadPackage=function(dir){var result={};var filepath=(dir||process.env.PWD)+"/package.json";if(Fs.existsSync(filepath)){try{result=JSON.parse(Fs.readFileSync(filepath))}catch(e){}}return result};exports.escapeRegex=function(string){return string.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")};exports.toss=function(condition){var message=arguments.length===3?arguments[1]:"";var next=arguments.length===3?arguments[2]:arguments[1];var err=message instanceof Error?message:message?new Error(message):condition instanceof Error?condition:new Error;if(condition instanceof Error||!condition){return next(err)}};exports.base64urlEncode=function(value){return new Buffer(value,"binary").toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")};exports.base64urlDecode=function(encoded){if(encoded&&!encoded.match(/^[\w\-]*$/)){return new Error("Invalid character")}try{return new Buffer(encoded.replace(/-/g,"+").replace(/:/g,"/"),"base64").toString("binary")}catch(err){return err}};exports.escapeHeaderAttribute=function(attribute){exports.assert(attribute.match(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~\"\\]*$/),"Bad attribute value ("+attribute+")");return attribute.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')};exports.escapeHtml=function(string){return Escape.escapeHtml(string)};exports.escapeJavaScript=function(string){return Escape.escapeJavaScript(string)};exports.consoleFunc=console.log;exports.printEvent=function(event){var pad=function(value){return(value<10?"0":"")+value};var now=new Date(event.timestamp);var timestring=(now.getYear()-100).toString()+pad(now.getMonth()+1)+pad(now.getDate())+"/"+pad(now.getHours())+pad(now.getMinutes())+pad(now.getSeconds())+"."+now.getMilliseconds();var data=event.data;if(typeof event.data!=="string"){try{data=JSON.stringify(event.data)}catch(e){data="JSON Error: "+e.message}}var output=timestring+", "+event.tags[0]+", "+data;exports.consoleFunc(output)};exports.nextTick=function(callback){return function(){var args=arguments;process.nextTick(function(){callback.apply(null,args)})}}},{"./escape":61,__browserify_Buffer:19,__browserify_process:20,fs:3}],63:[function(require,module,exports){arguments[4][52][0].apply(exports,arguments)},{"./lib":64}],64:[function(require,module,exports){var Crypto=require("crypto");var Boom=require("boom");var internals={};exports.randomString=function(size){var buffer=exports.randomBits((size+1)*6);if(buffer instanceof Error){return buffer}var string=buffer.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"");return string.slice(0,size)};exports.randomBits=function(bits){if(!bits||bits<0){return Boom.internal("Invalid random bits count")}var bytes=Math.ceil(bits/8);try{return Crypto.randomBytes(bytes)}catch(err){return Boom.internal("Failed generating random bits: "+err.message)}};exports.fixedTimeComparison=function(a,b){if(typeof a!=="string"||typeof b!=="string"){return false}var mismatch=a.length===b.length?0:1;if(mismatch){b=a}for(var i=0,il=a.length;i<il;++i){var ac=a.charCodeAt(i);var bc=b.charCodeAt(i);mismatch+=ac===bc?0:1}return mismatch===0}},{boom:58,crypto:7}],65:[function(require,module,exports){arguments[4][52][0].apply(exports,arguments)},{"./lib":67}],66:[function(require,module,exports){var Buffer=require("__browserify_Buffer");var internals={};exports.escapeJavaScript=function(input){if(!input){return""}var escaped="";for(var i=0,il=input.length;i<il;++i){var charCode=input.charCodeAt(i);if(internals.isSafe(charCode)){escaped+=input[i]}else{escaped+=internals.escapeJavaScriptChar(charCode)}}return escaped};exports.escapeHtml=function(input){if(!input){return""}var escaped="";for(var i=0,il=input.length;i<il;++i){var charCode=input.charCodeAt(i);if(internals.isSafe(charCode)){escaped+=input[i]}else{escaped+=internals.escapeHtmlChar(charCode)}}return escaped};internals.escapeJavaScriptChar=function(charCode){if(charCode>=256){return"\\u"+internals.padLeft(""+charCode,4)}var hexValue=new Buffer(String.fromCharCode(charCode),"ascii").toString("hex");return"\\x"+internals.padLeft(hexValue,2)};internals.escapeHtmlChar=function(charCode){var namedEscape=internals.namedHtml[charCode];if(typeof namedEscape!=="undefined"){return namedEscape}if(charCode>=256){return"&#"+charCode+";"}var hexValue=new Buffer(String.fromCharCode(charCode),"ascii").toString("hex");return"&#x"+internals.padLeft(hexValue,2)+";"};internals.padLeft=function(str,len){while(str.length<len){str="0"+str}return str};internals.isSafe=function(charCode){return typeof internals.safeCharCodes[charCode]!=="undefined"};internals.namedHtml={38:"&amp;",60:"&lt;",62:"&gt;",34:"&quot;",160:"&nbsp;",162:"&cent;",163:"&pound;",164:"&curren;",169:"&copy;",174:"&reg;"};internals.safeCharCodes=function(){var safe={};for(var i=32;i<123;++i){if(i>=97&&i<=122||i>=65&&i<=90||i>=48&&i<=57||i===32||i===46||i===44||i===45||i===58||i===95){safe[i]=null}}return safe}()},{__browserify_Buffer:19}],67:[function(require,module,exports){var process=require("__browserify_process"),Buffer=require("__browserify_Buffer");var Fs=require("fs");var Escape=require("./escape");var internals={};exports.clone=function(obj,seen){if(typeof obj!=="object"||obj===null){return obj}seen=seen||{orig:[],copy:[]};var lookup=seen.orig.indexOf(obj);if(lookup!==-1){return seen.copy[lookup]}var newObj=obj instanceof Array?[]:{};seen.orig.push(obj);seen.copy.push(newObj);for(var i in obj){if(obj.hasOwnProperty(i)){if(obj[i]instanceof Buffer){newObj[i]=new Buffer(obj[i])}else if(obj[i]instanceof Date){newObj[i]=new Date(obj[i].getTime())}else if(obj[i]instanceof RegExp){var flags=""+(obj[i].global?"g":"")+(obj[i].ignoreCase?"i":"")+(obj[i].multiline?"m":"");newObj[i]=new RegExp(obj[i].source,flags)}else{newObj[i]=exports.clone(obj[i],seen)}}}return newObj};exports.merge=function(target,source,isNullOverride,isMergeArrays){exports.assert(target&&typeof target=="object","Invalid target value: must be an object");exports.assert(source===null||source===undefined||typeof source==="object","Invalid source value: must be null, undefined, or an object");if(!source){return target}if(source instanceof Array){exports.assert(target instanceof Array,"Cannot merge array onto an object");if(isMergeArrays===false){target.length=0}source.forEach(function(item){target.push(item)});return target}Object.keys(source).forEach(function(key){var value=source[key];if(value&&typeof value==="object"){if(!target[key]||typeof target[key]!=="object"){target[key]=exports.clone(value)}else{exports.merge(target[key],source[key],isNullOverride,isMergeArrays)}}else{if(value!==null&&value!==undefined){target[key]=value}else if(isNullOverride!==false){target[key]=value}}});return target};exports.applyToDefaults=function(defaults,options){exports.assert(defaults&&typeof defaults=="object","Invalid defaults value: must be an object");
exports.assert(!options||options===true||typeof options==="object","Invalid options value: must be true, falsy or an object");if(!options){return null}var copy=exports.clone(defaults);if(options===true){return copy}return exports.merge(copy,options,false,false)};exports.unique=function(array,key){var index={};var result=[];for(var i=0,il=array.length;i<il;++i){var id=key?array[i][key]:array[i];if(index[id]!==true){result.push(array[i]);index[id]=true}}return result};exports.mapToObject=function(array,key){if(!array){return null}var obj={};for(var i=0,il=array.length;i<il;++i){if(key){if(array[i][key]){obj[array[i][key]]=true}}else{obj[array[i]]=true}}return obj};exports.intersect=function(array1,array2){if(!array1||!array2){return[]}var common=[];var hash=array1 instanceof Array?exports.mapToObject(array1):array1;var found={};for(var i=0,il=array2.length;i<il;++i){if(hash[array2[i]]&&!found[array2[i]]){common.push(array2[i]);found[array2[i]]=true}}return common};exports.matchKeys=function(obj,keys){var matched=[];for(var i=0,il=keys.length;i<il;++i){if(obj.hasOwnProperty(keys[i])){matched.push(keys[i])}}return matched};exports.flatten=function(array,target){var result=target||[];for(var i=0,il=array.length;i<il;++i){if(Array.isArray(array[i])){exports.flatten(array[i],result)}else{result.push(array[i])}}return result};exports.removeKeys=function(object,keys){for(var i=0,il=keys.length;i<il;i++){delete object[keys[i]]}};exports.reach=function(obj,chain){var path=chain.split(".");var ref=obj;path.forEach(function(level){if(ref){ref=ref[level]}});return ref};exports.inheritAsync=function(self,obj,keys){keys=keys||null;for(var i in obj){if(obj.hasOwnProperty(i)){if(keys instanceof Array&&keys.indexOf(i)<0){continue}self.prototype[i]=function(fn){return function(next){var result=null;try{result=fn()}catch(err){return next(err)}return next(null,result)}}(obj[i])}}};exports.formatStack=function(stack){var trace=[];stack.forEach(function(item){trace.push([item.getFileName(),item.getLineNumber(),item.getColumnNumber(),item.getFunctionName(),item.isConstructor()])});return trace};exports.formatTrace=function(trace){var display=[];trace.forEach(function(row){display.push((row[4]?"new ":"")+row[3]+" ("+row[0]+":"+row[1]+":"+row[2]+")")});return display};exports.callStack=function(slice){var v8=Error.prepareStackTrace;Error.prepareStackTrace=function(err,stack){return stack};var capture={};Error.captureStackTrace(capture,arguments.callee);var stack=capture.stack;Error.prepareStackTrace=v8;var trace=exports.formatStack(stack);if(slice){return trace.slice(slice)}return trace};exports.displayStack=function(slice){var trace=exports.callStack(slice===undefined?1:slice+1);return exports.formatTrace(trace)};exports.abortThrow=false;exports.abort=function(message,hideStack){if(process.env.NODE_ENV==="test"||exports.abortThrow===true){throw new Error(message||"Unknown error")}var stack="";if(!hideStack){stack=exports.displayStack(1).join("\n	")}console.log("ABORT: "+message+"\n	"+stack);process.exit(1)};exports.assert=function(condition){if(condition){return}var msgs=Array.prototype.slice.call(arguments,1);msgs=msgs.map(function(msg){return typeof msg==="string"?msg:msg instanceof Error?msg.message:JSON.stringify(msg)});throw new Error(msgs.join(" ")||"Unknown error")};exports.loadDirModules=function(path,excludeFiles,target){var exclude={};for(var i=0,il=excludeFiles.length;i<il;++i){exclude[excludeFiles[i]+".js"]=true}Fs.readdirSync(path).forEach(function(filename){if(/\.js$/.test(filename)&&!exclude[filename]){var name=filename.substr(0,filename.lastIndexOf("."));var capName=name.charAt(0).toUpperCase()+name.substr(1).toLowerCase();if(typeof target!=="function"){target[capName]=require(path+"/"+name)}else{target(path+"/"+name,name,capName)}}})};exports.rename=function(obj,from,to){obj[to]=obj[from];delete obj[from]};exports.Timer=function(){this.reset()};exports.Timer.prototype.reset=function(){this.ts=Date.now()};exports.Timer.prototype.elapsed=function(){return Date.now()-this.ts};exports.loadPackage=function(dir){var result={};var filepath=(dir||process.env.PWD)+"/package.json";if(Fs.existsSync(filepath)){try{result=JSON.parse(Fs.readFileSync(filepath))}catch(e){}}return result};exports.escapeRegex=function(string){return string.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")};exports.toss=function(condition){var message=arguments.length===3?arguments[1]:"";var next=arguments.length===3?arguments[2]:arguments[1];var err=message instanceof Error?message:message?new Error(message):condition instanceof Error?condition:new Error;if(condition instanceof Error||!condition){return next(err)}};exports.base64urlEncode=function(value){return new Buffer(value,"binary").toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")};exports.base64urlDecode=function(encoded){if(encoded&&!encoded.match(/^[\w\-]*$/)){return new Error("Invalid character")}try{return new Buffer(encoded.replace(/-/g,"+").replace(/:/g,"/"),"base64").toString("binary")}catch(err){return err}};exports.escapeHeaderAttribute=function(attribute){exports.assert(attribute.match(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~\"\\]*$/),"Bad attribute value ("+attribute+")");return attribute.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')};exports.escapeHtml=function(string){return Escape.escapeHtml(string)};exports.escapeJavaScript=function(string){return Escape.escapeJavaScript(string)};exports.consoleFunc=console.log;exports.printEvent=function(event){var pad=function(value){return(value<10?"0":"")+value};var now=new Date(event.timestamp);var timestring=(now.getYear()-100).toString()+pad(now.getMonth()+1)+pad(now.getDate())+"/"+pad(now.getHours())+pad(now.getMinutes())+pad(now.getSeconds())+"."+now.getMilliseconds();var data=event.data;if(typeof event.data!=="string"){try{data=JSON.stringify(event.data)}catch(e){data="JSON Error: "+e.message}}var output=timestring+", "+event.tags[0]+", "+data;exports.consoleFunc(output)};exports.nextTick=function(callback){return function(){var args=arguments;process.nextTick(function(){callback.apply(null,args)})}}},{"./escape":66,__browserify_Buffer:19,__browserify_process:20,fs:3}],68:[function(require,module,exports){arguments[4][52][0].apply(exports,arguments)},{"./lib":69}],69:[function(require,module,exports){var process=require("__browserify_process"),Buffer=require("__browserify_Buffer");var Dgram=require("dgram");var Dns=require("dns");var Hoek=require("hoek");var internals={};exports.time=function(options,callback){if(arguments.length!==2){callback=arguments[0];options={}}var settings=Hoek.clone(options);settings.host=settings.host||"pool.ntp.org";settings.port=settings.port||123;settings.resolveReference=settings.resolveReference||false;var timeoutId=0;var sent=0;var isFinished=false;var finish=function(err,result){if(timeoutId){clearTimeout(timeoutId);timeoutId=0}if(!isFinished){isFinished=true;socket.removeAllListeners();socket.close();return callback(err,result)}};var socket=Dgram.createSocket("udp4");socket.once("error",function(err){return finish(err)});socket.on("message",function(buffer,rinfo){var received=Date.now();var message=new internals.NtpMessage(buffer);if(!message.isValid){return finish(new Error("Invalid server response"),message)}if(message.originateTimestamp!==sent){return finish(new Error("Wrong originate timestamp"),message)}var T1=message.originateTimestamp;var T2=message.receiveTimestamp;var T3=message.transmitTimestamp;var T4=received;message.d=T4-T1-(T3-T2);message.t=(T2-T1+(T3-T4))/2;message.receivedLocally=received;if(!settings.resolveReference||message.stratum!=="secondary"){return finish(null,message)}Dns.reverse(message.referenceId,function(err,domains){if(!err){message.referenceHost=domains[0]}return finish(null,message)})});if(settings.timeout){timeoutId=setTimeout(function(){timeoutId=0;return finish(new Error("Timeout"))},settings.timeout)}var message=new Buffer(48);for(var i=0;i<48;i++){message[i]=0}message[0]=(0<<6)+(4<<3)+(3<<0);sent=Date.now();internals.fromMsecs(sent,message,40);socket.send(message,0,message.length,settings.port,settings.host,function(err,bytes){if(err||bytes!==48){return finish(err||new Error("Could not send entire message"))}})};internals.NtpMessage=function(buffer){this.isValid=false;if(buffer.length!==48){return}var li=buffer[0]>>6;switch(li){case 0:this.leapIndicator="no-warning";break;case 1:this.leapIndicator="last-minute-61";break;case 2:this.leapIndicator="last-minute-59";break;case 3:this.leapIndicator="alarm";break}var vn=(buffer[0]&56)>>3;this.version=vn;var mode=buffer[0]&7;switch(mode){case 1:this.mode="symmetric-active";break;case 2:this.mode="symmetric-passive";break;case 3:this.mode="client";break;case 4:this.mode="server";break;case 5:this.mode="broadcast";break;case 0:case 6:case 7:this.mode="reserved";break}var stratum=buffer[1];if(stratum===0){this.stratum="death"}else if(stratum===1){this.stratum="primary"}else if(stratum<=15){this.stratum="secondary"}else{this.stratum="reserved"}this.pollInterval=Math.round(Math.pow(2,buffer[2]))*1e3;this.precision=Math.pow(2,buffer[3])*1e3;var rootDelay=256*(256*(256*buffer[4]+buffer[5])+buffer[6])+buffer[7];this.rootDelay=1e3*(rootDelay/65536);this.rootDispersion=((buffer[8]<<8)+buffer[9]+((buffer[10]<<8)+buffer[11])/Math.pow(2,16))*1e3;this.referenceId="";switch(this.stratum){case"death":case"primary":this.referenceId=String.fromCharCode(buffer[12])+String.fromCharCode(buffer[13])+String.fromCharCode(buffer[14])+String.fromCharCode(buffer[15]);break;case"secondary":this.referenceId=""+buffer[12]+"."+buffer[13]+"."+buffer[14]+"."+buffer[15];break}this.referenceTimestamp=internals.toMsecs(buffer,16);this.originateTimestamp=internals.toMsecs(buffer,24);this.receiveTimestamp=internals.toMsecs(buffer,32);this.transmitTimestamp=internals.toMsecs(buffer,40);if(this.version===4&&this.stratum!=="reserved"&&this.mode==="server"&&this.originateTimestamp&&this.receiveTimestamp&&this.transmitTimestamp){this.isValid=true}return this};internals.toMsecs=function(buffer,offset){var seconds=0;var fraction=0;for(var i=0;i<4;++i){seconds=seconds*256+buffer[offset+i]}for(i=4;i<8;++i){fraction=fraction*256+buffer[offset+i]}return(seconds-2208988800+fraction/Math.pow(2,32))*1e3};internals.fromMsecs=function(ts,buffer,offset){var seconds=Math.floor(ts/1e3)+2208988800;var fraction=Math.round(ts%1e3/1e3*Math.pow(2,32));buffer[offset+0]=(seconds&4278190080)>>24;buffer[offset+1]=(seconds&16711680)>>16;buffer[offset+2]=(seconds&65280)>>8;buffer[offset+3]=seconds&255;buffer[offset+4]=(fraction&4278190080)>>24;buffer[offset+5]=(fraction&16711680)>>16;buffer[offset+6]=(fraction&65280)>>8;buffer[offset+7]=fraction&255};internals.last={offset:0,expires:0,host:"",port:0};exports.offset=function(options,callback){if(arguments.length!==2){callback=arguments[0];options={}}var now=Date.now();var clockSyncRefresh=options.clockSyncRefresh||24*60*60*1e3;if(internals.last.offset&&internals.last.host===options.host&&internals.last.port===options.port&&now<internals.last.expires){process.nextTick(function(){callback(null,internals.last.offset)});return}exports.time(options,function(err,time){if(err){return callback(err,0)}internals.last={offset:Math.round(time.t),expires:now+clockSyncRefresh,host:options.host,port:options.port};return callback(null,internals.last.offset)})};internals.now={intervalId:0};exports.start=function(options,callback){if(arguments.length!==2){callback=arguments[0];options={}}if(internals.now.intervalId){process.nextTick(function(){callback()});return}exports.offset(options,function(err,offset){internals.now.intervalId=setInterval(function(){exports.offset(options,function(){})},options.clockSyncRefresh||24*60*60*1e3);return callback()})};exports.stop=function(){if(!internals.now.intervalId){return}clearInterval(internals.now.intervalId);internals.now.intervalId=0};exports.isLive=function(){return!!internals.now.intervalId};exports.now=function(){var now=Date.now();if(!exports.isLive()||now>=internals.last.expires){return now}return now+internals.last.offset}},{__browserify_Buffer:19,__browserify_process:20,dgram:3,dns:3,hoek:70}],70:[function(require,module,exports){arguments[4][52][0].apply(exports,arguments)},{"./lib":72}],71:[function(require,module,exports){module.exports=require(61)},{__browserify_Buffer:19}],72:[function(require,module,exports){module.exports=require(62)},{"./escape":71,__browserify_Buffer:19,__browserify_process:20,fs:3}],73:[function(require,module,exports){var parser=require("./parser");var signer=require("./signer");var verify=require("./verify");var util=require("./util");module.exports={parse:parser.parseRequest,parseRequest:parser.parseRequest,sign:signer.signRequest,signRequest:signer.signRequest,sshKeyToPEM:util.sshKeyToPEM,sshKeyFingerprint:util.fingerprint,verify:verify.verifySignature,verifySignature:verify.verifySignature}},{"./parser":74,"./signer":75,"./util":76,"./verify":77}],74:[function(require,module,exports){var assert=require("assert-plus");var util=require("util");var Algorithms={"rsa-sha1":true,"rsa-sha256":true,"rsa-sha512":true,"dsa-sha1":true,"hmac-sha1":true,"hmac-sha256":true,"hmac-sha512":true};var State={New:0,Params:1};var ParamsState={Name:0,Quote:1,Value:2,Comma:3};function HttpSignatureError(message,caller){if(Error.captureStackTrace)Error.captureStackTrace(this,caller||HttpSignatureError);this.message=message;this.name=caller.name}util.inherits(HttpSignatureError,Error);function ExpiredRequestError(message){HttpSignatureError.call(this,message,ExpiredRequestError)}util.inherits(ExpiredRequestError,HttpSignatureError);function InvalidHeaderError(message){HttpSignatureError.call(this,message,InvalidHeaderError)}util.inherits(InvalidHeaderError,HttpSignatureError);function InvalidParamsError(message){HttpSignatureError.call(this,message,InvalidParamsError)}util.inherits(InvalidParamsError,HttpSignatureError);function MissingHeaderError(message){HttpSignatureError.call(this,message,MissingHeaderError)}util.inherits(MissingHeaderError,HttpSignatureError);module.exports={parseRequest:function parseRequest(request,options){assert.object(request,"request");assert.object(request.headers,"request.headers");if(options===undefined){options={}}if(options.headers===undefined){options.headers=[request.headers["x-date"]?"x-date":"date"]}assert.object(options,"options");assert.arrayOfString(options.headers,"options.headers");assert.optionalNumber(options.clockSkew,"options.clockSkew");if(!request.headers.authorization)throw new MissingHeaderError("no authorization header present in "+"the request");options.clockSkew=options.clockSkew||300;var i=0;var state=State.New;var substate=ParamsState.Name;var tmpName="";var tmpValue="";var parsed={scheme:"",params:{},signingString:"",get algorithm(){return this.params.algorithm.toUpperCase()},get keyId(){return this.params.keyId}};var authz=request.headers.authorization;for(i=0;i<authz.length;i++){var c=authz.charAt(i);switch(Number(state)){case State.New:if(c!==" ")parsed.scheme+=c;else state=State.Params;break;case State.Params:switch(Number(substate)){case ParamsState.Name:var code=c.charCodeAt(0);if(code>=65&&code<=90||code>=97&&code<=122){tmpName+=c}else if(c==="="){if(tmpName.length===0)throw new InvalidHeaderError("bad param format");substate=ParamsState.Quote}else{throw new InvalidHeaderError("bad param format")}break;case ParamsState.Quote:if(c==='"'){tmpValue="";substate=ParamsState.Value}else{throw new InvalidHeaderError("bad param format")}break;case ParamsState.Value:if(c==='"'){parsed.params[tmpName]=tmpValue;substate=ParamsState.Comma}else{tmpValue+=c}break;case ParamsState.Comma:if(c===","){tmpName="";substate=ParamsState.Name}else{throw new InvalidHeaderError("bad param format")}break;default:throw new Error("Invalid substate")}break;default:throw new Error("Invalid substate")}}if(!parsed.params.headers||parsed.params.headers===""){if(request.headers["x-date"]){parsed.params.headers=["x-date"]}else{parsed.params.headers=["date"]}}else{parsed.params.headers=parsed.params.headers.split(" ")}if(!parsed.scheme||parsed.scheme!=="Signature")throw new InvalidHeaderError('scheme was not "Signature"');if(!parsed.params.keyId)throw new InvalidHeaderError("keyId was not specified");if(!parsed.params.algorithm)throw new InvalidHeaderError("algorithm was not specified");if(!parsed.params.signature)throw new InvalidHeaderError("signature was not specified");parsed.params.algorithm=parsed.params.algorithm.toLowerCase();if(!Algorithms[parsed.params.algorithm])throw new InvalidParamsError(parsed.params.algorithm+" is not supported");for(i=0;i<parsed.params.headers.length;i++){var h=parsed.params.headers[i].toLowerCase();parsed.params.headers[i]=h;if(h!=="request-line"){var value=request.headers[h];if(!value)throw new MissingHeaderError(h+" was not in the request");parsed.signingString+=h+": "+value}else{parsed.signingString+=request.method+" "+request.url+" HTTP/"+request.httpVersion}if(i+1<parsed.params.headers.length)parsed.signingString+="\n"}var date;if(request.headers.date||request.headers["x-date"]){if(request.headers["x-date"]){date=new Date(request.headers["x-date"])}else{date=new Date(request.headers.date)}var now=new Date;var skew=Math.abs(now.getTime()-date.getTime());if(skew>options.clockSkew*1e3){throw new ExpiredRequestError("clock skew of "+skew/1e3+"s was greater than "+options.clockSkew+"s")}}options.headers.forEach(function(hdr){if(parsed.params.headers.indexOf(hdr)<0)throw new MissingHeaderError(hdr+" was not a signed header")});if(options.algorithms){if(options.algorithms.indexOf(parsed.params.algorithm)===-1)throw new InvalidParamsError(parsed.params.algorithm+" is not a supported algorithm")}return parsed}}},{"assert-plus":84,util:39}],75:[function(require,module,exports){var assert=require("assert-plus");var crypto=require("crypto");var http=require("http");var sprintf=require("util").format;var Algorithms={"rsa-sha1":true,"rsa-sha256":true,"rsa-sha512":true,"dsa-sha1":true,"hmac-sha1":true,"hmac-sha256":true,"hmac-sha512":true};var Authorization='Signature keyId="%s",algorithm="%s",headers="%s",signature="%s"';function MissingHeaderError(message){this.name="MissingHeaderError";this.message=message;this.stack=(new Error).stack}MissingHeaderError.prototype=new Error;function InvalidAlgorithmError(message){this.name="InvalidAlgorithmError";this.message=message;this.stack=(new Error).stack}InvalidAlgorithmError.prototype=new Error;function _pad(val){if(parseInt(val,10)<10){val="0"+val}return val}function _rfc1123(){var date=new Date;var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return days[date.getUTCDay()]+", "+_pad(date.getUTCDate())+" "+months[date.getUTCMonth()]+" "+date.getUTCFullYear()+" "+_pad(date.getUTCHours())+":"+_pad(date.getUTCMinutes())+":"+_pad(date.getUTCSeconds())+" GMT"}module.exports={signRequest:function signRequest(request,options){assert.object(request,"request");assert.object(options,"options");assert.optionalString(options.algorithm,"options.algorithm");assert.string(options.keyId,"options.keyId");assert.optionalArrayOfString(options.headers,"options.headers");assert.optionalString(options.httpVersion,"options.httpVersion");if(!request.getHeader("Date"))request.setHeader("Date",_rfc1123());if(!options.headers)options.headers=["date"];if(!options.algorithm)options.algorithm="rsa-sha256";if(!options.httpVersion)options.httpVersion="1.1";options.algorithm=options.algorithm.toLowerCase();if(!Algorithms[options.algorithm])throw new InvalidAlgorithmError(options.algorithm+" is not supported");var i;var stringToSign="";for(i=0;i<options.headers.length;i++){if(typeof options.headers[i]!=="string")throw new TypeError("options.headers must be an array of Strings");var h=options.headers[i].toLowerCase();if(h!=="request-line"){var value=request.getHeader(h);if(!value){throw new MissingHeaderError(h+" was not in the request")}stringToSign+=h+": "+value}else{value=stringToSign+=request.method+" "+request.path+" HTTP/"+options.httpVersion}if(i+1<options.headers.length)stringToSign+="\n"}var alg=options.algorithm.match(/(hmac|rsa)-(\w+)/);var signature;if(alg[1]==="hmac"){var hmac=crypto.createHmac(alg[2].toUpperCase(),options.key);hmac.update(stringToSign);signature=hmac.digest("base64")}else{var signer=crypto.createSign(options.algorithm.toUpperCase());signer.update(stringToSign);signature=signer.sign(options.key,"base64")}request.setHeader("Authorization",sprintf(Authorization,options.keyId,options.algorithm,options.headers.join(" "),signature));return true}}},{"assert-plus":84,crypto:7,http:13,util:39}],76:[function(require,module,exports){var Buffer=require("__browserify_Buffer");var assert=require("assert-plus");var crypto=require("crypto");var asn1=require("asn1");var ctype=require("ctype");function readNext(buffer,offset){var len=ctype.ruint32(buffer,"big",offset);offset+=4;var newOffset=offset+len;return{data:buffer.slice(offset,newOffset),offset:newOffset}}function writeInt(writer,buffer){writer.writeByte(2);writer.writeLength(buffer.length);for(var i=0;i<buffer.length;i++)writer.writeByte(buffer[i]);return writer}function rsaToPEM(key){var buffer;var der;var exponent;var i;var modulus;var newKey="";var offset=0;var type;var tmp;try{buffer=new Buffer(key.split(" ")[1],"base64");tmp=readNext(buffer,offset);type=tmp.data.toString();offset=tmp.offset;if(type!=="ssh-rsa")throw new Error("Invalid ssh key type: "+type);tmp=readNext(buffer,offset);exponent=tmp.data;offset=tmp.offset;tmp=readNext(buffer,offset);modulus=tmp.data}catch(e){throw new Error("Invalid ssh key: "+key)}der=new asn1.BerWriter;der.startSequence();der.startSequence();der.writeOID("1.2.840.113549.1.1.1");der.writeNull();der.endSequence();der.startSequence(3);der.writeByte(0);der.startSequence();writeInt(der,modulus);writeInt(der,exponent);der.endSequence();der.endSequence();der.endSequence();tmp=der.buffer.toString("base64");for(i=0;i<tmp.length;i++){if(i%64===0)newKey+="\n";newKey+=tmp.charAt(i)}if(!/\\n$/.test(newKey))newKey+="\n";return"-----BEGIN PUBLIC KEY-----"+newKey+"-----END PUBLIC KEY-----\n"}function dsaToPEM(key){var buffer;var offset=0;var tmp;var der;var newKey="";var type;var p;var q;var g;var y;try{buffer=new Buffer(key.split(" ")[1],"base64");tmp=readNext(buffer,offset);type=tmp.data.toString();offset=tmp.offset;if(!/^ssh-ds[as].*/.test(type))throw new Error("Invalid ssh key type: "+type);tmp=readNext(buffer,offset);p=tmp.data;offset=tmp.offset;tmp=readNext(buffer,offset);q=tmp.data;offset=tmp.offset;tmp=readNext(buffer,offset);g=tmp.data;offset=tmp.offset;tmp=readNext(buffer,offset);y=tmp.data}catch(e){console.log(e.stack);throw new Error("Invalid ssh key: "+key)}der=new asn1.BerWriter;der.startSequence();der.startSequence();der.writeOID("1.2.840.10040.4.1");der.startSequence();writeInt(der,p);writeInt(der,q);writeInt(der,g);der.endSequence();der.endSequence();der.startSequence(3);der.writeByte(0);writeInt(der,y);der.endSequence();der.endSequence();tmp=der.buffer.toString("base64");for(var i=0;i<tmp.length;i++){if(i%64===0)newKey+="\n";newKey+=tmp.charAt(i)}if(!/\\n$/.test(newKey))newKey+="\n";return"-----BEGIN PUBLIC KEY-----"+newKey+"-----END PUBLIC KEY-----\n"}module.exports={sshKeyToPEM:function sshKeyToPEM(key){assert.string(key,"ssh_key");if(/^ssh-rsa.*/.test(key))return rsaToPEM(key);if(/^ssh-ds[as].*/.test(key))return dsaToPEM(key);throw new Error("Only RSA and DSA public keys are allowed")},fingerprint:function fingerprint(key){assert.string(key,"ssh_key");var pieces=key.split(" ");if(!pieces||!pieces.length||pieces.length<2)throw new Error("invalid ssh key");var data=new Buffer(pieces[1],"base64");var hash=crypto.createHash("md5");hash.update(data);var digest=hash.digest("hex");var fp="";for(var i=0;i<digest.length;i++){if(i&&i%2===0)fp+=":";fp+=digest[i]}return fp}}},{__browserify_Buffer:19,asn1:83,"assert-plus":84,crypto:7,ctype:87}],77:[function(require,module,exports){var assert=require("assert-plus");var crypto=require("crypto");module.exports={verifySignature:function verifySignature(parsedSignature,key){assert.object(parsedSignature,"parsedSignature");assert.string(key,"key");var alg=parsedSignature.algorithm.match(/(HMAC|RSA|DSA)-(\w+)/);if(!alg||alg.length!==3)throw new TypeError("parsedSignature: unsupported algorithm "+parsedSignature.algorithm);if(alg[1]==="HMAC"){var hmac=crypto.createHmac(alg[2].toUpperCase(),key);hmac.update(parsedSignature.signingString);return hmac.digest("base64")===parsedSignature.params.signature}else{var verify=crypto.createVerify(alg[0]);verify.update(parsedSignature.signingString);return verify.verify(key,parsedSignature.params.signature,"base64")}}}},{"assert-plus":84,crypto:7}],78:[function(require,module,exports){module.exports={newInvalidAsn1Error:function(msg){var e=new Error;e.name="InvalidAsn1Error";e.message=msg||"";return e}}},{}],79:[function(require,module,exports){var errors=require("./errors");var types=require("./types");var Reader=require("./reader");var Writer=require("./writer");module.exports={Reader:Reader,Writer:Writer};for(var t in types){if(types.hasOwnProperty(t))module.exports[t]=types[t]}for(var e in errors){if(errors.hasOwnProperty(e))module.exports[e]=errors[e]}},{"./errors":78,"./reader":80,"./types":81,"./writer":82}],80:[function(require,module,exports){var Buffer=require("__browserify_Buffer");var assert=require("assert");var ASN1=require("./types");var errors=require("./errors");var newInvalidAsn1Error=errors.newInvalidAsn1Error;function Reader(data){if(!data||!Buffer.isBuffer(data))throw new TypeError("data must be a node Buffer");this._buf=data;this._size=data.length;this._len=0;this._offset=0;var self=this;this.__defineGetter__("length",function(){return self._len});this.__defineGetter__("offset",function(){return self._offset});this.__defineGetter__("remain",function(){return self._size-self._offset});this.__defineGetter__("buffer",function(){return self._buf.slice(self._offset)})}Reader.prototype.readByte=function(peek){if(this._size-this._offset<1)return null;var b=this._buf[this._offset]&255;if(!peek)this._offset+=1;return b};Reader.prototype.peek=function(){return this.readByte(true)};Reader.prototype.readLength=function(offset){if(offset===undefined)offset=this._offset;if(offset>=this._size)return null;var lenB=this._buf[offset++]&255;if(lenB===null)return null;if((lenB&128)==128){lenB&=127;if(lenB==0)throw newInvalidAsn1Error("Indefinite length not supported");if(lenB>4)throw newInvalidAsn1Error("encoding too long");if(this._size-offset<lenB)return null;this._len=0;for(var i=0;i<lenB;i++)this._len=(this._len<<8)+(this._buf[offset++]&255)}else{this._len=lenB}return offset};Reader.prototype.readSequence=function(tag){var seq=this.peek();if(seq===null)return null;if(tag!==undefined&&tag!==seq)throw newInvalidAsn1Error("Expected 0x"+tag.toString(16)+": got 0x"+seq.toString(16));var o=this.readLength(this._offset+1);if(o===null)return null;this._offset=o;return seq};Reader.prototype.readInt=function(){return this._readTag(ASN1.Integer)};Reader.prototype.readBoolean=function(){return this._readTag(ASN1.Boolean)===0?false:true};Reader.prototype.readEnumeration=function(){return this._readTag(ASN1.Enumeration)};Reader.prototype.readString=function(tag,retbuf){if(!tag)tag=ASN1.OctetString;var b=this.peek();if(b===null)return null;if(b!==tag)throw newInvalidAsn1Error("Expected 0x"+tag.toString(16)+": got 0x"+b.toString(16));var o=this.readLength(this._offset+1);if(o===null)return null;if(this.length>this._size-o)return null;this._offset=o;if(this.length===0)return"";var str=this._buf.slice(this._offset,this._offset+this.length);this._offset+=this.length;return retbuf?str:str.toString("utf8")};Reader.prototype.readOID=function(tag){if(!tag)tag=ASN1.OID;var b=this.peek();if(b===null)return null;if(b!==tag)throw newInvalidAsn1Error("Expected 0x"+tag.toString(16)+": got 0x"+b.toString(16));var o=this.readLength(this._offset+1);if(o===null)return null;if(this.length>this._size-o)return null;this._offset=o;var values=[];var value=0;for(var i=0;i<this.length;i++){var byte=this._buf[this._offset++]&255;value<<=7;value+=byte&127;if((byte&128)==0){values.push(value);value=0}}value=values.shift();values.unshift(value%40);values.unshift(value/40>>0);return values.join(".")};Reader.prototype._readTag=function(tag){assert.ok(tag!==undefined);var b=this.peek();if(b===null)return null;if(b!==tag)throw newInvalidAsn1Error("Expected 0x"+tag.toString(16)+": got 0x"+b.toString(16));var o=this.readLength(this._offset+1);if(o===null)return null;if(this.length>4)throw newInvalidAsn1Error("Integer too long: "+this.length);if(this.length>this._size-o)return null;this._offset=o;var fb=this._buf[this._offset++];var value=0;value=fb&127;for(var i=1;i<this.length;i++){value<<=8;value|=this._buf[this._offset++]&255}if((fb&128)==128)value=-value;return value};module.exports=Reader},{"./errors":78,"./types":81,__browserify_Buffer:19,assert:4}],81:[function(require,module,exports){module.exports={EOC:0,Boolean:1,Integer:2,BitString:3,OctetString:4,Null:5,OID:6,ObjectDescriptor:7,External:8,Real:9,Enumeration:10,PDV:11,Utf8String:12,RelativeOID:13,Sequence:16,Set:17,NumericString:18,PrintableString:19,T61String:20,VideotexString:21,IA5String:22,UTCTime:23,GeneralizedTime:24,GraphicString:25,VisibleString:26,GeneralString:28,UniversalString:29,CharacterString:30,BMPString:31,Constructor:32,Context:128}},{}],82:[function(require,module,exports){var Buffer=require("__browserify_Buffer");var assert=require("assert");var ASN1=require("./types");var errors=require("./errors");var newInvalidAsn1Error=errors.newInvalidAsn1Error;var DEFAULT_OPTS={size:1024,growthFactor:8};function merge(from,to){assert.ok(from);assert.equal(typeof from,"object");assert.ok(to);assert.equal(typeof to,"object");var keys=Object.getOwnPropertyNames(from);keys.forEach(function(key){if(to[key])return;var value=Object.getOwnPropertyDescriptor(from,key);Object.defineProperty(to,key,value)});return to}function Writer(options){options=merge(DEFAULT_OPTS,options||{});this._buf=new Buffer(options.size||1024);this._size=this._buf.length;this._offset=0;this._options=options;this._seq=[];var self=this;this.__defineGetter__("buffer",function(){if(self._seq.length)throw new InvalidAsn1Error(self._seq.length+" unended sequence(s)");return self._buf.slice(0,self._offset)})}Writer.prototype.writeByte=function(b){if(typeof b!=="number")throw new TypeError("argument must be a Number");this._ensure(1);this._buf[this._offset++]=b};Writer.prototype.writeInt=function(i,tag){if(typeof i!=="number")throw new TypeError("argument must be a Number");if(typeof tag!=="number")tag=ASN1.Integer;var sz=4;while(((i&4286578688)===0||(i&4286578688)===4286578688)&&sz>1){sz--;i<<=8}if(sz>4)throw new InvalidAsn1Error("BER ints cannot be > 0xffffffff");this._ensure(2+sz);this._buf[this._offset++]=tag;this._buf[this._offset++]=sz;while(sz-->0){this._buf[this._offset++]=(i&4278190080)>>24;i<<=8}};Writer.prototype.writeNull=function(){this.writeByte(ASN1.Null);this.writeByte(0)};Writer.prototype.writeEnumeration=function(i,tag){if(typeof i!=="number")throw new TypeError("argument must be a Number");if(typeof tag!=="number")tag=ASN1.Enumeration;return this.writeInt(i,tag)};Writer.prototype.writeBoolean=function(b,tag){if(typeof b!=="boolean")throw new TypeError("argument must be a Boolean");if(typeof tag!=="number")tag=ASN1.Boolean;this._ensure(3);this._buf[this._offset++]=tag;this._buf[this._offset++]=1;this._buf[this._offset++]=b?255:0};Writer.prototype.writeString=function(s,tag){if(typeof s!=="string")throw new TypeError("argument must be a string (was: "+typeof s+")");if(typeof tag!=="number")tag=ASN1.OctetString;var len=Buffer.byteLength(s);this.writeByte(tag);this.writeLength(len);if(len){this._ensure(len);this._buf.write(s,this._offset);this._offset+=len}};Writer.prototype.writeBuffer=function(buf,tag){if(typeof tag!=="number")throw new TypeError("tag must be a number");
if(!Buffer.isBuffer(buf))throw new TypeError("argument must be a buffer");this.writeByte(tag);this.writeLength(buf.length);this._ensure(buf.length);buf.copy(this._buf,this._offset,0,buf.length);this._offset+=buf.length};Writer.prototype.writeStringArray=function(strings){if(!strings instanceof Array)throw new TypeError("argument must be an Array[String]");var self=this;strings.forEach(function(s){self.writeString(s)})};Writer.prototype.writeOID=function(s,tag){if(typeof s!=="string")throw new TypeError("argument must be a string");if(typeof tag!=="number")tag=ASN1.OID;if(!/^([0-9]+\.){3,}[0-9]+$/.test(s))throw new Error("argument is not a valid OID string");function encodeOctet(bytes,octet){if(octet<128){bytes.push(octet)}else if(octet<16384){bytes.push(octet>>>7|128);bytes.push(octet&127)}else if(octet<2097152){bytes.push(octet>>>14|128);bytes.push((octet>>>7|128)&255);bytes.push(octet&127)}else if(octet<268435456){bytes.push(octet>>>21|128);bytes.push((octet>>>14|128)&255);bytes.push((octet>>>7|128)&255);bytes.push(octet&127)}else{bytes.push((octet>>>28|128)&255);bytes.push((octet>>>21|128)&255);bytes.push((octet>>>14|128)&255);bytes.push((octet>>>7|128)&255);bytes.push(octet&127)}}var tmp=s.split(".");var bytes=[];bytes.push(parseInt(tmp[0],10)*40+parseInt(tmp[1],10));tmp.slice(2).forEach(function(b){encodeOctet(bytes,parseInt(b,10))});var self=this;this._ensure(2+bytes.length);this.writeByte(tag);this.writeLength(bytes.length);bytes.forEach(function(b){self.writeByte(b)})};Writer.prototype.writeLength=function(len){if(typeof len!=="number")throw new TypeError("argument must be a Number");this._ensure(4);if(len<=127){this._buf[this._offset++]=len}else if(len<=255){this._buf[this._offset++]=129;this._buf[this._offset++]=len}else if(len<=65535){this._buf[this._offset++]=130;this._buf[this._offset++]=len>>8;this._buf[this._offset++]=len}else if(len<=16777215){this._shift(start,len,1);this._buf[this._offset++]=131;this._buf[this._offset++]=len>>16;this._buf[this._offset++]=len>>8;this._buf[this._offset++]=len}else{throw new InvalidAsn1ERror("Length too long (> 4 bytes)")}};Writer.prototype.startSequence=function(tag){if(typeof tag!=="number")tag=ASN1.Sequence|ASN1.Constructor;this.writeByte(tag);this._seq.push(this._offset);this._ensure(3);this._offset+=3};Writer.prototype.endSequence=function(){var seq=this._seq.pop();var start=seq+3;var len=this._offset-start;if(len<=127){this._shift(start,len,-2);this._buf[seq]=len}else if(len<=255){this._shift(start,len,-1);this._buf[seq]=129;this._buf[seq+1]=len}else if(len<=65535){this._buf[seq]=130;this._buf[seq+1]=len>>8;this._buf[seq+2]=len}else if(len<=16777215){this._shift(start,len,1);this._buf[seq]=131;this._buf[seq+1]=len>>16;this._buf[seq+2]=len>>8;this._buf[seq+3]=len}else{throw new InvalidAsn1Error("Sequence too long")}};Writer.prototype._shift=function(start,len,shift){assert.ok(start!==undefined);assert.ok(len!==undefined);assert.ok(shift);this._buf.copy(this._buf,start+shift,start,start+len);this._offset+=shift};Writer.prototype._ensure=function(len){assert.ok(len);if(this._size-this._offset<len){var sz=this._size*this._options.growthFactor;if(sz-this._offset<len)sz+=len;var buf=new Buffer(sz);this._buf.copy(buf,0,0,this._offset);this._buf=buf;this._size=sz}};module.exports=Writer},{"./errors":78,"./types":81,__browserify_Buffer:19,assert:4}],83:[function(require,module,exports){var Ber=require("./ber/index");module.exports={Ber:Ber,BerReader:Ber.Reader,BerWriter:Ber.Writer}},{"./ber/index":79}],84:[function(require,module,exports){var process=require("__browserify_process"),Buffer=require("__browserify_Buffer");var assert=require("assert");var Stream=require("stream").Stream;var util=require("util");var NDEBUG=process.env.NODE_NDEBUG||false;var ARRAY_TYPE_REQUIRED="%s ([%s]) required";var TYPE_REQUIRED="%s (%s) is required";function capitalize(str){return str.charAt(0).toUpperCase()+str.slice(1)}function uncapitalize(str){return str.charAt(0).toLowerCase()+str.slice(1)}function _(){return util.format.apply(util,arguments)}function _assert(arg,type,name,stackFunc){if(!NDEBUG){name=name||type;stackFunc=stackFunc||_assert.caller;var t=typeof arg;if(t!==type){throw new assert.AssertionError({message:_(TYPE_REQUIRED,name,type),actual:t,expected:type,operator:"===",stackStartFunction:stackFunc})}}}function array(arr,type,name){if(!NDEBUG){name=name||type;if(!Array.isArray(arr)){throw new assert.AssertionError({message:_(ARRAY_TYPE_REQUIRED,name,type),actual:typeof arr,expected:"array",operator:"Array.isArray",stackStartFunction:array.caller})}for(var i=0;i<arr.length;i++){_assert(arr[i],type,name,array)}}}function bool(arg,name){_assert(arg,"boolean",name,bool)}function buffer(arg,name){if(!Buffer.isBuffer(arg)){throw new assert.AssertionError({message:_(TYPE_REQUIRED,name,type),actual:typeof arg,expected:"buffer",operator:"Buffer.isBuffer",stackStartFunction:buffer})}}function func(arg,name){_assert(arg,"function",name)}function number(arg,name){_assert(arg,"number",name)}function object(arg,name){_assert(arg,"object",name)}function stream(arg,name){if(!(arg instanceof Stream)){throw new assert.AssertionError({message:_(TYPE_REQUIRED,name,type),actual:typeof arg,expected:"Stream",operator:"instanceof",stackStartFunction:buffer})}}function string(arg,name){_assert(arg,"string",name)}module.exports={bool:bool,buffer:buffer,func:func,number:number,object:object,stream:stream,string:string};Object.keys(module.exports).forEach(function(k){if(k==="buffer")return;var name="arrayOf"+capitalize(k);if(k==="bool")k="boolean";if(k==="func")k="function";module.exports[name]=function(arg,name){array(arg,k,name)}});Object.keys(module.exports).forEach(function(k){var _name="optional"+capitalize(k);var s=uncapitalize(k.replace("arrayOf",""));if(s==="bool")s="boolean";if(s==="func")s="function";if(k.indexOf("arrayOf")!==-1){module.exports[_name]=function(arg,name){if(!NDEBUG&&arg!==undefined){array(arg,s,name)}}}else{module.exports[_name]=function(arg,name){if(!NDEBUG&&arg!==undefined){_assert(arg,s,name)}}}});Object.keys(assert).forEach(function(k){if(k==="AssertionError"){module.exports[k]=assert[k];return}module.exports[k]=function(){if(!NDEBUG){assert[k].apply(assert[k],arguments)}}})},{__browserify_Buffer:19,__browserify_process:20,assert:4,stream:30,util:39}],85:[function(require,module,exports){var mod_assert=require("assert");var ASSERT=mod_assert.ok;var ctf_versions=["1.0"];var ctf_entries=["integer","float","typedef","struct"];var ctf_deftypes=["int8_t","uint8_t","int16_t","uint16_t","int32_t","uint32_t","float","double"];function ctfParseInteger(entry,ctype){var name,sign,len,type;name=entry["name"];if(!("signed"in entry["integer"]))throw new Error("Malformed CTF JSON: integer missing "+"signed value");if(!("length"in entry["integer"]))throw new Error("Malformed CTF JSON: integer missing "+"length value");sign=entry["integer"]["signed"];len=entry["integer"]["length"];type=null;if(sign&&len==1)type="int8_t";else if(len==1)type="uint8_t";else if(sign&&len==2)type="int16_t";else if(len==2)type="uint16_t";else if(sign&&len==4)type="int32_t";else if(len==4)type="uint32_t";else if(sign&&len==8)type="int64_t";else if(len==8)type="uint64_t";if(type===null)throw new Error("Malformed CTF JSON: integer has "+"unsupported length and sign - "+len+"/"+sign);if(name==type)return;if(name=="char"){ASSERT(type=="int8_t");return}ctype.typedef(name,type)}function ctfParseFloat(entry,ctype){var name,len;name=entry["name"];if(!("length"in entry["float"]))throw new Error("Malformed CTF JSON: float missing "+"length value");len=entry["float"]["length"];if(len!=4&&len!=8)throw new Error("Malformed CTF JSON: float has invalid "+"length value");if(len==4){if(name=="float")return;ctype.typedef(name,"float")}else if(len==8){if(name=="double")return;ctype.typedef(name,"double")}}function ctfParseTypedef(entry,ctype){var name,type,ii;name=entry["name"];if(typeof entry["typedef"]!="string")throw new Error("Malformed CTF JSON: typedef value in not "+"a string");type=entry["typedef"];for(ii=0;ii<ctf_deftypes.length;ii++){if(name==ctf_deftypes[ii])return}ctype.typedef(name,type)}function ctfParseStruct(entry,ctype){var name,type,ii,val,index,member,push;member=[];if(!Array.isArray(entry["struct"]))throw new Error("Malformed CTF JSON: struct value is not "+"an array");for(ii=0;ii<entry["struct"].length;ii++){val=entry["struct"][ii];if(!("name"in val))throw new Error("Malformed CTF JSON: struct member "+"missing name");if(!("type"in val))throw new Error("Malformed CTF JSON: struct member "+"missing type");if(typeof val["name"]!="string")throw new Error("Malformed CTF JSON: struct member "+"name isn't a string");if(typeof val["type"]!="string")throw new Error("Malformed CTF JSON: struct member "+"type isn't a string");name=val["name"];type=val["type"];index=type.indexOf(" [");if(index!=-1){type=type.substring(0,index)+type.substring(index+1,type.length)}push={};push[name]={type:type};member.push(push)}name=entry["name"];ctype.typedef(name,member)}function ctfParseEntry(entry,ctype){var ii,found;if(!("name"in entry))throw new Error('Malformed CTF JSON: entry missing "name" '+"section");for(ii=0;ii<ctf_entries.length;ii++){if(ctf_entries[ii]in entry)found++}if(found===0)throw new Error("Malformed CTF JSON: found no entries");if(found>=2)throw new Error("Malformed CTF JSON: found more than one "+"entry");if("integer"in entry){ctfParseInteger(entry,ctype);return}if("float"in entry){ctfParseFloat(entry,ctype);return}if("typedef"in entry){ctfParseTypedef(entry,ctype);return}if("struct"in entry){ctfParseStruct(entry,ctype);return}ASSERT(false,"shouldn't reach here")}function ctfParseJson(json,ctype){var version,ii;ASSERT(json);ASSERT(ctype);if(!("metadata"in json))throw new Error("Invalid CTF JSON: missing metadata section");if(!("ctf2json_version"in json["metadata"]))throw new Error("Invalid CTF JSON: missing ctf2json_version");version=json["metadata"]["ctf2json_version"];for(ii=0;ii<ctf_versions.length;ii++){if(ctf_versions[ii]==version)break}if(ii==ctf_versions.length)throw new Error("Unsuported ctf2json_version: "+version);if(!("data"in json))throw new Error("Invalid CTF JSON: missing data section");if(!Array.isArray(json["data"]))throw new Error("Malformed CTF JSON: data section is not "+"an array");for(ii=0;ii<json["data"].length;ii++)ctfParseEntry(json["data"][ii],ctype)}exports.ctfParseJson=ctfParseJson},{assert:4}],86:[function(require,module,exports){var mod_assert=require("assert");function ruint8(buffer,endian,offset){if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset>=buffer.length)throw new Error("Trying to read beyond buffer length");return buffer[offset]}function rgint16(buffer,endian,offset){var val=0;if(endian=="big"){val=buffer[offset]<<8;val|=buffer[offset+1]}else{val=buffer[offset];val|=buffer[offset+1]<<8}return val}function ruint16(buffer,endian,offset){if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+1>=buffer.length)throw new Error("Trying to read beyond buffer length");return rgint16(buffer,endian,offset)}function rgint32(buffer,endian,offset){var val=0;if(endian=="big"){val=buffer[offset+1]<<16;val|=buffer[offset+2]<<8;val|=buffer[offset+3];val=val+(buffer[offset]<<24>>>0)}else{val=buffer[offset+2]<<16;val|=buffer[offset+1]<<8;val|=buffer[offset];val=val+(buffer[offset+3]<<24>>>0)}return val}function ruint32(buffer,endian,offset){if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+3>=buffer.length)throw new Error("Trying to read beyond buffer length");return rgint32(buffer,endian,offset)}function rgint64(buffer,endian,offset){var val=new Array(2);if(endian=="big"){val[0]=ruint32(buffer,endian,offset);val[1]=ruint32(buffer,endian,offset+4)}else{val[0]=ruint32(buffer,endian,offset+4);val[1]=ruint32(buffer,endian,offset)}return val}function ruint64(buffer,endian,offset){if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+7>=buffer.length)throw new Error("Trying to read beyond buffer length");return rgint64(buffer,endian,offset)}function rsint8(buffer,endian,offset){var neg;if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset>=buffer.length)throw new Error("Trying to read beyond buffer length");neg=buffer[offset]&128;if(!neg)return buffer[offset];return(255-buffer[offset]+1)*-1}function rsint16(buffer,endian,offset){var neg,val;if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+1>=buffer.length)throw new Error("Trying to read beyond buffer length");val=rgint16(buffer,endian,offset);neg=val&32768;if(!neg)return val;return(65535-val+1)*-1}function rsint32(buffer,endian,offset){var neg,val;if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+3>=buffer.length)throw new Error("Trying to read beyond buffer length");val=rgint32(buffer,endian,offset);neg=val&2147483648;if(!neg)return val;return(4294967295-val+1)*-1}function rsint64(buffer,endian,offset){var neg,val;if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+3>=buffer.length)throw new Error("Trying to read beyond buffer length");val=rgint64(buffer,endian,offset);neg=val[0]&2147483648;if(!neg)return val;val[0]=(4294967295-val[0])*-1;val[1]=(4294967295-val[1]+1)*-1;mod_assert.ok(val[1]<=4294967296);if(val[1]==-4294967296){val[1]=0;val[0]--}return val}function rfloat(buffer,endian,offset){var bytes=[];var sign,exponent,mantissa,val;var bias=127;var maxexp=255;if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+3>=buffer.length)throw new Error("Trying to read beyond buffer length");if(endian=="big"){bytes[0]=buffer[offset];bytes[1]=buffer[offset+1];bytes[2]=buffer[offset+2];bytes[3]=buffer[offset+3]}else{bytes[3]=buffer[offset];bytes[2]=buffer[offset+1];bytes[1]=buffer[offset+2];bytes[0]=buffer[offset+3]}sign=bytes[0]&128;exponent=(bytes[0]&127)<<1;exponent|=(bytes[1]&128)>>>7;mantissa=(bytes[1]&127)<<16;mantissa|=bytes[2]<<8;mantissa|=bytes[3];if(!sign&&exponent==maxexp&&mantissa===0)return Number.POSITIVE_INFINITY;if(sign&&exponent==maxexp&&mantissa===0)return Number.NEGATIVE_INFINITY;if(exponent==maxexp&&mantissa!==0)return Number.NaN;if(exponent===0&&mantissa===0)return 0;exponent-=bias;if(exponent==-bias){exponent++;val=0}else{val=1}val=(val+mantissa*Math.pow(2,-23))*Math.pow(2,exponent);if(sign)val*=-1;return val}function rdouble(buffer,endian,offset){var bytes=[];var sign,exponent,mantissa,val,lowmant;var bias=1023;var maxexp=2047;if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+7>=buffer.length)throw new Error("Trying to read beyond buffer length");if(endian=="big"){bytes[0]=buffer[offset];bytes[1]=buffer[offset+1];bytes[2]=buffer[offset+2];bytes[3]=buffer[offset+3];bytes[4]=buffer[offset+4];bytes[5]=buffer[offset+5];bytes[6]=buffer[offset+6];bytes[7]=buffer[offset+7]}else{bytes[7]=buffer[offset];bytes[6]=buffer[offset+1];bytes[5]=buffer[offset+2];bytes[4]=buffer[offset+3];bytes[3]=buffer[offset+4];bytes[2]=buffer[offset+5];bytes[1]=buffer[offset+6];bytes[0]=buffer[offset+7]}sign=bytes[0]&128;exponent=(bytes[0]&127)<<4;exponent|=(bytes[1]&240)>>>4;lowmant=bytes[7];lowmant|=bytes[6]<<8;lowmant|=bytes[5]<<16;mantissa=bytes[4];mantissa|=bytes[3]<<8;mantissa|=bytes[2]<<16;mantissa|=(bytes[1]&15)<<24;mantissa*=Math.pow(2,24);mantissa+=lowmant;if(!sign&&exponent==maxexp&&mantissa===0)return Number.POSITIVE_INFINITY;if(sign&&exponent==maxexp&&mantissa===0)return Number.NEGATIVE_INFINITY;if(exponent==maxexp&&mantissa!==0)return Number.NaN;if(exponent===0&&mantissa===0)return 0;exponent-=bias;if(exponent==-bias){exponent++;val=0}else{val=1}val=(val+mantissa*Math.pow(2,-52))*Math.pow(2,exponent);if(sign)val*=-1;return val}function prepuint(value,max){if(typeof value!="number")throw new(Error("cannot write a non-number as a number"));if(value<0)throw new Error("specified a negative value for writing an "+"unsigned value");if(value>max)throw new Error("value is larger than maximum value for "+"type");if(Math.floor(value)!==value)throw new Error("value has a fractional component");return value}function wuint8(value,endian,buffer,offset){var val;if(value===undefined)throw new Error("missing value");if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset>=buffer.length)throw new Error("Trying to read beyond buffer length");val=prepuint(value,255);buffer[offset]=val}function wgint16(val,endian,buffer,offset){if(endian=="big"){buffer[offset]=(val&65280)>>>8;buffer[offset+1]=val&255}else{buffer[offset+1]=(val&65280)>>>8;buffer[offset]=val&255}}function wuint16(value,endian,buffer,offset){var val;if(value===undefined)throw new Error("missing value");if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+1>=buffer.length)throw new Error("Trying to read beyond buffer length");val=prepuint(value,65535);wgint16(val,endian,buffer,offset)}function wgint32(val,endian,buffer,offset){if(endian=="big"){buffer[offset]=(val-(val&16777215))/Math.pow(2,24);buffer[offset+1]=val>>>16&255;buffer[offset+2]=val>>>8&255;buffer[offset+3]=val&255}else{buffer[offset+3]=(val-(val&16777215))/Math.pow(2,24);buffer[offset+2]=val>>>16&255;buffer[offset+1]=val>>>8&255;buffer[offset]=val&255}}function wuint32(value,endian,buffer,offset){var val;if(value===undefined)throw new Error("missing value");if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+3>=buffer.length)throw new Error("Trying to read beyond buffer length");val=prepuint(value,4294967295);wgint32(val,endian,buffer,offset)}function wgint64(value,endian,buffer,offset){if(endian=="big"){wgint32(value[0],endian,buffer,offset);wgint32(value[1],endian,buffer,offset+4)}else{wgint32(value[0],endian,buffer,offset+4);wgint32(value[1],endian,buffer,offset)}}function wuint64(value,endian,buffer,offset){if(value===undefined)throw new Error("missing value");if(!(value instanceof Array))throw new Error("value must be an array");if(value.length!=2)throw new Error("value must be an array of length 2");if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+7>=buffer.length)throw new Error("Trying to read beyond buffer length");prepuint(value[0],4294967295);prepuint(value[1],4294967295);wgint64(value,endian,buffer,offset)}function prepsint(value,max,min){if(typeof value!="number")throw new(Error("cannot write a non-number as a number"));if(value>max)throw new Error("value larger than maximum allowed value");if(value<min)throw new Error("value smaller than minimum allowed value");if(Math.floor(value)!==value)throw new Error("value has a fractional component");return value}function wsint8(value,endian,buffer,offset){var val;if(value===undefined)throw new Error("missing value");if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset>=buffer.length)throw new Error("Trying to read beyond buffer length");val=prepsint(value,127,-128);if(val>=0)wuint8(val,endian,buffer,offset);else wuint8(255+val+1,endian,buffer,offset)}function wsint16(value,endian,buffer,offset){var val;if(value===undefined)throw new Error("missing value");if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+1>=buffer.length)throw new Error("Trying to read beyond buffer length");val=prepsint(value,32767,-32768);if(val>=0)wgint16(val,endian,buffer,offset);else wgint16(65535+val+1,endian,buffer,offset)}function wsint32(value,endian,buffer,offset){var val;if(value===undefined)throw new Error("missing value");if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+3>=buffer.length)throw new Error("Trying to read beyond buffer length");val=prepsint(value,2147483647,-2147483648);if(val>=0)wgint32(val,endian,buffer,offset);else wgint32(4294967295+val+1,endian,buffer,offset)}function wsint64(value,endian,buffer,offset){var vzpos,vopos;var vals=new Array(2);if(value===undefined)throw new Error("missing value");if(!(value instanceof Array))throw new Error("value must be an array");if(value.length!=2)throw new Error("value must be an array of length 2");if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+7>=buffer.length)throw new Error("Trying to read beyond buffer length");vzpos=value[0]*Number.POSITIVE_INFINITY==Number.POSITIVE_INFINITY;vopos=value[1]*Number.POSITIVE_INFINITY==Number.POSITIVE_INFINITY;if(value[0]!=0&&value[1]!=0&&vzpos!=vopos)throw new Error("Both entries in the array must have "+"the same sign");if(vzpos){prepuint(value[0],2147483647);prepuint(value[1],4294967295)}else{prepsint(value[0],0,-2147483648);prepsint(value[1],0,-4294967295);if(value[0]==-2147483648&&value[1]!=0)throw new Error("value smaller than minimum "+"allowed value")}if(value[0]<0||value[1]<0){vals[0]=4294967295-Math.abs(value[0]);vals[1]=4294967296-Math.abs(value[1]);if(vals[1]==4294967296){vals[1]=0;vals[0]++}}else{vals[0]=value[0];vals[1]=value[1]}wgint64(vals,endian,buffer,offset)}function log2(value){return Math.log(value)/Math.log(2)}function intexp(value){return Math.floor(log2(value))}function fracexp(value){return Math.floor(log2(value))}function wfloat(value,endian,buffer,offset){var sign,exponent,mantissa,ebits;var bytes=[];if(value===undefined)throw new Error("missing value");if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+3>=buffer.length)throw new Error("Trying to read beyond buffer length");if(isNaN(value)){sign=0;exponent=255;mantissa=23}else if(value==Number.POSITIVE_INFINITY){sign=0;exponent=255;mantissa=0}else if(value==Number.NEGATIVE_INFINITY){sign=1;exponent=255;mantissa=0}else{if(value<0){sign=1;value=Math.abs(value)}else{sign=0}if(value<1)ebits=fracexp(value);else ebits=intexp(value);if(ebits<=-127){exponent=0;mantissa=value*Math.pow(2,149)&8388607}else{exponent=127+ebits;mantissa=value*Math.pow(2,23-ebits);mantissa&=8388607}}bytes[0]=sign<<7|(exponent&254)>>>1;bytes[1]=(exponent&1)<<7|(mantissa&8323072)>>>16;bytes[2]=(mantissa&65280)>>>8;bytes[3]=mantissa&255;if(endian=="big"){buffer[offset]=bytes[0];buffer[offset+1]=bytes[1];buffer[offset+2]=bytes[2];buffer[offset+3]=bytes[3]}else{buffer[offset]=bytes[3];buffer[offset+1]=bytes[2];buffer[offset+2]=bytes[1];buffer[offset+3]=bytes[0]}}function wdouble(value,endian,buffer,offset){var sign,exponent,mantissa,ebits;var bytes=[];if(value===undefined)throw new Error("missing value");if(endian===undefined)throw new Error("missing endian");if(buffer===undefined)throw new Error("missing buffer");if(offset===undefined)throw new Error("missing offset");if(offset+7>=buffer.length)throw new Error("Trying to read beyond buffer length");if(isNaN(value)){sign=0;exponent=2047;mantissa=23}else if(value==Number.POSITIVE_INFINITY){sign=0;exponent=2047;mantissa=0}else if(value==Number.NEGATIVE_INFINITY){sign=1;exponent=2047;mantissa=0}else{if(value<0){sign=1;value=Math.abs(value)}else{sign=0}if(value<1)ebits=fracexp(value);else ebits=intexp(value);if(value<=2.225073858507201e-308||ebits<=-1023){exponent=0;mantissa=value*Math.pow(2,1023)*Math.pow(2,51);mantissa%=Math.pow(2,52)}else{if(ebits>1023)ebits=1023;exponent=1023+ebits;mantissa=value*Math.pow(2,-ebits);mantissa*=Math.pow(2,52);mantissa%=Math.pow(2,52)}}bytes[7]=mantissa&255;bytes[6]=mantissa>>>8&255;bytes[5]=mantissa>>>16&255;mantissa=(mantissa-(mantissa&16777215))/Math.pow(2,24);bytes[4]=mantissa&255;bytes[3]=mantissa>>>8&255;bytes[2]=mantissa>>>16&255;bytes[1]=(exponent&15)<<4|mantissa>>>24;bytes[0]=sign<<7|(exponent&2032)>>>4;if(endian=="big"){buffer[offset]=bytes[0];buffer[offset+1]=bytes[1];buffer[offset+2]=bytes[2];buffer[offset+3]=bytes[3];buffer[offset+4]=bytes[4];buffer[offset+5]=bytes[5];buffer[offset+6]=bytes[6];buffer[offset+7]=bytes[7]}else{buffer[offset+7]=bytes[0];buffer[offset+6]=bytes[1];buffer[offset+5]=bytes[2];buffer[offset+4]=bytes[3];buffer[offset+3]=bytes[4];buffer[offset+2]=bytes[5];buffer[offset+1]=bytes[6];buffer[offset]=bytes[7]}}exports.ruint8=ruint8;exports.ruint16=ruint16;exports.ruint32=ruint32;exports.ruint64=ruint64;exports.wuint8=wuint8;exports.wuint16=wuint16;exports.wuint32=wuint32;exports.wuint64=wuint64;exports.rsint8=rsint8;exports.rsint16=rsint16;exports.rsint32=rsint32;exports.rsint64=rsint64;exports.wsint8=wsint8;exports.wsint16=wsint16;exports.wsint32=wsint32;exports.wsint64=wsint64;exports.rfloat=rfloat;exports.rdouble=rdouble;exports.wfloat=wfloat;exports.wdouble=wdouble},{assert:4}],87:[function(require,module,exports){var Buffer=require("__browserify_Buffer");var mod_ctf=require("./ctf.js");var mod_ctio=require("./ctio.js");var mod_assert=require("assert");var deftypes={uint8_t:{read:ctReadUint8,write:ctWriteUint8},uint16_t:{read:ctReadUint16,write:ctWriteUint16},uint32_t:{read:ctReadUint32,write:ctWriteUint32},uint64_t:{read:ctReadUint64,write:ctWriteUint64},int8_t:{read:ctReadSint8,write:ctWriteSint8},int16_t:{read:ctReadSint16,write:ctWriteSint16},int32_t:{read:ctReadSint32,write:ctWriteSint32},int64_t:{read:ctReadSint64,write:ctWriteSint64},"float":{read:ctReadFloat,write:ctWriteFloat},"double":{read:ctReadDouble,write:ctWriteDouble},"char":{read:ctReadChar,write:ctWriteChar},"char[]":{read:ctReadCharArray,write:ctWriteCharArray}};function ctReadUint8(endian,buffer,offset){var val=mod_ctio.ruint8(buffer,endian,offset);return{value:val,size:1}}function ctReadUint16(endian,buffer,offset){var val=mod_ctio.ruint16(buffer,endian,offset);return{value:val,size:2}}function ctReadUint32(endian,buffer,offset){var val=mod_ctio.ruint32(buffer,endian,offset);return{value:val,size:4}}function ctReadUint64(endian,buffer,offset){var val=mod_ctio.ruint64(buffer,endian,offset);return{value:val,size:8}}function ctReadSint8(endian,buffer,offset){var val=mod_ctio.rsint8(buffer,endian,offset);return{value:val,size:1}}function ctReadSint16(endian,buffer,offset){var val=mod_ctio.rsint16(buffer,endian,offset);return{value:val,size:2}}function ctReadSint32(endian,buffer,offset){var val=mod_ctio.rsint32(buffer,endian,offset);return{value:val,size:4}}function ctReadSint64(endian,buffer,offset){var val=mod_ctio.rsint64(buffer,endian,offset);return{value:val,size:8}}function ctReadFloat(endian,buffer,offset){var val=mod_ctio.rfloat(buffer,endian,offset);return{value:val,size:4}}function ctReadDouble(endian,buffer,offset){var val=mod_ctio.rdouble(buffer,endian,offset);return{value:val,size:8}}function ctReadChar(endian,buffer,offset){var res=new Buffer(1);res[0]=mod_ctio.ruint8(buffer,endian,offset);return{value:res,size:1}}function ctReadCharArray(length,endian,buffer,offset){var ii;var res=new Buffer(length);for(ii=0;ii<length;ii++)res[ii]=mod_ctio.ruint8(buffer,endian,offset+ii);return{value:res,size:length}}function ctWriteUint8(value,endian,buffer,offset){mod_ctio.wuint8(value,endian,buffer,offset);return 1}function ctWriteUint16(value,endian,buffer,offset){mod_ctio.wuint16(value,endian,buffer,offset);return 2}function ctWriteUint32(value,endian,buffer,offset){mod_ctio.wuint32(value,endian,buffer,offset);return 4}function ctWriteUint64(value,endian,buffer,offset){mod_ctio.wuint64(value,endian,buffer,offset);return 8}function ctWriteSint8(value,endian,buffer,offset){mod_ctio.wsint8(value,endian,buffer,offset);return 1}function ctWriteSint16(value,endian,buffer,offset){mod_ctio.wsint16(value,endian,buffer,offset);return 2}function ctWriteSint32(value,endian,buffer,offset){mod_ctio.wsint32(value,endian,buffer,offset);return 4}function ctWriteSint64(value,endian,buffer,offset){mod_ctio.wsint64(value,endian,buffer,offset);return 8}function ctWriteFloat(value,endian,buffer,offset){mod_ctio.wfloat(value,endian,buffer,offset);return 4}function ctWriteDouble(value,endian,buffer,offset){mod_ctio.wdouble(value,endian,buffer,offset);return 8}function ctWriteChar(value,endian,buffer,offset){if(!(value instanceof Buffer))throw new Error("Input must be a buffer");mod_ctio.ruint8(value[0],endian,buffer,offset);return 1}function ctWriteCharArray(value,length,endian,buffer,offset){var ii;if(!(value instanceof Buffer))throw new Error("Input must be a buffer");if(value.length>length)throw new Error("value length greater than array length");for(ii=0;ii<value.length&&ii<length;ii++)mod_ctio.wuint8(value[ii],endian,buffer,offset+ii);for(;ii<length;ii++)mod_ctio.wuint8(0,endian,offset+ii);return length}function ctGetBasicTypes(){var ret={};var key;for(key in deftypes)ret[key]=deftypes[key];return ret}function ctParseType(str){var begInd,endInd;var type,len;if(typeof str!="string")throw new Error("type must be a Javascript string");endInd=str.lastIndexOf("]");if(endInd==-1){if(str.lastIndexOf("[")!=-1)throw new Error("found invalid type with '[' but "+"no corresponding ']'");return{type:str}}begInd=str.lastIndexOf("[");if(begInd==-1)throw new Error("found invalid type with ']' but "+"no corresponding '['");if(begInd>=endInd)throw new Error("malformed type, ']' appears before '['");type=str.substring(0,begInd);len=str.substring(begInd+1,endInd);return{type:type,len:len}}function ctCheckReq(def,types,fields){var ii,jj;var req,keys,key;var found={};if(!(def instanceof Array))throw new Error("definition is not an array");if(def.length===0)throw new Error("definition must have at least one element");for(ii=0;ii<def.length;ii++){req=def[ii];if(!(req instanceof Object))throw new Error("definition must be an array of"+"objects");keys=Object.keys(req);if(keys.length!=1)throw new Error("definition entry must only have "+"one key");if(keys[0]in found)throw new Error("Specified name already "+"specified: "+keys[0]);if(!("type"in req[keys[0]]))throw new Error("missing required type definition");key=ctParseType(req[keys[0]]["type"]);while(key["len"]!==undefined){if(isNaN(parseInt(key["len"],10))){if(!(key["len"]in found))throw new Error("Given an array "+"length without a matching type")}key=ctParseType(key["type"])}if(!(key["type"]in types))throw new Error("type not found or typdefed: "+key["type"]);if(fields!==undefined){for(jj=0;jj<fields.length;jj++){if(!(fields[jj]in req[keys[0]]))throw new Error("Missing required "+"field: "+fields[jj])}}found[keys[0]]=true}}function CTypeParser(conf){if(!conf)throw new Error("missing required argument");
if(!("endian"in conf))throw new Error("missing required endian value");if(conf["endian"]!="big"&&conf["endian"]!="little")throw new Error("Invalid endian type");if("char-type"in conf&&(conf["char-type"]!="uint8"&&conf["char-type"]!="int8"))throw new Error("invalid option for char-type: "+conf["char-type"]);this.endian=conf["endian"];this.types=ctGetBasicTypes();if("char-type"in conf&&conf["char-type"]=="uint8")this.types["char"]=this.types["uint8_t"];if("char-type"in conf&&conf["char-type"]=="int8")this.types["char"]=this.types["int8_t"]}CTypeParser.prototype.setEndian=function(endian){if(endian!="big"&&endian!="little")throw new Error("invalid endian type, must be big or "+"little");this.endian=endian};CTypeParser.prototype.getEndian=function(){return this.endian};CTypeParser.prototype.typedef=function(name,value){var type;if(name===undefined)throw new(Error("missing required typedef argument: name"));if(value===undefined)throw new(Error("missing required typedef argument: value"));if(typeof name!="string")throw new(Error("the name of a type must be a string"));type=ctParseType(name);if(type["len"]!==undefined)throw new Error("Cannot have an array in the typedef name");if(name in this.types)throw new Error("typedef name already present: "+name);if(typeof value!="string"&&!(value instanceof Array))throw new Error("typedef value must either be a string or "+"struct");if(typeof value=="string"){type=ctParseType(value);if(type["len"]!==undefined){if(isNaN(parseInt(type["len"],10)))throw new(Error("typedef value must use "+"fixed size array when outside of a "+"struct"))}this.types[name]=value}else{ctCheckReq(value,this.types);this.types[name]=value}};CTypeParser.prototype.lstypes=function(){var key;var ret={};for(key in this.types){if(key in deftypes)continue;ret[key]=this.types[key]}return ret};function ctResolveArray(str,values){var ret="";var type=ctParseType(str);while(type["len"]!==undefined){if(isNaN(parseInt(type["len"],10))){if(typeof values[type["len"]]!="number")throw new Error("cannot sawp in non-number "+"for array value");ret="["+values[type["len"]]+"]"+ret}else{ret="["+type["len"]+"]"+ret}type=ctParseType(type["type"])}ret=type["type"]+ret;return ret}CTypeParser.prototype.resolveTypedef=function(type,dispatch,buffer,offset,value){var pt;mod_assert.ok(type in this.types);if(typeof this.types[type]=="string"){pt=ctParseType(this.types[type]);if(dispatch=="read")return this.readEntry(pt,buffer,offset);else if(dispatch=="write")return this.writeEntry(value,pt,buffer,offset);else throw new Error("invalid dispatch type to "+"resolveTypedef")}else{if(dispatch=="read")return this.readStruct(this.types[type],buffer,offset);else if(dispatch=="write")return this.writeStruct(value,this.types[type],buffer,offset);else throw new Error("invalid dispatch type to "+"resolveTypedef")}};CTypeParser.prototype.readEntry=function(type,buffer,offset){var parse,len;if(type["len"]!==undefined){len=parseInt(type["len"],10);if(isNaN(len))throw new Error("somehow got a non-numeric length");if(type["type"]=="char")parse=this.types["char[]"]["read"](len,this.endian,buffer,offset);else parse=this.readArray(type["type"],len,buffer,offset)}else{if(type["type"]in deftypes)parse=this.types[type["type"]]["read"](this.endian,buffer,offset);else parse=this.resolveTypedef(type["type"],"read",buffer,offset)}return parse};CTypeParser.prototype.readArray=function(type,length,buffer,offset){var ii,ent,pt;var baseOffset=offset;var ret=new Array(length);pt=ctParseType(type);for(ii=0;ii<length;ii++){ent=this.readEntry(pt,buffer,offset);offset+=ent["size"];ret[ii]=ent["value"]}return{value:ret,size:offset-baseOffset}};CTypeParser.prototype.readStruct=function(def,buffer,offset){var parse,ii,type,entry,key;var baseOffset=offset;var ret={};for(ii=0;ii<def.length;ii++){key=Object.keys(def[ii])[0];entry=def[ii][key];type=ctParseType(ctResolveArray(entry["type"],ret));if("offset"in entry)offset=baseOffset+entry["offset"];parse=this.readEntry(type,buffer,offset);offset+=parse["size"];ret[key]=parse["value"]}return{value:ret,size:offset-baseOffset}};CTypeParser.prototype.readData=function(def,buffer,offset){if(def===undefined)throw new Error("missing definition for what we should be"+"parsing");if(buffer===undefined)throw new Error("missing buffer for what we should be "+"parsing");if(offset===undefined)throw new Error("missing offset for what we should be "+"parsing");ctCheckReq(def,this.types);return this.readStruct(def,buffer,offset)["value"]};CTypeParser.prototype.writeArray=function(value,type,length,buffer,offset){var ii,pt;var baseOffset=offset;if(!(value instanceof Array))throw new Error("asked to write an array, but value is not "+"an array");if(value.length!=length)throw new Error("asked to write array of length "+length+" but that does not match value length: "+value.length);pt=ctParseType(type);for(ii=0;ii<length;ii++)offset+=this.writeEntry(value[ii],pt,buffer,offset);return offset-baseOffset};CTypeParser.prototype.writeEntry=function(value,type,buffer,offset){var len,ret;if(type["len"]!==undefined){len=parseInt(type["len"],10);if(isNaN(len))throw new Error("somehow got a non-numeric length");if(type["type"]=="char")ret=this.types["char[]"]["write"](value,len,this.endian,buffer,offset);else ret=this.writeArray(value,type["type"],len,buffer,offset)}else{if(type["type"]in deftypes)ret=this.types[type["type"]]["write"](value,this.endian,buffer,offset);else ret=this.resolveTypedef(type["type"],"write",buffer,offset,value)}return ret};CTypeParser.prototype.writeStruct=function(value,def,buffer,offset){var ii,entry,type,key;var baseOffset=offset;var vals={};for(ii=0;ii<def.length;ii++){key=Object.keys(def[ii])[0];entry=def[ii][key];type=ctParseType(ctResolveArray(entry["type"],vals));if("offset"in entry)offset=baseOffset+entry["offset"];offset+=this.writeEntry(value[ii],type,buffer,offset);vals[key]=value[ii]}return offset};function getValues(def){var ii,out,key;out=[];for(ii=0;ii<def.length;ii++){key=Object.keys(def[ii])[0];mod_assert.ok("value"in def[ii][key]);out.push(def[ii][key]["value"])}return out}CTypeParser.prototype.writeData=function(def,buffer,offset,values){var hv;if(def===undefined)throw new Error("missing definition for what we should be"+"parsing");if(buffer===undefined)throw new Error("missing buffer for what we should be "+"parsing");if(offset===undefined)throw new Error("missing offset for what we should be "+"parsing");hv=values!=null&&values!=undefined;if(hv){if(!Array.isArray(values))throw new Error("missing values for writing");ctCheckReq(def,this.types)}else{ctCheckReq(def,this.types,["value"])}this.writeStruct(hv?values:getValues(def),def,buffer,offset)};function toAbs64(val){if(val===undefined)throw new Error("missing required arg: value");if(!Array.isArray(val))throw new Error("value must be an array");if(val.length!=2)throw new Error("value must be an array of length 2");if(val[0]>=1048576)throw new Error("value would become approximated");return val[0]*Math.pow(2,32)+val[1]}function toApprox64(val){if(val===undefined)throw new Error("missing required arg: value");if(!Array.isArray(val))throw new Error("value must be an array");if(val.length!=2)throw new Error("value must be an array of length 2");return Math.pow(2,32)*val[0]+val[1]}function parseCTF(json,conf){var ctype=new CTypeParser(conf);mod_ctf.ctfParseJson(json,ctype);return ctype}exports.Parser=CTypeParser;exports.toAbs64=toAbs64;exports.toApprox64=toApprox64;exports.parseCTF=parseCTF;exports.ruint8=mod_ctio.ruint8;exports.ruint16=mod_ctio.ruint16;exports.ruint32=mod_ctio.ruint32;exports.ruint64=mod_ctio.ruint64;exports.wuint8=mod_ctio.wuint8;exports.wuint16=mod_ctio.wuint16;exports.wuint32=mod_ctio.wuint32;exports.wuint64=mod_ctio.wuint64;exports.rsint8=mod_ctio.rsint8;exports.rsint16=mod_ctio.rsint16;exports.rsint32=mod_ctio.rsint32;exports.rsint64=mod_ctio.rsint64;exports.wsint8=mod_ctio.wsint8;exports.wsint16=mod_ctio.wsint16;exports.wsint32=mod_ctio.wsint32;exports.wsint64=mod_ctio.wsint64;exports.rfloat=mod_ctio.rfloat;exports.rdouble=mod_ctio.rdouble;exports.wfloat=mod_ctio.wfloat;exports.wdouble=mod_ctio.wdouble},{"./ctf.js":85,"./ctio.js":86,__browserify_Buffer:19,assert:4}],88:[function(require,module,exports){module.exports=stringify;function getSerialize(fn,decycle){var seen=[];decycle=decycle||function(key,value){return"[Circular]"};return function(key,value){var ret=value;if(typeof value==="object"&&value){if(seen.indexOf(value)!==-1)ret=decycle(key,value);else seen.push(value)}if(fn)ret=fn(key,ret);return ret}}function stringify(obj,fn,spaces,decycle){return JSON.stringify(obj,getSerialize(fn,decycle),spaces)}stringify.getSerialize=getSerialize},{}],89:[function(require,module,exports){var process=require("__browserify_process"),__dirname="/node_modules/jsonld/node_modules/request/node_modules/mime";var path=require("path");var fs=require("fs");function Mime(){this.types=Object.create(null);this.extensions=Object.create(null)}Mime.prototype.define=function(map){for(var type in map){var exts=map[type];for(var i=0;i<exts.length;i++){if(process.env.DEBUG_MIME&&this.types[exts]){console.warn(this._loading.replace(/.*\//,""),'changes "'+exts[i]+'" extension type from '+this.types[exts]+" to "+type)}this.types[exts[i]]=type}if(!this.extensions[type]){this.extensions[type]=exts[0]}}};Mime.prototype.load=function(file){this._loading=file;var map={},content=fs.readFileSync(file,"ascii"),lines=content.split(/[\r\n]+/);lines.forEach(function(line){var fields=line.replace(/\s*#.*|^\s*|\s*$/g,"").split(/\s+/);map[fields.shift()]=fields});this.define(map);this._loading=null};Mime.prototype.lookup=function(path,fallback){var ext=path.replace(/.*[\.\/\\]/,"").toLowerCase();return this.types[ext]||fallback||this.default_type};Mime.prototype.extension=function(mimeType){var type=mimeType.match(/^\s*([^;\s]*)(?:;|\s|$)/)[1].toLowerCase();return this.extensions[type]};var mime=new Mime;mime.load(path.join(__dirname,"types/mime.types"));mime.load(path.join(__dirname,"types/node.types"));mime.default_type=mime.lookup("bin");mime.Mime=Mime;mime.charsets={lookup:function(mimeType,fallback){return/^text\//.test(mimeType)?"UTF-8":fallback}};module.exports=mime},{__browserify_process:20,fs:3,path:24}],90:[function(require,module,exports){var Buffer=require("__browserify_Buffer");(function(){var _global=this;var _rng;if(typeof require=="function"){try{var _rb=require("crypto").randomBytes;_rng=_rb&&function(){return _rb(16)}}catch(e){}}if(!_rng&&_global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);_rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!_rng){var _rnds=new Array(16);_rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}var BufferClass=typeof Buffer=="function"?Buffer:Array;var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16){buf[i+ii++]=_hexToByte[oct]}});while(ii<16){buf[i+ii++]=0}return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!=null?options.clockseq:_clockseq;var msecs=options.msecs!=null?options.msecs:(new Date).getTime();var nsecs=options.nsecs!=null?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq==null){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs==null){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;n++){b[i+n]=node[n]}return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new BufferClass(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;ii++){buf[i+ii]=rnds[ii]}}return buf||unparse(rnds)}var uuid=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;uuid.unparse=unparse;uuid.BufferClass=BufferClass;if(typeof define==="function"&&define.amd){define(function(){return uuid})}else if(typeof module!="undefined"&&module.exports){module.exports=uuid}else{var _previousRoot=_global.uuid;uuid.noConflict=function(){_global.uuid=_previousRoot;return uuid};_global.uuid=uuid}}).call(this)},{__browserify_Buffer:19,crypto:7}],91:[function(require,module,exports){var crypto=require("crypto"),qs=require("querystring");function sha1(key,body){return crypto.createHmac("sha1",key).update(body).digest("base64")}function rfc3986(str){return encodeURIComponent(str).replace(/!/g,"%21").replace(/\*/g,"%2A").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/'/g,"%27")}function hmacsign(httpMethod,base_uri,params,consumer_secret,token_secret){var querystring=Object.keys(params).sort().map(function(key){return escape(rfc3986(key))+"%3D"+escape(rfc3986(params[key]))}).join("%26");var base=[httpMethod?httpMethod.toUpperCase():"GET",rfc3986(base_uri),querystring].join("&");var key=[consumer_secret,token_secret||""].map(rfc3986).join("&");return sha1(key,base)}exports.hmacsign=hmacsign;exports.rfc3986=rfc3986},{crypto:7,querystring:28}],92:[function(require,module,exports){var toString=Object.prototype.toString;var hasOwnProperty=Object.prototype.hasOwnProperty;var indexOf=typeof Array.prototype.indexOf==="function"?function(arr,el){return arr.indexOf(el)}:function(arr,el){for(var i=0;i<arr.length;i++){if(arr[i]===el)return i}return-1};var isArray=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"};var objectKeys=Object.keys||function(obj){var ret=[];for(var key in obj){if(obj.hasOwnProperty(key)){ret.push(key)}}return ret};var forEach=typeof Array.prototype.forEach==="function"?function(arr,fn){return arr.forEach(fn)}:function(arr,fn){for(var i=0;i<arr.length;i++)fn(arr[i])};var reduce=function(arr,fn,initial){if(typeof arr.reduce==="function")return arr.reduce(fn,initial);var res=initial;for(var i=0;i<arr.length;i++)res=fn(res,arr[i]);return res};var isint=/^[0-9]+$/;function promote(parent,key){if(parent[key].length==0)return parent[key]={};var t={};for(var i in parent[key]){if(hasOwnProperty.call(parent[key],i)){t[i]=parent[key][i]}}parent[key]=t;return t}function parse(parts,parent,key,val){var part=parts.shift();if(Object.getOwnPropertyDescriptor(Object.prototype,key))return;if(!part){if(isArray(parent[key])){parent[key].push(val)}else if("object"==typeof parent[key]){parent[key]=val}else if("undefined"==typeof parent[key]){parent[key]=val}else{parent[key]=[parent[key],val]}}else{var obj=parent[key]=parent[key]||[];if("]"==part){if(isArray(obj)){if(""!=val)obj.push(val)}else if("object"==typeof obj){obj[objectKeys(obj).length]=val}else{obj=parent[key]=[parent[key],val]}}else if(~indexOf(part,"]")){part=part.substr(0,part.length-1);if(!isint.test(part)&&isArray(obj))obj=promote(parent,key);parse(parts,obj,part,val)}else{if(!isint.test(part)&&isArray(obj))obj=promote(parent,key);parse(parts,obj,part,val)}}}function merge(parent,key,val){if(~indexOf(key,"]")){var parts=key.split("["),len=parts.length,last=len-1;parse(parts,parent,"base",val)}else{if(!isint.test(key)&&isArray(parent.base)){var t={};for(var k in parent.base)t[k]=parent.base[k];parent.base=t}set(parent.base,key,val)}return parent}function compact(obj){if("object"!=typeof obj)return obj;if(isArray(obj)){var ret=[];for(var i in obj){if(hasOwnProperty.call(obj,i)){ret.push(obj[i])}}return ret}for(var key in obj){obj[key]=compact(obj[key])}return obj}function parseObject(obj){var ret={base:{}};forEach(objectKeys(obj),function(name){merge(ret,name,obj[name])});return compact(ret.base)}function parseString(str){var ret=reduce(String(str).split("&"),function(ret,pair){var eql=indexOf(pair,"="),brace=lastBraceInKey(pair),key=pair.substr(0,brace||eql),val=pair.substr(brace||eql,pair.length),val=val.substr(indexOf(val,"=")+1,val.length);if(""==key)key=pair,val="";if(""==key)return ret;return merge(ret,decode(key),decode(val))},{base:{}}).base;return compact(ret)}exports.parse=function(str){if(null==str||""==str)return{};return"object"==typeof str?parseObject(str):parseString(str)};var stringify=exports.stringify=function(obj,prefix){if(isArray(obj)){return stringifyArray(obj,prefix)}else if("[object Object]"==toString.call(obj)){return stringifyObject(obj,prefix)}else if("string"==typeof obj){return stringifyString(obj,prefix)}else{return prefix+"="+encodeURIComponent(String(obj))}};function stringifyString(str,prefix){if(!prefix)throw new TypeError("stringify expects an object");return prefix+"="+encodeURIComponent(str)}function stringifyArray(arr,prefix){var ret=[];if(!prefix)throw new TypeError("stringify expects an object");for(var i=0;i<arr.length;i++){ret.push(stringify(arr[i],prefix+"["+i+"]"))}return ret.join("&")}function stringifyObject(obj,prefix){var ret=[],keys=objectKeys(obj),key;for(var i=0,len=keys.length;i<len;++i){key=keys[i];if(""==key)continue;if(null==obj[key]){ret.push(encodeURIComponent(key)+"=")}else{ret.push(stringify(obj[key],prefix?prefix+"["+encodeURIComponent(key)+"]":encodeURIComponent(key)))}}return ret.join("&")}function set(obj,key,val){var v=obj[key];if(Object.getOwnPropertyDescriptor(Object.prototype,key))return;if(undefined===v){obj[key]=val}else if(isArray(v)){v.push(val)}else{obj[key]=[v,val]}}function lastBraceInKey(str){var len=str.length,brace,c;for(var i=0;i<len;++i){c=str[i];if("]"==c)brace=false;if("["==c)brace=true;if("="==c&&!brace)return i}}function decode(str){try{return decodeURIComponent(str.replace(/\+/g," "))}catch(err){return str}}},{}],93:[function(require,module,exports){var process=require("__browserify_process"),Buffer=require("__browserify_Buffer");"use strict";var net=require("net"),tls=require("tls"),http=require("http"),https=require("https"),events=require("events"),assert=require("assert"),util=require("util");exports.httpOverHttp=httpOverHttp;exports.httpsOverHttp=httpsOverHttp;exports.httpOverHttps=httpOverHttps;exports.httpsOverHttps=httpsOverHttps;function httpOverHttp(options){var agent=new TunnelingAgent(options);agent.request=http.request;return agent}function httpsOverHttp(options){var agent=new TunnelingAgent(options);agent.request=http.request;agent.createSocket=createSecureSocket;return agent}function httpOverHttps(options){var agent=new TunnelingAgent(options);agent.request=https.request;return agent}function httpsOverHttps(options){var agent=new TunnelingAgent(options);agent.request=https.request;agent.createSocket=createSecureSocket;return agent}function TunnelingAgent(options){var self=this;self.options=options||{};self.proxyOptions=self.options.proxy||{};self.maxSockets=self.options.maxSockets||http.Agent.defaultMaxSockets;self.requests=[];self.sockets=[];self.on("free",function onFree(socket,host,port){for(var i=0,len=self.requests.length;i<len;++i){var pending=self.requests[i];if(pending.host===host&&pending.port===port){self.requests.splice(i,1);pending.request.onSocket(socket);return}}socket.destroy();self.removeSocket(socket)})}util.inherits(TunnelingAgent,events.EventEmitter);TunnelingAgent.prototype.addRequest=function addRequest(req,host,port){var self=this;if(self.sockets.length>=this.maxSockets){self.requests.push({host:host,port:port,request:req});return}self.createSocket({host:host,port:port,request:req},function(socket){socket.on("free",onFree);socket.on("close",onCloseOrRemove);socket.on("agentRemove",onCloseOrRemove);req.onSocket(socket);function onFree(){self.emit("free",socket,host,port)}function onCloseOrRemove(err){self.removeSocket();socket.removeListener("free",onFree);socket.removeListener("close",onCloseOrRemove);socket.removeListener("agentRemove",onCloseOrRemove)}})};TunnelingAgent.prototype.createSocket=function createSocket(options,cb){var self=this;var placeholder={};self.sockets.push(placeholder);var connectOptions=mergeOptions({},self.proxyOptions,{method:"CONNECT",path:options.host+":"+options.port,agent:false});if(connectOptions.proxyAuth){connectOptions.headers=connectOptions.headers||{};connectOptions.headers["Proxy-Authorization"]="Basic "+new Buffer(connectOptions.proxyAuth).toString("base64")}debug("making CONNECT request");var connectReq=self.request(connectOptions);connectReq.useChunkedEncodingByDefault=false;connectReq.once("response",onResponse);connectReq.once("upgrade",onUpgrade);connectReq.once("connect",onConnect);connectReq.once("error",onError);connectReq.end();function onResponse(res){res.upgrade=true}function onUpgrade(res,socket,head){process.nextTick(function(){onConnect(res,socket,head)})}function onConnect(res,socket,head){connectReq.removeAllListeners();socket.removeAllListeners();if(res.statusCode===200){assert.equal(head.length,0);debug("tunneling connection has established");self.sockets[self.sockets.indexOf(placeholder)]=socket;cb(socket)}else{debug("tunneling socket could not be established, statusCode=%d",res.statusCode);var error=new Error("tunneling socket could not be established, "+"statusCode="+res.statusCode);error.code="ECONNRESET";options.request.emit("error",error);self.removeSocket(placeholder)}}function onError(cause){connectReq.removeAllListeners();debug("tunneling socket could not be established, cause=%s\n",cause.message,cause.stack);var error=new Error("tunneling socket could not be established, "+"cause="+cause.message);error.code="ECONNRESET";options.request.emit("error",error);self.removeSocket(placeholder)}};TunnelingAgent.prototype.removeSocket=function removeSocket(socket){var pos=this.sockets.indexOf(socket);if(pos===-1)return;this.sockets.splice(pos,1);var pending=this.requests.shift();if(pending){this.createSocket(pending,function(socket){pending.request.onSocket(socket)})}};function createSecureSocket(options,cb){var self=this;TunnelingAgent.prototype.createSocket.call(self,options,function(socket){var secureSocket=tls.connect(0,mergeOptions({},self.options,{servername:options.host,socket:socket}));cb(secureSocket)})}function mergeOptions(target){for(var i=1,len=arguments.length;i<len;++i){var overrides=arguments[i];if(typeof overrides==="object"){var keys=Object.keys(overrides);for(var j=0,keyLen=keys.length;j<keyLen;++j){var k=keys[j];if(overrides[k]!==undefined){target[k]=overrides[k]}}}}return target}var debug;if(process.env.NODE_DEBUG&&/\btunnel\b/.test(process.env.NODE_DEBUG)){debug=function(){var args=Array.prototype.slice.call(arguments);if(typeof args[0]==="string"){args[0]="TUNNEL: "+args[0]}else{args.unshift("TUNNEL:")}console.error.apply(console,args)}}else{debug=function(){}}exports.debug=debug},{__browserify_Buffer:19,__browserify_process:20,assert:4,events:12,http:13,https:17,net:3,tls:94,util:39}],94:[function(require,module,exports){var bind=Function.prototype.bind,slice=Array.prototype.slice,toString=Object.prototype.toString;exports.bind=function(func,that){var args=slice.call(arguments,2);if(bind){args.unshift(that);return bind.apply(func,args)}return function(){return func.apply(that,args.concat(slice.call(arguments)))}};exports.slice=function(object,begin,end){return slice.call(object,begin,end)};exports.toString=function(object){return toString.call(object)};exports.isNull=nativeTypeChecker("Null");exports.isDate=nativeTypeChecker("Date");exports.isMath=nativeTypeChecker("Math");exports.isJSON=nativeTypeChecker("JSON");exports.isError=nativeTypeChecker("Error");exports.isArray=Array.isArray||nativeTypeChecker("Array");exports.isObject=nativeTypeChecker("Object");exports.isRegExp=nativeTypeChecker("RegExp");exports.isNumber=nativeTypeChecker("Number");exports.isString=nativeTypeChecker("String");exports.isBoolean=nativeTypeChecker("Boolean");exports.isFunction=nativeTypeChecker("Function");exports.isArguments=nativeTypeChecker("Arguments");exports.isUndefined=nativeTypeChecker("Undefined");function nativeTypeChecker(type){type="[object "+type+"]";return function(object){return toString.call(object)===type}}exports.isValid=function(object){return!exports.isInvalid(object)};exports.isInvalid=function(object){return exports.isNull(object)||exports.isUndefined(object)};exports.isImmutable=function(object){return!exports.isMutable(object)};exports.isMutable=function(object){return object&&!exports.isNumber(object)&&!exports.isString(object)&&!exports.isBoolean(object)};exports.isEnumerable=function(object){if(!object)return false;if(exports.isNumber(object))return exports.isInteger(object);if(exports.isInteger(object.length))return object.length>=0;return exports.isEnumerableObject(object)};exports.isEnumerableObject=function(object){for(var _ in object)return true;return false};exports.isEmpty=function(object){return exports.isObject(object)?!exports.isEnumerableObject(object):!exports.isEnumerable(object)};exports.isFiniteNumber=function(number){return exports.isNumber(number)&&isFinite(number)};exports.isInteger=function(number){return exports.isFiniteNumber(number)&&Math.floor(number)===number};exports.isVague=function(object){return object&&typeof object==="object"};exports.isList=function(list){return exports.isVague(list)&&exports.isInteger(list.length)&&list.length>=0};exports.isNaN=isNaN;exports.nativeTypeOf=function(object){var nativeType=object.toString(object);return nativeType.substring(8,nativeType.length-1)};exports.typeOf=function(object){return exports.isObject(object)?object.constructor.name||"Object":exports.nativeTypeOf(object)};exports.safeApply=function(func,args,that){return exports.isFunction(func)?func.apply(that||this,args):undefined};exports.enumerate=function(object,iterator,that,_ignoreForEach){if(!object)return object;that=that||this;if(!_ignoreForEach&&exports.isFunction(object.forEach))return object.forEach(iterator,that);var key=0,end=object.length;if(exports.isString(object)){for(;key<end;key+=1)iterator.call(that,object.charAt(key),key,object)}if(exports.isList(object)){for(;key<end;key+=1)iterator.call(that,object[key],key,object)}else if(exports.isInteger(object)){if(object<0){end=0;key=object}else end=object;for(;key<end;key+=1)iterator.call(that,key,Math.abs(key),object)}else exports.enumerateObject(object,iterator,that);return object};exports.enumerateObject=function(object,iterator,that){var key;for(key in object)iterator.call(that,object[key],key,object);return object};exports.assignAll=function(target,giver,filter,that,_method){if(!exports.isMutable(target))return target;_method=_method==="enumerate"?_method:"enumerateObject";exports[_method](giver,function(value,key){if(!exports.safeApply(filter,arguments,that||target)){target[key]=value}});return target};exports.assignList=function(target,giver,filter,that){return exports.assignAll(target,giver,filter,that,"enumerate")};exports.assign=function(target,giver,filter,that){return exports.assignAll(target,giver,function(_,key){if(!giver.hasOwnProperty(key))return true;return exports.safeApply(filter,arguments,that||this)},that)};exports.toArray=function(object,begin,end){if(exports.isArray())return exports.isInteger(begin)?exports.slice(object,begin,end):object;if(exports.isArguments(object)||exports.isString(object))return exports.slice(object,begin,end);if(!exports.isList(object))return undefined;if(!exports.isInteger(end))end=object.length;begin=begin||0;return exports.assignList([],object,function(_,i){return begin>i||i>=end})}},{}],95:[function(require,module,exports){function DOMParser(options){this.options=options!=true&&options||{locator:{}}}DOMParser.prototype.parseFromString=function(source,mimeType){var sax=new XMLReader;var options=this.options;var domBuilder=options.domBuilder||new DOMHandler;var errorHandler=options.errorHandler;var locator=options.locator;var defaultNSMap={};var entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};if(locator){domBuilder.setDocumentLocator(locator)}sax.errorHandler=buildErrorHandler(errorHandler,domBuilder,locator);sax.domBuilder=options.domBuilder||domBuilder;if(/\/x?html?$/.test(mimeType)){entityMap.nbsp=" ";entityMap.copy="©";defaultNSMap[""]="http://www.w3.org/1999/xhtml"}sax.parse(source,defaultNSMap,entityMap);return domBuilder.document};function buildErrorHandler(errorImpl,domBuilder,locator){if(!errorImpl){if(domBuilder instanceof DOMHandler){return domBuilder}errorImpl=domBuilder}var errorHandler={};var isCallback=errorImpl instanceof Function;locator=locator||{};function build(key){var fn=errorImpl[key];if(!fn){if(isCallback){fn=errorImpl.length==2?function(msg){errorImpl(key,msg)}:errorImpl}else{var i=arguments.length;while(--i){if(fn=errorImpl[arguments[i]]){break}}}}errorHandler[key]=fn&&function(msg){fn(msg+_locator(locator))}||function(){}}build("warning","warn");build("error","warn","warning");build("fatalError","warn","warning","error");return errorHandler}function DOMHandler(){this.cdata=false}function position(locator,node){node.lineNumber=locator.lineNumber;node.columnNumber=locator.columnNumber}DOMHandler.prototype={startDocument:function(){this.document=(new DOMImplementation).createDocument(null,null,null);if(this.locator){this.document.documentURI=this.locator.systemId}},startElement:function(namespaceURI,localName,qName,attrs){var doc=this.document;var el=doc.createElementNS(namespaceURI,qName||localName);var len=attrs.length;appendElement(this,el);this.currentElement=el;this.locator&&position(this.locator,el);for(var i=0;i<len;i++){var namespaceURI=attrs.getURI(i);var value=attrs.getValue(i);var qName=attrs.getQName(i);var attr=doc.createAttributeNS(namespaceURI,qName);if(attr.getOffset){position(attr.getOffset(1),attr)}attr.value=attr.nodeValue=value;el.setAttributeNode(attr)}},endElement:function(namespaceURI,localName,qName){var current=this.currentElement;var tagName=current.tagName;this.currentElement=current.parentNode},startPrefixMapping:function(prefix,uri){},endPrefixMapping:function(prefix){},processingInstruction:function(target,data){var ins=this.document.createProcessingInstruction(target,data);this.locator&&position(this.locator,ins);appendElement(this,ins)},ignorableWhitespace:function(ch,start,length){},characters:function(chars,start,length){chars=_toString.apply(this,arguments);if(this.currentElement&&chars){if(this.cdata){var charNode=this.document.createCDATASection(chars);this.currentElement.appendChild(charNode)}else{var charNode=this.document.createTextNode(chars);this.currentElement.appendChild(charNode)}this.locator&&position(this.locator,charNode)}},skippedEntity:function(name){},endDocument:function(){this.document.normalize()},setDocumentLocator:function(locator){if(this.locator=locator){locator.lineNumber=0}},comment:function(chars,start,length){chars=_toString.apply(this,arguments);var comm=this.document.createComment(chars);this.locator&&position(this.locator,comm);appendElement(this,comm)},startCDATA:function(){this.cdata=true},endCDATA:function(){this.cdata=false},startDTD:function(name,publicId,systemId){var impl=this.document.implementation;if(impl&&impl.createDocumentType){var dt=impl.createDocumentType(name,publicId,systemId);this.locator&&position(this.locator,dt);
appendElement(this,dt)}},warning:function(error){console.warn(error,_locator(this.locator))},error:function(error){console.error(error,_locator(this.locator))},fatalError:function(error){console.error(error,_locator(this.locator));throw error}};function _locator(l){if(l){return"\n@"+(l.systemId||"")+"#[line:"+l.lineNumber+",col:"+l.columnNumber+"]"}}function _toString(chars,start,length){if(typeof chars=="string"){return chars.substr(start,length)}else{if(chars.length>=start+length||start){return new java.lang.String(chars,start,length)+""}return chars}}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(key){DOMHandler.prototype[key]=function(){return null}});function appendElement(hander,node){if(!hander.currentElement){hander.document.appendChild(node)}else{hander.currentElement.appendChild(node)}}if(typeof require=="function"){var XMLReader=require("./sax").XMLReader;var DOMImplementation=exports.DOMImplementation=require("./dom").DOMImplementation;exports.XMLSerializer=require("./dom").XMLSerializer;exports.DOMParser=DOMParser}},{"./dom":96,"./sax":97}],96:[function(require,module,exports){function copy(src,dest){for(var p in src){dest[p]=src[p]}}function _extends(Class,Super){var pt=Class.prototype;if(Object.create){var ppt=Object.create(Super.prototype);pt.__proto__=ppt}if(!(pt instanceof Super)){function t(){}t.prototype=Super.prototype;t=new t;copy(pt,t);Class.prototype=pt=t}if(pt.constructor!=Class){if(typeof Class!="function"){console.error("unknow Class:"+Class)}pt.constructor=Class}}var htmlns="http://www.w3.org/1999/xhtml";var NodeType={};var ELEMENT_NODE=NodeType.ELEMENT_NODE=1;var ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2;var TEXT_NODE=NodeType.TEXT_NODE=3;var CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4;var ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5;var ENTITY_NODE=NodeType.ENTITY_NODE=6;var PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7;var COMMENT_NODE=NodeType.COMMENT_NODE=8;var DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9;var DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10;var DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11;var NOTATION_NODE=NodeType.NOTATION_NODE=12;var ExceptionCode={};var ExceptionMessage={};var INDEX_SIZE_ERR=ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1);var DOMSTRING_SIZE_ERR=ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2);var HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3);var WRONG_DOCUMENT_ERR=ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4);var INVALID_CHARACTER_ERR=ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5);var NO_DATA_ALLOWED_ERR=ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6);var NO_MODIFICATION_ALLOWED_ERR=ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7);var NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8);var NOT_SUPPORTED_ERR=ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9);var INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10);var INVALID_STATE_ERR=ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11);var SYNTAX_ERR=ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12);var INVALID_MODIFICATION_ERR=ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13);var NAMESPACE_ERR=ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14);var INVALID_ACCESS_ERR=ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(code,message){if(message instanceof Error){var error=message}else{error=this;Error.call(this,ExceptionMessage[code]);this.message=ExceptionMessage[code];if(Error.captureStackTrace)Error.captureStackTrace(this,DOMException)}error.code=code;if(message)this.message=this.message+": "+message;return error}DOMException.prototype=Error.prototype;copy(ExceptionCode,DOMException);function NodeList(){}NodeList.prototype={length:0,item:function(index){return this[index]||null}};function LiveNodeList(node,refresh){this._node=node;this._refresh=refresh;_updateLiveList(this)}function _updateLiveList(list){var inc=list._node._inc||list._node.ownerDocument._inc;if(list._inc!=inc){var ls=list._refresh(list._node);__set__(list,"length",ls.length);copy(ls,list);list._inc=inc}}LiveNodeList.prototype.item=function(i){_updateLiveList(this);return this[i]};_extends(LiveNodeList,NodeList);function NamedNodeMap(){}function _findNodeIndex(list,node){var i=list.length;while(i--){if(list[i]===node){return i}}}function _addNamedNode(el,list,newAttr,oldAttr){if(oldAttr){list[_findNodeIndex(list,oldAttr)]=newAttr}else{list[list.length++]=newAttr}if(el){newAttr.ownerElement=el;var doc=el.ownerDocument;if(doc){oldAttr&&_onRemoveAttribute(doc,el,oldAttr);_onAddAttribute(doc,el,newAttr)}}}function _removeNamedNode(el,list,attr){var i=_findNodeIndex(list,attr);if(i>=0){var lastIndex=list.length-1;while(i<lastIndex){list[i]=list[++i]}list.length=lastIndex;if(el){var doc=el.ownerDocument;if(doc){_onRemoveAttribute(doc,el,attr);attr.ownerElement=null}}}else{throw DOMException(NOT_FOUND_ERR,new Error)}}NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(key){var i=this.length;while(i--){var attr=this[i];if(attr.nodeName==key){return attr}}},setNamedItem:function(attr){var el=attr.ownerElement;if(el&&el!=this._ownerElement){throw new DOMException(INUSE_ATTRIBUTE_ERR)}var oldAttr=this.getNamedItem(attr.nodeName);_addNamedNode(this._ownerElement,this,attr,oldAttr);return oldAttr},setNamedItemNS:function(attr){var el=attr.ownerElement,oldAttr;if(el&&el!=this._ownerElement){throw new DOMException(INUSE_ATTRIBUTE_ERR)}oldAttr=this.getNamedItemNS(attr.namespaceURI,attr.localName);_addNamedNode(this._ownerElement,this,attr,oldAttr);return oldAttr},removeNamedItem:function(key){var attr=this.getNamedItem(key);_removeNamedNode(this._ownerElement,this,attr);return attr},removeNamedItemNS:function(namespaceURI,localName){var attr=this.getNamedItemNS(namespaceURI,localName);_removeNamedNode(this._ownerElement,this,attr);return attr},getNamedItemNS:function(namespaceURI,localName){var i=this.length;while(i--){var node=this[i];if(node.localName==localName&&node.namespaceURI==namespaceURI){return node}}return null}};function DOMImplementation(features){this._features={};if(features){for(var feature in features){this._features=features[feature]}}}DOMImplementation.prototype={hasFeature:function(feature,version){var versions=this._features[feature.toLowerCase()];if(versions&&(!version||version in versions)){return true}else{return false}},createDocument:function(namespaceURI,qualifiedName,doctype){var doc=new Document;doc.doctype=doctype;if(doctype){doc.appendChild(doctype)}doc.implementation=this;doc.childNodes=new NodeList;if(qualifiedName){var root=doc.createElementNS(namespaceURI,qualifiedName);doc.appendChild(root)}return doc},createDocumentType:function(qualifiedName,publicId,systemId){var node=new DocumentType;node.name=qualifiedName;node.nodeName=qualifiedName;node.publicId=publicId;node.systemId=systemId;return node}};function Node(){}Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(newChild,refChild){return _insertBefore(this,newChild,refChild)},replaceChild:function(newChild,oldChild){this.insertBefore(newChild,oldChild);if(oldChild){this.removeChild(oldChild)}},removeChild:function(oldChild){return _removeChild(this,oldChild)},appendChild:function(newChild){return this.insertBefore(newChild,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(deep){return cloneNode(this.ownerDocument||this,this,deep)},normalize:function(){var child=this.firstChild;while(child){var next=child.nextSibling;if(next&&next.nodeType==TEXT_NODE&&child.nodeType==TEXT_NODE){this.removeChild(next);child.appendData(next.data)}else{child.normalize();child=next}}},isSupported:function(feature,version){return this.ownerDocument.implementation.hasFeature(feature,version)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(namespaceURI){var el=this;while(el){var map=el._nsMap;if(map){for(var n in map){if(map[n]==namespaceURI){return n}}}el=el.nodeType==2?el.ownerDocument:el.parentNode}return null},lookupNamespaceURI:function(prefix){var el=this;while(el){var map=el._nsMap;if(map){if(prefix in map){return map[prefix]}}el=el.nodeType==2?el.ownerDocument:el.parentNode}return null},isDefaultNamespace:function(namespaceURI){var prefix=this.lookupPrefix(namespaceURI);return prefix==null}};function _xmlEncoder(c){return c=="<"&&"&lt;"||c==">"&&"&gt;"||c=="&"&&"&amp;"||c=='"'&&"&quot;"||"&#"+c.charCodeAt()+";"}copy(NodeType,Node);copy(NodeType,Node.prototype);function _visitNode(node,callback){if(callback(node)){return true}if(node=node.firstChild){do{if(_visitNode(node,callback)){return true}}while(node=node.nextSibling)}}function Document(){}function _onAddAttribute(doc,el,newAttr){doc&&doc._inc++;var ns=newAttr.namespaceURI;if(ns=="http://www.w3.org/2000/xmlns/"){el._nsMap[newAttr.prefix?newAttr.localName:""]=newAttr.value}}function _onRemoveAttribute(doc,el,newAttr,remove){doc&&doc._inc++;var ns=newAttr.namespaceURI;if(ns=="http://www.w3.org/2000/xmlns/"){delete el._nsMap[newAttr.prefix?newAttr.localName:""]}}function _onUpdateChild(doc,el,newChild){if(doc&&doc._inc){doc._inc++;var cs=el.childNodes;if(newChild){cs[cs.length++]=newChild}else{var child=el.firstChild;var i=0;while(child){cs[i++]=child;child=child.nextSibling}cs.length=i}}}function _removeChild(parentNode,child){var previous=child.previousSibling;var next=child.nextSibling;if(previous){previous.nextSibling=next}else{parentNode.firstChild=next}if(next){next.previousSibling=previous}else{parentNode.lastChild=previous}_onUpdateChild(parentNode.ownerDocument,parentNode);return child}function _insertBefore(parentNode,newChild,nextChild){var cp=newChild.parentNode;if(cp){cp.removeChild(newChild)}if(newChild.nodeType===DOCUMENT_FRAGMENT_NODE){var newFirst=newChild.firstChild;if(newFirst==null){return newChild}var newLast=newChild.lastChild}else{newFirst=newLast=newChild}var pre=nextChild?nextChild.previousSibling:parentNode.lastChild;newFirst.previousSibling=pre;newLast.nextSibling=nextChild;if(pre){pre.nextSibling=newFirst}else{parentNode.firstChild=newFirst}if(nextChild==null){parentNode.lastChild=newLast}else{nextChild.previousSibling=newLast}do{newFirst.parentNode=parentNode}while(newFirst!==newLast&&(newFirst=newFirst.nextSibling));_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){newChild.firstChild=newChild.lastChild=null}return newChild}function _appendSingleChild(parentNode,newChild){var cp=newChild.parentNode;if(cp){var pre=parentNode.lastChild;cp.removeChild(newChild);var pre=parentNode.lastChild}var pre=parentNode.lastChild;newChild.parentNode=parentNode;newChild.previousSibling=pre;newChild.nextSibling=null;if(pre){pre.nextSibling=newChild}else{parentNode.firstChild=newChild}parentNode.lastChild=newChild;_onUpdateChild(parentNode.ownerDocument,parentNode,newChild);return newChild}Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(newChild,refChild){if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){var child=newChild.firstChild;while(child){var next=child.nextSibling;this.insertBefore(child,refChild);child=next}return newChild}if(this.documentElement==null&&newChild.nodeType==1){this.documentElement=newChild}return _insertBefore(this,newChild,refChild),newChild.ownerDocument=this,newChild},removeChild:function(oldChild){if(this.documentElement==oldChild){this.documentElement=null}return _removeChild(this,oldChild)},importNode:function(importedNode,deep){return importNode(this,importedNode,deep)},getElementById:function(id){var rtv=null;_visitNode(this.documentElement,function(node){if(node.nodeType==1){if(node.getAttribute("id")==id){rtv=node;return true}}});return rtv},createElement:function(tagName){var node=new Element;node.ownerDocument=this;node.nodeName=tagName;node.tagName=tagName;node.childNodes=new NodeList;var attrs=node.attributes=new NamedNodeMap;attrs._ownerElement=node;return node},createDocumentFragment:function(){var node=new DocumentFragment;node.ownerDocument=this;node.childNodes=new NodeList;return node},createTextNode:function(data){var node=new Text;node.ownerDocument=this;node.appendData(data);return node},createComment:function(data){var node=new Comment;node.ownerDocument=this;node.appendData(data);return node},createCDATASection:function(data){var node=new CDATASection;node.ownerDocument=this;node.appendData(data);return node},createProcessingInstruction:function(target,data){var node=new ProcessingInstruction;node.ownerDocument=this;node.tagName=node.target=target;node.nodeValue=node.data=data;return node},createAttribute:function(name){var node=new Attr;node.ownerDocument=this;node.name=name;node.nodeName=name;node.localName=name;node.specified=true;return node},createEntityReference:function(name){var node=new EntityReference;node.ownerDocument=this;node.nodeName=name;return node},createElementNS:function(namespaceURI,qualifiedName){var node=new Element;var pl=qualifiedName.split(":");var attrs=node.attributes=new NamedNodeMap;node.childNodes=new NodeList;node.ownerDocument=this;node.nodeName=qualifiedName;node.tagName=qualifiedName;node.namespaceURI=namespaceURI;if(pl.length==2){node.prefix=pl[0];node.localName=pl[1]}else{node.localName=qualifiedName}attrs._ownerElement=node;return node},createAttributeNS:function(namespaceURI,qualifiedName){var node=new Attr;var pl=qualifiedName.split(":");node.ownerDocument=this;node.nodeName=qualifiedName;node.name=qualifiedName;node.namespaceURI=namespaceURI;node.specified=true;if(pl.length==2){node.prefix=pl[0];node.localName=pl[1]}else{node.localName=qualifiedName}return node}};_extends(Document,Node);function Element(){this._nsMap={}}Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(name){return this.getAttributeNode(name)!=null},getAttribute:function(name){var attr=this.getAttributeNode(name);return attr&&attr.value||""},getAttributeNode:function(name){return this.attributes.getNamedItem(name)},setAttribute:function(name,value){var attr=this.ownerDocument.createAttribute(name);attr.value=attr.nodeValue=""+value;this.setAttributeNode(attr)},removeAttribute:function(name){var attr=this.getAttributeNode(name);attr&&this.removeAttributeNode(attr)},appendChild:function(newChild){if(newChild.nodeType===DOCUMENT_FRAGMENT_NODE){return this.insertBefore(newChild,null)}else{return _appendSingleChild(this,newChild)}},setAttributeNode:function(newAttr){return this.attributes.setNamedItem(newAttr)},setAttributeNodeNS:function(newAttr){return this.attributes.setNamedItemNS(newAttr)},removeAttributeNode:function(oldAttr){return this.attributes.removeNamedItem(oldAttr.nodeName)},removeAttributeNS:function(namespaceURI,localName){var old=this.getAttributeNodeNS(namespaceURI,localName);old&&this.removeAttributeNode(old)},hasAttributeNS:function(namespaceURI,localName){return this.getAttributeNodeNS(namespaceURI,localName)!=null},getAttributeNS:function(namespaceURI,localName){var attr=this.getAttributeNodeNS(namespaceURI,localName);return attr&&attr.value||""},setAttributeNS:function(namespaceURI,qualifiedName,value){var attr=this.ownerDocument.createAttributeNS(namespaceURI,qualifiedName);attr.value=attr.nodeValue=value;this.setAttributeNode(attr)},getAttributeNodeNS:function(namespaceURI,localName){return this.attributes.getNamedItemNS(namespaceURI,localName)},getElementsByTagName:function(tagName){return new LiveNodeList(this,function(base){var ls=[];_visitNode(base,function(node){if(node!==base&&node.nodeType==ELEMENT_NODE&&(tagName==="*"||node.tagName==tagName)){ls.push(node)}});return ls})},getElementsByTagNameNS:function(namespaceURI,localName){return new LiveNodeList(this,function(base){var ls=[];_visitNode(base,function(node){if(node!==base&&node.nodeType===ELEMENT_NODE&&node.namespaceURI===namespaceURI&&(localName==="*"||node.localName==localName)){ls.push(node)}});return ls})}};Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName;Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS;_extends(Element,Node);function Attr(){}Attr.prototype.nodeType=ATTRIBUTE_NODE;_extends(Attr,Node);function CharacterData(){}CharacterData.prototype={data:"",substringData:function(offset,count){return this.data.substring(offset,offset+count)},appendData:function(text){text=this.data+text;this.nodeValue=this.data=text;this.length=text.length},insertData:function(offset,text){this.replaceData(offset,0,text)},appendChild:function(newChild){throw new Error(ExceptionMessage[3]);return Node.prototype.appendChild.apply(this,arguments)},deleteData:function(offset,count){this.replaceData(offset,count,"")},replaceData:function(offset,count,text){var start=this.data.substring(0,offset);var end=this.data.substring(offset+count);text=start+text+end;this.nodeValue=this.data=text;this.length=text.length}};_extends(CharacterData,Node);function Text(){}Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(offset){var text=this.data;var newText=text.substring(offset);text=text.substring(0,offset);this.data=this.nodeValue=text;this.length=text.length;var newNode=this.ownerDocument.createTextNode(newText);if(this.parentNode){this.parentNode.insertBefore(newNode,this.nextSibling)}return newNode}};_extends(Text,CharacterData);function Comment(){}Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE};_extends(Comment,CharacterData);function CDATASection(){}CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE};_extends(CDATASection,CharacterData);function DocumentType(){}DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE;_extends(DocumentType,Node);function Notation(){}Notation.prototype.nodeType=NOTATION_NODE;_extends(Notation,Node);function Entity(){}Entity.prototype.nodeType=ENTITY_NODE;_extends(Entity,Node);function EntityReference(){}EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE;_extends(EntityReference,Node);function DocumentFragment(){}DocumentFragment.prototype.nodeName="#document-fragment";DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE;_extends(DocumentFragment,Node);function ProcessingInstruction(){}ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE;_extends(ProcessingInstruction,Node);function XMLSerializer(){}XMLSerializer.prototype.serializeToString=function(node){var buf=[];serializeToString(node,buf);return buf.join("")};Node.prototype.toString=function(){return XMLSerializer.prototype.serializeToString(this)};function serializeToString(node,buf){switch(node.nodeType){case ELEMENT_NODE:var attrs=node.attributes;var len=attrs.length;var child=node.firstChild;var nodeName=node.tagName;var isHTML=htmlns===node.namespaceURI;buf.push("<",nodeName);for(var i=0;i<len;i++){serializeToString(attrs.item(i),buf,isHTML)}if(child||isHTML&&!/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){buf.push(">");if(isHTML&&/^script$/i.test(nodeName)){if(child){buf.push(child.data)}}else{while(child){serializeToString(child,buf);child=child.nextSibling}}buf.push("</",nodeName,">")}else{buf.push("/>")}return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var child=node.firstChild;while(child){serializeToString(child,buf);child=child.nextSibling}return;case ATTRIBUTE_NODE:return buf.push(" ",node.name,'="',node.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return buf.push(node.data.replace(/[<&]/g,_xmlEncoder));case CDATA_SECTION_NODE:return buf.push("<![CDATA[",node.data,"]]>");case COMMENT_NODE:return buf.push("<!--",node.data,"-->");case DOCUMENT_TYPE_NODE:var pubid=node.publicId;var sysid=node.systemId;buf.push("<!DOCTYPE ",node.name);if(pubid){buf.push(' PUBLIC "',pubid);if(sysid&&sysid!="."){buf.push('" "',sysid)}buf.push('">')}else if(sysid&&sysid!="."){buf.push(' SYSTEM "',sysid,'">')}else{var sub=node.internalSubset;if(sub){buf.push(" [",sub,"]")}buf.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return buf.push("<?",node.target," ",node.data,"?>");case ENTITY_REFERENCE_NODE:return buf.push("&",node.nodeName,";");default:buf.push("??",node.nodeName)}}function importNode(doc,node,deep){var node2;switch(node.nodeType){case ELEMENT_NODE:node2=node.cloneNode(false);node2.ownerDocument=doc;var attrs=node2.attributes;var len=attrs.length;for(var i=0;i<len;i++){node2.setAttributeNodeNS(importNode(doc,attrs.item(i),deep))}case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:deep=true;break}if(!node2){node2=node.cloneNode(false)}node2.ownerDocument=doc;node2.parentNode=null;if(deep){var child=node.firstChild;while(child){node2.appendChild(importNode(doc,child,deep));child=child.nextSibling}}return node2}function cloneNode(doc,node,deep){var node2=new node.constructor;for(var n in node){var v=node[n];if(typeof v!="object"){if(v!=node2[n]){node2[n]=v}}}if(node.childNodes){node2.childNodes=new NodeList}node2.ownerDocument=doc;switch(node2.nodeType){case ELEMENT_NODE:var attrs=node.attributes;var attrs2=node2.attributes=new NamedNodeMap;var len=attrs.length;attrs2._ownerElement=node2;for(var i=0;i<len;i++){node2.setAttributeNode(cloneNode(doc,attrs.item(i),true))}break;case ATTRIBUTE_NODE:deep=true}if(deep){var child=node.firstChild;while(child){node2.appendChild(cloneNode(doc,child,deep));child=child.nextSibling}}return node2}function __set__(object,key,value){object[key]=value}try{if(Object.defineProperty){Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){_updateLiveList(this);return this.$$length}});Object.defineProperty(Node.prototype,"textContent",{get:function(){return getTextContent(this)},set:function(data){switch(this.nodeType){case 1:case 11:while(this.firstChild){this.removeChild(this.firstChild)}if(data||String(data)){this.appendChild(this.ownerDocument.createTextNode(data))}break;default:this.data=data;this.value=value;this.nodeValue=data}}});function getTextContent(node){switch(node.nodeType){case 1:case 11:var buf=[];node=node.firstChild;while(node){if(node.nodeType!==7&&node.nodeType!==8){buf.push(getTextContent(node))}node=node.nextSibling}return buf.join("");default:return node.nodeValue}}__set__=function(object,key,value){object["$$"+key]=value}}}catch(e){}if(typeof require=="function"){exports.DOMImplementation=DOMImplementation;exports.XMLSerializer=XMLSerializer}},{}],97:[function(require,module,exports){var nameStartChar=/[A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�]/;var nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"·̀-ͯ\\ux203F-⁀]");var tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$");var S_TAG=0;var S_ATTR=1;var S_ATTR_S=2;var S_EQ=3;var S_V=4;var S_E=5;var S_S=6;var S_C=7;function XMLReader(){}XMLReader.prototype={parse:function(source,defaultNSMap,entityMap){var domBuilder=this.domBuilder;domBuilder.startDocument();_copy(defaultNSMap,defaultNSMap={});parse(source,defaultNSMap,entityMap,domBuilder,this.errorHandler);domBuilder.endDocument()}};function parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){function fixedFromCharCode(code){if(code>65535){code-=65536;var surrogate1=55296+(code>>10),surrogate2=56320+(code&1023);return String.fromCharCode(surrogate1,surrogate2)}else{return String.fromCharCode(code)}}function entityReplacer(a){var k=a.slice(1,-1);if(k in entityMap){return entityMap[k]}else if(k.charAt(0)==="#"){return fixedFromCharCode(parseInt(k.substr(1).replace("x","0x")))}else{errorHandler.error("entity not found:"+a);return a}}function appendText(end){var xt=source.substring(start,end).replace(/&#?\w+;/g,entityReplacer);locator&&position(start);domBuilder.characters(xt,0,end-start);start=end}function position(start,m){while(start>=endPos&&(m=linePattern.exec(source))){startPos=m.index;endPos=startPos+m[0].length;locator.lineNumber++}locator.columnNumber=start-startPos+1}var startPos=0;var endPos=0;var linePattern=/.+(?:\r\n?|\n)|.*$/g;var locator=domBuilder.locator;var parseStack=[{currentNSMap:defaultNSMapCopy}];var closeMap={};var start=0;while(true){var i=source.indexOf("<",start);if(i>start){appendText(i)}switch(source.charAt(i+1)){case"/":var end=source.indexOf(">",i+3);var tagName=source.substring(i+2,end);var config=parseStack.pop();var localNSMap=config.localNSMap;if(config.tagName!=tagName){errorHandler.fatalError("end tag name: "+tagName+" is not match the current start tagName:"+config.tagName)}domBuilder.endElement(config.uri,config.localName,tagName);if(localNSMap){for(var prefix in localNSMap){domBuilder.endPrefixMapping(prefix)}}end++;break;case"?":locator&&position(i);end=parseInstruction(source,i,domBuilder);break;case"!":locator&&position(i);end=parseDCC(source,i,domBuilder);break;default:if(i<0){if(!source.substr(start).match(/^\s*$/)){errorHandler.error("source code out of document root")}return}else{try{locator&&position(i);var el=new ElementAttributes;var end=parseElementStartPart(source,i,el,entityReplacer,errorHandler);var len=el.length;if(len&&locator){var backup=copyLocator(locator,{});for(var i=0;i<len;i++){var a=el[i];position(a.offset);a.offset=copyLocator(locator,{})}copyLocator(backup,locator)}el.closed=el.closed||fixSelfClosed(source,end,el.tagName,closeMap);appendElement(el,domBuilder,parseStack);if(el.uri==="http://www.w3.org/1999/xhtml"&&!el.closed){end=parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)}else{end++}}catch(e){errorHandler.error("element parse error: "+e);end=-1}}}if(end<0){appendText(i+1)}else{start=end}}}function copyLocator(f,t){t.lineNumber=f.lineNumber;t.columnNumber=f.columnNumber;return t}function parseElementStartPart(source,start,el,entityReplacer,errorHandler){var attrName;var value;var p=++start;var s=S_TAG;while(true){var c=source.charAt(p);switch(c){case"=":if(s===S_ATTR){attrName=source.slice(start,p);s=S_EQ}else if(s===S_ATTR_S){s=S_EQ}else{throw new Error("attribute equal must after attrName")}break;case"'":case'"':if(s===S_EQ){start=p+1;p=source.indexOf(c,start);if(p>0){value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);el.add(attrName,value,start-1);s=S_E}else{throw new Error("attribute value no end '"+c+"' match")}}else if(s==S_V){value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);el.add(attrName,value,start);errorHandler.warning('attribute "'+attrName+'" missed start quot('+c+")!!");start=p+1;s=S_E}else{throw new Error('attribute value must after "="')}break;case"/":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_E:case S_S:case S_C:s=S_C;el.closed=true;case S_V:case S_ATTR:case S_ATTR_S:break;default:throw new Error("attribute invalid close char('/')")}break;case">":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_E:case S_S:case S_C:break;case S_V:case S_ATTR:value=source.slice(start,p);if(value.slice(-1)==="/"){el.closed=true;value=value.slice(0,-1)}case S_ATTR_S:if(s===S_ATTR_S){value=attrName}if(s==S_V){errorHandler.warning('attribute "'+value+'" missed quot(")!!');el.add(attrName,value.replace(/&#?\w+;/g,entityReplacer),start)}else{errorHandler.warning('attribute "'+value+'" missed value!! "'+value+'" instead!!');el.add(value,value,start)}break;case S_EQ:throw new Error("attribute value missed!!")}return p;case"":c=" ";default:if(c<=" "){switch(s){case S_TAG:el.setTagName(source.slice(start,p));s=S_S;break;case S_ATTR:attrName=source.slice(start,p);s=S_ATTR_S;break;case S_V:var value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);errorHandler.warning('attribute "'+value+'" missed quot(")!!');el.add(attrName,value,start);case S_E:s=S_S;break}}else{switch(s){case S_ATTR_S:errorHandler.warning('attribute "'+attrName+'" missed value!! "'+attrName+'" instead!!');el.add(attrName,attrName,start);start=p;s=S_ATTR;break;case S_E:errorHandler.warning('attribute space is required"'+attrName+'"!!');case S_S:s=S_ATTR;start=p;break;case S_EQ:s=S_V;start=p;break;case S_C:throw new Error("elements closed character '/' and '>' must be connected to")}}}p++}}function appendElement(el,domBuilder,parseStack){var tagName=el.tagName;var localNSMap=null;var currentNSMap=parseStack[parseStack.length-1].currentNSMap;var i=el.length;while(i--){var a=el[i];var qName=a.qName;var value=a.value;var nsp=qName.indexOf(":");if(nsp>0){var prefix=a.prefix=qName.slice(0,nsp);var localName=qName.slice(nsp+1);var nsPrefix=prefix==="xmlns"&&localName}else{localName=qName;prefix=null;nsPrefix=qName==="xmlns"&&""}a.localName=localName;if(nsPrefix!==false){if(localNSMap==null){localNSMap={};_copy(currentNSMap,currentNSMap={})}currentNSMap[nsPrefix]=localNSMap[nsPrefix]=value;a.uri="http://www.w3.org/2000/xmlns/";domBuilder.startPrefixMapping(nsPrefix,value)}}var i=el.length;while(i--){a=el[i];var prefix=a.prefix;if(prefix){if(prefix==="xml"){a.uri="http://www.w3.org/XML/1998/namespace"}if(prefix!=="xmlns"){a.uri=currentNSMap[prefix]}}}var nsp=tagName.indexOf(":");if(nsp>0){prefix=el.prefix=tagName.slice(0,nsp);localName=el.localName=tagName.slice(nsp+1)}else{prefix=null;localName=el.localName=tagName}var ns=el.uri=currentNSMap[prefix||""];domBuilder.startElement(ns,localName,tagName,el);if(el.closed){domBuilder.endElement(ns,localName,tagName);if(localNSMap){for(prefix in localNSMap){domBuilder.endPrefixMapping(prefix)}}}else{el.currentNSMap=currentNSMap;el.localNSMap=localNSMap;parseStack.push(el)}}function parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){if(/^(?:script|textarea)$/i.test(tagName)){var elEndStart=source.indexOf("</"+tagName+">",elStartEnd);var text=source.substring(elStartEnd+1,elEndStart);if(/[&<]/.test(text)){if(/^script$/i.test(tagName)){domBuilder.characters(text,0,text.length);return elEndStart}text=text.replace(/&#?\w+;/g,entityReplacer);domBuilder.characters(text,0,text.length);return elEndStart}}return elStartEnd+1}function fixSelfClosed(source,elStartEnd,tagName,closeMap){var pos=closeMap[tagName];if(pos==null){pos=closeMap[tagName]=source.lastIndexOf("</"+tagName+">")}return pos<elStartEnd}function _copy(source,target){for(var n in source){target[n]=source[n]}}function parseDCC(source,start,domBuilder){var next=source.charAt(start+2);switch(next){case"-":if(source.charAt(start+3)==="-"){var end=source.indexOf("-->",start+4);domBuilder.comment(source,start+4,end-start-4);return end+3}else{return-1}default:if(source.substr(start+3,6)=="CDATA["){var end=source.indexOf("]]>",start+9);domBuilder.startCDATA();domBuilder.characters(source,start+9,end-start-9);domBuilder.endCDATA();return end+3}var matchs=split(source,start);var len=matchs.length;if(len>1&&/!doctype/i.test(matchs[0][0])){var name=matchs[1][0];var pubid=len>3&&/^public$/i.test(matchs[2][0])&&matchs[3][0];var sysid=len>4&&matchs[4][0];var lastMatch=matchs[len-1];domBuilder.startDTD(name,pubid,sysid);domBuilder.endDTD();return lastMatch.index+lastMatch[0].length}}return-1}function parseInstruction(source,start,domBuilder){var end=source.indexOf("?>",start);if(end){var match=source.substring(start,end).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(match){var len=match[0].length;domBuilder.processingInstruction(match[1],match[2]);return end+2}else{return-1}}return-1}function ElementAttributes(source){}ElementAttributes.prototype={setTagName:function(tagName){if(!tagNamePattern.test(tagName)){throw new Error("invalid tagName:"+tagName)}this.tagName=tagName},add:function(qName,value,offset){if(!tagNamePattern.test(qName)){throw new Error("invalid attribute:"+qName)
}this[this.length++]={qName:qName,value:value,offset:offset}},length:0,getLocalName:function(i){return this[i].localName},getOffset:function(i){return this[i].offset},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}};function _set_proto_(thiz,parent){thiz.__proto__=parent;return thiz}if(!(_set_proto_({},_set_proto_.prototype)instanceof _set_proto_)){_set_proto_=function(thiz,parent){function p(){}p.prototype=parent;p=new p;for(parent in thiz){p[parent]=thiz[parent]}return p}}function split(source,start){var match;var buf=[];var reg=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;reg.lastIndex=start;reg.exec(source);while(match=reg.exec(source)){buf.push(match);if(match[1])return buf}}if(typeof require=="function"){exports.XMLReader=XMLReader}if(typeof require=="function"){exports.XMLReader=XMLReader}},{}],98:[function(require,module,exports){var XsdString="http://www.w3.org/2001/XMLSchema#string";var RdfLangString="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString";var N3Util={isUri:function(entity){if(!entity)return entity;var firstChar=entity[0];return firstChar!=='"'&&firstChar!=="_"},isLiteral:function(entity){return entity&&entity[0]==='"'},isBlank:function(entity){return entity&&entity.substr(0,2)==="_:"},getLiteralValue:function(literal){var match=/^"((?:.|\n|\r)*)"/.exec(literal);if(!match)throw new Error(literal+" is not a literal");return match[1]},getLiteralType:function(literal){var match=/^"(?:.|\n|\r)*"(?:\^\^<(.+)>|(@)[\-a-z]+)?$/i.exec(literal);if(!match)throw new Error(literal+" is not a literal");return match[1]||(match[2]?RdfLangString:XsdString)},getLiteralLanguage:function(literal){var match=/^"(?:.|\n|\r)*"(?:@([\-a-z]+)|\^\^<.+>)?$/i.exec(literal);if(!match)throw new Error(literal+" is not a literal");return match[1]?match[1].toLowerCase():""},isQName:function(entity){return entity&&/^[^:\/]*:[^:\/]+$/.test(entity)},expandQName:function(qname,prefixes){var parts=/^([^:\/]*):([^:\/]+)$/.exec(qname);if(!parts)throw new Error(qname+" is not a QName");var prefix=parts[1];if(!(prefix in prefixes))throw new Error("Unknown prefix: "+prefix);return prefixes[prefix]+parts[2]}};function AddN3Util(parent,toPrototype){for(var name in N3Util)if(!toPrototype)parent[name]=N3Util[name];else parent.prototype[name]=ApplyToThis(N3Util[name]);return parent}function ApplyToThis(f){return function(a){return f(this,a)}}module.exports=AddN3Util(AddN3Util)},{}],99:[function(require,module,exports){var global=typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};var rng;if(global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}module.exports=rng},{}],100:[function(require,module,exports){var Buffer=require("__browserify_Buffer");var _rng=require("./rng");var BufferClass=typeof Buffer=="function"?Buffer:Array;var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16){buf[i+ii++]=_hexToByte[oct]}});while(ii<16){buf[i+ii++]=0}return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!==undefined?options.clockseq:_clockseq;var msecs=options.msecs!==undefined?options.msecs:(new Date).getTime();var nsecs=options.nsecs!==undefined?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===undefined){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs===undefined){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;n++){b[i+n]=node[n]}return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new BufferClass(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;ii++){buf[i+ii]=rnds[ii]}}return buf||unparse(rnds)}var uuid=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;uuid.unparse=unparse;uuid.BufferClass=BufferClass;module.exports=uuid},{"./rng":99,__browserify_Buffer:19}]},{},[1])(1)});